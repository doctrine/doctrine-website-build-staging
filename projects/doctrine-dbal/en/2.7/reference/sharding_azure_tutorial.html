<!DOCTYPE html>
<html>
    <head>
        <title>SQLAzure Sharding Tutorial - Database Abstraction Layer (DBAL) - Doctrine</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Database Abstraction Layer Documentation: SQLAzure Sharding Tutorial ">

        <meta name="keywords" content="php,mysql,pgsql,dbal,database,abstraction,documentation,sqlazure,sharding,tutorial">

                    <meta name="robots" content="noindex">
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine-dbal/en/2.7/reference/sharding_azure_tutorial.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?87bf05" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine-dbal/en/2.7/reference/sharding_azure_tutorial.html" />
        <meta property="og:title" content="SQLAzure Sharding Tutorial - Database Abstraction Layer (DBAL) - Doctrine" />
        <meta property="og:description" content="Doctrine Database Abstraction Layer Documentation: SQLAzure Sharding Tutorial " />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine Database Abstraction Layer",
            "description": "SQLAzure Sharding Tutorial",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="index-html-welcome-to-doctrine-dbal-s-documentation" class="toc-item"><a href="../index.html#welcome-to-doctrine-dbal-s-documentation">Welcome to Doctrine DBAL's documentation!</a></li><li id="index-html-indices-and-tables" class="toc-item"><a href="../index.html#indices-and-tables">Indices and tables</a></li><li id="architecture-html-architecture" class="toc-item"><a href="architecture.html#architecture">Architecture</a></li><ul><li id="architecture-html-drivers" class="toc-item"><a href="architecture.html#drivers">Drivers</a></li><li id="architecture-html-platforms" class="toc-item"><a href="architecture.html#platforms">Platforms</a></li><li id="architecture-html-logging" class="toc-item"><a href="architecture.html#logging">Logging</a></li><li id="architecture-html-schema" class="toc-item"><a href="architecture.html#schema">Schema</a></li><li id="architecture-html-types" class="toc-item"><a href="architecture.html#types">Types</a></li></ul><li id="caching-html-caching" class="toc-item"><a href="caching.html#caching">Caching</a></li><li id="configuration-html-configuration" class="toc-item"><a href="configuration.html#configuration">Configuration</a></li><ul><li id="configuration-html-getting-a-connection" class="toc-item"><a href="configuration.html#getting-a-connection">Getting a Connection</a></li><ul><li id="configuration-html-connecting-using-a-url" class="toc-item"><a href="configuration.html#connecting-using-a-url">Connecting using a URL</a></li><li id="configuration-html-driver" class="toc-item"><a href="configuration.html#driver">Driver</a></li><li id="configuration-html-wrapper-class" class="toc-item"><a href="configuration.html#wrapper-class">Wrapper Class</a></li><li id="configuration-html-connection-details" class="toc-item"><a href="configuration.html#connection-details">Connection Details</a></li><ul></ul><li id="configuration-html-automatic-platform-version-detection" class="toc-item"><a href="configuration.html#automatic-platform-version-detection">Automatic platform version detection</a></li><li id="configuration-html-custom-platform" class="toc-item"><a href="configuration.html#custom-platform">Custom Platform</a></li><li id="configuration-html-custom-driver-options" class="toc-item"><a href="configuration.html#custom-driver-options">Custom Driver Options</a></li></ul></ul><li id="data-retrieval-and-manipulation-html-data-retrieval-and-manipulation" class="toc-item"><a href="data-retrieval-and-manipulation.html#data-retrieval-and-manipulation">Data Retrieval And Manipulation</a></li><ul><li id="data-retrieval-and-manipulation-html-data-retrieval" class="toc-item"><a href="data-retrieval-and-manipulation.html#data-retrieval">Data Retrieval</a></li><ul><li id="data-retrieval-and-manipulation-html-dynamic-parameters-and-prepared-statements" class="toc-item"><a href="data-retrieval-and-manipulation.html#dynamic-parameters-and-prepared-statements">Dynamic Parameters and Prepared Statements</a></li><li id="data-retrieval-and-manipulation-html-using-prepared-statements" class="toc-item"><a href="data-retrieval-and-manipulation.html#using-prepared-statements">Using Prepared Statements</a></li></ul><li id="data-retrieval-and-manipulation-html-binding-types" class="toc-item"><a href="data-retrieval-and-manipulation.html#binding-types">Binding Types</a></li><ul><li id="data-retrieval-and-manipulation-html-doctrine-dbal-types-conversion" class="toc-item"><a href="data-retrieval-and-manipulation.html#doctrine-dbal-types-conversion">Doctrine\DBAL\Types Conversion</a></li><li id="data-retrieval-and-manipulation-html-list-of-parameters-conversion" class="toc-item"><a href="data-retrieval-and-manipulation.html#list-of-parameters-conversion">List of Parameters Conversion</a></li></ul><li id="data-retrieval-and-manipulation-html-api" class="toc-item"><a href="data-retrieval-and-manipulation.html#api">API</a></li><ul><li id="data-retrieval-and-manipulation-html-prepare" class="toc-item"><a href="data-retrieval-and-manipulation.html#prepare">prepare()</a></li><li id="data-retrieval-and-manipulation-html-executeupdate" class="toc-item"><a href="data-retrieval-and-manipulation.html#executeupdate">executeUpdate()</a></li><li id="data-retrieval-and-manipulation-html-executequery" class="toc-item"><a href="data-retrieval-and-manipulation.html#executequery">executeQuery()</a></li><li id="data-retrieval-and-manipulation-html-fetchall" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchall">fetchAll()</a></li><li id="data-retrieval-and-manipulation-html-fetcharray" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetcharray">fetchArray()</a></li><li id="data-retrieval-and-manipulation-html-fetchcolumn" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchcolumn">fetchColumn()</a></li><li id="data-retrieval-and-manipulation-html-fetchassoc" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchassoc">fetchAssoc()</a></li><li id="data-retrieval-and-manipulation-html-delete" class="toc-item"><a href="data-retrieval-and-manipulation.html#delete">delete()</a></li><li id="data-retrieval-and-manipulation-html-insert" class="toc-item"><a href="data-retrieval-and-manipulation.html#insert">insert()</a></li><li id="data-retrieval-and-manipulation-html-update" class="toc-item"><a href="data-retrieval-and-manipulation.html#update">update()</a></li><li id="data-retrieval-and-manipulation-html-quote" class="toc-item"><a href="data-retrieval-and-manipulation.html#quote">quote()</a></li><li id="data-retrieval-and-manipulation-html-quoteidentifier" class="toc-item"><a href="data-retrieval-and-manipulation.html#quoteidentifier">quoteIdentifier()</a></li></ul></ul><li id="events-html-events" class="toc-item"><a href="events.html#events">Events</a></li><ul><li id="events-html-postconnect-event" class="toc-item"><a href="events.html#postconnect-event">PostConnect Event</a></li><li id="events-html-schema-events" class="toc-item"><a href="events.html#schema-events">Schema Events</a></li><ul><li id="events-html-onschemacreatetable-event" class="toc-item"><a href="events.html#onschemacreatetable-event">OnSchemaCreateTable Event</a></li><li id="events-html-onschemacreatetablecolumn-event" class="toc-item"><a href="events.html#onschemacreatetablecolumn-event">OnSchemaCreateTableColumn Event</a></li><li id="events-html-onschemadroptable-event" class="toc-item"><a href="events.html#onschemadroptable-event">OnSchemaDropTable Event</a></li><li id="events-html-onschemaaltertable-event" class="toc-item"><a href="events.html#onschemaaltertable-event">OnSchemaAlterTable Event</a></li><li id="events-html-onschemaaltertableaddcolumn-event" class="toc-item"><a href="events.html#onschemaaltertableaddcolumn-event">OnSchemaAlterTableAddColumn Event</a></li><li id="events-html-onschemaaltertableremovecolumn-event" class="toc-item"><a href="events.html#onschemaaltertableremovecolumn-event">OnSchemaAlterTableRemoveColumn Event</a></li><li id="events-html-onschemaaltertablechangecolumn-event" class="toc-item"><a href="events.html#onschemaaltertablechangecolumn-event">OnSchemaAlterTableChangeColumn Event</a></li><li id="events-html-onschemaaltertablerenamecolumn-event" class="toc-item"><a href="events.html#onschemaaltertablerenamecolumn-event">OnSchemaAlterTableRenameColumn Event</a></li><li id="events-html-onschemacolumndefinition-event" class="toc-item"><a href="events.html#onschemacolumndefinition-event">OnSchemaColumnDefinition Event</a></li><li id="events-html-onschemaindexdefinition-event" class="toc-item"><a href="events.html#onschemaindexdefinition-event">OnSchemaIndexDefinition Event</a></li></ul></ul><li id="introduction-html-introduction" class="toc-item"><a href="introduction.html#introduction">Introduction</a></li><li id="known-vendor-issues-html-known-vendor-issues" class="toc-item"><a href="known-vendor-issues.html#known-vendor-issues">Known Vendor Issues</a></li><ul><li id="known-vendor-issues-html-postgresql" class="toc-item"><a href="known-vendor-issues.html#postgresql">PostgreSQL</a></li><ul><li id="known-vendor-issues-html-datetime-datetimetz-and-time-types" class="toc-item"><a href="known-vendor-issues.html#datetime-datetimetz-and-time-types">DateTime, DateTimeTz and Time Types</a></li><li id="known-vendor-issues-html-timezones-and-datetimetz" class="toc-item"><a href="known-vendor-issues.html#timezones-and-datetimetz">Timezones and DateTimeTz</a></li></ul><li id="known-vendor-issues-html-mysql" class="toc-item"><a href="known-vendor-issues.html#mysql">MySQL</a></li><ul><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li></ul><li id="known-vendor-issues-html-sqlite" class="toc-item"><a href="known-vendor-issues.html#sqlite">Sqlite</a></li><ul><li id="known-vendor-issues-html-buffered-queries-and-isolation" class="toc-item"><a href="known-vendor-issues.html#buffered-queries-and-isolation">Buffered Queries and Isolation</a></li><li id="known-vendor-issues-html-datetime" class="toc-item"><a href="known-vendor-issues.html#datetime">DateTime</a></li><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li><li id="known-vendor-issues-html-reverse-engineering-primary-key-order" class="toc-item"><a href="known-vendor-issues.html#reverse-engineering-primary-key-order">Reverse engineering primary key order</a></li></ul><li id="known-vendor-issues-html-ibm-db2" class="toc-item"><a href="known-vendor-issues.html#ibm-db2">IBM DB2</a></li><ul><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li></ul><li id="known-vendor-issues-html-oracle" class="toc-item"><a href="known-vendor-issues.html#oracle">Oracle</a></li><ul><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li><li id="known-vendor-issues-html-oci-lob-instances" class="toc-item"><a href="known-vendor-issues.html#oci-lob-instances">OCI-LOB instances</a></li></ul><li id="known-vendor-issues-html-microsoft-sql-server" class="toc-item"><a href="known-vendor-issues.html#microsoft-sql-server">Microsoft SQL Server</a></li><ul><li id="known-vendor-issues-html-unique-and-null" class="toc-item"><a href="known-vendor-issues.html#unique-and-null">Unique and NULL</a></li><li id="known-vendor-issues-html-datetime-datetimetz-and-time-types" class="toc-item"><a href="known-vendor-issues.html#datetime-datetimetz-and-time-types">DateTime, DateTimeTz and Time Types</a></li><li id="known-vendor-issues-html-pdo-sqlsrv-varbinary-blob-columns" class="toc-item"><a href="known-vendor-issues.html#pdo-sqlsrv-varbinary-blob-columns">PDO_SQLSRV: VARBINARY/BLOB columns</a></li></ul></ul><li id="platforms-html-platforms" class="toc-item"><a href="platforms.html#platforms">Platforms</a></li><ul><li id="platforms-html-mysql" class="toc-item"><a href="platforms.html#mysql">MySQL</a></li><li id="platforms-html-oracle" class="toc-item"><a href="platforms.html#oracle">Oracle</a></li><li id="platforms-html-microsoft-sql-server" class="toc-item"><a href="platforms.html#microsoft-sql-server">Microsoft SQL Server</a></li><li id="platforms-html-postgresql" class="toc-item"><a href="platforms.html#postgresql">PostgreSQL</a></li><li id="platforms-html-sap-sybase-sql-anywhere" class="toc-item"><a href="platforms.html#sap-sybase-sql-anywhere">SAP Sybase SQL Anywhere</a></li><li id="platforms-html-sqlite" class="toc-item"><a href="platforms.html#sqlite">SQLite</a></li><li id="platforms-html-drizzle" class="toc-item"><a href="platforms.html#drizzle">Drizzle</a></li></ul><li id="portability-html-portability" class="toc-item"><a href="portability.html#portability">Portability</a></li><ul><li id="portability-html-connection-wrapper" class="toc-item"><a href="portability.html#connection-wrapper">Connection Wrapper</a></li><li id="portability-html-database-platform" class="toc-item"><a href="portability.html#database-platform">Database Platform</a></li><li id="portability-html-keyword-lists" class="toc-item"><a href="portability.html#keyword-lists">Keyword Lists</a></li></ul><li id="query-builder-html-sql-query-builder" class="toc-item"><a href="query-builder.html#sql-query-builder">SQL Query Builder</a></li><ul><li id="query-builder-html-security-safely-preventing-sql-injection" class="toc-item"><a href="query-builder.html#security-safely-preventing-sql-injection">Security: Safely preventing SQL Injection</a></li><li id="query-builder-html-building-a-query" class="toc-item"><a href="query-builder.html#building-a-query">Building a Query</a></li><ul><li id="query-builder-html-where-clause" class="toc-item"><a href="query-builder.html#where-clause">WHERE-Clause</a></li><li id="query-builder-html-table-alias" class="toc-item"><a href="query-builder.html#table-alias">Table alias</a></li><li id="query-builder-html-group-by-and-having-clause" class="toc-item"><a href="query-builder.html#group-by-and-having-clause">GROUP BY and HAVING Clause</a></li><li id="query-builder-html-join-clauses" class="toc-item"><a href="query-builder.html#join-clauses">Join Clauses</a></li><li id="query-builder-html-order-by-clause" class="toc-item"><a href="query-builder.html#order-by-clause">Order-By Clause</a></li><li id="query-builder-html-limit-clause" class="toc-item"><a href="query-builder.html#limit-clause">Limit Clause</a></li><li id="query-builder-html-values-clause" class="toc-item"><a href="query-builder.html#values-clause">VALUES Clause</a></li><li id="query-builder-html-set-clause" class="toc-item"><a href="query-builder.html#set-clause">Set Clause</a></li></ul><li id="query-builder-html-building-expressions" class="toc-item"><a href="query-builder.html#building-expressions">Building Expressions</a></li><li id="query-builder-html-binding-parameters-to-placeholders" class="toc-item"><a href="query-builder.html#binding-parameters-to-placeholders">Binding Parameters to Placeholders</a></li></ul><li id="schema-manager-html-schema-manager" class="toc-item"><a href="schema-manager.html#schema-manager">Schema-Manager</a></li><ul><li id="schema-manager-html-listdatabases" class="toc-item"><a href="schema-manager.html#listdatabases">listDatabases()</a></li><li id="schema-manager-html-listsequences" class="toc-item"><a href="schema-manager.html#listsequences">listSequences()</a></li><li id="schema-manager-html-listtablecolumns" class="toc-item"><a href="schema-manager.html#listtablecolumns">listTableColumns()</a></li><li id="schema-manager-html-listtabledetails" class="toc-item"><a href="schema-manager.html#listtabledetails">listTableDetails()</a></li><li id="schema-manager-html-listtableforeignkeys" class="toc-item"><a href="schema-manager.html#listtableforeignkeys">listTableForeignKeys()</a></li><li id="schema-manager-html-listtableindexes" class="toc-item"><a href="schema-manager.html#listtableindexes">listTableIndexes()</a></li><li id="schema-manager-html-listtables" class="toc-item"><a href="schema-manager.html#listtables">listTables()</a></li><li id="schema-manager-html-listviews" class="toc-item"><a href="schema-manager.html#listviews">listViews()</a></li><li id="schema-manager-html-createschema" class="toc-item"><a href="schema-manager.html#createschema">createSchema()</a></li></ul><li id="schema-representation-html-schema-representation" class="toc-item"><a href="schema-representation.html#schema-representation">Schema-Representation</a></li><ul><li id="schema-representation-html-schema-assets" class="toc-item"><a href="schema-representation.html#schema-assets">Schema Assets</a></li><ul><li id="schema-representation-html-column" class="toc-item"><a href="schema-representation.html#column">Column</a></li><ul></ul></ul></ul><li id="security-html-security" class="toc-item"><a href="security.html#security">Security</a></li><ul><li id="security-html-sql-injection-safe-and-unsafe-apis-for-user-input" class="toc-item"><a href="security.html#sql-injection-safe-and-unsafe-apis-for-user-input">SQL Injection: Safe and Unsafe APIs for User Input</a></li><li id="security-html-user-input-in-your-queries" class="toc-item"><a href="security.html#user-input-in-your-queries">User input in your queries</a></li><ul><li id="security-html-wrong-string-concatenation" class="toc-item"><a href="security.html#wrong-string-concatenation">Wrong: String Concatenation</a></li><li id="security-html-right-prepared-statements" class="toc-item"><a href="security.html#right-prepared-statements">Right: Prepared Statements</a></li><li id="security-html-right-quoting-escaping-values" class="toc-item"><a href="security.html#right-quoting-escaping-values">Right: Quoting/Escaping values</a></li></ul></ul><li id="sharding-html-sharding" class="toc-item"><a href="sharding.html#sharding">Sharding</a></li><ul><li id="sharding-html-id-generation" class="toc-item"><a href="sharding.html#id-generation">ID Generation</a></li><ul><li id="sharding-html-use-guid-uuids" class="toc-item"><a href="sharding.html#use-guid-uuids">Use GUID/UUIDs</a></li><li id="sharding-html-table-generator" class="toc-item"><a href="sharding.html#table-generator">Table Generator</a></li><li id="sharding-html-natural-identifiers" class="toc-item"><a href="sharding.html#natural-identifiers">Natural Identifiers</a></li></ul><li id="sharding-html-transactions" class="toc-item"><a href="sharding.html#transactions">Transactions</a></li><li id="sharding-html-foreign-keys" class="toc-item"><a href="sharding.html#foreign-keys">Foreign Keys</a></li><li id="sharding-html-complex-queries" class="toc-item"><a href="sharding.html#complex-queries">Complex Queries</a></li><li id="sharding-html-shardmanager-interface" class="toc-item"><a href="sharding.html#shardmanager-interface">ShardManager Interface</a></li><li id="sharding-html-schema-operations-schemasynchronizer-interface" class="toc-item"><a href="sharding.html#schema-operations-schemasynchronizer-interface">Schema Operations: SchemaSynchronizer Interface</a></li><li id="sharding-html-sql-azure-federations" class="toc-item"><a href="sharding.html#sql-azure-federations">SQL Azure Federations</a></li><ul><li id="sharding-html-schema-operations" class="toc-item"><a href="sharding.html#schema-operations">Schema Operations</a></li><li id="sharding-html-sqlazure-filtering" class="toc-item"><a href="sharding.html#sqlazure-filtering">SQLAzure Filtering</a></li></ul><li id="sharding-html-generic-sql-sharding-support" class="toc-item"><a href="sharding.html#generic-sql-sharding-support">Generic SQL Sharding Support</a></li></ul><li id="sharding_azure_tutorial-html-sqlazure-sharding-tutorial" class="toc-item"><a href="sharding_azure_tutorial.html#sqlazure-sharding-tutorial">SQLAzure Sharding Tutorial</a></li><ul><li id="sharding_azure_tutorial-html-install-doctrine" class="toc-item"><a href="sharding_azure_tutorial.html#install-doctrine">Install Doctrine</a></li><li id="sharding_azure_tutorial-html-setup-connection" class="toc-item"><a href="sharding_azure_tutorial.html#setup-connection">Setup Connection</a></li><li id="sharding_azure_tutorial-html-create-database" class="toc-item"><a href="sharding_azure_tutorial.html#create-database">Create Database</a></li><li id="sharding_azure_tutorial-html-create-schema" class="toc-item"><a href="sharding_azure_tutorial.html#create-schema">Create Schema</a></li><li id="sharding_azure_tutorial-html-view-federation-members" class="toc-item"><a href="sharding_azure_tutorial.html#view-federation-members">View Federation Members</a></li><li id="sharding_azure_tutorial-html-insert-data" class="toc-item"><a href="sharding_azure_tutorial.html#insert-data">Insert Data</a></li><li id="sharding_azure_tutorial-html-split-federation" class="toc-item"><a href="sharding_azure_tutorial.html#split-federation">Split Federation</a></li><li id="sharding_azure_tutorial-html-inserting-data-after-split" class="toc-item"><a href="sharding_azure_tutorial.html#inserting-data-after-split">Inserting Data after Split</a></li><li id="sharding_azure_tutorial-html-querying-data-with-filtering-off" class="toc-item"><a href="sharding_azure_tutorial.html#querying-data-with-filtering-off">Querying data with filtering off</a></li><li id="sharding_azure_tutorial-html-querying-data-with-filtering-on" class="toc-item"><a href="sharding_azure_tutorial.html#querying-data-with-filtering-on">Querying data with filtering on</a></li></ul><li id="supporting-other-databases-html-supporting-other-databases" class="toc-item"><a href="supporting-other-databases.html#supporting-other-databases">Supporting Other Databases</a></li><ul><li id="supporting-other-databases-html-implementation-steps-in-detail" class="toc-item"><a href="supporting-other-databases.html#implementation-steps-in-detail">Implementation Steps in Detail</a></li></ul><li id="transactions-html-transactions" class="toc-item"><a href="transactions.html#transactions">Transactions</a></li><ul><li id="transactions-html-transaction-nesting" class="toc-item"><a href="transactions.html#transaction-nesting">Transaction Nesting</a></li><li id="transactions-html-auto-commit-mode" class="toc-item"><a href="transactions.html#auto-commit-mode">Auto-commit mode</a></li><li id="transactions-html-error-handling" class="toc-item"><a href="transactions.html#error-handling">Error handling</a></li></ul><li id="types-html-types" class="toc-item"><a href="types.html#types">Types</a></li><ul><li id="types-html-reference" class="toc-item"><a href="types.html#reference">Reference</a></li><ul><li id="types-html-numeric-types" class="toc-item"><a href="types.html#numeric-types">Numeric types</a></li><ul></ul><li id="types-html-string-types" class="toc-item"><a href="types.html#string-types">String types</a></li><ul></ul><li id="types-html-bit-types" class="toc-item"><a href="types.html#bit-types">Bit types</a></li><ul></ul><li id="types-html-date-and-time-types" class="toc-item"><a href="types.html#date-and-time-types">Date and time types</a></li><ul></ul><li id="types-html-array-types" class="toc-item"><a href="types.html#array-types">Array types</a></li><ul></ul><li id="types-html-object-types" class="toc-item"><a href="types.html#object-types">Object types</a></li><ul></ul></ul><li id="types-html-mapping-matrix" class="toc-item"><a href="types.html#mapping-matrix">Mapping Matrix</a></li><li id="types-html-detection-of-database-types" class="toc-item"><a href="types.html#detection-of-database-types">Detection of Database Types</a></li><li id="types-html-custom-mapping-types" class="toc-item"><a href="types.html#custom-mapping-types">Custom Mapping Types</a></li></ul><li id="upgrading-html-upgrading" class="toc-item"><a href="upgrading.html#upgrading">Upgrading</a></li><ul><li id="upgrading-html-deprecations" class="toc-item"><a href="upgrading.html#deprecations">Deprecations</a></li></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine-dbal/en/2.7/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">SQLAzure Sharding Tutorial</li>
                            </ol>
                        </nav>
                                    </div>

                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-dbal/en/2.7/reference/sharding_azure_tutorial.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        2.7
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                            
                                                <a class="project-version-switcher dropdown-item" href="/projects/doctrine-dbal/en/latest/reference/sharding_azure_tutorial.html">
                                                    3.0

                                                    
                                                                                                            (upcoming)
                                                                                                    </a>
                                                                                            
                                                <a class="project-version-switcher dropdown-item" href="/projects/doctrine-dbal/en/2.8/reference/sharding_azure_tutorial.html">
                                                    2.8

                                                    
                                                                                                            (upcoming)
                                                                                                    </a>
                                                                                            
                                                <a class="project-version-switcher dropdown-item active" href="/projects/doctrine-dbal/en/2.7/reference/sharding_azure_tutorial.html">
                                                    2.7

                                                                                                            (current)
                                                    
                                                                                                    </a>
                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                            
                                                <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.6/reference/sharding_azure_tutorial.html">2.6</a>
                                                                                            
                                                <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.5/reference/sharding_azure_tutorial.html">2.5</a>
                                                                                                                        </div>
                                </div>

                                <a href="https://github.com/doctrine/dbal/edit/2.7/docs/en/reference/sharding_azure_tutorial.rst" class="btn btn-primary btn-sm">Edit</a>
                            
                            
<p></p>
<a class="section-anchor" id="sqlazure-sharding-tutorial" name="sqlazure-sharding-tutorial"></a><h1 class="section-header"><a href="#sqlazure-sharding-tutorial">SQLAzure Sharding Tutorial<i class="fas fa-link"></i></a></h1>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>The sharding extension is currently in transition from a separate Project
into DBAL. Class names may differ.</p>
</div>
<p>This tutorial builds upon the <a href="#brian-swans-tutorial-http-blogs-msdn-com-b-silverlining-archive-2012-01-18-using-sql-azure-federations-via-php-aspx">Brian Swans tutorial
&lt;http://blogs.msdn.com/b/silverlining/archive/2012/01/18/using-sql-azure-federations-via-php.aspx&gt;</a>
on SQLAzure Sharding and turns all the examples into examples using the Doctrine Sharding support.</p>
<p>It introduces SQL Azure Sharding, which is an abstraction layer in SQL Azure to
support sharding. Many features for sharding are implemented on the database
level, which makes it much easier to work with than generic sharding
implementations.</p>
<p>For this tutorial you need an Azure account. You don't need to deploy the code
on Azure, you can run it from your own machine against the remote database.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>You can look at the code from the 'examples/sharding' directory.</p>
</div>
<a class="section-anchor" id="install-doctrine" name="install-doctrine"></a><h2 class="section-header"><a href="#install-doctrine">Install Doctrine<i class="fas fa-link"></i></a></h2>
<p>For this tutorial we will install Doctrine and the Sharding Extension through
<a href="http://getcomposer.org">Composer</a> which is the easiest way to install
Doctrine. Composer is a new package manager for PHP. Download the
<code>composer.phar</code> from their website and put it into a newly created folder for
this tutorial. Now create a <code>composer.json</code> file in this project root with
the following content:</p>
<blockquote><p>{
    &quot;require&quot;: {
        &quot;doctrine/dbal&quot;: &quot;2.2.2&quot;,
        &quot;doctrine/shards&quot;: &quot;0.2&quot;
    }
}</p>
</blockquote>
<p>Open up the commandline and switch to your tutorial root directory, then call
<code>php composer.phar install</code>. It will grab the code and install it into the
<code>vendor</code> subdirectory of your project. It also creates an autoloader, so that
we don't have to care about this.</p>
<a class="section-anchor" id="setup-connection" name="setup-connection"></a><h2 class="section-header"><a href="#setup-connection">Setup Connection<i class="fas fa-link"></i></a></h2>
<p>The first thing to start with is setting up Doctrine and the database connection:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="d73c1faf5caa315c33be87e5a001d0bb5d38ab42"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="d73c1faf5caa315c33be87e5a001d0bb5d38ab42"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// bootstrap.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">DriverManager</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Shards</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">SQLAzure</span>\<span class="hljs-title">SQLAzureShardManager</span>;
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">"vendor/autoload.php"</span>;
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">$conn = DriverManager::getConnection(<span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">9</td><td class="code-line">    <span class="hljs-string">'driver'</span>   =&gt; <span class="hljs-string">'pdo_sqlsrv'</span>,
</td></tr><tr><td class="line-number noselect">10</td><td class="code-line">    <span class="hljs-string">'dbname'</span>   =&gt; <span class="hljs-string">'SalesDB'</span>,
</td></tr><tr><td class="line-number noselect">11</td><td class="code-line">    <span class="hljs-string">'host'</span>     =&gt; <span class="hljs-string">'tcp:dbname.windows.net'</span>,
</td></tr><tr><td class="line-number noselect">12</td><td class="code-line">    <span class="hljs-string">'user'</span>     =&gt; <span class="hljs-string">'user@dbname'</span>,
</td></tr><tr><td class="line-number noselect">13</td><td class="code-line">    <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'XXX'</span>,
</td></tr><tr><td class="line-number noselect">14</td><td class="code-line">    <span class="hljs-string">'platform'</span>       =&gt; <span class="hljs-keyword">new</span> \Doctrine\DBAL\Platforms\SQLAzurePlatform(),
</td></tr><tr><td class="line-number noselect">15</td><td class="code-line">    <span class="hljs-string">'driverOptions'</span>  =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'MultipleActiveResultSets'</span> =&gt; <span class="hljs-keyword">false</span>),
</td></tr><tr><td class="line-number noselect">16</td><td class="code-line">    <span class="hljs-string">'sharding'</span> =&gt; <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">17</td><td class="code-line">        <span class="hljs-string">'federationName'</span>   =&gt; <span class="hljs-string">'Orders_Federation'</span>,
</td></tr><tr><td class="line-number noselect">18</td><td class="code-line">        <span class="hljs-string">'distributionKey'</span>  =&gt; <span class="hljs-string">'CustId'</span>,
</td></tr><tr><td class="line-number noselect">19</td><td class="code-line">        <span class="hljs-string">'distributionType'</span> =&gt; <span class="hljs-string">'integer'</span>,
</td></tr><tr><td class="line-number noselect">20</td><td class="code-line">    )
</td></tr><tr><td class="line-number noselect">21</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">22</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">23</td><td class="code-line">$shardManager = <span class="hljs-keyword">new</span> SQLAzureShardManager($conn);
</td></tr></table></div></code></pre>
<a class="section-anchor" id="create-database" name="create-database"></a><h2 class="section-header"><a href="#create-database">Create Database<i class="fas fa-link"></i></a></h2>
<p>Create a new database using the Azure/SQL Azure management console.</p>
<a class="section-anchor" id="create-schema" name="create-schema"></a><h2 class="section-header"><a href="#create-schema">Create Schema<i class="fas fa-link"></i></a></h2>
<p>Doctrine has a powerful schema API. We don't need to use low-level DDL
statements to generate the database schema. Instead you can use an Object-Oriented API
to create the database schema and then have Doctrine turn it into DDL
statements.</p>
<p>We will recreate Brians example schema with Doctrine DBAL. Instead of having to
create federations and schema separately as in his example, Doctrine will do it
all in one step:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="8e2ba894c32eb564508933a2073309831b681bee"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="8e2ba894c32eb564508933a2073309831b681bee"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// create_schema.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Schema</span>\<span class="hljs-title">Schema</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Shards</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">SQLAzure</span>\<span class="hljs-title">SQLAzureSchemaSynchronizer</span>;
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">'bootstrap.php'</span>;
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">$schema = <span class="hljs-keyword">new</span> Schema();
</td></tr><tr><td class="line-number noselect">9</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">10</td><td class="code-line">$products = $schema-&gt;createTable(<span class="hljs-string">'Products'</span>);
</td></tr><tr><td class="line-number noselect">11</td><td class="code-line">$products-&gt;addColumn(<span class="hljs-string">'ProductID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">12</td><td class="code-line">$products-&gt;addColumn(<span class="hljs-string">'SupplierID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">13</td><td class="code-line">$products-&gt;addColumn(<span class="hljs-string">'ProductName'</span>, <span class="hljs-string">'string'</span>);
</td></tr><tr><td class="line-number noselect">14</td><td class="code-line">$products-&gt;addColumn(<span class="hljs-string">'Price'</span>, <span class="hljs-string">'decimal'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'scale'</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">'precision'</span> =&gt; <span class="hljs-number">12</span>));
</td></tr><tr><td class="line-number noselect">15</td><td class="code-line">$products-&gt;setPrimaryKey(<span class="hljs-keyword">array</span>(<span class="hljs-string">'ProductID'</span>));
</td></tr><tr><td class="line-number noselect">16</td><td class="code-line">$products-&gt;addOption(<span class="hljs-string">'azure.federated'</span>, <span class="hljs-keyword">true</span>);
</td></tr><tr><td class="line-number noselect">17</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">18</td><td class="code-line">$customers = $schema-&gt;createTable(<span class="hljs-string">'Customers'</span>);
</td></tr><tr><td class="line-number noselect">19</td><td class="code-line">$customers-&gt;addColumn(<span class="hljs-string">'CustomerID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">20</td><td class="code-line">$customers-&gt;addColumn(<span class="hljs-string">'CompanyName'</span>, <span class="hljs-string">'string'</span>);
</td></tr><tr><td class="line-number noselect">21</td><td class="code-line">$customers-&gt;addColumn(<span class="hljs-string">'FirstName'</span>, <span class="hljs-string">'string'</span>);
</td></tr><tr><td class="line-number noselect">22</td><td class="code-line">$customers-&gt;addColumn(<span class="hljs-string">'LastName'</span>, <span class="hljs-string">'string'</span>);
</td></tr><tr><td class="line-number noselect">23</td><td class="code-line">$customers-&gt;setPrimaryKey(<span class="hljs-keyword">array</span>(<span class="hljs-string">'CustomerID'</span>));
</td></tr><tr><td class="line-number noselect">24</td><td class="code-line">$customers-&gt;addOption(<span class="hljs-string">'azure.federated'</span>, <span class="hljs-keyword">true</span>);
</td></tr><tr><td class="line-number noselect">25</td><td class="code-line">$customers-&gt;addOption(<span class="hljs-string">'azure.federatedOnColumnName'</span>, <span class="hljs-string">'CustomerID'</span>);
</td></tr><tr><td class="line-number noselect">26</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">27</td><td class="code-line">$orders = $schema-&gt;createTable(<span class="hljs-string">'Orders'</span>);
</td></tr><tr><td class="line-number noselect">28</td><td class="code-line">$orders-&gt;addColumn(<span class="hljs-string">'CustomerID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">29</td><td class="code-line">$orders-&gt;addColumn(<span class="hljs-string">'OrderID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">30</td><td class="code-line">$orders-&gt;addColumn(<span class="hljs-string">'OrderDate'</span>, <span class="hljs-string">'datetime'</span>);
</td></tr><tr><td class="line-number noselect">31</td><td class="code-line">$orders-&gt;setPrimaryKey(<span class="hljs-keyword">array</span>(<span class="hljs-string">'CustomerID'</span>, <span class="hljs-string">'OrderID'</span>));
</td></tr><tr><td class="line-number noselect">32</td><td class="code-line">$orders-&gt;addOption(<span class="hljs-string">'azure.federated'</span>, <span class="hljs-keyword">true</span>);
</td></tr><tr><td class="line-number noselect">33</td><td class="code-line">$orders-&gt;addOption(<span class="hljs-string">'azure.federatedOnColumnName'</span>, <span class="hljs-string">'CustomerID'</span>);
</td></tr><tr><td class="line-number noselect">34</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">35</td><td class="code-line">$orderItems = $schema-&gt;createTable(<span class="hljs-string">'OrderItems'</span>);
</td></tr><tr><td class="line-number noselect">36</td><td class="code-line">$orderItems-&gt;addColumn(<span class="hljs-string">'CustomerID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">37</td><td class="code-line">$orderItems-&gt;addColumn(<span class="hljs-string">'OrderID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">38</td><td class="code-line">$orderItems-&gt;addColumn(<span class="hljs-string">'ProductID'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">39</td><td class="code-line">$orderItems-&gt;addColumn(<span class="hljs-string">'Quantity'</span>, <span class="hljs-string">'integer'</span>);
</td></tr><tr><td class="line-number noselect">40</td><td class="code-line">$orderItems-&gt;setPrimaryKey(<span class="hljs-keyword">array</span>(<span class="hljs-string">'CustomerID'</span>, <span class="hljs-string">'OrderID'</span>, <span class="hljs-string">'ProductID'</span>));
</td></tr><tr><td class="line-number noselect">41</td><td class="code-line">$orderItems-&gt;addOption(<span class="hljs-string">'azure.federated'</span>, <span class="hljs-keyword">true</span>);
</td></tr><tr><td class="line-number noselect">42</td><td class="code-line">$orderItems-&gt;addOption(<span class="hljs-string">'azure.federatedOnColumnName'</span>, <span class="hljs-string">'CustomerID'</span>);
</td></tr><tr><td class="line-number noselect">43</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">44</td><td class="code-line"><span class="hljs-comment">// Create the Schema + Federation:</span>
</td></tr><tr><td class="line-number noselect">45</td><td class="code-line">$synchronizer = <span class="hljs-keyword">new</span> SQLAzureSchemaSynchronizer($conn, $shardManager);
</td></tr><tr><td class="line-number noselect">46</td><td class="code-line">$synchronizer-&gt;createSchema($schema);
</td></tr><tr><td class="line-number noselect">47</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">48</td><td class="code-line"><span class="hljs-comment">// Or jut look at the SQL:</span>
</td></tr><tr><td class="line-number noselect">49</td><td class="code-line"><span class="hljs-keyword">echo</span> implode(<span class="hljs-string">"\n"</span>, $synchronizer-&gt;getCreateSchema($schema));
</td></tr></table></div></code></pre>
<a class="section-anchor" id="view-federation-members" name="view-federation-members"></a><h2 class="section-header"><a href="#view-federation-members">View Federation Members<i class="fas fa-link"></i></a></h2>
<p>To see how many shard instances (called Federation Members) your SQLAzure database currently has
you can ask the <code>ShardManager</code> to enumerate all shards:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="134d1df8669c070bf2347203e62a39e1a7c85137"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="134d1df8669c070bf2347203e62a39e1a7c85137"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// view_federation_members.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">"bootstrap.php"</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">$shards = $shardManager-&gt;getShards();
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line"><span class="hljs-keyword">foreach</span> ($shards <span class="hljs-keyword">as</span> $shard) {
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">    print_r($shard);
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">}
</td></tr></table></div></code></pre>
<a class="section-anchor" id="insert-data" name="insert-data"></a><h2 class="section-header"><a href="#insert-data">Insert Data<i class="fas fa-link"></i></a></h2>
<p>Now we want to insert some test data into the database to see the behavior when
we split the shards. We use the same test data as Brian, but use the Doctrine
API to insert them. To insert data into federated tables we have to select the
shard we want to put the data into. We can use the ShardManager to execute this
operation for us:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="5c7ceae42fd38886d673b8b41d880dd28bc3c7ec"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="5c7ceae42fd38886d673b8b41d880dd28bc3c7ec"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// insert_data.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">"bootstrap.php"</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">$shardManager-&gt;selectShard(<span class="hljs-number">0</span>);
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Products"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">    <span class="hljs-string">"ProductID"</span> =&gt; <span class="hljs-number">386</span>,
</td></tr><tr><td class="line-number noselect">9</td><td class="code-line">    <span class="hljs-string">"SupplierID"</span> =&gt; <span class="hljs-number">1001</span>,
</td></tr><tr><td class="line-number noselect">10</td><td class="code-line">    <span class="hljs-string">"ProductName"</span> =&gt; <span class="hljs-string">'Titanium Extension Bracket Left Hand'</span>,
</td></tr><tr><td class="line-number noselect">11</td><td class="code-line">    <span class="hljs-string">"Price"</span> =&gt; <span class="hljs-number">5.25</span>,
</td></tr><tr><td class="line-number noselect">12</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">13</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Products"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">14</td><td class="code-line">    <span class="hljs-string">"ProductID"</span> =&gt; <span class="hljs-number">387</span>,
</td></tr><tr><td class="line-number noselect">15</td><td class="code-line">    <span class="hljs-string">"SupplierID"</span> =&gt; <span class="hljs-number">1001</span>,
</td></tr><tr><td class="line-number noselect">16</td><td class="code-line">    <span class="hljs-string">"ProductName"</span> =&gt; <span class="hljs-string">'Titanium Extension Bracket Right Hand'</span>,
</td></tr><tr><td class="line-number noselect">17</td><td class="code-line">    <span class="hljs-string">"Price"</span> =&gt; <span class="hljs-number">5.25</span>,
</td></tr><tr><td class="line-number noselect">18</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">19</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Products"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">20</td><td class="code-line">    <span class="hljs-string">"ProductID"</span> =&gt; <span class="hljs-number">388</span>,
</td></tr><tr><td class="line-number noselect">21</td><td class="code-line">    <span class="hljs-string">"SupplierID"</span> =&gt; <span class="hljs-number">1001</span>,
</td></tr><tr><td class="line-number noselect">22</td><td class="code-line">    <span class="hljs-string">"ProductName"</span> =&gt; <span class="hljs-string">'Fusion Generator Module 5 kV'</span>,
</td></tr><tr><td class="line-number noselect">23</td><td class="code-line">    <span class="hljs-string">"Price"</span> =&gt; <span class="hljs-number">10.50</span>,
</td></tr><tr><td class="line-number noselect">24</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">25</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Products"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">26</td><td class="code-line">    <span class="hljs-string">"ProductID"</span> =&gt; <span class="hljs-number">388</span>,
</td></tr><tr><td class="line-number noselect">27</td><td class="code-line">    <span class="hljs-string">"SupplierID"</span> =&gt; <span class="hljs-number">1001</span>,
</td></tr><tr><td class="line-number noselect">28</td><td class="code-line">    <span class="hljs-string">"ProductName"</span> =&gt; <span class="hljs-string">'Bypass Filter 400 MHz Low Pass'</span>,
</td></tr><tr><td class="line-number noselect">29</td><td class="code-line">    <span class="hljs-string">"Price"</span> =&gt; <span class="hljs-number">10.50</span>,
</td></tr><tr><td class="line-number noselect">30</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">31</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">32</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">33</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">10</span>,
</td></tr><tr><td class="line-number noselect">34</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Van Nuys'</span>,
</td></tr><tr><td class="line-number noselect">35</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Catherine'</span>,
</td></tr><tr><td class="line-number noselect">36</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Abel'</span>,
</td></tr><tr><td class="line-number noselect">37</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">38</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">39</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">20</span>,
</td></tr><tr><td class="line-number noselect">40</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Abercrombie'</span>,
</td></tr><tr><td class="line-number noselect">41</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Kim'</span>,
</td></tr><tr><td class="line-number noselect">42</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Branch'</span>,
</td></tr><tr><td class="line-number noselect">43</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">44</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">45</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">30</span>,
</td></tr><tr><td class="line-number noselect">46</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Contoso'</span>,
</td></tr><tr><td class="line-number noselect">47</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Frances'</span>,
</td></tr><tr><td class="line-number noselect">48</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Adams'</span>,
</td></tr><tr><td class="line-number noselect">49</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">50</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">51</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">40</span>,
</td></tr><tr><td class="line-number noselect">52</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'A. Datum Corporation'</span>,
</td></tr><tr><td class="line-number noselect">53</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Mark'</span>,
</td></tr><tr><td class="line-number noselect">54</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Harrington'</span>,
</td></tr><tr><td class="line-number noselect">55</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">56</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">57</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">50</span>,
</td></tr><tr><td class="line-number noselect">58</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Adventure Works'</span>,
</td></tr><tr><td class="line-number noselect">59</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Keith'</span>,
</td></tr><tr><td class="line-number noselect">60</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Harris'</span>,
</td></tr><tr><td class="line-number noselect">61</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">62</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">63</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">60</span>,
</td></tr><tr><td class="line-number noselect">64</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Alpine Ski House'</span>,
</td></tr><tr><td class="line-number noselect">65</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Wilson'</span>,
</td></tr><tr><td class="line-number noselect">66</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Pais'</span>,
</td></tr><tr><td class="line-number noselect">67</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">68</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">69</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">70</span>,
</td></tr><tr><td class="line-number noselect">70</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Baldwin Museum of Science'</span>,
</td></tr><tr><td class="line-number noselect">71</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Roger'</span>,
</td></tr><tr><td class="line-number noselect">72</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Harui'</span>,
</td></tr><tr><td class="line-number noselect">73</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">74</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">75</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">80</span>,
</td></tr><tr><td class="line-number noselect">76</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Blue Yonder Airlines'</span>,
</td></tr><tr><td class="line-number noselect">77</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Pilar'</span>,
</td></tr><tr><td class="line-number noselect">78</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Pinilla'</span>,
</td></tr><tr><td class="line-number noselect">79</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">80</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">81</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">90</span>,
</td></tr><tr><td class="line-number noselect">82</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'City Power &amp; Light'</span>,
</td></tr><tr><td class="line-number noselect">83</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Kari'</span>,
</td></tr><tr><td class="line-number noselect">84</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Hensien'</span>,
</td></tr><tr><td class="line-number noselect">85</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">86</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">87</td><td class="code-line">    <span class="hljs-string">'CustomerID'</span> =&gt; <span class="hljs-number">100</span>,
</td></tr><tr><td class="line-number noselect">88</td><td class="code-line">    <span class="hljs-string">'CompanyName'</span> =&gt; <span class="hljs-string">'Coho Winery'</span>,
</td></tr><tr><td class="line-number noselect">89</td><td class="code-line">    <span class="hljs-string">'FirstName'</span> =&gt; <span class="hljs-string">'Peter'</span>,
</td></tr><tr><td class="line-number noselect">90</td><td class="code-line">    <span class="hljs-string">'LastName'</span> =&gt; <span class="hljs-string">'Brehm'</span>,
</td></tr><tr><td class="line-number noselect">91</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">92</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">93</td><td class="code-line">$conn-&gt;executeUpdate(<span class="hljs-string">"DECLARE @orderId INT</span>
</td></tr><tr><td class="line-number noselect">94</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">95</td><td class="code-line">    <span class="hljs-keyword">DECLARE</span> @customerId INT
</td></tr><tr><td class="line-number noselect">96</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">97</td><td class="code-line">    SET @orderId = <span class="hljs-number">10</span>
</td></tr><tr><td class="line-number noselect">98</td><td class="code-line">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = <span class="hljs-string">'Hensien'</span> <span class="hljs-keyword">and</span> FirstName = <span class="hljs-string">'Kari'</span>
</td></tr><tr><td class="line-number noselect">99</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">100</td><td class="code-line">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)
</td></tr><tr><td class="line-number noselect">101</td><td class="code-line">    VALUES (@customerId, @orderId, GetDate())
</td></tr><tr><td class="line-number noselect">102</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">103</td><td class="code-line">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)
</td></tr><tr><td class="line-number noselect">104</td><td class="code-line">    VALUES (@customerId, @orderId, <span class="hljs-number">388</span>, <span class="hljs-number">4</span>)
</td></tr><tr><td class="line-number noselect">105</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">106</td><td class="code-line">    SET @orderId = <span class="hljs-number">20</span>
</td></tr><tr><td class="line-number noselect">107</td><td class="code-line">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = <span class="hljs-string">'Harui'</span> <span class="hljs-keyword">and</span> FirstName = <span class="hljs-string">'Roger'</span>
</td></tr><tr><td class="line-number noselect">108</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">109</td><td class="code-line">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)
</td></tr><tr><td class="line-number noselect">110</td><td class="code-line">    VALUES (@customerId, @orderId, GetDate())
</td></tr><tr><td class="line-number noselect">111</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">112</td><td class="code-line">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)
</td></tr><tr><td class="line-number noselect">113</td><td class="code-line">    VALUES (@customerId, @orderId, <span class="hljs-number">389</span>, <span class="hljs-number">2</span>)
</td></tr><tr><td class="line-number noselect">114</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">115</td><td class="code-line">    SET @orderId = <span class="hljs-number">30</span>
</td></tr><tr><td class="line-number noselect">116</td><td class="code-line">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = <span class="hljs-string">'Brehm'</span> <span class="hljs-keyword">and</span> FirstName = <span class="hljs-string">'Peter'</span>
</td></tr><tr><td class="line-number noselect">117</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">118</td><td class="code-line">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)
</td></tr><tr><td class="line-number noselect">119</td><td class="code-line">    VALUES (@customerId, @orderId, GetDate())
</td></tr><tr><td class="line-number noselect">120</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">121</td><td class="code-line">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)
</td></tr><tr><td class="line-number noselect">122</td><td class="code-line">    VALUES (@customerId, @orderId, <span class="hljs-number">387</span>, <span class="hljs-number">3</span>)
</td></tr><tr><td class="line-number noselect">123</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">124</td><td class="code-line">    SET @orderId = <span class="hljs-number">40</span>
</td></tr><tr><td class="line-number noselect">125</td><td class="code-line">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = <span class="hljs-string">'Pais'</span> <span class="hljs-keyword">and</span> FirstName = <span class="hljs-string">'Wilson'</span>
</td></tr><tr><td class="line-number noselect">126</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">127</td><td class="code-line">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)
</td></tr><tr><td class="line-number noselect">128</td><td class="code-line">    VALUES (@customerId, @orderId, GetDate())
</td></tr><tr><td class="line-number noselect">129</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">130</td><td class="code-line">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)
</td></tr><tr><td class="line-number noselect">131</td><td class="code-line">    VALUES (@customerId, @orderId, <span class="hljs-number">388</span>, <span class="hljs-number">1</span>)<span class="hljs-string">"</span>
</td></tr><tr><td class="line-number noselect">132</td><td class="code-line">);
</td></tr></table></div></code></pre>
<p>This puts the data into the currently only existing federation member. We
selected that federation member by picking 0 as distribution value, which is by
definition part of the only existing federation.</p>
<a class="section-anchor" id="split-federation" name="split-federation"></a><h2 class="section-header"><a href="#split-federation">Split Federation<i class="fas fa-link"></i></a></h2>
<p>Now lets split the federation, creating a second federation member. SQL Azure
will automatically redistribute the data into the two federations after you
executed this command.</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="8d4e896f2c3d60f9fa0484a299eb7660ae57ff16"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="8d4e896f2c3d60f9fa0484a299eb7660ae57ff16"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// split_federation.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">'bootstrap.php'</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">$shardManager-&gt;splitFederation(<span class="hljs-number">60</span>);
</td></tr></table></div></code></pre>
<p>This little script uses the shard manager with a special method only existing
on the SQL AZure implementation <code>splitFederation</code>. It accepts a value at
at which the split is executed.</p>
<p>If you reexecute the <code>view_federation_members.php</code> script you can now see
that there are two federation members instead of just one as before. You can
see with the <code>rangeLow</code> and <code>rangeHigh</code> parameters what customers and
related entries are now served by which federation.</p>
<a class="section-anchor" id="inserting-data-after-split" name="inserting-data-after-split"></a><h2 class="section-header"><a href="#inserting-data-after-split">Inserting Data after Split<i class="fas fa-link"></i></a></h2>
<p>Now after we splitted the data we now have to make sure to be connected to the
right federation before inserting data. Lets add a new customer with ID 55 and
have him create an order.</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="0447aa55e1b88ce7f0010f083ab68493a2f07232"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="0447aa55e1b88ce7f0010f083ab68493a2f07232"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// insert_data_aftersplit.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">'bootstrap.php'</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">$newCustomerId = <span class="hljs-number">55</span>;
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">$shardManager-&gt;selectShard($newCustomerId);
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">9</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Customers"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">10</td><td class="code-line">    <span class="hljs-string">"CustomerID"</span> =&gt; $newCustomerId,
</td></tr><tr><td class="line-number noselect">11</td><td class="code-line">    <span class="hljs-string">"CompanyName"</span> =&gt; <span class="hljs-string">"Microsoft"</span>,
</td></tr><tr><td class="line-number noselect">12</td><td class="code-line">    <span class="hljs-string">"FirstName"</span> =&gt; <span class="hljs-string">"Brian"</span>,
</td></tr><tr><td class="line-number noselect">13</td><td class="code-line">    <span class="hljs-string">"LastName"</span> =&gt; <span class="hljs-string">"Swan"</span>,
</td></tr><tr><td class="line-number noselect">14</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">15</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">16</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"Orders"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">17</td><td class="code-line">    <span class="hljs-string">"CustomerID"</span> =&gt; <span class="hljs-number">55</span>,
</td></tr><tr><td class="line-number noselect">18</td><td class="code-line">    <span class="hljs-string">"OrderID"</span> =&gt; <span class="hljs-number">37</span>,
</td></tr><tr><td class="line-number noselect">19</td><td class="code-line">    <span class="hljs-string">"OrderDate"</span> =&gt; date(<span class="hljs-string">'Y-m-d H:i:s'</span>),
</td></tr><tr><td class="line-number noselect">20</td><td class="code-line">));
</td></tr><tr><td class="line-number noselect">21</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">22</td><td class="code-line">$conn-&gt;insert(<span class="hljs-string">"OrderItems"</span>, <span class="hljs-keyword">array</span>(
</td></tr><tr><td class="line-number noselect">23</td><td class="code-line">    <span class="hljs-string">"CustomerID"</span> =&gt; <span class="hljs-number">55</span>,
</td></tr><tr><td class="line-number noselect">24</td><td class="code-line">    <span class="hljs-string">"OrderID"</span> =&gt; <span class="hljs-number">37</span>,
</td></tr><tr><td class="line-number noselect">25</td><td class="code-line">    <span class="hljs-string">"ProductID"</span> =&gt; <span class="hljs-number">387</span>,
</td></tr><tr><td class="line-number noselect">26</td><td class="code-line">    <span class="hljs-string">"Quantity"</span> =&gt; <span class="hljs-number">1</span>,
</td></tr><tr><td class="line-number noselect">27</td><td class="code-line">));
</td></tr></table></div></code></pre>
<p>As you can see its very important to pick the right distribution key in your
sharded application. Otherwise you have to switch the shards very often, which
is not really easy to work with. If you pick the sharding key right then it
should be possible to select the shard only once per request for the major
number of use-cases.</p>
<p>Fan-out the queries accross multiple shards should only be necessary for a
small number of queries, because these kind of queries are complex.</p>
<a class="section-anchor" id="querying-data-with-filtering-off" name="querying-data-with-filtering-off"></a><h2 class="section-header"><a href="#querying-data-with-filtering-off">Querying data with filtering off<i class="fas fa-link"></i></a></h2>
<p>To access the data you have to pick a shard again and then start selecting data
from it.</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="085e0bdb72f512ff932e0088a32f3a1431922741"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="085e0bdb72f512ff932e0088a32f3a1431922741"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// query_filtering_off.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">"bootstrap.php"</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">$shardManager-&gt;selectShard(<span class="hljs-number">0</span>);
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">$data = $conn-&gt;fetchAll(<span class="hljs-string">'SELECT * FROM Customers'</span>);
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">print_r($data);
</td></tr></table></div></code></pre>
<p>This returns all customers from the shard with distribution value 0. This will
be all customers with id 10 to less than 60, since we split federations at 60.</p>
<a class="section-anchor" id="querying-data-with-filtering-on" name="querying-data-with-filtering-on"></a><h2 class="section-header"><a href="#querying-data-with-filtering-on">Querying data with filtering on<i class="fas fa-link"></i></a></h2>
<p>One special feature of SQL Azure is the possibility to database level filtering
based on the sharding distribution values. This means that SQL Azure will add
WHERE clauses with distributionkey=current distribution value conditions to
each distribution key.</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="6053baf6c41405c77e73a84f7d62afa2f102a60b"
            data-toggle="tooltip"
            data-placement="bottom"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="6053baf6c41405c77e73a84f7d62afa2f102a60b"><table class="code-block-table"><tr><td class="line-number noselect">1</td><td class="code-line"><span class="hljs-meta">&lt;?php</span>
</td></tr><tr><td class="line-number noselect">2</td><td class="code-line"><span class="hljs-comment">// query_filtering_on.php</span>
</td></tr><tr><td class="line-number noselect">3</td><td class="code-line"><span class="hljs-keyword">require_once</span> <span class="hljs-string">"bootstrap.php"</span>;
</td></tr><tr><td class="line-number noselect">4</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">5</td><td class="code-line">$shardManager-&gt;setFilteringEnabled(<span class="hljs-keyword">true</span>);
</td></tr><tr><td class="line-number noselect">6</td><td class="code-line">$shardManager-&gt;selectShard(<span class="hljs-number">55</span>);
</td></tr><tr><td class="line-number noselect">7</td><td class="code-line">
</td></tr><tr><td class="line-number noselect">8</td><td class="code-line">$data = $conn-&gt;fetchAll(<span class="hljs-string">'SELECT * FROM Customers'</span>);
</td></tr><tr><td class="line-number noselect">9</td><td class="code-line">print_r($data);
</td></tr></table></div></code></pre>
<p>Now you only get the customer with id = 55. The same holds for queries on the
<code>Orders</code> and <code>OrderItems</code> table, which are restricted by customer id = 55.</p>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?850a2b"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'dbal';
            var versionSlug = '2.7';

            new Main();

            new Search(projectSlug, versionSlug);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

            <script src="https://staging.doctrine-project.org/js/sidebar.js?01f3db"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

        
        
            </body>
</html>
