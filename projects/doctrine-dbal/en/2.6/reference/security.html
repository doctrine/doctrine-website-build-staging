<!DOCTYPE html>
<html>
    <head>
        <title>Security - Database Abstraction Layer (DBAL)</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Powerful PHP database abstraction layer (DBAL) with many features for database schema introspection, schema management and PDO abstraction.
">

        <meta name="keywords" content="php,mysql,pgsql,dbal,database,abstraction">

                    <meta name="robots" content="noindex">
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine-dbal/en/2.7/reference/security.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?991dfa" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine-dbal/en/2.6/reference/security.html" />
        <meta property="og:title" content="Security - Database Abstraction Layer (DBAL)" />
        <meta property="og:description" content="Powerful PHP database abstraction layer (DBAL) with many features for database schema introspection, schema management and PDO abstraction.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine Database Abstraction Layer",
            "description": "Security",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="--/index-html-welcome-to-doctrine-dbal-s-documentation" class="toc-item"><a href="../index.html#welcome-to-doctrine-dbal-s-documentation">Welcome to Doctrine DBAL's documentation!</a></li><li id="--/index-html-indices-and-tables" class="toc-item"><a href="../index.html#indices-and-tables">Indices and tables</a></li></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine-dbal/en/2.6/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Security</li>
                            </ol>
                        </nav>
                                    </div>

                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-dbal/en/latest/reference/security.html" class="project-version-switcher badge badge-secondary">master</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-dbal/en/2.7/reference/security.html" class="project-version-switcher badge badge-secondary">2.7</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-dbal/en/2.6/reference/security.html" class="project-version-switcher badge badge-warning">2.6</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-dbal/en/2.5/reference/security.html" class="project-version-switcher badge badge-secondary">2.5</a>
                                        </li>
                                    
                                    
                                    <li class="list-inline-item ml-2"><a href="https://github.com/doctrine/dbal/edit/2.6/docs/en/reference/security.rst" class="badge badge-primary">Edit</a></li>

                                </ul>
                            
                            
<p></p>
<a class="section-anchor" id="security" name="security"></a><h1 class="section-header"><a href="#security">Security<i class="fas fa-link"></i></a></h1>
<p>Allowing users of your website to communicate with a database can possibly have
security implications that you should be aware of. Databases allow very
powerful commands that not every user of your website should be able to
execute. Additionally the data in your database probably contains information
that should not be visible to everyone with access to the website.</p>
<p>The most dangerous security problem with regard to databases is the possibility
of SQL injections.  An SQL injection security hole allows an attacker to
execute new or modify existing SQL statements to access information that he is
not allowed to access.</p>
<p>Neither Doctrine DBAL nor ORM can prevent such attacks if you are careless as a
developer. This section explains to you the problems of SQL injection and how
to prevent them.</p>
<a class="section-anchor" id="sql-injection-safe-and-unsafe-apis-for-user-input" name="sql-injection-safe-and-unsafe-apis-for-user-input"></a><h2 class="section-header"><a href="#sql-injection-safe-and-unsafe-apis-for-user-input">SQL Injection: Safe and Unsafe APIs for User Input<i class="fas fa-link"></i></a></h2>
<p>A database library naturally falls touches the class of SQL injection security
vulnerabilities. You should read the following information carefully to
understand how Doctrine can and cannot help you to prevent SQL injection.</p>
<p>In general you should assume that APIs in Doctrine are not safe for user input.
There are however some exceptions.</p>
<p>The following APIs are designed to be <strong>SAFE</strong> from SQL injections:</p>
<ul><li class="dash">For <code>Doctrine\DBAL\Connection#insert($table, $values, $types)</code>,
  <code>Doctrine\DBAL\Connection#update($table, $values, $where, $types)</code> and
  <code>Doctrine\DBAL\Connection#delete($table, $where, $types)</code> only the array
  values of <code>$values</code> and <code>$where</code>. The table name and keys of <code>$values</code>
  and <code>$where</code> are NOT escaped.</li>
<li class="dash"><code>Doctrine\DBAL\Query\QueryBuilder#setFirstResult($offset)</code></li>
<li class="dash"><code>Doctrine\DBAL\Query\QueryBuilder#setMaxResults($limit)</code></li>
<li class="dash"><code>Doctrine\DBAL\Platforms\AbstractPlatform#modifyLimitQuery($sql, $limit, $offset)</code> for the <code>$limit</code> and <code>$offset</code> parameters.</li>
</ul>

<p>Consider <strong>ALL</strong> other APIs to be not safe for user-input:</p>
<ul><li class="dash">Query methods on the Connection</li>
<li class="dash">The QueryBuilder API</li>
<li class="dash">The Platforms and SchemaManager APIs to generate and execute DML/DDL SQL statements</li>
</ul>

<p>To escape user input in those scenarios use the <code>Connection#quote()</code> method.</p>
<a class="section-anchor" id="user-input-in-your-queries" name="user-input-in-your-queries"></a><h2 class="section-header"><a href="#user-input-in-your-queries">User input in your queries<i class="fas fa-link"></i></a></h2>
<p>A database application necessarily requires user-input to passed to your queries.
There are wrong and right ways to do this and is very important to be very strict about this:</p>
<a class="section-anchor" id="wrong-string-concatenation" name="wrong-string-concatenation"></a><h3 class="section-header"><a href="#wrong-string-concatenation">Wrong: String Concatenation<i class="fas fa-link"></i></a></h3>
<p>You should never ever build your queries dynamically and concatenate user-input into your
SQL or DQL query. For Example:</p>
<pre><code class="php">&lt;?php
// Very wrong!
$sql = &quot;SELECT * FROM users WHERE name = '&quot; . $_GET['username']. &quot;'&quot;;
</code></pre>
<p>An attacker could inject any value into the GET variable &quot;username&quot; to modify the query to his needs.</p>
<p>Although DQL is a wrapper around SQL that can prevent you from some security implications, the previous
example is also a threat to DQL queries.</p>
<pre><code class="php">&lt;?php
// DQL is not safe against arbitrary user-input as well:
$dql = &quot;SELECT u FROM User u WHERE u.username = '&quot; . $_GET['username'] . &quot;'&quot;;
</code></pre>
<p>In this scenario an attacker could still pass a username set to <code>' OR 1 = 1</code> and create a valid DQL query.
Although DQL will make use of quoting functions when literals are used in a DQL statement, allowing
the attacker to modify the DQL statement with valid literals cannot be detected by the DQL parser, it
is your responsibility.</p>
<a class="section-anchor" id="right-prepared-statements" name="right-prepared-statements"></a><h3 class="section-header"><a href="#right-prepared-statements">Right: Prepared Statements<i class="fas fa-link"></i></a></h3>
<p>You should always use prepared statements to execute your queries. Prepared statements is a two-step
procedure, separating SQL query from the parameters. They are supported (and encouraged) for both
DBAL SQL queries and for ORM DQL queries.</p>
<p>Instead of using string concatenation to insert user-input into your SQL/DQL statements you just specify
either placeholders instead and then explain to the database driver which variable should be bound to
which placeholder. Each database vendor supports different placeholder styles:</p>
<ul><li class="dash"> All PDO Drivers support positional (using question marks) and named placeholders (:param1, :foo, :bar).</li>
<li class="dash"> OCI8 only supports named parameters, but Doctrine DBAL has a thin layer around OCI8 and
   also allows positional placeholders.</li>
<li class="dash"> Doctrine ORM DQL allows both named and positional parameters. The positional parameters however are not
   just question marks, but suffixed with a number (?1, ?2, ?3, ...).</li>
</ul>

<p>Following are examples of using prepared statements with SQL and DQL:</p>
<pre><code class="php">&lt;?php
// SQL Prepared Statements: Positional
$sql = &quot;SELECT * FROM users WHERE username = ?&quot;;
$stmt = $connection-&gt;prepare($sql);
$stmt-&gt;bindValue(1, $_GET['username']);
$stmt-&gt;execute();

// SQL Prepared Statements: Named
$sql = &quot;SELECT * FROM users WHERE username = :user&quot;;
$stmt = $connection-&gt;prepare($sql);
$stmt-&gt;bindValue(&quot;user&quot;, $_GET['username']);
$stmt-&gt;execute();

// DQL Prepared Statements: Positional
$dql = &quot;SELECT u FROM User u WHERE u.username = ?1&quot;;
$query = $em-&gt;createQuery($dql);
$query-&gt;setParameter(1, $_GET['username']);
$data = $query-&gt;getResult();

// DQL Prepared Statements: Named
$dql = &quot;SELECT u FROM User u WHERE u.username = :name&quot;;
$query = $em-&gt;createQuery($dql);
$query-&gt;setParameter(&quot;name&quot;, $_GET['username']);
$data = $query-&gt;getResult();
</code></pre>
<p>You can see this is a bit more tedious to write, but this is the only way to write secure queries. If you
are using just the DBAL there are also helper methods which simplify the usage quite alot:</p>
<pre><code class="php">&lt;?php
// bind parameters and execute query at once.
$sql = &quot;SELECT * FROM users WHERE username = ?&quot;;
$stmt = $connection-&gt;executeQuery($sql, array($_GET['username']));
</code></pre>
<p>There is also <code>executeUpdate</code> which does not return a statement but the number of affected rows.</p>
<p>Besides binding parameters you can also pass the type of the variable. This allows Doctrine or the underyling
vendor to not only escape but also cast the value to the correct type. See the docs on querying and DQL in the
respective chapters for more information.</p>
<a class="section-anchor" id="right-quoting-escaping-values" name="right-quoting-escaping-values"></a><h3 class="section-header"><a href="#right-quoting-escaping-values">Right: Quoting/Escaping values<i class="fas fa-link"></i></a></h3>
<p>Although previously we said string concatenation is wrong, there is a way to do it correctly using
the <code>Connection#quote</code> method:</p>
<pre><code class="php">&lt;?php
// Parameter quoting
$sql = &quot;SELECT * FROM users WHERE name = &quot; . $connection-&gt;quote($_GET['username'], \PDO::PARAM_STR);
</code></pre>
<p>This method is only available for SQL, not for DQL. For DQL it is always encouraged to use prepared
statements not only for security, but also for caching reasons.</p>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'dbal';
            var versionSlug = '2.6';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

            <script src="https://staging.doctrine-project.org/js/sidebar.js?482a20"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

        
        
            </body>
</html>
