<!DOCTYPE html>
<html>
    <head>
        <title>        Migrations - Doctrine Doctrine1 ORM (Doctrine1)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine1 ORM Documentation: Migrations ">

        <meta name="keywords" content="                    php,doctrine1,orm,database,documentation,migrations
    ">

                    <meta name="robots" content="noindex">
        
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/migrations.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://staging.doctrine-project.org/frontend/css/index.css?c900c9"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/migrations.html" />
        <meta property="og:title" content="        Migrations - Doctrine Doctrine1 ORM (Doctrine1)
    " />
        <meta property="og:description" content="Doctrine Doctrine1 ORM Documentation: Migrations " />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine1 ORM",
            "description": "Migrations",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://staging.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine1/edit/master/docs/en/manual/migrations.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://staging.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "Doctrine1",
            "item": "https://staging.doctrine-project.org/projects/doctrine1.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://staging.doctrine-project.org/projects/doctrine1/en/latest/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Migrations",
            "item": "https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/migrations.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine1.html">Doctrine1</a></li>
                                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine1/en/latest/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Migrations</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>This project is no longer maintained and has been archived.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine1/en/latest/manual/migrations.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        master
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine1/en/latest/manual/migrations.html">
                                                        master

                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                                                                                    </div>
                                </div>
                            
                            

            <div class="section" id="migrations">
            <h1 class="section-header ">
    <a href="#migrations">
        Migrations
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>The Doctrine migration package allows you to easily update your
production databases through a nice programmatic interface. The changes
are done in a way so that your database is versioned and you can walk
backwards and forwards through the database versions.</p>

            <div class="section" id="performing-migrations">
            <h2 class="section-header ">
    <a href="#performing-migrations">
        Performing Migrations
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Before we learn how to create the migration classes lets take a look at
how we can run migrations so that we can implement them in our Doctrine
test environment in the next section.</p>

            
    <p>First lets create a new instance of Doctrine_Migration and pass it
the path to our migration classes:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>migration = new Doctrine_Migration( '/path/to/migration_classes', $conn );</code></pre></div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>Notice the second argument to the Doctrine_Migration
constructor. You can pass an optional Doctrine_Connection
instance. If you do not pass the connection for the migration class
to use, it will simply grab the current connection.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>Now we can migrate to the latest version by calling the <code>migrate()</code>
method:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>migration->migrate();</code></pre></div>
            
    <p>If you want to migrate to a specific version you can pass an argument to
<code>migrate()</code>. For example we can migrate to version 3 from 0:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>migration->migrate( 3 );</code></pre></div>
            
    <p>Now you can migrate back to version 0 from 3:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>migration->migrate( 0 );</code></pre></div>
            
    <p>If you want to get the current version of the database you can use the
<code>getCurrentVersion()</code> method:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>echo $migration->getCurrentVersion();
</code></pre></div>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>Omitting the version number argument for the <code>migrate()</code>
method means that internally Doctrine will try and migrate to the
latest class version number that it could find in the directory you
passed.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p><strong>Transactions in Migrations</strong> Internally Doctrine does not
wrap migration versions in transactions. It is up to you as the
developer to handle exceptions and transactions in your migration
classes. Remember though, that very few databases support
transactional DDL. So on most databases, even if you wrap the
migrations in a transaction, any DDL statements like create, alter,
drop, rename, etc., will take effect anyway.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="implement">
            <h2 class="section-header ">
    <a href="#implement">
        Implement
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Now that we know how to perform migrations lets implement a little
script in our Doctrine test environment named <code>migrate.php</code>.</p>

            
    <p>First we need to create a place for our migration classes to be stored
so lets create a directory named <code>migrations</code>:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>mkdir migrations</code></pre></div>
            
    <p>Now create the <code>migrate.php</code> script in your favorite editor and place
the following code inside:</p>

            <div class="console"><pre><code class="console">// migrate.php
require_once('bootstrap.php');

<span class="noselect">$ </span>migration = new Doctrine_Migration( 'migrations' );
<span class="noselect">$ </span>migration->migrate();</code></pre></div>
    </div>
            <div class="section" id="writing-migration-classes">
            <h2 class="section-header ">
    <a href="#writing-migration-classes">
        Writing Migration Classes
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Migration classes consist of a simple class that extends from
Doctrine_Migration<code>. You can define a ``up()`` and </code><code>down()</code> method
that is meant for doing and undoing changes to a database for that
migration version.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>The name of the class can be whatever you want, but the
name of the file which contains the class must have a prefix
containing a number that is used for loading the migrations in the
correct order.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>Below are a few examples of some migration classes you can use to build
your database starting from version 1.</p>

            
    <p>For the first version lets create a new table named <code>migration_test</code>:</p>

            <div class="console"><pre><code class="console">// migrations/1_add_table.php
class AddTable extends Doctrine_Migration_Base
{
    public function up()
    {
        $this->createTable( 'migration_test', array( 'field1' => array( 'type' => 'string' ) ) );
    }

    public function down()
    {
        $this->dropTable( 'migration_test' );
    }
}</code></pre></div>
            
    <p>Now lets create a second version where we add a new column to the table
we added in the previous version:</p>

            <div class="console"><pre><code class="console">// migrations/2_add_column.php
class AddColumn extends Doctrine_Migration_Base
{
    public function up()
    {
        $this->addColumn( 'migration_test', 'field2', 'string' );
    }

    public function down()
    {
        $this->removeColumn( 'migration_test', 'field2' );
    }
}</code></pre></div>
            
    <p>Finally, lets change the type of the <code>field1</code> column in the table we
created previously:</p>

            <div class="console"><pre><code class="console">// migrations/3_change_column.php
class ChangeColumn extends Doctrine_Migration_Base
{
    public function up()
    {
        $this->changeColumn( 'migration_test', 'field2', 'integer' );
    }

    public function down()
    {
        $this->changeColumn( 'migration_test', 'field2', 'string' );
    }
}</code></pre></div>
            
    <p>Now that we have created the three migration classes above we can run
our <code>migrate.php</code> script we implemented earlier:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php migrate.php</code></pre></div>
            
    <p>If you look in the database you will see that we have the table named
<code>migrate_test</code> created and the version number in the
<code>migration_version</code> is set to three.</p>

            
    <p>If you want to migrate back to where we started you can pass a version
number to the <code>migrate()</code> method in the <code>migrate.php</code> script:</p>

            <div class="console"><pre><code class="console">// migrate.php

// ...
<span class="noselect">$ </span>migration = new Doctrine_Migration( 'migrations' );
<span class="noselect">$ </span>migration->migrate( 0 );</code></pre></div>
            
    <p>Now run the <code>migrate.php</code> script:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php migrate.php</code></pre></div>
            
    <p>If you look in the database now, everything we did in the <code>up()</code>
methods has been reversed by the contents of the <code>down()</code> method.</p>

            <div class="section" id="available-operations">
            <h3 class="section-header ">
    <a href="#available-operations">
        Available Operations
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Here is a list of the available methods you can use to alter your
database in your migration classes.</p>

            <div class="section" id="create-table">
            <h4 class="section-header ">
    <a href="#create-table">
        Create Table
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $columns = array(
        'id' => array(
            'type'     => 'integer',
            'unsigned' => 1,
            'notnull'  => 1,
            'default'  => 0
        ),
        'name' => array(
            'type'   => 'string',
            'length' => 12
        ),
        'password' => array(
            'type'   => 'string',
            'length' => 12
        )
    );

    $options = array(
        'type'    => 'INNODB',
        'charset' => 'utf8'
    );

    $this->createTable( 'table_name', $columns, $options );
}
// ...</code></pre></div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>You might notice already that the data structures used to
manipulate the your schema are the same as the data structures used
with the database abstraction layer. This is because internally the
migration package uses the database abstraction layer to perform the
operations specified in the migration classes.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="drop-table">
            <h4 class="section-header ">
    <a href="#drop-table">
        Drop Table
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function down()
{
    $this->dropTable( 'table_name' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="rename-table">
            <h4 class="section-header ">
    <a href="#rename-table">
        Rename Table
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $this->renameTable( 'old_table_name', 'new_table_name' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="create-constraint">
            <h4 class="section-header ">
    <a href="#create-constraint">
        Create Constraint
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $definition = array(
        'fields' => array(
            'username' => array()
        ),
        'unique' => true
    );

    $this->createConstraint( 'table_name', 'constraint_name', $definition );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="drop-constraint">
            <h4 class="section-header ">
    <a href="#drop-constraint">
        Drop Constraint
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p><strong>Now the opposite</strong> <code>down()</code> <strong>would look like the following:</strong></p>

            <div class="console"><pre><code class="console">// ...
public function down()
{
    $this->dropConstraint( 'table_name', 'constraint_name' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="create-foreign-key">
            <h4 class="section-header ">
    <a href="#create-foreign-key">
        Create Foreign Key
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $definition = array(
        'local'        => 'email_id',
        'foreign'      => 'id',
        'foreignTable' => 'email',
        'onDelete'     => 'CASCADE',
    );

    $this->createForeignKey( 'table_name', 'email_foreign_key', $definition );
}
// ...</code></pre></div>
            
    <p>The valid options for the <code>$definition</code> are:</p>

            <table>
                <thead>
            <tr>
                            <th>Name</th>
                            <th>Description</th>
                    </tr>
        </thead>
    <tbody>
    <tr>
            <td>name</td>
            <td>Optional constraint name</td>
    </tr>
    <tr>
            <td>local</td>
            <td>The local field(s)</td>
    </tr>
    <tr>
            <td>foreign</td>
            <td>The foreign reference field(s)</td>
    </tr>
    <tr>
            <td>foreignTable</td>
            <td>The name of the foreign table</td>
    </tr>
    <tr>
            <td>onDelete</td>
            <td>Referential delete action</td>
    </tr>
    <tr>
            <td>onUpdate</td>
            <td>Referential update action</td>
    </tr>
    <tr>
            <td>deferred</td>
            <td>Deferred constraint checking</td>
    </tr>
</tbody>
</table>
    </div>
            <div class="section" id="drop-foreign-key">
            <h4 class="section-header ">
    <a href="#drop-foreign-key">
        Drop Foreign Key
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function down()
{
    $this->dropForeignKey( 'table_name', 'email_foreign_key' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="add-column">
            <h4 class="section-header ">
    <a href="#add-column">
        Add Column
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $this->addColumn( 'table_name', 'column_name', 'string', $length, $options );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="rename-column">
            <h4 class="section-header ">
    <a href="#rename-column">
        Rename Column
        <i class="fas fa-link"></i>
    </a>
</h4>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>Some DBMS like sqlite do not implement the rename column
operation. An exception is thrown if you try and rename a column
when using a sqlite connection.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $this->renameColumn( 'table_name', 'old_column_name', 'new_column_name' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="change-column">
            <h4 class="section-header ">
    <a href="#change-column">
        Change Column
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p><strong>Change any aspect of an existing column:</strong></p>

            <div class="console"><pre><code class="console">// ...
public function up()
{
    $options = array( 'length' => 1 );
    $this->changeColumn( 'table_name', 'column_name', 'tinyint', $options );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="remove-column">
            <h4 class="section-header ">
    <a href="#remove-column">
        Remove Column
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $this->removeColumn( 'table_name', 'column_name' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="irreversible-migration">
            <h4 class="section-header ">
    <a href="#irreversible-migration">
        Irreversible Migration
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>Sometimes you may perform some operations in the <code>up()</code>
method that cannot be reversed. For example if you remove a column
from a table. In this case you need to throw a new
Doctrine_Migration_IrreversibleMigrationException exception.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="console"><pre><code class="console">// ...
public function down()
{
    throw new Doctrine_Migration_IrreversibleMigrationException( 'The remove column operation cannot be undone!' );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="add-index">
            <h4 class="section-header ">
    <a href="#add-index">
        Add Index
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function up()
{
    $options = array(
        'fields' => array(
            'username' => array(
                'sorting' => 'ascending'
            ),
            'last_login' => array()
        )
    );

    $this->addIndex( 'table_name', 'index_name', $options );
}
// ...</code></pre></div>
    </div>
            <div class="section" id="remove-index">
            <h4 class="section-header ">
    <a href="#remove-index">
        Remove Index
        <i class="fas fa-link"></i>
    </a>
</h4>
            <div class="console"><pre><code class="console">// ...
public function down()
{
    $this->removeIndex( 'table_name', 'index_name' );
}
// ...</code></pre></div>
    </div>
    </div>
            <div class="section" id="pre-and-post-hooks">
            <h3 class="section-header ">
    <a href="#pre-and-post-hooks">
        Pre and Post Hooks
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Sometimes you may need to alter the data in the database with your
models. Since you may create a table or make a change, you have to do
the data altering after the <code>up()</code> or <code>down()</code> method is processed.
We have hooks in place for this named <code>preUp()</code>, <code>postUp()</code>,
<code>preDown()</code>, and <code>postDown()</code>. Define these methods and they will be
triggered:</p>

            <div class="console"><pre><code class="console">// migrations/1_add_table.php
class AddTable extends Doctrine_Migration_Base
{
    public function up()
    {
        $this->createTable( 'migration_test', array(
            'field1' => array(
                'type' => 'string'
            )
        );
    }

    public function postUp()
    {
        $migrationTest         = new MigrationTest();
        $migrationTest->field1 = 'Initial record created by migrations';
        $migrationTest->save();
    }

    public function down()
    {
        $this->dropTable( 'migration_test' );
    }
}</code></pre></div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>The above example assumes you have created and made
available the <code>MigrationTest</code> model. Once the <code>up()</code> method is
executed the <code>migration_test</code> table is created so the
<code>MigrationTest</code> model can be used. We have provided the definition
of this model below.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="console"><pre><code class="console">// models/MigrationTest.php
class MigrationTest extends Doctrine_Record
{
    public function setTableDefinition()
    {
        $this->hasColumn( 'field1', 'string' );
    }
}</code></pre></div>
            
    <p>Here is the same example in YAML format. You can read more about YAML in
the <a href="yaml-schema-files.html">YAML Schema Files</a> chapter:</p>

            <pre class="code-block-table"><code class="yaml"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="a17e2c13705649a65524d5b0e30e0b00a361401a"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="a17e2c13705649a65524d5b0e30e0b00a361401a"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-1" class="line-number-anchor" /><a href="#line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-1">1</a></td><td class="code-line" rowspan="6"><span class="hljs-meta">---</span>
<span class="hljs-comment"># schema.yml</span>

<span class="hljs-attr">MigrationTest:</span>
  <span class="hljs-attr">columns:</span>
    <span class="hljs-attr">field1:</span> <span class="hljs-string">string</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-2" class="line-number-anchor" /><a href="#line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-3" class="line-number-anchor" /><a href="#line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-4" class="line-number-anchor" /><a href="#line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-5" class="line-number-anchor" /><a href="#line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-6" class="line-number-anchor" /><a href="#line-number-a17e2c13705649a65524d5b0e30e0b00a361401a-6">6</a></td></tr></table></div></code></pre>
    </div>
            <div class="section" id="up-down-automation">
            <h3 class="section-header ">
    <a href="#up-down-automation">
        Up/Down Automation
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>In Doctrine migrations it is possible most of the time to automate the
opposite of a migration method. For example if you create a new column
in the up of a migration, we should be able to easily automate the down
since all we need to do is remove the column that was created. This is
possible by using the <code>migrate()</code> function for both the <code>up</code> and
<code>down</code>.</p>

            
    <p>The <code>migrate()</code> method accepts an argument of $direction and it will
either have a value of <code>up</code> or <code>down</code>. This value is passed to the
first argument of functions like <code>column</code>, <code>table</code>, etc.</p>

            
    <p>Here is an example where we automate the adding and removing of a column</p>

            <div class="console"><pre><code class="console">class MigrationTest extends Doctrine_Migration_Base
{
    public function migrate( $direction )
    {
        $this->column( $direction, 'table_name', 'column_name', 'string', '255' );
    }
}</code></pre></div>
            
    <p>Now when we run up with the above migration, the column will be added
and when we run down the column will be removed.</p>

            
    <p>Here is a list of the following migration methods that can be automated:</p>

            <table>
                <thead>
            <tr>
                            <th>Automate Method Name</th>
                            <th>Automates</th>
                    </tr>
        </thead>
    <tbody>
    <tr>
            <td><strong>table()</strong></td>
            <td><strong>createTable()/dropTable()</strong></td>
    </tr>
    <tr>
            <td><strong>constraint()</strong></td>
            <td><strong>createConstraint()/dropConstraint()</strong></td>
    </tr>
    <tr>
            <td><strong>foreignKey()</strong></td>
            <td><strong>createForeignKey()/dropForeignKey()</strong></td>
    </tr>
    <tr>
            <td><strong>column()</strong></td>
            <td><strong>addColumn()/removeColumn()</strong></td>
    </tr>
    <tr>
            <td><strong>index()</strong></td>
            <td><strong>addIndex()/removeIndex()</strong></td>
    </tr>
</tbody>
</table>
    </div>
            <div class="section" id="generating-migrations">
            <h3 class="section-header ">
    <a href="#generating-migrations">
        Generating Migrations
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Doctrine offers the ability to generate migration classes a few
different ways. You can generate a set of migrations to re-create an
existing database, or generate migration classes to create a database
for an existing set of models. You can even generate migrations from
differences between two sets of schema information.</p>

            <div class="section" id="from-database">
            <h4 class="section-header ">
    <a href="#from-database">
        From Database
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>To generate a set of migrations from the existing database connections
it is simple, just use <code>Doctrine_Core::generateMigrationsFromDb()</code>.</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>Doctrine_Core::generateMigrationsFromDb( '/path/to/migration/classes' );
</code></pre></div>
    </div>
            <div class="section" id="from-existing-models">
            <h4 class="section-header ">
    <a href="#from-existing-models">
        From Existing Models
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>To generate a set of migrations from an existing set of models it is
just as simple as from a database, just use
<code>Doctrine_Core::generateMigrationsFromModels()</code>.</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>Doctrine_Core::generateMigrationsFromModels( '/path/to/migration/classes', '/path/to/models' );
</code></pre></div>
    </div>
            <div class="section" id="diff-tool">
            <h4 class="section-header ">
    <a href="#diff-tool">
        Diff Tool
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>Sometimes you may want to alter your models and be able to automate the
migration process for your changes. In the past you would have to write
the migration classes manually for your changes. Now with the diff tool
you can make your changes then generate the migration classes for the
changes.</p>

            
    <p>The diff tool is simple to use. It accepts a &quot;from&quot; and a &quot;to&quot; and they
can be one of the following:</p>

            <blockquote>

<ul>
    <li class="dash">Path to yaml schema files</li>
    <li class="dash">Name of an existing database connection</li>
    <li class="dash">Path to an existing set of models</li>
</ul>
</blockquote>
            
    <p>A simple example would be to create two YAML schema files, one named
<code>schema1.yml</code> and another named <code>schema2.yml</code>.</p>

            
    <p>The <code>schema1.yml</code> contains a simple <code>User</code> model:</p>

            <pre class="code-block-table"><code class="yaml"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-1" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-1">1</a></td><td class="code-line" rowspan="7"><span class="hljs-meta">---</span>
<span class="hljs-comment"># schema1.yml</span>

<span class="hljs-attr">User:</span>
  <span class="hljs-attr">columns:</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">string(255)</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">string(255)</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-2" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-3" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-4" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-5" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-6" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-7" class="line-number-anchor" /><a href="#line-number-a29de58c7d3df3d8c89cc2dc0f4408b9a15aaecf-7">7</a></td></tr></table></div></code></pre>
            
    <p>Now imagine we modify the above schema and want to add a
<code>email_address</code> column:</p>

            <pre class="code-block-table"><code class="yaml"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="599c7610b0da0ada8b76c5c2aacf145189e86a48"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="599c7610b0da0ada8b76c5c2aacf145189e86a48"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-1" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-1">1</a></td><td class="code-line" rowspan="8"><span class="hljs-meta">---</span>
<span class="hljs-comment"># schema1.yml</span>

<span class="hljs-attr">User:</span>
  <span class="hljs-attr">columns:</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">string(255)</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">string(255)</span>
    <span class="hljs-attr">email_address:</span> <span class="hljs-string">string(255)</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-2" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-3" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-4" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-5" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-6" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-7" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-8" class="line-number-anchor" /><a href="#line-number-599c7610b0da0ada8b76c5c2aacf145189e86a48-8">8</a></td></tr></table></div></code></pre>
            
    <p>Now we can easily generate a migration class which will add the new
column to our database:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>Doctrine_Core::generateMigrationsFromDiff( '/path/to/migration/classes', '/path/to/schema1.yml', '/path/to/schema2.yml' );
</code></pre></div>
            
    <p>This will produce a file at the path <code>/path/to/migration/classes/1236199329_version1.php</code></p>

            <div class="console"><pre><code class="console">class Version1 extends Doctrine_Migration_Base
{
    public function up()
    {
        $this->addColumn( 'user', 'email_address', 'string', '255', array() );
    }

    public function down()
    {
        $this->removeColumn( 'user', 'email_address' );
    }
}</code></pre></div>
            
    <p>Now you can easily migrate your database and add the new column!</p>

    </div>
    </div>
    </div>
            <div class="section" id="conclusion">
            <h2 class="section-header ">
    <a href="#conclusion">
        Conclusion
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Using migrations is highly recommended for altering your production
database schemas as it is a safe and easy way to make changes to your
schema.</p>

            
    <p>Migrations are the last feature of Doctrine that we will discuss in this
book. The final chapters will discuss some other topics that will help
you be a better Doctrine developers on a day-to-day basis. First lets
discuss some of the other <a href="utilities.html">Utilities</a> that Doctrine provides.</p>

    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://staging.doctrine-project.org/frontend/js/bundle.js?ff3b61"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'doctrine1';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search Doctrine1 master'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
        
            </body>
</html>
