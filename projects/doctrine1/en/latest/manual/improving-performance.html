<!DOCTYPE html>
<html>
    <head>
        <title>        Improving Performance - Doctrine Doctrine1 ORM (Doctrine1)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine1 ORM Documentation: Improving Performance ">

        <meta name="keywords" content="                    php,doctrine1,orm,database,documentation,improving,performance
    ">

                    <meta name="robots" content="noindex">
        
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/improving-performance.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://staging.doctrine-project.org/frontend/css/index.css?c900c9"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/improving-performance.html" />
        <meta property="og:title" content="        Improving Performance - Doctrine Doctrine1 ORM (Doctrine1)
    " />
        <meta property="og:description" content="Doctrine Doctrine1 ORM Documentation: Improving Performance " />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine1 ORM",
            "description": "Improving Performance",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://staging.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine1/edit/master/docs/en/manual/improving-performance.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://staging.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "Doctrine1",
            "item": "https://staging.doctrine-project.org/projects/doctrine1.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://staging.doctrine-project.org/projects/doctrine1/en/latest/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Improving Performance",
            "item": "https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/improving-performance.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine1.html">Doctrine1</a></li>
                                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine1/en/latest/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Improving Performance</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>This project is no longer maintained and has been archived.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine1/en/latest/manual/improving-performance.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        master
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine1/en/latest/manual/improving-performance.html">
                                                        master

                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                                                                                    </div>
                                </div>
                            
                            

            <div class="section" id="improving-performance">
            <h1 class="section-header ">
    <a href="#improving-performance">
        Improving Performance
        <i class="fas fa-link"></i>
    </a>
</h1>
            <div class="section" id="introduction">
            <h2 class="section-header ">
    <a href="#introduction">
        Introduction
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Performance is a very important aspect of all medium to large sized
applications. Doctrine is a large abstraction library that provides a database
abstraction layer as well as object-relational mapping. While this provides a
lot of benefits like portability and ease of development it&#039;s inevitable that
this leads to drawbacks in terms of performance.  This chapter tries to help
you to get the best performance out of Doctrine.</p>

    </div>
            <div class="section" id="compile">
            <a id="improving-performance-compile"></a>
            <h2 class="section-header ">
    <a href="#compile">
        Compile
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Doctrine is quite big framework and usually dozens of files are being included
on each request. This brings a lot of overhead. In fact these file operations
are as time consuming as sending multiple queries to database server. The clean
separation of class per file works well in developing environment, however when
project goes commercial distribution the speed overcomes the clean separation
of class per file convention.</p>

            
    <p>Doctrine offers method called compile to solve this issue. The
compile method makes a single file of most used Doctrine components which can
then be included on top of your script. By default the file is created into
Doctrine root by the name Doctrine.compiled.php.</p>

            
    <p>Compiling is a method for making a single file of most used doctrine runtime
components including the compiled file instead of multiple files (in worst
cases dozens of files) can improve performance by an order of magnitude. In
cases where this might fail, a Doctrine_Exception is throw detailing the
error.</p>

            
    <p>Lets create a compile script named compile.php to handle the
compiling of DoctrineL:</p>

            <div class="console"><pre><code class="console">// compile.php

require_once( '/path/to/doctrine/lib/Doctrine.php' );
spl_autoload_register( array( 'Doctrine', 'autoload' ) );

Doctrine_Core::compile( 'Doctrine.compiled.php' );</code></pre></div>
            
    <p>Now we can execute compile.php and a file named
Doctrine.compiled.php will be generated in the root of your
<code>doctrine_test</code> folder:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php compile.php</code></pre></div>
            
    <p>If you wish to only compile in the database drivers you are using you
can pass an array of drivers as the second argument to compile.
For this example we are only using MySQL so lets tell Doctrine to only
compile the <code>mysql</code> driver:</p>

            <div class="console"><pre><code class="console">// compile.php

// ...
Doctrine_Core::compile( 'Doctrine.compiled.php', array( 'mysql' ) );</code></pre></div>
            
    <p>Now you can change your bootstrap.php script to include the compiled
Doctrine:</p>

            <div class="console"><pre><code class="console">// bootstrap.php

// ...
require_once( 'Doctrine.compiled.php' );
// ...</code></pre></div>
    </div>
            <div class="section" id="conservative-fetching">
            <h2 class="section-header ">
    <a href="#conservative-fetching">
        Conservative Fetching
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Maybe the most important rule is to be conservative and only fetch the data you
actually need. This may sound trivial but laziness or lack of knowledge about
the possibilities that are available often lead to a lot of unnecessary
overhead.</p>

            
    <p>Take a look at this example:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>record = $table->find( $id );</code></pre></div>
            
    <p>How often do you find yourself writing code like that? It&#039;s convenient but it&#039;s
very often not what you need. The example above will pull all columns of the
record out of the database and populate the newly created object with that
data. This not only means unnecessary network traffic but also means that
Doctrine has to populate data into objects that is never used.</p>

            
    <p>I&#039;m sure you all know why a query like the following is not ideal:</p>

            <pre class="code-block-table"><code class="sql"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="4266f8b35f19851867576692faed6658c553b475"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="4266f8b35f19851867576692faed6658c553b475"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-4266f8b35f19851867576692faed6658c553b475-1" class="line-number-anchor" /><a href="#line-number-4266f8b35f19851867576692faed6658c553b475-1">1</a></td><td class="code-line" rowspan="3"><span class="hljs-keyword">SELECT</span>
*
<span class="hljs-keyword">FROM</span> my_table</td></tr>
<tr><td class="line-number noselect"><a name="line-number-4266f8b35f19851867576692faed6658c553b475-2" class="line-number-anchor" /><a href="#line-number-4266f8b35f19851867576692faed6658c553b475-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-4266f8b35f19851867576692faed6658c553b475-3" class="line-number-anchor" /><a href="#line-number-4266f8b35f19851867576692faed6658c553b475-3">3</a></td></tr></table></div></code></pre>
            
    <p>The above is bad in any application and this is also true when using Doctrine.
In fact it&#039;s even worse when using Doctrine because populating objects with
data that is not needed is a waste of time.</p>

            
    <p>Another important rule that belongs in this category is: <strong>Only fetch objects
when you really need them</strong>. Doctrine has the ability to fetch &quot;array graphs&quot;
instead of object graphs. At first glance this may sound strange because why
use an object-relational mapper in the first place then? Take a second to think
about it. PHP is by nature a precedural language that has been enhanced with a
lot of features for decent OOP.  Arrays are still the most efficient data
structures you can use in PHP.  Objects have the most value when they&#039;re used
to accomplish complex business logic. It&#039;s a waste of resources when data gets
wrapped in costly object structures when you have no benefit of that. Take a
look at the following code that fetches all comments with some related data for
an article, passing them to the view for display afterwards:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>q = Doctrine_Query::create()
    ->select( 'b.title, b.author, b.created_at' )
    ->addSelect( 'COUNT(t.id) as num_comments' )
    ->from( 'BlogPost b' )
    ->leftJoin( 'b.Comments c' )
    ->where( 'b.id = ?' )
    ->orderBy( 'b.created_at DESC' );

<span class="noselect">$ </span>blogPosts = $q->execute( array( 1 ) );</code></pre></div>
            
    <p>Now imagine you have a view or template that renders the most recent
blog posts:</p>

            <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-1" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-1">1</a></td><td class="code-line" rowspan="14"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">foreach</span> ( $blogPosts <span class="hljs-keyword">as</span> $blogPost ): <span class="hljs-meta">?&gt;</span>
    &lt;li&gt;
        &lt;strong&gt;
            <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> $blogPost[<span class="hljs-string">'title'</span>] <span class="hljs-meta">?&gt;</span>
        &lt;/strong&gt;

        - Posted on <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> $blogPost[<span class="hljs-string">'created_at'</span>] <span class="hljs-meta">?&gt;</span>
        by <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> $blogPost[<span class="hljs-string">'author'</span>] <span class="hljs-meta">?&gt;</span>.

        &lt;small&gt;
            (<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> $blogPost[<span class="hljs-string">'num_comments'</span>] <span class="hljs-meta">?&gt;</span>)
        &lt;/small&gt;
    &lt;/li&gt;
<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endforeach</span>; <span class="hljs-meta">?&gt;</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-2" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-3" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-4" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-5" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-6" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-7" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-8" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-9" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-10" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-11" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-12" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-13" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-14" class="line-number-anchor" /><a href="#line-number-9ebb4e0c081b82c190b5ab2e4147c8d8adf886c5-14">14</a></td></tr></table></div></code></pre>
            
    <p>Can you think of any benefit of having objects in the view instead of
arrays? You&#039;re not going to execute business logic in the view, are you?
One parameter can save you a lot of unnecessary processing:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>blogPosts = $q->execute( array( 1 ), Doctrine_Core::HYDRATE_ARRAY );</code></pre></div>
            
    <p>If you prefer you can also use the setHydrationMethod method:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>q->setHydrationMode( Doctrine_Core::HYDRATE_ARRAY );
<span class="noselect">$ </span>blogPosts = $q->execute( array( 1 ) );</code></pre></div>
            
    <p>The above code will hydrate the data into arrays instead of objects
which is much less expensive.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>One great thing about array hydration is that if you use the
ArrayAccess on your objects you can easily switch your queries to use
array hydration and your code will work exactly the same. For example the
above code we wrote to render the list of the most recent blog posts would
work when we switch the query behind it to array hydration.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>Sometimes, you may want the direct output from PDO instead of an object or an
array. To do this, set the hydration mode to
Doctrine_Core::HYDRATE_NONE. Here&#039;s an example:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>q = Doctrine_Query::create()
    ->select( 'SUM(d.amount)' )
    ->from( 'Donation d' );

<span class="noselect">$ </span>results = $q->execute( array(), Doctrine_Core::HYDRATE_NONE );</code></pre></div>
            
    <p>You will need to print the results and find the value in the array
depending on your DQL query:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>print_r( $results );
</code></pre></div>
            
    <p>In this example the result would be accessible with the following code:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>total = $results[0][1];</code></pre></div>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>There are two important differences between <code>HYDRATE_ARRAY</code> and
<code>HYDRATE_NONE</code> which you should consider before choosing which to use.
<code>HYDRATE_NONE</code> is the fastest but the result is an array with numeric
keys and so results would be referenced as <code>$result[0][0]</code> instead of
<code>$result[0][&#039;my_field&#039;]</code> with <code>HYDRATE_ARRAY</code>. Best practice would to
use <code>HYDRATE_NONE</code> when retrieving large record sets or when doing many
similar queries. Otherwise, <code>HYDRATE_ARRAY</code> is more comfortable and
should be preferred.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="bundle-your-class-files">
            <h2 class="section-header ">
    <a href="#bundle-your-class-files">
        Bundle your Class Files
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>When using Doctrine or any other large OO library or framework the number of
files that need to be included on a regular HTTP request rises significantly.
50-100 includes per request are not uncommon. This has a significant
performance impact because it results in a lot of disk operations. While this
is generally no issue in a dev environment, it&#039;s not suited for production. The
recommended way to handle this problem is to bundle the most-used classes of
your libraries into a single file for production, stripping out any unnecessary
whitespaces, linebreaks and comments. This way you get a significant
performance improvement even without a bytecode cache (see next section). The
best way to create such a bundle is probably as part of an automated build
process i.e. with Phing.</p>

    </div>
            <div class="section" id="use-a-bytecode-cache">
            <h2 class="section-header ">
    <a href="#use-a-bytecode-cache">
        Use a Bytecode Cache
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>A bytecode cache like APC will cache the bytecode that is generated by php
prior to executing it. That means that the parsing of a file and the creation
of the bytecode happens only once and not on every request.  This is especially
useful when using large libraries and/or frameworks.  Together with file
bundling for production this should give you a significant performance
improvement. To get the most out of a bytecode cache you should contact the
manual pages since most of these caches have a lot of configuration options
which you can tweak to optimize the cache to your needs.</p>

    </div>
            <div class="section" id="free-objects">
            <h2 class="section-header ">
    <a href="#free-objects">
        Free Objects
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>As of version 5.2.5, PHP is not able to garbage collect object graphs that have
circular references, e.g. Parent has a reference to Child which has a reference
to Parent. Since many doctrine model objects have such relations, PHP will not
free their memory even when the objects go out of scope.</p>

            
    <p>For most PHP applications, this problem is of little consequence, since PHP
scripts tend to be short-lived. Longer-lived scripts, e.g. bulk data importers
and exporters, can run out of memory unless you manually break the circular
reference chains. Doctrine provides a free function on
Doctrine_Collection, and
Doctrine_Query which eliminates the circular references on those
objects, freeing them up for garbage collection. Usage might look like:</p>

            
    <p>Free objects when mass inserting records:</p>

            <div class="console"><pre><code class="console">for ( $i = 0; $i < 1000; $i++ )
{
    $object = createBigObject();
    $object->save();
    $object->free( true );
}</code></pre></div>
            
    <p>You can also free query objects in the same way:</p>

            <div class="console"><pre><code class="console">for ( $i = 0; $i < 1000; $i++ )
{
    $q = Doctrine_Query::create()
        ->from( 'User u' );

    $results = $q->fetchArray();
    $q->free();
}</code></pre></div>
            
    <p>Or even better if you can reuse the same query object for each query in
the loop that would be ideal:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>q = Doctrine_Query::create()
    ->from('User u');

for ( $i = 0; $i < 1000; $i++ )
{
    $results = $q->fetchArray();
    $q->free();
}</code></pre></div>
    </div>
            <div class="section" id="other-tips">
            <h2 class="section-header ">
    <a href="#other-tips">
        Other Tips
        <i class="fas fa-link"></i>
    </a>
</h2>
            

<ul>
    <li>
    <p>Helping the DQL parser</p>
<blockquote>
    <p>There are two possible ways when it comes to using DQL. The first one is
writing the plain DQL queries and passing them to
<code>Doctrine_Connection::query( $dql )</code>. The second one is to use a
Doctrine_Query object and its fluent interface. The latter should
be preferred for all but very simple queries. The reason is that using the
Doctrine_Query object and it&#039;s methods makes the life of the DQL
parser a little bit easier. It reduces the amount of query parsing that needs
to be done and is therefore faster.</p>
</blockquote></li>
    <li>
    <p>Efficient relation handling</p>
<blockquote>
    <p>When you want to add a relation between two components you should not do something like the following:</p>
            <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>The following example assumes a many-many between <code>Role</code> and <code>User</code>.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div><div class="console"><pre><code class="console"><span class="noselect">$ </span>role = new Role();
<span class="noselect">$ </span>role->name = 'New Role Name';

<span class="noselect">$ </span>user->Roles[] = $newRole;
</code></pre></div>            <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>The above code will load all roles of the user from the
database if they&#039;re not yet loaded! Just to add one new link!</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    <p>The following is the recommended way instead:</p>
<div class="console"><pre><code class="console"><span class="noselect">$ </span>userRole          = new UserRole();
<span class="noselect">$ </span>userRole->role_id = $role_id;
<span class="noselect">$ </span>userRole->user_id = $user_id;
<span class="noselect">$ </span>userRole->save();</code></pre></div></blockquote></li>
</ul>

    </div>
            <div class="section" id="conclusion">
            <h2 class="section-header ">
    <a href="#conclusion">
        Conclusion
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Lots of methods exist for improving performance in Doctrine. It is highly
recommended that you consider some of the methods described above.</p>

            
    <p>Now lets move on to learn about some of the <a href="technology.html">Technology</a>
used in Doctrine.</p>

    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://staging.doctrine-project.org/frontend/js/bundle.js?ff3b61"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'doctrine1';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search Doctrine1 master'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
        
            </body>
</html>
