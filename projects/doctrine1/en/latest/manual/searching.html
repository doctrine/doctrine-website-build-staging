<!DOCTYPE html>
<html>
    <head>
        <title>        Searching - Doctrine Doctrine1 ORM (Doctrine1)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine1 ORM Documentation: Searching ">

        <meta name="keywords" content="                    php,doctrine1,orm,database,documentation,searching
    ">

                    <meta name="robots" content="noindex">
        
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/searching.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://staging.doctrine-project.org/frontend/css/index.css?33995b"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/searching.html" />
        <meta property="og:title" content="        Searching - Doctrine Doctrine1 ORM (Doctrine1)
    " />
        <meta property="og:description" content="Doctrine Doctrine1 ORM Documentation: Searching " />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine1 ORM",
            "description": "Searching",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://staging.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine1/edit/master/docs/en/manual/searching.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="menu">
    <ul class="menu-level">
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://staging.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "Doctrine1",
            "item": "https://staging.doctrine-project.org/projects/doctrine1.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://staging.doctrine-project.org/projects/doctrine1/en/latest/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Searching",
            "item": "https://staging.doctrine-project.org/projects/doctrine1/en/latest/manual/searching.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine1.html">Doctrine1</a></li>
                                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine1/en/latest/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Searching</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>This project is no longer maintained and has been archived.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine1/en/latest/manual/searching.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        master
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine1/en/latest/manual/searching.html">
                                                        master

                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                                                                                    </div>
                                </div>
                            
                            

            <div class="section" id="searching">
            <h1 class="section-header ">
    <a href="#searching">
        Searching
        <i class="fas fa-link"></i>
    </a>
</h1>
            <div class="section" id="introduction">
            <h2 class="section-header ">
    <a href="#introduction">
        Introduction
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Searching is a huge topic, hence an entire chapter has been devoted to a
behavior called <code>Searchable</code>. It is a fulltext indexing and searching
tool. It can be used for indexing and searching both database and files.</p>

            
    <p>Consider we have a class called <code>NewsItem</code> with the following
definition:</p>

            <div class="console"><pre><code class="console">// models/NewsItem.php
class NewsItem extends Doctrine_Record
{
    public function setTableDefinition()
    {
        $this->hasColumn('title', 'string', 255);
        $this->hasColumn('body', 'clob');
    }
}</code></pre></div>
            
    <p>Here is the same example in YAML format. You can read more about YAML in
the <a href="yaml-schema-files.html">YAML Schema Files</a> chapter:</p>

            <pre class="code-block-table"><code class="yaml"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="b118ed5c522ee92be78f3f9c5d0f112b26c20c81"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="b118ed5c522ee92be78f3f9c5d0f112b26c20c81"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-1" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-1">1</a></td><td class="code-line" rowspan="8"><span class="hljs-meta">---</span>
<span class="hljs-comment"># schema.yml</span>

<span class="hljs-comment"># ...</span>
<span class="hljs-attr">NewsItem:</span>
  <span class="hljs-attr">columns:</span>
    <span class="hljs-attr">title:</span> <span class="hljs-string">string(255)</span>
    <span class="hljs-attr">body:</span> <span class="hljs-string">clob</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-2" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-3" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-4" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-5" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-6" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-7" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-8" class="line-number-anchor" /><a href="#line-number-b118ed5c522ee92be78f3f9c5d0f112b26c20c81-8">8</a></td></tr></table></div></code></pre>
            
    <p>Now lets say we have an application where users are allowed to search
for different news items, an obvious way to implement this would be
building a form and based on that forms submitted values build DQL
queries such as:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>q = Doctrine_Query::create()
    ->from('NewsItem i')
    ->where('n.title LIKE ? OR n.content LIKE ?');</code></pre></div>
            
    <p>As the application grows these kind of queries become very slow. For
example when using the previous query with parameters <code>%framework%</code>
and <code>%framework%</code> (this would be equivalent of &#039;find all news items
whose title or content contains word &#039;framework&#039;) the database would
have to traverse through each row in the table, which would naturally be
very very slow.</p>

            
    <p>Doctrine solves this with its search component and inverse indexes.
First lets alter our definition a bit:</p>

            <div class="console"><pre><code class="console">// models/NewsItem.php
class NewsItem extends Doctrine_Record
{
    // ...
    public function setUp()
    {
        $this->actAs('Searchable', array(
                'fields' => array('title', 'content')
            )
        );
    }
}</code></pre></div>
            
    <p>Here is the same example in YAML format. You can read more about YAML in
the <a href="yaml-schema-files.html">YAML Schema Files</a> chapter:</p>

            <pre class="code-block-table"><code class="yaml"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="3a987eec3de9546e8ca36dacdb22a5831017cc19"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="3a987eec3de9546e8ca36dacdb22a5831017cc19"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-1" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-1">1</a></td><td class="code-line" rowspan="9"><span class="hljs-meta">---</span>
<span class="hljs-comment"># schema.yml</span>

<span class="hljs-comment"># ...</span>
<span class="hljs-attr">NewsItem:</span>
  <span class="hljs-attr">actAs:</span>
    <span class="hljs-attr">Searchable:</span>
      <span class="hljs-attr">fields:</span> <span class="hljs-string">[title,</span> <span class="hljs-string">content]</span>
<span class="hljs-comment"># ...</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-2" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-3" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-4" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-5" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-6" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-7" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-8" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-9" class="line-number-anchor" /><a href="#line-number-3a987eec3de9546e8ca36dacdb22a5831017cc19-9">9</a></td></tr></table></div></code></pre>
            
    <p>Lets check the SQL that is generated by the above models:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>sql = Doctrine_Core::generateSqlFromArray(array('NewsItem'));
echo $sql[0] . "";
echo $sql[1] . "";
echo $sql[2];</code></pre></div>
            
    <p>The above code would output the following SQL query:</p>

            <div class="console"><pre><code class="console">CREATE TABLE news_item_index (id BIGINT,
keyword VARCHAR(200),
field VARCHAR(50),
position BIGINT,
PRIMARY KEY(id,
keyword,
field,
position)) ENGINE = INNODB
CREATE TABLE news_item (id BIGINT AUTO_INCREMENT,
title VARCHAR(255),
body LONGTEXT,
PRIMARY KEY(id)) ENGINE = INNODB
ALTER TABLE news_item_index ADD FOREIGN KEY (id) REFERENCES news_item(id) ON UPDATE CASCADE ON DELETE CASCADE</code></pre></div>
            
    <p>Here we tell Doctrine that <code>NewsItem</code> class acts as searchable
(internally Doctrine loads Doctrine_Template_Searchable) and
fields <code>title</code> and <code>content</code> are marked as fulltext indexed fields.
This means that every time a <code>NewsItem</code> is added or updated Doctrine
will:</p>

            
    
<ol start="1" type="1">
    <li value="1">Update the inverse search index or</li>
    <li value="2">Add new pending entry to the inverse search index (sometimes it can
be efficient to update the inverse search index in batches)</li>
</ol>

    </div>
            <div class="section" id="index-structure">
            <h2 class="section-header ">
    <a href="#index-structure">
        Index structure
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>The structure of the inverse index Doctrine uses is the following:</p>

            
    <p>[ (string) keyword] [ (string) field ] [ (integer) position ] [ (mixed) [foreign_keys] ]</p>

            <table>
                <thead>
            <tr>
                            <th>Column</th>
                            <th>Description</th>
                    </tr>
        </thead>
    <tbody>
    <tr>
            <td><code>keyword</code></td>
            <td>The keyword in the text that can be searched for.</td>
    </tr>
    <tr>
            <td><code>field</code></td>
            <td>The field where the keyword was found.</td>
    </tr>
    <tr>
            <td><code>position</code></td>
            <td>The position where the keyword was found.</td>
    </tr>
    <tr>
            <td><code>[foreign_keys]</code></td>
            <td>The foreign keys of the record being indexed.</td>
    </tr>
</tbody>
</table>
            
    <p>In the <code>NewsItem</code> example the <code>[foreign_keys]</code> would simply contain
one field named <code>id</code> with foreign key references to <code>NewsItem(id)</code>
and with <code>onDelete =&gt; CASCADE</code> constraint.</p>

            
    <p>An example row in this table might look something like:</p>

            <table>
                <thead>
            <tr>
                            <th>keyword</th>
                            <th>field</th>
                            <th>position</th>
                            <th>id</th>
                    </tr>
        </thead>
    <tbody>
    <tr>
            <td><code>database</code></td>
            <td><code>title</code></td>
            <td><code>3</code></td>
            <td><code>1</code></td>
    </tr>
</tbody>
</table>
            
    <p>In this example the word <code>database</code> is the third word of the <code>title</code>
field of <code>NewsItem</code> with id of <code>1</code>.</p>

    </div>
            <div class="section" id="index-building">
            <h2 class="section-header ">
    <a href="#index-building">
        Index Building
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Whenever a searchable record is being inserted into database Doctrine
executes the index building procedure. This happens in the background as
the procedure is being invoked by the search listener. The phases of
this procedure are:</p>

            
    
<ol start="1" type="1">
    <li value="1">Analyze the text using a Doctrine_Search_Analyzer based class</li>
    <li value="2">Insert new rows into index table for all analyzed keywords</li>
</ol>

            
    <p>Sometimes you may not want to update the index table directly when new
searchable entries are added. Rather you may want to batch update the
index table in certain intervals. For disabling the direct update
functionality you&#039;ll need to set the batchUpdates option to true when
you attach the behavior:</p>

            <div class="console"><pre><code class="console">// models/NewsItem.php
class NewsItem extends Doctrine_Record
{
    // ...
    public function setUp()
    {
        $this->actAs('Searchable', array(
                'fields' => array('title', 'content')
                'batchUpdates' => true
            )
        );
    }
}</code></pre></div>
            
    <p>Here is the same example in YAML format. You can read more about YAML in
the <a href="yaml-schema-files.html">YAML Schema Files</a> chapter:</p>

            <pre class="code-block-table"><code class="yaml"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="0059389193bd48c489460a7f333a2b976a69404d"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="0059389193bd48c489460a7f333a2b976a69404d"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-1" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-1">1</a></td><td class="code-line" rowspan="10"><span class="hljs-meta">---</span>
<span class="hljs-comment"># schema.yml</span>

<span class="hljs-comment"># ...</span>
<span class="hljs-attr">NewsItem:</span>
  <span class="hljs-attr">actAs:</span>
    <span class="hljs-attr">Searchable:</span>
      <span class="hljs-attr">fields:</span> <span class="hljs-string">[title,</span> <span class="hljs-string">content]</span>
      <span class="hljs-attr">batchUpdates:</span> <span class="hljs-literal">true</span>
<span class="hljs-comment"># ...</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-2" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-3" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-4" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-5" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-6" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-7" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-8" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-9" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0059389193bd48c489460a7f333a2b976a69404d-10" class="line-number-anchor" /><a href="#line-number-0059389193bd48c489460a7f333a2b976a69404d-10">10</a></td></tr></table></div></code></pre>
            
    <p>The actual batch updating procedure can be invoked with the
<code>batchUpdateIndex()</code> method. It takes two optional arguments:
<code>limit</code> and <code>offset</code>. Limit can be used for limiting the number of
batch indexed entries while the offset can be used for setting the first
entry to start the indexing from.</p>

            
    <p>First lets insert a new <code>NewsItem</code> records:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>newsItem        = new NewsItem();
<span class="noselect">$ </span>newsItem->title = 'Test';
<span class="noselect">$ </span>newsItem->body  = 'test';
<span class="noselect">$ </span>newsItem->save();</code></pre></div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>If you don&#039;t have batch updates enabled then the index will
be automatically updated for you when you insert or update
<code>NewsItem</code> records. If you do have batch updates enabled then you
can perform the batch updates by using the following code:</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>newsItemTable = Doctrine_Core::getTable('NewsItem');
<span class="noselect">$ </span>newsItemTable->batchUpdateIndex();</code></pre></div>
    </div>
            <div class="section" id="text-analyzers">
            <h2 class="section-header ">
    <a href="#text-analyzers">
        Text Analyzers
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>By default Doctrine uses Doctrine_Search_Analyzer_Standard for
analyzing the text. This class performs the following things:</p>

            

<ul>
    <li class="dash">Strips out stop-keywords (such as &#039;and&#039;, &#039;if&#039; etc.) As many commonly
used words such as &#039;and&#039;, &#039;if&#039; etc. have no relevance for the search,
they are being stripped out in order to keep the index size
reasonable.</li>
    <li class="dash">Makes all keywords lowercased. When searching words &#039;database&#039; and
&#039;DataBase&#039; are considered equal by the standard analyzer, hence the
standard analyzer lowercases all keywords.</li>
    <li class="dash">Replaces all non alpha-numeric marks with whitespace. In normal text
many keywords might contain non alpha-numeric chars after them, for
example &#039;database.&#039;. The standard analyzer strips these out so that
&#039;database&#039; matches &#039;database.&#039;.</li>
    <li class="dash">Replaces all quotation marks with empty strings so that &quot;O&#039;Connor&quot;
matches &quot;oconnor&quot;</li>
</ul>

            
    <p>You can write your own analyzer class by making a class that implements
Doctrine_Search_Analyzer_Interface. Here is an example where we
create an analyzer named <code>MyAnalyzer</code>:</p>

            <div class="console"><pre><code class="console">// models/MyAnalyzer.php
class MyAnalyzer implements Doctrine_Search_Analyzer_Interface
{
    public function analyze($text)
    {
        $text = trim($text);
        return $text;
    }
}</code></pre></div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>The search analyzers must only contain one method named
<code>analyze()</code> and it should return the modified inputted text to be indexed.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>This analyzer can then be applied to the search object as follows:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>newsItemTable = Doctrine_Core::getTable('NewsItem');
<span class="noselect">$ </span>search = $newsItemTable
    ->getTemplate('Doctrine_Template_Searchable')
    ->getPlugin();

<span class="noselect">$ </span>search->setOption('analyzer', new MyAnalyzer());</code></pre></div>
    </div>
            <div class="section" id="query-language">
            <h2 class="section-header ">
    <a href="#query-language">
        Query language
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Doctrine_Search provides a query language similar to Apache Lucene.
The Doctrine_Search_Query converts human readable,
easy-to-construct search queries to their complex DQL equivalents which
are then converted to SQL like normal.</p>

    </div>
            <div class="section" id="performing-searches">
            <h2 class="section-header ">
    <a href="#performing-searches">
        Performing Searches
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Here is a simple example to retrieve the record ids and relevance data.</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>newsItemTable = Doctrine_Core::getTable('NewsItem');
<span class="noselect">$ </span>results       = $newsItemTable->search('test');
print_r($results);</code></pre></div>
            
    <p>The above code executes the following query:</p>

            <div class="console"><pre><code class="console">SELECT
COUNT(keyword) AS relevance,
id
FROM article_index
WHERE id IN (SELECT
id
FROM article_index WHERE keyword = ?)
AND id IN (SELECT
id
FROM article_index
WHERE keyword = ?)
GROUP BY id
ORDER BY relevance DESC</code></pre></div>
            
    <p>The output of the code above would be the following:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php test.php
Array
(
    [0] => Array
        (
            [relevance] => 1
            [id] => 1
        )
)</code></pre></div>
            
    <p>Now you can use those results in another query to retrieve the actual
<code>NewsItem</code> objects:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>ids = array();
foreach ($results as $result) {
    $ids[] = $result['id'];
}

<span class="noselect">$ </span>q = Doctrine_Query::create()
    ->from('NewsItem i')
    ->whereIn('i.id', $ids);

<span class="noselect">$ </span>newsItems = $q->execute();

print_r($newsItems->toArray());</code></pre></div>
            
    <p>The above example would produce the following output:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php test.php
Array
(
    [0] => Array
        (
            [id] => 1
            [title] => Test
            [body] => test
        )
)</code></pre></div>
            
    <p>You can optionally pass the <code>search()</code> function a query object to
modify with a where condition subquery to limit the results using the
search index.</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>q = Doctrine_Query::create()
    ->from('NewsItem i');

<span class="noselect">$ </span>q = Doctrine_Core::getTable('Article')
    ->search('test', $q);

echo $q->getSqlQuery();</code></pre></div>
            
    <p>The above call to <code>getSql()</code> would output the following SQL query:</p>

            <div class="console"><pre><code class="console">SELECT
n.id AS n**id,
n.title AS n**title,
n.body AS n__body
FROM news_item n
WHERE n.id IN (SELECT
id
FROM news_item_index
WHERE keyword = ?
GROUP BY id)</code></pre></div>
            
    <p>Now we can execute the query and get the <code>NewsItem</code> objects:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>newsItems = $q->execute();

print_r($newsItems->toArray());</code></pre></div>
            
    <p>The above example would produce the following output:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php test.php
Array
(
    [0] => Array
        (
            [id] => 1
            [title] => Test
            [body] => test
        )
)</code></pre></div>
    </div>
            <div class="section" id="file-searches">
            <h2 class="section-header ">
    <a href="#file-searches">
        File searches
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>As stated before Doctrine_Search can also be used for searching
files. Lets say we have a directory which we want to be searchable.
First we need to create an instance of Doctrine_Search_File which
is a child of Doctrine_Search providing some extra functionality
needed for the file searches.</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>search = new Doctrine_Search_File();</code></pre></div>
            
    <p>Second thing to do is to generate the index table. By default Doctrine
names the database index class as <code>FileIndex</code>.</p>

            
    <p>Lets check the SQL that is generated by the above models created:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>sql = Doctrine_Core::generateSqlFromArray(array('FileIndex'));</code></pre></div>
            
    <p>The above code would output the following SQL query:</p>

            <div class="console"><pre><code class="console">CREATE TABLE file_index (url VARCHAR(255),
keyword VARCHAR(200),
field VARCHAR(50),
position BIGINT,
PRIMARY KEY(url,
keyword,
field,
position)) ENGINE = INNODB</code></pre></div>
            
    <p>You can create the actual table in the database by using the
<code>Doctrine_Core::createTablesFromArray()</code> method:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
Doctrine_Core::createTablesFromArray(array('FileIndex'));</code></pre></div>
            
    <p>Now we can start using the file searcher. In this example lets just
index the <code>models</code> directory:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>search->indexDirectory('models');</code></pre></div>
            
    <p>The <code>indexDirectory()</code> iterates recursively through given directory
and analyzes all files within it updating the index table as necessary.</p>

            
    <p>Finally we can start searching for pieces of text within the indexed
files:</p>

            <div class="console"><pre><code class="console">// test.php

// ...
<span class="noselect">$ </span>results = $search->search('hasColumn');
print_r($results);</code></pre></div>
            
    <p>The above example would produce the following output:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>php test.php
Array
(
    [0] => Array
        (
            [relevance] => 2
            [url] => models/generated/BaseNewsItem.php
        )
)</code></pre></div>
    </div>
            <div class="section" id="conclusion">
            <h2 class="section-header ">
    <a href="#conclusion">
        Conclusion
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Now that we have learned all about the <code>Searchable</code> behavior we are
ready to learn in more detail about the <code>NestedSet</code> behavior in the
<a href="hierarchical-data.html">Hierarchical Data</a> chapter. The <code>NestedSet</code> is a large
topic like the <code>Searchable</code> behavior so it got its own dedicated
chapter as well.</p>

    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://staging.doctrine-project.org/frontend/js/bundle.js?ff3b61"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'doctrine1';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search Doctrine1 master'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
        
            </body>
</html>
