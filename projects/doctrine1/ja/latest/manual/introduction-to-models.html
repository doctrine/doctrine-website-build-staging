<!DOCTYPE html>
<html>
    <head>
        <title>はじめに - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?c8b404" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/css/railscasts.css?62eb49" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/ja/latest/manual/introduction-to-models.html" />
        <meta property="og:title" content="はじめに - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?6c0dab" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
                    
<p></p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h1>
<p>最も低いレベルで、DoctrineはPHPクラスの一式でデータベーススキーマを表現します。これらのクラスはスキーマとモデルの振る舞いを定義します。</p>
<p>ウェブアプリケーションのユーザーを表す基本モデルは次のようになります。</p>
<blockquote><p>class User extends Doctrine\_Record { public function</p>
</blockquote>
<p>setTableDefinition() { $this-&gt;hasColumn('username', 'string', 255);
$this-&gt;hasColumn('password', 'string', 255); }</p>
<div class="console"><pre><code class="console">public function setUp()
{
    $this->actAs('Timestampable');
}</code></pre></div>
<p>}</p>
<blockquote><p><strong>NOTE</strong>
実際には上記のクラスは使いません。これらは単なる例です。この章の後の方で既存のデータベーステーブルから最初のクラスの定義を生成します。</p>
</blockquote>
<p><code>Doctrine\_Record</code>のそれぞれの子クラスは<code>setTableDefinition()</code>と<code>setUp()</code>メソッドを持ちます。<code>setTableDefinition()</code>メソッドはカラム、インデックスとテーブルのスキーマに関するその他の情報を定義するためにあります。<code>setUp()</code>メソッドはビヘイビアと<code>Doctrine_Record</code>子クラスの間のリレーションを定義するためにあります。上記の例ではautomagic機能を追加するTimestampableビヘイビアを有効にしています。[doc
defining-models
:name]の章でこれらのメソッドすべてが使われている例を学びます。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">モデルを生成する<i class="fas fa-link"></i></a></h1>
<p>Doctrineは使い始めを楽にするためにこれらのクラスを生成する方法を提供します。</p>
<blockquote><p><strong>NOTE</strong>
既存のデータベースの生成は始めるための利便性のみしか意味しません。データベースを生成した後で必要に応じて調整と整頓をしなければなりません。</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">既存のデータベース<i class="fas fa-link"></i></a></h2>
<p>よくある事例はORMにアクセスするデータベースとコードはより巨大/複雑になることです。SQLを手で書くよりも信頼のおけるツールが必要です。</p>
<p>Doctrineは既存のデータベースから<code>Doctrine\_Record</code>クラスを生成する機能をサポートします。ドメインモデル用にすべての<code>Doctrine_Record</code>クラスを手動で書く必要はありません。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h3 class="section-header"><a href="#">最初のインポートを行う<i class="fas fa-link"></i></a></h3>
<p><code>doctrine_test</code>という名前のデータベースと<code>user</code>という名前の単独のテーブルがある場合を考えてみましょう。<code>user</code>テーブルは次のSQL文で作成されます:</p>
<blockquote><p>CREATE TABLE user ( id bigint(20) NOT NULL auto\_increment, first\_name</p>
</blockquote>
<p>varchar(255) default NULL, last\_name varchar(255) default NULL,
username varchar(255) default NULL, password varchar(255) default NULL,
type varchar(255) default NULL, is\_active tinyint(1) default '1',
is\_super\_admin tinyint(1) default '0', created\_at TIMESTAMP,
updated\_at TIMESTAMP, PRIMARY KEY (id) ) ENGINE=InnoDB</p>
<p>これを<code>Doctrine_Record</code>クラスに変換することを考えます。Doctrineによってこれは簡単です！[doc
getting-started
:name]章で作成したテストスクリプトを覚えていますか？これを利用してモデルを生成します。</p>
<p>最初にSQLiteのメモリの代わりにMySQLデータベースを使うために<code>bootstrap.php</code>を修正する必要があります:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $conn =
Doctrine\_Manager::connection('mysql://root:mys3cr3et@localhost/doctrine\_test',
'doctrine'); // ...</p>
<blockquote><p><strong>NOTE</strong>
データベースがまだ存在せず接続ユーザーがデータベースを作成するパーミッションを持つ場合データベースを作成するために<code>$conn-&gt;createDatabase()</code>メソッドを使うことができます。テーブルを作成するために<code>CREATE
TABLE</code>文を使用します。</p>
</blockquote>
<p>生成クラスを置く場所が必要なので<code>doctrine_test</code>ディレクトリの中で<code>models</code>という名前のディレクトリを作りましょう:</p>
<blockquote><p>$ mkdir doctrine\_test/models</p>
</blockquote>
<p>モデルクラスを生成するには<code>test.php</code>スクリプトにコードを追加することだけが必要です:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... Doctrine\_Core::generateModelsFromDb('models', array('doctrine'),
array('generateTableClasses' =&gt; true));</p>
<blockquote><p><strong>NOTE</strong>
<code>generateModelsFromDb</code>メソッドは1つのパラメータのみを必要としこのパラメータはディレクトリです(生成レコードが書き込まれるディレクトリ)。2番目の引数はモデルを生成するためのデータベースの接続名の配列で、3番目はモデルのビルド用のオプションの配列です。</p>
</blockquote>
<p>これだけです！<code>doctrine_test/models/generated</code>ディレクトリで<code>BaseUser.php</code>という名前のファイルがあります。ファイルは次のようになります:</p>
<blockquote><p>// models/generated/BaseUser.php</p>
</blockquote>
<p>/\<em>\</em> \<em> This class has been auto-generated by the Doctrine ORM
Framework \</em>/ abstract class BaseUser extends Doctrine\_Record { public
function setTableDefinition() { $this-&gt;setTableName('user');
$this-&gt;hasColumn('id', 'integer', 8, array('type' =&gt; 'integer', 'length'
=&gt; 8, 'primary' =&gt; true, 'autoincrement' =&gt; true));
$this-&gt;hasColumn('first\_name', 'string', 255, array('type' =&gt; 'string',
'length' =&gt; 255)); $this-&gt;hasColumn('last\_name', 'string', 255,
array('type' =&gt; 'string', 'length' =&gt; 255));
$this-&gt;hasColumn('username', 'string', 255, array('type' =&gt; 'string',
'length' =&gt; 255)); $this-&gt;hasColumn('password', 'string', 255,
array('type' =&gt; 'string', 'length' =&gt; 255)); $this-&gt;hasColumn('type',
'string', 255, array('type' =&gt; 'string', 'length' =&gt; 255));
$this-&gt;hasColumn('is\_active', 'integer', 1, array('type' =&gt; 'integer',
'length' =&gt; 1, 'default' =&gt; '1')); $this-&gt;hasColumn('is\_super\_admin',
'integer', 1, array('type' =&gt; 'integer', 'length' =&gt; 1, 'default' =&gt;
'0')); $this-&gt;hasColumn('created\_at', 'timestamp', null, array('type'
=&gt; 'timestamp', 'notnull' =&gt; true)); $this-&gt;hasColumn('updated\_at',
'timestamp', null, array('type' =&gt; 'timestamp', 'notnull' =&gt; true)); } }</p>
<p><code>doctrine_test/models</code>ディレクトリで<code>User.php</code>という名前のファイルもあります。ファイルは次のようになります:</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>/\<em>\</em> \<em> This class has been auto-generated by the Doctrine ORM
Framework \</em>/ class User extends BaseUser {</p>
<p>}</p>
<p>Doctrineは<code>doctrine\_test/models/UserTable.php</code>で<code>Doctrine_Table</code>スケルトンクラスを自動生成します。<code>true</code>の値を持つ<code>generateTableClasses</code>オプションを渡したからです。ファイルは次のようになります:</p>
<blockquote><p>// models/UserTable.php</p>
</blockquote>
<p>/\<em>\</em> \<em> This class has been auto-generated by the Doctrine ORM
Framework \</em>/ class UserTable extends Doctrine\_Table {</p>
<p>}</p>
<p>モデルの機能をカスタマイズするために<code>User</code>と<code>UserTable</code>クラスの中でカスタムメソッドを設置できます。下記のコードは例です:</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>// ... class User extends BaseUser { public function
setPassword($password) { return `this-&gt;_set('password', md5(`\ password));} }</p>
<p>適切に動作させるために<code>password</code>アクセサをオーバーライドするには<code>bootstrap.php</code>ファイルで<code>auto\_accessor_override</code>属性を有効にしなければなりません。</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ...
$manager-&gt;setAttribute(Doctrine\_Core::ATTR\_AUTO\_ACCESSOR\_OVERRIDE,
true);</p>
<p>ユーザーパスワードを設定しようとするとmd5に暗号化されます。最初に<code>models</code>ディレクトリからモデルをオートロードするために次のように<code>bootstrap.php</code>ファイルを修正する必要があります:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... Doctrine\_Core::loadModels('models');</p>
<blockquote><p><strong>NOTE</strong> モデルのロードはこの章の[doc
introduction-to-models:autoloading-models
:name]セクションで説明されます。</p>
</blockquote>
<p><code>User</code>モデルに行った変更をテストするコードを含めるために<code>test.php</code>を修正します:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ...</p>
<p>$user = new User(); $user-&gt;username = 'jwage'; $user-&gt;password =
'changeme';</p>
<p>echo $user-&gt;password; // changemeではなくmd5ハッシュを出力する</p>
<p>ターミナルから<code>test.php</code>を実行するとき次の内容が表示されます:</p>
<blockquote><p>$ php test.php 4cb9c8a8048fd02294477fcb1a41191a</p>
</blockquote>
<p><code>UserTable</code>クラスに追加するカスタムメソッドの例は次の通りです:</p>
<blockquote><p>// models/UserTable.php</p>
</blockquote>
<p>// ... class UserTable extends Doctrine\_Table { public function
getCreatedToday() { $today = date('Y-m-d h:i:s',
strtotime(date('Y-m-d'))); return $this-&gt;createQuery('u')
-&gt;where('u.created\_at &gt; ?', $today) -&gt;execute(); } }</p>
<p>カスタムの<code>Doctrine\_Table</code>クラスをロードするには<code>bootstrap.php</code>ファイルで<code>autoload\_table_classes</code>属性を有効にしなければなりません。</p>
<blockquote><p>// boostrap.php</p>
</blockquote>
<p>// ...
$manager-&gt;setAttribute(Doctrine\_Core::ATTR\_AUTOLOAD\_TABLE\_CLASSES,
true);</p>
<p><code>UserTable</code>インスタンスを扱っているときにこのメソッドにアクセスできます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $usersCreatedToday =
Doctrine\_Core::getTable('User')-&gt;getCreatedToday();</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">スキーマファイル<i class="fas fa-link"></i></a></h2>
<p>代わりにYAMLスキーマファイルでモデルを管理してそれらのファイルからPHPクラスを生成できます。最初に作業をやりやすくするために手元にある既存のモデルからYAMLスキーマファイルを生成しましょう。次のコードを内部に取り込むために<code>test.php</code>を変更します:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ...</p>
<p>Doctrine\_Core::generateYamlFromModels('schema.yml', 'models');</p>
<p><code>test.php</code>スクリプトを実行します:</p>
<blockquote><p>$ php test.php</p>
</blockquote>
<p><code>doctrine_test</code>ディレクトリのrootに作成された<code>schema.yml</code>という名前のファイルを見ます。内容は次の通りです:</p>
<blockquote><p>User: tableName: user columns: id: type: integer(8) primary: true</p>
</blockquote>
<p>autoincrement: true is\_active: type: integer(1) default: '1'
is\_super\_admin: type: integer(1) default: '0' created\_at: type:
timestamp(25) notnull: true updated\_at: type: timestamp(25) notnull:
true first\_name: string(255) last\_name: string(255) username:
string(255) password: string(255) type: string(255)</p>
<p>有効なYAMLスキーマファイルが手元にあるので、ここからスキーマを維持管理してPHPクラスを生成できます。<code>generate.php</code>という名前の新しいPHPスクリプトを作りましょう。このスクリプトはすべてを再生成しスクリプトが呼び出されるたびにデータベースを再インスタンス化します:</p>
<blockquote><p>// generate.php</p>
</blockquote>
<p>require\_once('bootstrap.php');</p>
<p>Doctrine\_Core::dropDatabases(); Doctrine\_Core::createDatabases();
Doctrine\_Core::generateModelsFromYaml('schema.yml', 'models');
Doctrine\_Core::createTablesFromModels('models');</p>
<p><code>schema.yml</code>を変更してターミナルから次のコマンドを実行してモデルを再生成できます:</p>
<blockquote><p>$ php generate.php</p>
</blockquote>
<p>YAMLスキーマファイルをセットアップしてスキーマファイルを再生成したのでファイルの内容を少し整頓してDoctrineの力を利用しましょう:</p>
<blockquote><p>User: actAs: [Timestampable] columns: is\_active: type: integer(1)</p>
</blockquote>
<p>default: '1' is\_super\_admin: type: integer(1) default: '0'
first\_name: string(255) last\_name: string(255) username: string(255)
password: string(255) type: string(255)</p>
<blockquote><p><strong>NOTE</strong> <strong>変更の注意点:</strong></p>
<p>1.) デフォルトなので明示的な<code>tableName</code>の定義を削除した。 2.)
<code>Timestampable</code>ビヘイビアを添付した。 3.)
主キーが定義されていない場合自動的に追加されるので<code>id</code>カラムを削除した。
4.)
<code>Timestampable</code>ビヘイビアで自動的に処理できるので<code>updated\_at</code>と<code>created_at</code>カラムを削除した。</p>
<p>デフォルトを利用することでYAMLはきれいになりコアのビヘイビアを活用するほど自分自身で行わなければならない作業は少なくなります。</p>
</blockquote>
<p>YAMLスキーマファイルからモデルを再生成します:</p>
<blockquote><p>$ php generate.php</p>
</blockquote>
<p>[doc yaml-schema-files
専用の章]でYAMLスキーマファイルに関する詳しい内容を学びます。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">モデルを書く<i class="fas fa-link"></i></a></h1>
<p>オプションとしてすべてのコンビニエンスメソッドをスキップして独自のPHPコードだけでモデルを書くことができます。[doc
defining-models :name]の章でモデルの構文のすべてを学びます。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">モデルをオートロードする<i class="fas fa-link"></i></a></h1>
<p>Doctrineはモデルをロードするための方法を2つ:コンサーバティブ(遅延)ロード、アグレッシブロードを提供します。コンサーバティブロードは初期にはPHPファイルを必要としません。代わりにクラスの名前へのパスをキャッシュしこのパスはspl\_autoload\_register()で初期に登録した<code>Doctrine_Core::autoload()</code>で使われます。両方のモデルのロード方法を利用した例は次の通りです。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">コンサーバティブ<i class="fas fa-link"></i></a></h2>
<p>コンサーバティブ(conservative -
慎重な・控えめな)なモデルロードは本番環境では理想的なモデルのロードメソッドになりつつあります。このメソッドはモデルのロードが実行されるときすべてのモデルをロードする代わりに遅延ロードします。</p>
<p>コンサーバティブなモデルロードはそれぞれが1つのクラスを持ち、ファイルの名前はクラスから名付けなければなりません。例えば、<code>User</code>というクラスがある場合、<code>User.php</code>という名前のファイルに含まれなければなりません。</p>
<p>コンサーバティブなモデルロードを使うにはモデルロードの属性をコンサーバティブにする必要があります:</p>
<blockquote><p>$manager-&gt;setAttribute(Doctrine\_Core::ATTR\_MODEL\_LOADING,</p>
</blockquote>
<p>Doctrine\_Core::MODEL\_LOADING\_CONSERVATIVE);</p>
<blockquote><p><strong>NOTE</strong>
以前のステップで<code>bootstrap.php</code>ファイルでこの変更をすでに行っているので再度同じ変更する必要はありません。</p>
</blockquote>
<p><code>Doctrine_Core::loadModels()</code>の機能を使うとき見つかるすべてのクラスは内部でキャッシュされるのでオートローダーは後でそれらを読み込むことができます。</p>
<blockquote><p>Doctrine\_Core::loadModels('models');</p>
</blockquote>
<p>新しいクラス、例えば<code>User</code>クラスをインスタンス化するとき、オートローダーが起動しクラスが読み込まれます。</p>
<blockquote><p>// Doctrine\_Core::autoload()の呼び出しが行われクラスが読み込まれる</p>
</blockquote>
<p>$user = new User();</p>
<p>上記でクラスをインスタンス化することで<code>Doctrine\_Core::autoload()</code>の呼び出しが行われ<code>Doctrine_Core::loadModels()</code>のコールで見つかったクラスが読み込まれ利用可能になります。</p>
<blockquote><p><strong>NOTE</strong>
必要がないときにモデルをクラスをすべて読み込むと不要なオーバーヘッドが生じるので、必要なときだけ読み込みたい場合、とりわけ本番環境でコンサーバティブなモデルロードは推奨されます。</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">アグレッシブ<i class="fas fa-link"></i></a></h2>
<p>アグレッシブ(aggressive -
積極的な)なモデルロードはデフォルトのモデルロードメソッドでとても便利です。<code>.php</code>拡張子を持つファイルをすべて探し読み込みます。Doctrineは継承を満たすことができないで、モデルが別のクラスを継承する場合、正しい順序でそれらのクラスを読み込むことはできません。なのですべての依存関係がそれぞれのクラスで満たされるようにするのはあなたの仕事です。</p>
<p>アグレッシブなモデルロードではファイルごとに複数のクラスを用意しファイルの名前はファイル内部のクラスの名前と関連する必要はありません。</p>
<p>アグレッシブなモデルロードの欠点はすべてのPHPファイルがすべてのリクエストに含まれるので、たくさんのモデルがある場合コンサーバティブなモデルロードを使うことをお勧めします。</p>
<p>アグレッシブなモデルロードを使うにはモデルロード属性をアグレッシブに設定する必要があります:</p>
<blockquote><p>$manager-&gt;setAttribute(Doctrine\_Core::ATTR\_MODEL\_LOADING,</p>
</blockquote>
<p>Doctrine\_Core::MODEL\_LOADING\_AGGRESSIVE);</p>
<blockquote><p><strong>TIP</strong>
アグレッシブなモデルロードはデフォルトのロード属性なので使う場合は明示的に設定する必要はありません。</p>
</blockquote>
<p><code>Doctrine_Core::loadModels()</code>の機能を使うとき見つかるすべてのクラスは直ちに読み込まれます:</p>
<blockquote><p>Doctrine\_Core::loadModels('/path/to/models');</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">まとめ<i class="fas fa-link"></i></a></h1>
<p>この章はこれまでで最もハードだと思いますが良い内容です。モデルの使い方、既存のデータベースからモデルを生成する方法、独自のモデルを書く方法、とモデルをYAMLスキーマファイルとして管理する方法を少し学びました。モデルディレクトリからモデルをロードする機能を実装するためにDoctrineのテスト環境も修正しました。</p>
<p>Doctrineのモデルのトピックは非常に大きいので開発者がすべての情報を吸収しやすいように章を3つのピースに分割します。[doc
defining-models 次の章]においてモデルを定義するために使うAPIに入ります。</p>
<p></p>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?4138a7"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?493399"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            new Main();

            new Search(projectSlug, versionSlug, searchBoxSettings);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
        
            </body>
</html>
