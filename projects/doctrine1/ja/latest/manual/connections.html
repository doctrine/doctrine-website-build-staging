<!DOCTYPE html>
<html>
    <head>
        <title>はじめに - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?c8b404" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/css/railscasts.css?62eb49" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/ja/latest/manual/connections.html" />
        <meta property="og:title" content="はじめに - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?6c0dab" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
                    
<p></p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h1>
<p>最初から複数の接続を扱えるようにDoctrineは設計されてきました。個別に指定しない限りDoctrineはクエリの実行には現在の接続を使います。</p>
<p>この章ではDoctrineの接続の作成と扱い方を示します。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">接続を開く<i class="fas fa-link"></i></a></h1>
<p><code>Doctrine\_Manager</code>はスタティックメソッドの<code>Doctrine_Manager::connection()</code>を提供します。このメソッドは新しい接続を開きます。</p>
<p>この例では新しい接続を開く方法を示しています:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn =
Doctrine\_Manager::connection('mysql://username:password@localhost/test',
'connection 1');</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">接続を読み取る<i class="fas fa-link"></i></a></h1>
<p><code>Doctrine_Manager::connection()</code>メソッドを使用し引数を渡さない場合現在の接続が返されます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn2 = Doctrine\_Manager::connection();</p>
<p>if ($conn === $conn2) { echo 'Doctrine\_Manager::connection() returns
the current connection'; }</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">現在の接続<i class="fas fa-link"></i></a></h1>
<p>現在の接続は最後に開いた接続です。次の例では<code>Doctrine_Manager</code>インスタンスから現在の接続を取得する方法が示されています:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn2 =
Doctrine\_Manager::connection('mysql://username2:password2@localhost/test2',
'connection 2');</p>
<p>if ($conn2 === $manager-&gt;getCurrentConnection()) { echo 'Current
connection is the connection we just created!'; }</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">現在の接続を変更する<i class="fas fa-link"></i></a></h1>
<p><code>Doctrine_Manager::setCurrentConnection()</code>を呼び出すことで現在の接続を変更できます。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $manager-&gt;setCurrentConnection('connection 1');</p>
<p>echo $manager-&gt;getCurrentConnection()-&gt;getName(); // connection 1</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">接続を反復する<i class="fas fa-link"></i></a></h1>
<p>foreach句にマネージャーオブジェクトを渡すことで開いた接続をイテレートできます。<code>Doctrine_Manager</code>が特殊な<code>IteratorAggregate</code>インターフェイスを実装するのでこれは可能です。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... foreach($manager as $conn) { echo $conn-&gt;getName() . &quot;&quot;; }</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">接続名を取得する<i class="fas fa-link"></i></a></h1>
<p>次のコードで<code>Doctrine_Connection</code>インスタンスの名前を簡単に取得できます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn = Doctrine\_Manager::connection();</p>
<p>$name = `manager-&gt;getConnectionName(`\ conn);
echo $name; // connection 1</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">接続を閉じる<i class="fas fa-link"></i></a></h1>
<p>接続を閉じたりDoctrine接続レジストリから削除のは簡単です:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn = Doctrine\_Manager::connection();</p>
<p>`manager-&gt;closeConnection(`\ conn);
接続を閉じるがDoctrine接続レジストリから削除したくない場合は次のコードが利用できます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn = Doctrine\_Manager::connection(); $conn-&gt;close();</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">すべての接続を取得する<i class="fas fa-link"></i></a></h1>
<p><code>Doctrine_Manager::getConnections()</code>メソッドを使用して登録されたすべての接続の配列を読み取ることができます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conns = `manager-&gt;getConnections(); foreach (`\ conns as$conn) { echo $conn-&gt;getName() . &quot;&quot;; }</p>
<p>上記のコードは初期の頃に<code>Doctrine_Manager</code>オブジェクトをイテレートすることと同じです。再度掲載します:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... foreach ($manager as $conn) { echo $conn-&gt;getName() . &quot;&quot;; }</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">接続をカウントする<i class="fas fa-link"></i></a></h1>
<p><code>Countable</code>インターフェイスを実装するので<code>Doctrine_Manager</code>オブジェクトから接続数を取得できます。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... `num = count(`\ manager);
echo $num;</p>
<p>上記のコードは次のコードと同じです:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $num = $manager-&gt;count();</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">データベースの作成と削除<i class="fas fa-link"></i></a></h1>
<p>Doctrineを使用して接続を作成するとき、これらの接続に関連するデータベースの作成と削除する機能が簡単に手に入ります。</p>
<p><code>Doctrine\_Manager</code>もしくは<code>Doctrine_Connection</code>クラスで提供されるメソッドを使うことで簡単にできます。</p>
<p>次のコードではインスタンス化された接続をすべてイテレートして<code>dropDatabases()</code>/<code>createDatabases()</code>メソッドを呼び出します:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $manager-&gt;createDatabases();</p>
<p>$manager-&gt;dropDatabases();</p>
<p><strong>特定の接続に対してデータベースを削除/作成する</strong></p>
<p>接続インスタンスで<code>dropDatabase()</code>/<code>createDatabase()</code>メソッドを呼び出すことで特定の<code>Doctrine_Connection</code>インスタンス用のデータベースを削除もしくは作成できます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn-&gt;createDatabase();</p>
<p>$conn-&gt;dropDatabase();</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">カスタム接続を書く<i class="fas fa-link"></i></a></h1>
<p>ときには独自のカスタム接続クラスを作りこれらを活用する機能が必要になることがあります。mysqlを拡張するもしくは独自のデータベース型を独自に書くことが必要になることがあります。これはいくつかのクラスを書き接続型をDoctrineに登録することで可能です。</p>
<p>カスタム接続を作成するにはまず次のクラスを書く必要があります。</p>
<blockquote><p>class Doctrine\_Connection\_Test extends Doctrine\_Connection\_Common {</p>
</blockquote>
<p>}</p>
<p>class Doctrine\_Adapter\_Test implements Doctrine\_Adapter\_Interface {
// ... all the methods defined in the interface }</p>
<p>ではこれらをDoctrineに登録します:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $manager-&gt;registerConnectionDriver('test',
'Doctrine\_Connection\_Test');</p>
<p>次のような少しの変更でこれが実現されます:</p>
<blockquote><p>$conn =</p>
</blockquote>
<p>$manager-&gt;openConnection('test://username:password@localhost/dbname');</p>
<p>接続にどんなクラスが使われるのか確認すればそれらが上記で定義したクラスであることがわかります。</p>
<blockquote><p>echo</p>
</blockquote>
<p>get\_class(`conn); // Doctrine_Connection_Test echo get_class(`\ conn-&gt;getDbh());// Doctrine\_Adapter\_Test</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">まとめ<i class="fas fa-link"></i></a></h1>
<p>Doctrineの接続すべてを学びましたので[doc introduction-to-models
:name]の章でモデルに直に飛び込む準備ができました。Doctrineのモデルも少し学びました。少し遊んで最初のテストモデルを作成しDoctrineが提供するマジックを見ることになります。</p>
<p></p>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?4138a7"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?493399"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            new Main();

            new Search(projectSlug, versionSlug, searchBoxSettings);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
        
            </body>
</html>
