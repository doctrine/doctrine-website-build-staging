<!DOCTYPE html>
<html>
    <head>
        <title>エクスポート - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?c8b404" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/css/railscasts.css?62eb49" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/ja/latest/manual/database-abstraction-layer.html" />
        <meta property="og:title" content="エクスポート - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?6c0dab" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
                    
<p></p>
<p>Doctrine Database Abstraction
Layerは内臓されるフレームワークで、使用しているデータベースとコミュニケーションを行いデータベースタイプに応じて適切なSQLを送信するためにORMが使用しています。このフレームワークはデータベースが持つテーブルもしくはテーブルが持つフィールドのような情報をデータベースに問い合わせる機能も持ち、ORMが既存のデータベースからモデルを簡単に生成できる手段です。</p>
<p>このレイヤーはORMから独立して使うことができます。例えば既存のアプリケーションがPDOを直接使用しこれをDoctrine
ConnectionsとDBALを使うためにこれを移植したい場合に役立ちます。後のフェーズで新しいことのためにORMを使い始めたりORMで使えるように古いピースを書き直したりします。</p>
<p>DBALは少数の異なるモジュールで構成されます。この章では異なるモジュールとそれらが担っている仕事を検討します</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">エクスポート<i class="fas fa-link"></i></a></h1>
<p>Exportモジュールはデータベース構造を管理するためのメソッドを提供します。メソッドはそれぞれの責務に基づいて分類できます。例えばデータベースの要素をcreate、edit(alterもしくはupdate)、listもしくはdelete
(drop)するなどです。以下のドキュメントでは利用可能なメソッドの一覧と使い方の例を示します。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h2>
<p>Exportモジュールでメソッドを変更するすべてのスキーマはalterオペレーションのために使われるSQLを返す同等物を持ちます。例えば<code>createTable()</code>は<code>createTableSql()</code>によって返されるクエリを実行します。</p>
<p>この章では<code>events_db</code>という名前のデータベースで、次のテーブルが作成され、変更され最後には削除されます:</p>
<p><strong>events</strong></p>
<p>\&nbsp; 名前 \&nbsp; 型 \&nbsp; Primary \&nbsp; Auto Increment \ \ <code>id</code>
\ <code>integer</code> \ <code>true</code> \ <code>true</code> \ \ <code>name</code> \
<code>string(255)</code> \ <code>false</code> \ <code>false</code> \ \ <code>datetime</code>
\ <code>timestamp</code> \ <code>false</code> \ <code>false</code> \</p>
<p><strong>people</strong></p>
<p>\&nbsp; 名前 \&nbsp; 型 \&nbsp; Primary \&nbsp; Auto Increment \ \ <code>id</code>
\ <code>integer</code> \ <code>true</code> \ <code>true</code> \ \ <code>name</code> \
<code>string(255)</code> \ <code>false</code>\ <code>false</code> \</p>
<p><strong>event\_participants</strong></p>
<p>\&nbsp; 名前 \&nbsp; 型 \&nbsp; Primary \&nbsp; Auto Increment \ \
<code>event_id</code> \ <code>integer</code> \ <code>true</code> \ <code>false</code> \ \
<code>person_id</code> \ <code>string(255)</code> \ <code>true</code> \ <code>false</code> \</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">データベースを作成する<i class="fas fa-link"></i></a></h2>
<p>Doctrineで新しいデータベースを作成するのはシンプルです。作成するデータベースの名前を引数にして<code>createDatabase()</code>メソッドを呼び出すだけです。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn-&gt;export-&gt;createDatabase('events\_db');</p>
<p>新しい<code>events_db</code>に接続するために<code>bootstrap.php</code>ファイルの接続を変更してみましょう:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>/\<em>\</em> \<em> Bootstrap Doctrine.php, register autoloader and specify \</em>
configuration attributes \*/</p>
<p>// ...</p>
<p>$conn =
Doctrine\_Manager::connection('mysql://root:@localhost/events\_db',
'doctrine');</p>
<p>// ...</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">テーブルを作成する<i class="fas fa-link"></i></a></h2>
<p>データベースは作成され接続を再設定しました。テーブルに追加に移ります。<code>createTable()</code>メソッドは3つのパラメータ:
テーブルの名前、フィールド定義の配列、と追加オプション(オプションでRDBMS固有)を受けとります。</p>
<p><code>events</code>テーブルを作成しましょう:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// $definition = array( 'id' =&gt; array( 'type' =&gt; 'integer', 'primary' =&gt;
true, 'autoincrement' =&gt; true ), 'name' =&gt; array( 'type' =&gt; 'string',
'length' =&gt; 255 ), 'datetime' =&gt; array( 'type' =&gt; 'timestamp' ) );</p>
<p>$conn-&gt;export-&gt;createTable('events', $definition);</p>
<p>定義配列のキーはテーブルのフィールド名です。値は他のキーと同じように必須キーの<code>type</code>を格納する配列で、<code>type</code>の値によって、<code>type</code>キーの値はDoctrineのデータ型と同じものが可能です。データ型によって、他のオプションが変わることがあります。</p>
<p>\&nbsp; データ型 \&nbsp; 長さ \&nbsp; デフォルト \&nbsp; not null \&nbsp; unsigned
\&nbsp; autoincrement \ \ <code>string</code> \ x \ x \ x \ \
\ \ <code>boolean</code> \ \ x \ x \ \ \ \ <code>integer</code>
\ x \ x \ x \ x \ x \ \ <code>decimal</code> \ \ x
\ x \ \ \ \ <code>float</code> \ \ x \ x \ \ \
\ <code>timestamp</code> \ \ x \ x \ \ \ \ <code>time</code> \
\ x \ x \ \ \ \ <code>date</code> \ \ x \ x \ \
\ \ <code>clob</code> \ x \ \ x \ \ \ \ <code>blob</code> \
x \ \ x \ \ \</p>
<p><code>people</code>テーブルを作ることができます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $definition = array( 'id' =&gt; array( 'type' =&gt; 'integer',
'primary' =&gt; true, 'autoincrement' =&gt; true ), 'name' =&gt; array( 'type' =&gt;
'string', 'length' =&gt; 255 ) );</p>
<p>$conn-&gt;export-&gt;createTable('people', $definition);</p>
<p><code>createTable()</code>メソッドの3番目の引数としてオプションの配列を指定することもできます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $options = array( 'comment' =&gt; 'Repository of people',
'character\_set' =&gt; 'utf8', 'collate' =&gt; 'utf8\_unicode\_ci', 'type' =&gt;
'innodb', );</p>
<p>// ...</p>
<p>$conn-&gt;export-&gt;createTable('people', $definition, $options);</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">外部キーを作成する<i class="fas fa-link"></i></a></h2>
<p>外部キーで<code>event_participants</code>テーブルを作成します:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $options = array( 'foreignKeys' =&gt; array( 'events\_id\_fk' =&gt;
array( 'local' =&gt; 'event\_id', 'foreign' =&gt; 'id', 'foreignTable' =&gt;
'events', 'onDelete' =&gt; 'CASCADE', ) ), 'primary' =&gt; array('event\_id',
'person\_id'), );</p>
<p>$definition = array( 'event\_id' =&gt; array( 'type' =&gt; 'integer',
'primary' =&gt; true ), 'person\_id' =&gt; array( 'type' =&gt; 'integer',
'primary' =&gt; true ), );</p>
<p>$conn-&gt;export-&gt;createTable('event\_participants', $definition,
$options);</p>
<blockquote><p><strong>TIP</strong>
上記の例で<code>person_id</code>に対して外部キーを省略していることに注目してください。この例では次の例で個別の外部キーをテーブルに追加する方法を示すために省略しました。通常は<code>foreignKeys</code>で定義された両方の外部キーがあることがベストです。</p>
</blockquote>
<p><code>person\_id</code>カラムの<code>event_participants</code>テーブルに見つからない外部キーを追加してみましょう:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $definition = array('local' =&gt; 'person\_id', 'foreign' =&gt; 'id',
'foreignTable' =&gt; 'people', 'onDelete' =&gt; 'CASCADE');</p>
<p>$conn-&gt;export-&gt;createForeignKey('event\_participants', $definition);</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">テーブルを変更する<i class="fas fa-link"></i></a></h2>
<p><code>Doctrine_Export</code>ドライバはデータベースがポータブルでありながら既存のデータベーステーブルを簡単に変更する方法を提供します。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $alter = array( 'add' =&gt; array( 'new\_column' =&gt; array( 'type' =&gt;
'string', 'length' =&gt; 255 ), 'new\_column2' =&gt; array( 'type' =&gt;
'string', 'length' =&gt; 255 ) ) );</p>
<p>echo $conn-&gt;export-&gt;alterTableSql('events', $alter);</p>
<p><code>alterTableSql()</code>への呼び出しは次のSQLクエリを出力します:</p>
<blockquote><p>ALTER TABLE events ADD new\_column VARCHAR(255), ADD new\_column2</p>
</blockquote>
<p>VARCHAR(255)</p>
<blockquote><p><strong>NOTE</strong>
生成SQLのみを実行しこれを返したくない場合、<code>alterTable()</code>メソッドを使います。</p>
<p>test.php</p>
</blockquote>
<p>// ...</p>
<p>$conn-&gt;export-&gt;alterTable('events', $alter);</p>
<p><code>alterTable()</code>メソッドは2つのパラメータを必須とし3番目のパラメータはオプションです:</p>
<p>\&nbsp; 名前 \&nbsp; 型 \&nbsp; 説明 \ \
//`name// \\\|</p>
<p>オプションの3番目のパラメータ(デフォルト: false):</p>
<p>\&nbsp; 名前 \&nbsp; 型 \&nbsp; 説明 \ \ //$check// \ <code>boolean</code>
\ 実行前にDBMSが実際にオペレーションを実行できるかチェックする \</p>
<p>現在サポートされる変更のタイプは次のように定義されます:</p>
<p>\&nbsp; 変更 \&nbsp; 説明 \ \ //name// \ テーブル用の新しい名前
\ \ //add// \
配列のインデックスとして追加されるフィールドの名前を格納する連想配列。配列のそれぞれのエントリの値は追加されるフィールドのプロパティを格納する別の連想配列に設定されます。フィールドのプロパティはDoctrineパーサーによって定義されたものと同じです。\
\ // remove// \
配列のインデックスとして削除されるフィールドの名前を格納する連想配列。現在それぞれのエントリに割り当てられた値は無視されます。空の配列は将来の互換性のために使われます。\
\ //rename// \
配列のインデックスとしてリネームされるフィールドの名前を格納する連想配列。配列のそれぞれのエントリの値は別の連想配列に設定されます。この別の連想配列は新しいフィールド名と<code>CREATE
TABLE</code>文として使われるDBM固有のSQLコードで既にあるフィールドの宣言の一部を格納するものとして設定されるDeclarationという名前のエントリを持ちます。\
\ //change// \
配列のインデックスとして変更されるフィールドの名前を格納する連想配列。フィールドと他のプロパティを変更するか、change配列エントリは配列インデックスとしてフィールドの新しい名前を格納するかを念頭においてください。\</p>
<p>配列のそれぞれのエントリの値はフィールドのプロパティを格納する別の連想配列に設定されます。これは配列エントリとして変更されることを意味します。これらのエントリはそれぞれのプロパティの新しい値に割り当てられます。フィールドのプロパティはDoctrineパーサーが定義するものと同じです。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $alter = array('name' =&gt; 'event', 'add' =&gt; array( 'quota' =&gt;
array( 'type' =&gt; 'integer', 'unsigned' =&gt; 1 ) ), 'remove' =&gt; array(
'new\_column2' =&gt; array() ), 'change' =&gt; array( 'name' =&gt; array(
'length' =&gt; '20', 'definition' =&gt; array( 'type' =&gt; 'string', 'length' =&gt;
20 ) ) ), 'rename' =&gt; array( 'new\_column' =&gt; array( 'name' =&gt; 'gender',
'definition' =&gt; array( 'type' =&gt; 'string', 'length' =&gt; 1, 'default' =&gt;
'M' ) ) )</p>
<div class="console"><pre><code class="console"><span class="noselect">$ </span>);
</code></pre></div>
<p>$conn-&gt;export-&gt;alterTable('events', $alter);</p>
<blockquote><p><strong>NOTE</strong>
テーブルを<code>event</code>にリネームしたことに注目してください。テーブルを<code>events</code>にリネームし直しましょう。機能を示すためだけにテーブルをリネームしたので次の例のためにテーブルを<code>events</code>と名づける必要があります。</p>
<p>test.php</p>
</blockquote>
<p>// ... $alter = array( 'name' =&gt; 'events' );</p>
<p>$conn-&gt;export-&gt;alterTable('event', $alter);</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">インデックスを作成する<i class="fas fa-link"></i></a></h2>
<p>インデックスを作成するために、<code>createIndex()</code>メソッドが使われます。このメソッドは<code>createConstraint()</code>と似たシグニチャを持ち、テーブルの名前、インデックスの名前と定義配列を受け取ります。定義配列は<code>fields</code>という名前の1つのキーを持ち、その値はインデックスの一部であるフィールドを格納する別の連想配列です。フィールドは次のキーを持つ配列として定義されます:
ソート、昇順と降順の長さを持つ値、整数値</p>
<p>すべてのRDBMSはインデックスソートもしくは長さをサポートしないので、これらの場合ドライバはこれらを無視します。テストのeventデータベースでは、アプリケーションが固有のtimeframeで起きるイベントを表示することを前提とすることができます。selectは<code>WHERE</code>条件でdatatimeフィールドを使います。このフィールドにインデックスが存在する場合に手助けになります。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $definition = array( 'fields' =&gt; array( 'datetime' =&gt; array() )
);</p>
<p>$conn-&gt;export-&gt;createIndex('events', 'datetime', $definition);</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">データベースの要素を削除する<i class="fas fa-link"></i></a></h2>
<p>上記で示されたそれぞれの<code>create*()</code>メソッドに対して、データベース、テーブル、フィールド、インデックスもしくは制約を削除するために対応する<code>drop*()</code>メソッドが存在します。<code>drop\*()</code>メソッドは削除されるアイテムの存在をチェックしません。try-catchブロックを使用して例外をチェックするのは開発者の責務です:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... try { $conn-&gt;export-&gt;dropSequence('nonexisting'); }
catch(Doctrine\_Exception $e) {</p>
<p>}</p>
<p>次のコードで制約を簡単に削除できます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn-&gt;export-&gt;dropConstraint('events', 'PRIMARY', true);</p>
<blockquote><p><strong>NOTE</strong> 3番目の引数はこれが主キーであることのヒントを与えます。</p>
<p>test.php</p>
</blockquote>
<p>// ... $conn-&gt;export-&gt;dropConstraint('event\_participants',
'event\_id');</p>
<p>次のコードでインデックスを簡単に削除できます:</p>
<blockquote><p>$conn-&gt;export-&gt;dropIndex('events', 'event\_timestamp');</p>
<blockquote><p><strong>TIP</strong>
次の2つの例を実際に実行するのは推奨されません。次のセクションで我々の例が無傷で動作できるように<code>events_db</code>が必要です。</p>
</blockquote>
</blockquote>
<p>次のコードでデータベースからテーブルを削除します:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn-&gt;export-&gt;dropTable('events');</p>
<p>次のコードでデータベースを削除できます:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $conn-&gt;export-&gt;dropDatabase('events\_db');</p>
<hr />
<a class="section-anchor" id="import" name="import"></a><h1 class="section-header"><a href="#import">Import<i class="fas fa-link"></i></a></h1>
<p>importモジュールによってデータベース接続の内容を検証できます。それぞれのデータベースとそれぞれのデータベースのスキーマを学びます。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">紹介<i class="fas fa-link"></i></a></h2>
<p>データベースに何があるのか見るために、Importモジュールの<code>list\*()</code>ファミリーのメソッドを使うことができます。</p>
<p>\&nbsp; 名前 \&nbsp; 説明 \ \ <code>listDatabases()</code> \
データベースの一覧を表示する。\ \ <code>listFunctions()</code> \
利用可能なメソッドの一覧を表示する。\ \
<code>listSequences(`dbName)</code> \\\\\\\\\\\|</p>
<p>下記において上記のメソッドの使い方の例が見つかります:</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">データベースの一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<a class="section-anchor" id="databases-conn-gt-import-gt-listdatabases-print-r-databases" name="databases-conn-gt-import-gt-listdatabases-print-r-databases"></a><h2 class="section-header"><a href="#databases-conn-gt-import-gt-listdatabases-print-r-databases">// ... $databases = `conn-&gt;import-&gt;listDatabases(); print_r(`\ databases);<i class="fas fa-link"></i></a></h2>
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">シーケンスの一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<a class="section-anchor" id="conn-gt-import-gt-listsequences-events-db-print-r-sequences" name="conn-gt-import-gt-listsequences-events-db-print-r-sequences"></a><h2 class="section-header"><a href="#conn-gt-import-gt-listsequences-events-db-print-r-sequences">`conn-&gt;import-&gt;listSequences('events_db'); print_r(`\ sequences);<i class="fas fa-link"></i></a></h2>
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">制約の一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<a class="section-anchor" id="conn-gt-import-gt-listtableconstraints-event-participants-print-r-constraints" name="conn-gt-import-gt-listtableconstraints-event-participants-print-r-constraints"></a><h2 class="section-header"><a href="#conn-gt-import-gt-listtableconstraints-event-participants-print-r-constraints">`conn-&gt;import-&gt;listTableConstraints('event_participants'); print_r(`\ constraints);<i class="fas fa-link"></i></a></h2>
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">テーブルカラムの一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<a class="section-anchor" id="conn-gt-import-gt-listtablecolumns-events-print-r-columns" name="conn-gt-import-gt-listtablecolumns-events-print-r-columns"></a><h2 class="section-header"><a href="#conn-gt-import-gt-listtablecolumns-events-print-r-columns">`conn-&gt;import-&gt;listTableColumns('events'); print_r(`\ columns);<i class="fas fa-link"></i></a></h2>
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">テーブルインデックスの一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<a class="section-anchor" id="conn-gt-import-gt-listtableindexes-events-print-r-indexes" name="conn-gt-import-gt-listtableindexes-events-print-r-indexes"></a><h2 class="section-header"><a href="#conn-gt-import-gt-listtableindexes-events-print-r-indexes">`conn-&gt;import-&gt;listTableIndexes('events'); print_r(`\ indexes);<i class="fas fa-link"></i></a></h2>
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">テーブルの一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p>$tables = `conn-&gt;import-&gt;listTables(); print_r(`\ tables);</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">ビューの一覧を表示する<i class="fas fa-link"></i></a></h2>
<blockquote><p><strong>NOTE</strong>
現在、ビューを作成するメソッドは存在しないので、手動で作成してください。</p>
<p>l = &quot;CREATE VIEW names\_only AS SELECT name FROM people&quot;;</p>
</blockquote>
<p>`conn-&gt;exec(`\ sql);
$sql = &quot;CREATE VIEW last\_ten\_events AS SELECT \* FROM events ORDER BY
id DESC LIMIT 0,10&quot;; `conn-&gt;exec(`\ sql);
先ほど作成したビューの一覧を表示できます:</p>
<blockquote><p>$views = `conn-&gt;import-&gt;listViews(); print_r(`\ views);</p>
</blockquote>
<hr />
<a class="section-anchor" id="datadict" name="datadict"></a><h1 class="section-header"><a href="#datadict">DataDict<i class="fas fa-link"></i></a></h1>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h2>
<p>ネイティブのRDBMの型をDoctrineの型に変換するもしくはその逆を行うためにDoctrineは内部で<code>DataDict</code>モジュールを使用します。<code>DataDict</code>モジュールは変換のために2つのメソッドを使用します:</p>
<ul><li class="dash"> <code>getPortableDeclaration()</code>はネイティブなRDBMSの型宣言をポータブルなDoctrine宣言に変換するために使われる</li>
<li class="dash"> <code>getNativeDeclaration()</code>はDoctrine宣言をドライバ固有の型宣言に変換するために使われる</li>
</ul>

<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">ポータブルな宣言を取得する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $declaration =
$conn-&gt;dataDict-&gt;getPortableDeclaration('VARCHAR(255)');</p>
<p>print\_r($declaration);</p>
<p>上記の例は次の内容を出力します:</p>
<blockquote><p>$ php test.php Array ( [type] =&gt; Array ( [0] =&gt; string )</p>
</blockquote>
<div class="console"><pre><code class="console">[length] => 255
[unsigned] => 
[fixed] => </code></pre></div>
<p>)</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">ネイティブな宣言を取得する<i class="fas fa-link"></i></a></h2>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $portableDeclaration = array( 'type' =&gt; 'string', 'length' =&gt; 20,
'fixed' =&gt; true );</p>
<p>$nativeDeclaration = `conn-&gt;dataDict-&gt;getNativeDeclaration(`\ portableDeclaration);
echo $nativeDeclaration;</p>
<p>上記の例は次の内容を出力します:</p>
<blockquote><p>$ php test.php CHAR(20)</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">ドライバ<i class="fas fa-link"></i></a></h1>
<hr />
<a class="section-anchor" id="mysql" name="mysql"></a><h2 class="section-header"><a href="#mysql">Mysql<i class="fas fa-link"></i></a></h2>
<hr />
<a class="section-anchor" id="" name=""></a><h3 class="section-header"><a href="#">テーブル型を設定する<i class="fas fa-link"></i></a></h3>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $fields = array( 'id' =&gt; array( 'type' =&gt; 'integer',
'autoincrement' =&gt; true ), 'name' =&gt; array( 'type' =&gt; 'string', 'fixed'
=&gt; true, 'length' =&gt; 8 ) );</p>
<blockquote><p><strong>NOTE</strong> 次のオプションはMySQL固有で他のドライバはスキップします。</p>
<p>tions = array('type' =&gt; 'INNODB');</p>
</blockquote>
<p>$sql = $conn-&gt;export-&gt;createTableSql('test\_table', $fields); echo
$sql[0];</p>
<p>上記の例は次のSQLクエリを出力します:</p>
<blockquote><p>CREATE TABLE test\_table (id INT AUTO\_INCREMENT, name CHAR(8)) ENGINE</p>
</blockquote>
<p>= INNODB</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">まとめ<i class="fas fa-link"></i></a></h1>
<p>この章は本当に素晴らしいものです。Doctrine
DBALはそれ自身が偉大なツールです。おそらく最も機能を持つものの1つでPHPデータベース抽象化レイヤーを簡単に利用できます。</p>
<p>[doc transactions :name]の使い方を学ぶ準備が整いました。</p>
<p></p>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?4138a7"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?493399"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            new Main();

            new Search(projectSlug, versionSlug, searchBoxSettings);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
        
            </body>
</html>
