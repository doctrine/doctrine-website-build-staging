<!DOCTYPE html>
<html>
    <head>
        <title>はじめに - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?c8b404" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/css/railscasts.css?62eb49" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/ja/latest/manual/caching.html" />
        <meta property="og:title" content="はじめに - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?6c0dab" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
                    
<p></p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h1>
<p><code>Doctrine_Cache</code>は直感的で使いやすいキャッシュのソリューションを提供します。:</p>
<ul><li class="dash"> 複数のキャッシュのバックエンド(Memcached、APCとSqliteを服務)</li>
<li class="dash"> 微調整できる高度なオプション。<code>Doctrine_Cache</code>はパフォーマンスの微調整用のたくさんのオプションを持つ。</li>
</ul>

<p>すべてのキャッシュドライバは次のようにインスタンス化されます:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $options = array();
`cacheDriver = new Doctrine_Cache_Memcache(`\ options);
    <strong>NOTE</strong>
    それぞれのドライバは配列<code>$options</code>用の独自の値を持ちます。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">ドライバ<i class="fas fa-link"></i></a></h1>
<hr />
<a class="section-anchor" id="memcache" name="memcache"></a><h2 class="section-header"><a href="#memcache">Memcache<i class="fas fa-link"></i></a></h2>
<p>Memcacheドライバはキャッシュレコードをmemcachedサーバーに保存します。Memcachedはハイパフォーマンスで、
分散型のメモリオブジェクトキャッシュシステムです。これをバックエンドに使うには、memcachedデーモンとPECLのmemcacheエクステンションが必要です。</p>
<p>Memcacheキャッシュドライバは次のコードでインスタンス化できます:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $servers = array( 'host' =&gt; 'localhost', 'port' =&gt; 11211,
'persistent' =&gt; true );</p>
<p>$cacheDriver = new Doctrine\_Cache\_Memcache(array( 'servers' =&gt;
$servers, 'compression' =&gt; false ) );</p>
<blockquote><p><strong>NOTE</strong> Memcacheは複数のサーバーを許可します。</p>
</blockquote>
<p>Memcacheドライバで利用できるオプション:</p>
<p>\&nbsp; オプション \&nbsp; データ型 \&nbsp; デフォルト値 \&nbsp; 説明 \ \
<code>servers</code> \ <code>array</code> \ <code>array(array('host' =&gt;
'localhost','port' =&gt; 11211, 'persistent' =&gt; true))</code> \
memcachedサーバーの配列;
それぞれのmemcachedサーバーは連想配列で記述される: <code>'host' =&gt;
(string)</code> : memcachedサーバーの名前、<code>'port' =&gt; (int)</code> :
memcachedサーバーのポート、<code>'persistent' =&gt; (bool)</code> :
memcachedサーバーへの永続接続を使うかどうか \ \ <code>compression</code>
\ <code>boolean</code> \ <code>false</code> \ 即座に圧縮したい場合は<code>true</code> \</p>
<hr />
<a class="section-anchor" id="apc" name="apc"></a><h2 class="section-header"><a href="#apc">APC<i class="fas fa-link"></i></a></h2>
<p>Alternative PHP Cache
(APC)はフリーでPHPのためのオープンなオプコードキャッシュです。これはPHPの中間コードのキャッシュと最適化のための頑強なフレームワークとも認識されています。DoctrineのAPCキャッシュドライバはキャッシュレコードを共用メモリに保存します。</p>
<p>次のコードでAPCキャッシュドライバをインスタンス化できます:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $cacheDriver = new Doctrine\_Cache\_Apc();</p>
<hr />
<a class="section-anchor" id="db" name="db"></a><h2 class="section-header"><a href="#db">Db<i class="fas fa-link"></i></a></h2>
<p>Dbキャッシュバックエンドはキャッシュレコードを任意のデータベースに保存します。通常は処理が速いフラットファイルベースのデータベースが使われます(sqliteなど)。</p>
<p>次のコードでデータベースキャッシュをインスタンス化できます:</p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $cacheConn = Doctrine\_Manager::connection(new
PDO('sqlite::memory:')); $cacheDriver = new
Doctrine\_Cache\_Db(array('connection' =&gt; $cacheConn));</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">クエリキャッシュと結果キャッシュ<i class="fas fa-link"></i></a></h1>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h2>
<p>DoctrineはDQLクエリの最終結果(データ)と同様にDQLの解析処理の結果をキャッシュする方法を提供します。これら2つのキャッシュメカニズムはパフォーマンスを大いに向上させます。DQLクエリ実行の標準ワークフローを考えてみましょう:</p>
<a class="section-anchor" id="dql" name="dql"></a><h1 class="section-header"><a href="#dql">新しいDQLクエリを初期化する<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="dql" name="dql"></a><h1 class="section-header"><a href="#dql">DQLクエリを解析する<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="sql" name="sql"></a><h1 class="section-header"><a href="#sql">データベース固有のSQLクエリをビルドする<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="sql" name="sql"></a><h1 class="section-header"><a href="#sql">SQLクエリを実行する<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">結果セットをビルドする<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">結果セットを返す<i class="fas fa-link"></i></a></h1>
<p>これらのフェーズはとても時間がかかります。とりわけクエリをデータベースサーバーに送信するフェーズ4は時間がかかります。Doctrineクエリキャッシュが実行されているとき次のフェーズが行われます:</p>
<a class="section-anchor" id="dql" name="dql"></a><h1 class="section-header"><a href="#dql">新しいDQLクエリを初期化する<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="sql" name="sql"></a><h1 class="section-header"><a href="#sql">SQLクエリを実行する(キャッシュから取得)<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">結果セットをビルドする<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">結果セットを返す<i class="fas fa-link"></i></a></h1>
<p>DQLクエリが有効なキャッシュエントリーを持つ場合キャッシュされたSQLクエリが使われ、さもなければフェーズ2-3が実行されこれらのステップの結果がキャッシュに保存されます。最新のクエリ結果を常に得られるのでクエリキャッシュには不都合なことはありません。</p>
<blockquote><p><strong>NOTE</strong>
本番環境では常にクエリキャッシュを使うべきです。すなわち開発期間も簡単に使えます。DQLクエリを変更して実行するときキャッシュが修正されたことをDoctrineが最初に確認して新しいキャッシュエントリを作ります。そのためキャッシュを取り消す必要はありません。</p>
</blockquote>
<p>クエリキャッシュの効率性がプリペアードステートメントの使い方(ともかくDoctrineはデフォルトで使用)に依存するのは無意味です。動的なクエリの部分を直接埋め込む代わりに常にプレースホルダーを使うべきです。</p>
<p>結果キャッシュを使えば状況がよくなります。クエリ処理は次のようになります(有効なキャッシュエントリが見つかることが前提):</p>
<a class="section-anchor" id="dql" name="dql"></a><h1 class="section-header"><a href="#dql">新しいDQLクエリを初期化する<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">結果セットを返す<i class="fas fa-link"></i></a></h1>
<p>ご覧の通り、結果キャッシュは以前示されたクエリキャッシュを暗に伝えます。クエリによって返されるデータが最新である必要がなければ結果キャッシュを使うことを常に考えるべきです。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">クエリキャッシュ<i class="fas fa-link"></i></a></h2>
<hr />
<a class="section-anchor" id="" name=""></a><h3 class="section-header"><a href="#">クエリキャッシュを使用する<i class="fas fa-link"></i></a></h3>
<p><code>Doctrine\_Core::ATTR\_QUERY_CACHE</code>属性を使用することで接続もしくは管理レベルのクエリキャッシュドライバを設定できます。接続レベルのキャッシュドライバを設定することはこの接続で実行されるすべてのドライバは特定のキャッシュドライバを使用するのに大してマネージャーレベルのキャッシュドライバを設定することは(接続レベルでオーバーライドされない限り)すべての接続が任意のキャッシュドライバを使用することを意味します。</p>
<p><strong>マネージャーレベルのクエリキャッシュドライバを設定する:</strong></p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $manager-&gt;setAttribute(Doctrine\_Core::ATTR\_QUERY\_CACHE,
$cacheDriver);</p>
<blockquote><p><strong>NOTE</strong>
<code>$cacheDriver</code>の値はこの章の前のセクションでインスタンス化されたドライバになります。</p>
</blockquote>
<p><strong>接続レベルのキャッシュドライバを設定する:</strong></p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $conn-&gt;setAttribute(Doctrine\_Core::ATTR\_QUERY\_CACHE,
$cacheDriver);</p>
<hr />
<a class="section-anchor" id="" name=""></a><h3 class="section-header"><a href="#">微調整する<i class="fas fa-link"></i></a></h3>
<p>以前の章でグローバルキャッシュの属性を使いました。これらの属性はクエリレベルでオーバーライドできます。<code>useQueryCache()</code>を呼び出すことでキャッシュドライバをオーバーライドしてこれにDoctrineの有効なキャッシュドライバを渡すことができます。これはクエリキャッシュにはほとんど意味ありませんが可能です:</p>
<blockquote><p>$q = Doctrine\_Query::create() -&gt;useQueryCache(new</p>
</blockquote>
<p>Doctrine\_Cache\_Apc());</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">結果キャッシュ<i class="fas fa-link"></i></a></h2>
<hr />
<a class="section-anchor" id="" name=""></a><h3 class="section-header"><a href="#">結果キャッシュを使用する<i class="fas fa-link"></i></a></h3>
<p><code>Doctrine\_Core::ATTR\_RESULT_CACHE</code>を使用することで接続もしくはマネージャーレベルの結果キャッシュドライバを設定できます。接続レベルのキャッシュドライバはこの接続で実行されるすべてのクエリが指定されたキャッシュドライバを使用するのに対してマネージャーレベルのキャッシュドライバは(接続レベルでオーバーライドされない限り)すべての接続が任意のキャッシュドライバを使用することを意味します。</p>
<p><strong>マネージャーレベルのキャッシュドライバを設定する:</strong></p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $manager-&gt;setAttribute(Doctrine\_Core::ATTR\_RESULT\_CACHE,
$cacheDriver);</p>
<p><strong>接続レベルのキャッシュドライバを設定する:</strong></p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ... $conn-&gt;setAttribute(Doctrine\_Core::ATTR\_RESULT\_CACHE,
$cacheDriver);</p>
<p>通常キャッシュエントリは同じ時間に対してのみ有効です。<code>Doctrine\_Core::ATTR\_RESULT\_CACHE_LIFESPAN</code>を使用することでキャッシュエントリの有効な期間のためのグローバルな値を設定できます。</p>
<p><strong>寿命を1時間に設定する(60秒 \* 60 = 1時間 = 3600秒):</strong></p>
<blockquote><p>// bootstrap.php</p>
</blockquote>
<p>// ...
$manager-&gt;setAttribute(Doctrine\_Core::ATTR\_RESULT\_CACHE\_LIFESPAN,
3600);</p>
<p>キャッシュドライバを設定したので<code>userResultCache()</code>メソッドを呼び出すことでDQLクエリを使うことができます:</p>
<p><strong>blog投稿のタイトルとコメントの数を取得する:</strong></p>
<blockquote><p>$q = Doctrine\_Query::create(); -&gt;select('b.title, COUNT(c.id) count')</p>
</blockquote>
<p>-&gt;from('BlogPost b') -&gt;leftJoin('b.Comments c') -&gt;limit(10)
-&gt;useResultCache(true);</p>
<p>$blogPosts = $q-&gt;execute();</p>
<hr />
<a class="section-anchor" id="" name=""></a><h3 class="section-header"><a href="#">微調整する<i class="fas fa-link"></i></a></h3>
<p>以前の章でグローバルキャッシュ属性を使いました。これらの属性はクエリレベルでオーバーライドできます。<code>useCache()</code>を呼び出してキャッシュドライバをオーバーライドしこれらにDoctrineのキャッシュドライバのインスタンスを渡すことができます。</p>
<blockquote><p>$q = Doctrine\_Query::create() -&gt;useResultCache(new</p>
</blockquote>
<p>Doctrine\_Cache\_Apc());</p>
<p><code>setResultCacheLifeSpan()</code>を呼び出すことでもlifespan属性をオーバーライドできます:</p>
<blockquote><p>$q = Doctrine\_Query::create() -&gt;setResultCacheLifeSpan(60 \* 30);</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">まとめ<i class="fas fa-link"></i></a></h1>
<p>開発と本番環境の両方でDoctrineのキャッシュ機能を使うことは大いにお勧めします。使うことで不都合な影響はなくアプリケーションのパフォーマンスの改善に役立ちます。</p>
<p>キャッシュ機能はこの本で検討される最後から2番目の機能です。この後のDoctrineで使われている[doc
technology テクノロジー]、[doc coding-standards コーディング規約]と[doc
unit-testing ユニットテスト]の章はまとめです。最後の機能である[doc
migrations :name]を検討するために移動しましょう。</p>
<p></p>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?4138a7"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?493399"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            new Main();

            new Search(projectSlug, versionSlug, searchBoxSettings);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
        
            </body>
</html>
