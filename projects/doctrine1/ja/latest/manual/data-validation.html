<!DOCTYPE html>
<html>
    <head>
        <title>はじめに - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?c8b404" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/css/railscasts.css?62eb49" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine1/ja/latest/manual/data-validation.html" />
        <meta property="og:title" content="はじめに - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?6c0dab" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
                    
<p></p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">はじめに<i class="fas fa-link"></i></a></h1>
<blockquote><p>[http://www.postgresql.jp/document/pg820doc/html/ddl-constraints.html
PostgreSQLのドキュメント]より引用: &gt;
データ型は、テーブルに格納するデータの種類を限定するための方法です。しかし、多くのアプリケーションでは、型が提供する制約では精密さに欠けます。例えば、製品の価格が入る列には、おそらく正数のみを受け入れるようにする必要があります。しかし、正数のみを受け入れるという標準のデータ型はありません。また、他の列や行に関連して列データを制約したい場合もあります。例えば、製品の情報が入っているテーブルでは、1つの製品番号についての行が2行以上あってはなりません。</p>
</blockquote>
<p>Doctrineによってカラムとテーブルで<em>ポータブルな</em>制約を定義できます。制約によってテーブルのデータを望むままにコントロールできます。ユーザーがカラムの制約に違反するデータを保存しようとすると、エラーが起動します。値がデフォルトの値の定義から来る場合でもこれが適用されます。</p>
<p>アプリケーションレベルのバリデータと同じようにDoctrineの制約はデータベースレベルの制約として振る舞います。このことは二重のセキュリティを意味します:
間違った種類の値とアプリケーションを許容しません。</p>
<p>Doctrineの範囲内で利用可能なバリデーションの全リストは次の通りです:</p>
<p>\&nbsp; バリデータ(引数) \&nbsp; 制約 \&nbsp; 説明 \ \ <code>notnull</code> \
<code>NOT NULL</code> \ アプリケーションとデータベースの両方のレベルで'not
null'制約を確認する \ \ <code>email</code> \ \
値が有効なEメールであるかチェックする \ \ <code>notblank</code> \ <code>NOT
NULL</code> \ not blankであることをチェックする \ \ <code>nospace</code> \
\ スペースがないことをチェックする \ \ <code>past</code> \
<code>CHECK</code>制約 \ 値が過去の日付がチェックする \ \ <code>future</code>
\ \ 値が未来の日付かチェックする \ \ <code>minlength(length)</code>
\ \ 値が最小長を満たすかチェックする \ \ <code>country</code> \
\ 値が有効な国コードであるかチェックする \ \ <code>ip</code> \ \
値が有効なIP(internet protocol)アドレスかチェックする \ \
<code>htmlcolor</code> \ \ 値が妥当なhtmlの色であるかチェックする \ \
<code>range(min, max)</code> \ <code>CHECK</code>制約 \
値が引数で指定された範囲に収まるかチェックする \ \ <code>unique</code> \
<code>UNIQUE</code>制約 \ 値がデータベーステーブルでユニークかチェックする
\ \ <code>regexp(expression)</code>\ \
値が正規表現にマッチするかチェックする \ \ <code>creditcard</code> \
\ 文字列が適正なクレジットカード番号であるかチェックする \ \
<code>digits(int, frac)</code> \ 精度とスケール \
値が整数の//int//の桁数を持ち分数の//frac//の桁数を持つかチェックする
\ \ <code>date</code> \ \ 値が有効な日付であるかチェックする \
<code>readonly</code> \ \
フィールドが修正され読み込み限定のフィールドに強制するようにfalseを返すかチェックする
\ \ <code>unsigned</code> \ \ 整数値が符号無しであるかチェックする
\ \ <code>usstate</code> \ \
値が有効なUSの州コードであるかチェックする \</p>
<p>下記のコードはバリデータの使い方とカラムでバリデータ用の引数を指定する方法の例です。</p>
<p><code>minlength</code>バリデータを使う例です。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('username', 'string', 255, array(
            'minlength' => 12
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: username: type: string(255) minlength: 12 # ...</p>
<p>=
例
=</p>
<hr />
<a class="section-anchor" id="not-null" name="not-null"></a><h2 class="section-header"><a href="#not-null">Not Null<i class="fas fa-link"></i></a></h2>
<p><code>not-null</code>制約はカラムがnullの値を想定してはならないことを指定します。<code>not-null</code>制約は常にカラムの制約として記述されます。</p>
<p>次の定義はカラム名用に<code>notnull</code>制約を使います。このことは指定されたカラムはnullの値を受け取らないことを意味します。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('username', 'string', 255, array(
            'notnull' => true,
            'primary' => true,
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます。:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: username: type: string(255) notnull: true primary: true #
...</p>
<p>このクラスがデータベースにエクスポートされるとき次のSQL文が実行されます(MySQLにて):</p>
<blockquote><p>CREATE TABLE user (username VARCHAR(255) NOT NULL, PRIMARY</p>
</blockquote>
<p>KEY(username))</p>
<p>not-null制約はアプリケーションレベルのバリデータとして振る舞います。このことはDoctrineのバリデータが有効な場合、Doctrineは指定されたカラムを保存するときにnullの値が含まれないことを自動的にチェックします。</p>
<p>これらのカラムがnullの値を含む場合<code>Doctrine\_Validator_Exception</code>が起動します。</p>
<hr />
<a class="section-anchor" id="e" name="e"></a><h2 class="section-header"><a href="#e">Eメール<i class="fas fa-link"></i></a></h2>
<p>Eメールバリデータは入力された値が本当に有効なEメールアドレスでありアドレスドメイン用のMXレコードがEメールアドレスとして解決することをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('email', 'string', 255, array(
            'email'   => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの同じサンプルは次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... email: type: string(255) email: true # ...</p>
<p>無効なEメールアドレスを持つユーザーを作成しようとするとバリデートは行われません:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage'; $user-&gt;email =
'jonwage';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid!'; }</p>
<p><code>jonwage</code>は有効なEメールアドレスではないので上記のコードは例外を投げます。これをさらに推し進めてEメールアドレスは有効であるがドメイン名が無効な例は次の通りです:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage'; $user-&gt;email =
'jonwage@somefakedomainiknowdoesntexist.com';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid!'; }</p>
<p>ドメインの<code>somefakedomainiknowdoesntexist.com</code>が存在せずPHPの<code>[http://www.php.net/checkdnsrr
checkdnsrr()]</code>関数はfalseを返すので上記のコードはエラーになります。</p>
<hr />
<a class="section-anchor" id="not-blank" name="not-blank"></a><h2 class="section-header"><a href="#not-blank">Not Blank<i class="fas fa-link"></i></a></h2>
<p>not blankバリデータはnot
nullバリデートと似ていますが空の文字列もしくは空白文字が含まれる場合はエラーになります。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('username', 'string', 255, array(
            'notblank'   => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: username: type: string(255) notblank: true # ...</p>
<p>1つの空白スペースを含むusernameを持つ<code>User</code>レコードを保存しようとすると、バリデーションはエラーになります:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = ' ';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid!'; }</p>
<hr />
<a class="section-anchor" id="no-space" name="no-space"></a><h2 class="section-header"><a href="#no-space">No Space<i class="fas fa-link"></i></a></h2>
<p>no
spaceバリデータは単純です。値にスペースが含まれないことをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('username', 'string', 255, array(
            'nospace'   => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: username: type: string(255) nospace: true # ...</p>
<p>スペースを含む<code>username</code>を持つ<code>User</code>を保存しようとするとバリデーションが失敗します:</p>
<blockquote><p>$user = new User(); $user-&gt;username = 'jon wage';</p>
</blockquote>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid!'; }</p>
<hr />
<a class="section-anchor" id="past" name="past"></a><h2 class="section-header"><a href="#past">Past<i class="fas fa-link"></i></a></h2>
<p>pastバリデータは値が過去の有効な日付であるかをチェックします。この例では<code>birthday</code>カラムを持つ<code>User</code>モデルがあり日付が過去のものであることバリデートします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('birthday', 'timestamp', null, array(
            'past' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... birthday: type: timestamp past: true # ...</p>
<p>過去にはない誕生日を設定しようとするとバリデーションエラーになります。</p>
<hr />
<a class="section-anchor" id="future" name="future"></a><h2 class="section-header"><a href="#future">Future<i class="fas fa-link"></i></a></h2>
<p>futureバリデータはpastバリデータの反対でデータが未来の有効な日付であることをチェックします。この例では<code>next\_appointment_date</code>カラムを持つ<code>User</code>モデルがあり日付が未来のものであることをバリデートします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('next_appointment_date', 'timestamp', null, array(
            'future' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... next\_appointment\_date: type: timestamp future:
true # ...</p>
<p>予約日が未来のものでなければ、バリデーションエラーになります。</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">最小長<i class="fas fa-link"></i></a></h2>
<p>最小長は正確な表現ではありません。文字列の長さが最小の長さよりも大きいことをチェックします。この例では<code>password</code>カラムを持つ<code>User</code>モデルがあり<code>password</code>の長さが少なくとも5文字であることを確認します。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { public function setTableDefinition() {
parent::setTableDefinition();</p>
<div class="console"><pre><code class="console">// ...

<span class="noselect">$ </span>this->hasColumn('password', 'timestamp', null, array(
        'minlength' => 5
    )
);</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... password: type: timestamp minlength: 5 # ...</p>
<p>5文字より短い<code>password</code>を持つ<code>User</code>を保存しようとすると、バリデーションはエラーになります。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage'; $user-&gt;password =
'test';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because &quot;test&quot; is only
4 characters long!'; }</p>
<hr />
<a class="section-anchor" id="country" name="country"></a><h2 class="section-header"><a href="#country">Country<i class="fas fa-link"></i></a></h2>
<p>countryバリデータは値が有効なcountryコードであるかチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('country', 'string', 2, array(
            'country' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... country: type: string(2) country: true # ...</p>
<p>無効な国コードを持つ<code>User</code>を保存しようとするとバリデーションがエラーになります。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage';
$user-&gt;country\_code = 'zz';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because &quot;zz&quot; is not a
valid country code!'; }</p>
<hr />
<a class="section-anchor" id="ip" name="ip"></a><h2 class="section-header"><a href="#ip">IPアドレス<i class="fas fa-link"></i></a></h2>
<p>IPアドレスバリデータは値が有効なIPアドレスであることをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('ip_address', 'string', 15, array(
            'ip' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... ip\_address: type: string(15) ip: true # ...</p>
<p>無効なIPアドレスを持つ<code>User</code>を保存しようとするとバリデーションはエラーになります。</p>
<blockquote><p>$user = new User(); $user-&gt;username = 'jwage'; $user-&gt;ip\_address =</p>
</blockquote>
<p>'123.123';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because &quot;123.123&quot; is
not a valid ip address }</p>
<hr />
<a class="section-anchor" id="html-color" name="html-color"></a><h2 class="section-header"><a href="#html-color">HTML Color<i class="fas fa-link"></i></a></h2>
<p>htmlcolorバリデータは値が有効な16進法のhtmlカラーであることをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { public function setTableDefinition() {
parent::setTableDefinition();</p>
<div class="console"><pre><code class="console">// ...

<span class="noselect">$ </span>this->hasColumn('favorite_color', 'string', 7, array(
        'htmlcolor' => true
    )
);</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... favorite\_color: type: string(7) htmlcolor: true #
...</p>
<p><code>favorite_color</code>カラム用の無効なhtmlカラーの値を持つ<code>User</code>を保存しようとするとバリデーションはエラーになります。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage';
$user-&gt;favorite\_color = 'red';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because &quot;red&quot; is not a
valid hex color'; }</p>
<hr />
<a class="section-anchor" id="range" name="range"></a><h2 class="section-header"><a href="#range">Range<i class="fas fa-link"></i></a></h2>
<p>rangeバリデータは値が与えられた数の範囲にあることをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('age', 'integer', 3, array(
            'range' => array(10, 100)
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... age: type: integer(3) range: [10, 100] # ...</p>
<p>10才未満もしくは100才を越える<code>User</code>を保存しようとすると、バリデーションはエラーになります。</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage'; $user-&gt;age = '3';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because &quot;3&quot; is less
than the minimum of &quot;10&quot;'; }</p>
<p>範囲配列の<code>0</code>もしくは<code>1</code>キーのどちらかを省略することで最大と最小の値をバリデートするために<code>range</code>バリデータを使うことができます:</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { public function setTableDefinition() {
parent::setTableDefinition();</p>
<div class="console"><pre><code class="console">// ...

<span class="noselect">$ </span>this->hasColumn('age', 'integer', 3, array(
        'range' => array(1 => 100)
    )
);</code></pre></div>
<p>}</p>
<p>上記の例では最大年齢は100才になります。最小値を指定するには、範囲配列で<code>1</code>の代わりに<code>0</code>を指定します。</p>
<p>YAML構文の例は次のようになります:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... age: type: integer(3) range: 1: 100 # ...</p>
<hr />
<a class="section-anchor" id="unique" name="unique"></a><h2 class="section-header"><a href="#unique">Unique<i class="fas fa-link"></i></a></h2>
<p>unique制約は1つのカラムもしくはカラムのグループに含まれるデータがテーブルのすべての列に関してユニークであること保証します。</p>
<p>一般的に、制約に含まれるカラムのすべての値が等しい複数の列が存在するときにunique制約は破られます。しかしながら、この比較では2つのnull値は等しいとはみなされません。このことはunique制約の下で制約の課された少なくとも1つのカラムでnull値を含む重複列を保存することが可能であることを意味します。このビヘイビアはSQL標準に準拠しますが、一部のデータベースはこのルールに従いません。ですのでポータルなアプリケーションを開発するときは注意してください。</p>
<p>次の定義はカラム名に対して<code>unique</code>制約を使います。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('username', 'string', 255, array(
            'unique' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: username: type: string(255) unique: true # ....</p>
<blockquote><p><strong>NOTE</strong>
主キーは既にuniqueなので主キー以外のカラムに対してのみunique制約を使うべきです。</p>
</blockquote>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">正規表現<i class="fas fa-link"></i></a></h2>
<p>正規表現バリデータは独自の正規表現に対してカラムの値をバリデートするシンプルな方法です。この例ではユーザー名は有効な文字もしくは数字だけを含むことを確認します。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('username', 'string', 255, array(
            'regexp' => '/[a-zA-Z0-9]/'
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: username: type: string(255) regexp: '/ [1]_+$/' # ...</p>
<p>文字か数字以外の文字を含む<code>username</code>を持つ<code>User</code>を保存しようとすると、バリデーションはエラーになります:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = '[jwage';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because the username
contains a [ character'; }</p>
<hr />
<a class="section-anchor" id="" name=""></a><h2 class="section-header"><a href="#">クレジットカード<i class="fas fa-link"></i></a></h2>
<p>creditcardバリデータは値が本当に有効なクレジットカード番号であることをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('cc_number', 'integer', 16, array(
            'creditcard' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... cc\_number: type: integer(16) creditcard: true #
...</p>
<hr />
<a class="section-anchor" id="read-only" name="read-only"></a><h2 class="section-header"><a href="#read-only">Read Only<i class="fas fa-link"></i></a></h2>
<p><code>readonly</code>バリデータが有効なカラムを修正しようとするとバリデーションに失敗します。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('readonly_value', 'string', 255, array(
            'readonly' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... readonly\_value: type: integer(16) readonly: true #
...</p>
<p><code>User</code>オブジェクトインスタンスから<code>readonly_value</code>という名前のカラムを修正しようとすると、バリデーションはエラーになります。</p>
<hr />
<a class="section-anchor" id="unsigned" name="unsigned"></a><h2 class="section-header"><a href="#unsigned">Unsigned<i class="fas fa-link"></i></a></h2>
<p>unsignedバリデータは整数が符号無しであることをチェックします。</p>
<blockquote><p>// models/User.php</p>
</blockquote>
<p>class User extends BaseUser { // ...</p>
<div class="console"><pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    $this->hasColumn('age', 'integer', 3, array(
            'unsigned' => true
        )
    );
}</code></pre></div>
<p>}</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>User: columns: # ... age: type: integer(3) unsigned: true # ...</p>
<p>マイナス年齢の<code>User</code>を保存しようとするとバリデーションはエラーになります:</p>
<blockquote><p>// test.php</p>
</blockquote>
<p>// ... $user = new User(); $user-&gt;username = 'jwage'; $user-&gt;age =
'-100';</p>
<p>if ( ! $user-&gt;isValid()) { echo 'User is invalid because -100 is
signed'; }</p>
<hr />
<a class="section-anchor" id="us-state" name="us-state"></a><h2 class="section-header"><a href="#us-state">US State<i class="fas fa-link"></i></a></h2>
<p>usstateバリデータは文字列が有効なUSの州コードであることをチェックします。</p>
<blockquote><p>// models/State.php</p>
</blockquote>
<p>class State extends Doctrine\_Record { public function
setTableDefinition() { $this-&gt;hasColumn('name', 'string', 255);
$this-&gt;hasColumn('code', 'string', 2, array( 'usstate' =&gt; true ) ); } }</p>
<p>YAMLフォーマットでの例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>
<blockquote><p># schema.yml</p>
</blockquote>
<p>State: columns: name: string(255) code: type: string(2) usstate: true</p>
<p>無効な州コードで<code>State</code>を保存しようとするとバリデーションがエラーになります。</p>
<blockquote><p>$state = new State(); $state-&gt;name = 'Tennessee'; $state-&gt;code = 'ZZ';</p>
</blockquote>
<p>if ( ! $state-&gt;isValid()) { echo 'State is invalid because &quot;ZZ&quot; is not a
valid state code'; }</p>
<hr />
<a class="section-anchor" id="" name=""></a><h1 class="section-header"><a href="#">まとめ<i class="fas fa-link"></i></a></h1>
<p>データを永続的にデータベースに保存する前にDoctrineにデータのバリデーションを行わせる方法を理解しDoctrineコアが提供する共通のバリデータを使うことができます。</p>
<p>[doc inheritance 次の章]では[doc inheritance
:name]を検討するので重要です！継承は最小のコードで複雑な機能を実現するための偉大な方法です。継承を検討した後で[doc
behaviors
:name]と呼ばれる継承よりも優れた機能を提供するカスタム戦略に移ります。</p>
<p></p>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?4138a7"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?493399"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            new Main();

            new Search(projectSlug, versionSlug, searchBoxSettings);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
        
            </body>
</html>
