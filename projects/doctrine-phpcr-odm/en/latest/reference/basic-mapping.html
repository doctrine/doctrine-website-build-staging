<!DOCTYPE html>
<html>
    <head>
        <title>Basic Mapping - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                                                                
                                
                                                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/">Projects</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/">Documentation</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Basic Mapping</li>
                        </ol>
                    </nav>
                
                                    <ul class="list-inline float-right">
                                                    <li class="list-inline-item mr-0">
                                <a href="/projects/doctrine-phpcr-odm/en/latest/reference/basic-mapping.html" class="badge badge-primary">master</a>
                            </li>
                                            </ul>
                
                <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
</head>
<body>
<h1 class="section-header" id="title.1"><a href="#title.1">Basic Mapping<i class="fas fa-link"></i></a></h1>
<p>This chapter explains the basic mapping of objects and properties.
Mapping of hierarchy associations and arbitrary references will be covered in the next chapter.</p>
<h2 class="section-header" id="title.1.1"><a href="#title.1.1">Mapping Drivers<i class="fas fa-link"></i></a></h2>
<p>Doctrine provides several different ways for specifying
object-document mapping metadata:</p>
<ul><li class="dash"> Docblock Annotations</li>
<li class="dash"> XML</li>
<li class="dash"> YAML</li>
</ul>

<p>This manual usually mentions docblock annotations in all the examples
that are spread throughout all chapters, however for many examples
alternative YAML and XML examples are given as well. There are dedicated
reference chapters for XML and YAML mapping, respectively that explain them
in more detail. There is also an Annotation reference chapter.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>If you're wondering which mapping driver gives the best
performance, the answer is: They all give exactly the same performance.
Once the metadata of a class has
been read from the source (annotations, xml or yaml) it is stored
in an instance of the <code>Doctrine\ODM\PHPCR\Mapping\ClassMetadata</code> class
and these instances are stored in the metadata cache. Therefore at
the end of the day all drivers perform equally well. If you're not
using a metadata cache (not recommended!) then the XML driver might
have a slight edge in performance due to the powerful native XML
support in PHP.</p>
</div>
<h2 class="section-header" id="title.1.2"><a href="#title.1.2">Introduction to Docblock Annotations<i class="fas fa-link"></i></a></h2>
<p>You've probably used docblock annotations in some form already,
most likely to provide documentation metadata for a tool like
<code>PHPDocumentor</code> (@author, @link, ...). Docblock annotations are a
tool to embed metadata inside the documentation section which can
then be processed by some tool. Doctrine generalizes the concept
of docblock annotations so that they can be used for any kind of
metadata and so that it is easy to define new docblock annotations.
In order to allow more involved annotation values and to reduce the
chances of clashes with other docblock annotations, the Doctrine
docblock annotations feature an alternative syntax that is heavily
inspired by the Annotation syntax introduced in Java 5.</p>
<p>The implementation of these enhanced docblock annotations is
located in the <code>Doctrine\Common\Annotations</code> namespace and
therefore part of the Common package. Doctrine docblock
annotations support namespaces and nested annotations among other
things. The Doctrine PHPCR-ODM defines its own set of docblock
annotations for supplying object-document mapping metadata.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>If you're not comfortable with the concept of docblock
annotations, don't worry, as mentioned earlier Doctrine provides
XML and YAML alternatives and you could easily implement your own
favourite mechanism for defining PHPCR-ODM metadata.</p>
</div>
<h2 class="section-header" id="title.1.3"><a href="#title.1.3">Persistent classes<i class="fas fa-link"></i></a></h2>
<p>In order to mark a class for object-document persistence it needs
to be designated as an document. This can be done through the
<code>@Document</code> marker annotation.</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/** @PHPCR\Document */
class MyPersistentClass
{
    //...
}
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;!-- ... --&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    # ...
</code></pre>
</div>
<p>There is a couple of options you can specify for the document mapping.
Some of them are explained here, the rest in the chapters on <a href="association-mapping_referenceable.html">References</a>,
<a href="multilang.html">Multilanguage</a> and <a href="versioning.html">Versioning</a>.</p>
<h3 class="section-header" id="title.1.3.1"><a href="#title.1.3.1">Specify a node type<i class="fas fa-link"></i></a></h3>
<p>The <code>nodeType</code> attribute allows to specify a PHPCR node type to use for this document,
instead of the default permissive nt:unstructured.</p>
<h3 class="section-header" id="title.1.3.2"><a href="#title.1.3.2">Specify a repository class<i class="fas fa-link"></i></a></h3>
<p>The <code>repositoryClass</code> attribute allows to specify a custom repository instead of the default
repository implementation.</p>
<h2 class="section-header" id="title.1.4"><a href="#title.1.4">Doctrine Mapping Types<i class="fas fa-link"></i></a></h2>
<p>A Doctrine Mapping Type defines the mapping between a PHP type and
a PHPCR property type. PHPCR defines a finite set of allowed types for properties.</p>
<p>For example, the Doctrine Mapping Type <code>string</code> defines the
mapping from a PHP string to a <code>PHPCR\\PropertyType::STRING</code>.
Here is a quick overview of the built-in mapping types:</p>
<p>See <a href="http://phpcr.github.io/doc/html/files/phpcr.src.PHPCR.PropertyType.html">PHPCR\\PropertyType</a> for details about the types.</p>
<ul><li class="dash"><code>String</code>: Arbitrary length strings</li>
<li class="dash"><code>Binary</code>: Binary stream using PHP streams</li>
<li class="dash"><code>Long</code>: Integer number (alias Int for convenience), limited by PHP_MAX_INT</li>
<li class="dash"><code>Decimal</code>: Arbitrary length number value (PHP string type for use with <code>bcmath</code>)</li>
<li class="dash"><code>Double</code>: Floating point number (alias Float for convenience)</li>
<li class="dash"><code>Date</code>: \DateTime object</li>
<li class="dash"><code>Boolean</code>: Boolean value</li>
<li class="dash"><code>Name</code>: A valid PHPCR name</li>
<li class="dash"><code>Path</code>: A valid PHPCR path</li>
<li class="dash"><code>Uri</code>: A valid URI, for example a URL</li>
</ul>

<p>Each document can have a unique identifier for referencing it. While the uuid is
also exposed as a read-only string property, the proper mapping for it is mapping
it as UUID. See <a href="association-mapping_referenceable.html">References</a> for more
information.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>DateTime types are compared by reference, not by value. Doctrine updates this values
if the reference changes and therefore behaves as if these objects are immutable value objects.</p>
</div>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>All Date types assume that you are exclusively using the default timezone
set by <a href="http://docs.php.net/manual/en/function.date-default-timezone-set.php">date_default_timezone_set()</a>
or by the php.ini configuration <code>date.timezone</code>. Working with
different timezones will cause troubles and unexpected behavior.</p>
<p>If you need specific timezone handling you have to handle this
in your domain, converting all the values back and forth from UTC.
There is also a <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/cookbook/working-with-datetime.html">cookbook entry in the ORM documentation</a>
on working with datetimes that gives hints for implementing
multi timezone applications.</p>
</div>
<h2 class="section-header" id="title.1.5"><a href="#title.1.5">Property Mapping<i class="fas fa-link"></i></a></h2>
<p>After a class has been marked as a document it can specify mappings
for its instance fields. Properties are only simple fields
that hold scalar values like strings, numbers, etc, or arrays thereof.
Although references are also stored as properties in PHPCR, they have
their own mappings - see the chapter &quot;Association Mapping&quot;.</p>
<p>To mark a property for relational persistence the <code>@Field</code>
docblock annotation is used. This annotation requires at least 1 attribute
to be set, the <code>type</code>. The <code>type</code> attribute
specifies the Doctrine Mapping Type to use for the field. If the
type is not specified, PHPCR-ODM will try to let the PHPCR implementation determine
a suitable type.</p>
<p>Example:</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Document
 */
class MyPersistentClass
{
    /**
     * @PHPCR\Field(type=&quot;long&quot;)
     */
    private $count;

    /**
     * @PHPCR\Field(type=&quot;string&quot;)
     */
    private $name; // type defaults to string
    //...
}
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;field fieldName=&quot;count&quot; type=&quot;long&quot; /&gt;
        &lt;field fieldName=&quot;name&quot; type=&quot;string&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    fields:
        count:
            type: long
        name:
            type: string
</code></pre>
</div>
<p>In that example we mapped the field <code>count</code> to the property <code>count</code>
using the mapping type <code>long</code> and the field <code>name</code> is mapped
to the property <code>name</code> with the mapping type <code>string</code>. As
you can see, by default the column names are assumed to be the same
as the field names.</p>
<h3 class="section-header" id="title.1.5.1"><a href="#title.1.5.1">Mapping to a differently named PHPCR property<i class="fas fa-link"></i></a></h3>
<p>To specify a different name for the column, you
can use the <code>property</code> attribute of the Column annotation as
follows:</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Field(property=&quot;db_name&quot;)
 */
private $myField;
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;field fieldName=&quot;myField&quot; property=&quot;db_name&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    type: document
    fields:
        myField:
            property: db_name
</code></pre>
</div>
<a id="basicmapping_mappingmultivalueproperties"></a>
<h3 class="section-header" id="title.1.5.2"><a href="#title.1.5.2">Mapping multivalue properties<i class="fas fa-link"></i></a></h3>
<p>PHPCR handles multivalue (array) data natively. The PHPCR-ODM exposes this feature through the
<code>multivalue</code> attribute of properties and adds support for hashmaps (storing the keys as well).
Unless specified as true, properties are considered single value.</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Field(type=&quot;string&quot;, multivalue=true)
 */
private $names;
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
  &lt;document name=&quot;MyPersistentClass&quot;&gt;
    &lt;field fieldName=&quot;names&quot; multivalue=&quot;true&quot; /&gt;
  &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    type: document
    fields:
        names:
            multivalue: true
</code></pre>
</div>
<p>This mapping expects the field $names to contain an array of strings. When reading from the database,
a multivalue property is expected and the field will be set to the array of strings.</p>
<p>The multivalue mapping will lose the keys of the array. To store hashmaps with keys, use the assoc
attribute. This attribute implies multivalue so you don't need to repeat multivalue=true. The following
configuration will result in the PHPCR property namesKeys for the names array and listArraykeys for
the list keys.</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Field(type=&quot;string&quot;, assoc=&quot;&quot;)
 */
private $names;

/**
 * @PHPCR\Field(type=&quot;string&quot;, assoc=&quot;listArraykeys&quot;)
 */
private $list;
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;field fieldName=&quot;names&quot; assoc=&quot;&quot; /&gt;
        &lt;field fieldName=&quot;list&quot; assoc=&quot;listArraykeys&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    type: document
    fields:
        names:
            assoc: &quot;&quot;
        list:
            assoc: &quot;listArraykeys&quot;
</code></pre>
</div>
<h3 class="section-header" id="title.1.5.3"><a href="#title.1.5.3">Summary<i class="fas fa-link"></i></a></h3>
<p>These are all attributes of the Property annotation. The ORM knows quite a few validation attributes
because they are used to generate the database schema. As PHPCR-ODM does not (yet) generate PHPCR
node type definitions, there is no need for validation.</p>
<p>If you need to validate your documents, take a look at validator components like the Symfony2 validator.</p>
<p>Again a short list for the overview:</p>
<ul><li class="dash"> <code>type</code>: (optional, autodetected if not specified) The mapping type to
   use for the property.</li>
<li class="dash"> <code>name</code>: (optional, defaults to field name) The name of the
   property in the repository.</li>
<li class="dash"> <code>multivalue</code>: (optional, defaults to false) If this is set to true, the
   property is an array of the specified type.</li>
<li class="dash"> <code>assoc</code>: (optional, defaults to false) If set to a string, the value is
   considered multivalue and the keys are stored in the PHPCR property given
   for the assoc property. If the value of assoc is empty, the name for the
   key field is the normal field name with <code>Keys</code> appended.</li>
</ul>

<a id="basicmapping_identifiers"></a>
<h2 class="section-header" id="title.1.6"><a href="#title.1.6">Identifiers<i class="fas fa-link"></i></a></h2>
<p>Every document has an identifier. The id in PHPCR-ODM is the PHPCR path.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>The id being the path, it is not totally immutable. When the document is moved either explicitly
with DocumentManager::move() or by assignment of a different @Field(type=&quot;name&quot;) or @ParentDocument, the
id will change. This was discussed thoroughly and is considered the best solution.</p>
<p>If you need to reference a document reliably even when moving, look at the @ReferenceOne and the @Uuid
annotations explained in the <a href="association-mapping.html">next chapter</a>.</p>
</div>
<p>While you can manually assign the id, this is not recommended. When manually assigning, you need
to ensure that the parent document resulting from the assigned path exists. The recommended way
is to use the @Parentdocument and @Nodename annotations to place the document in the tree.
When using that strategy, you need not have a property with the @Id annotation - though you can
if you want to have access to the path for something.</p>
<a id="basicmapping_identifier_generation_strategies"></a>
<h3 class="section-header" id="title.1.6.1"><a href="#title.1.6.1">Identifier Generation Strategies<i class="fas fa-link"></i></a></h3>
<p>Every document needs a unique id. PHPCR-ODM provides a couple of id strategies.
You can specify one of them explicitly on the id mapping, or let the PHPCR-ODM
pick a fitting one. The order is:</p>
<ul><li class="dash">Explicitly specified strategy on the <code>id</code> mapping, for example
  <code>@Id(strategy=&quot;repository&quot;);</code></li>
<li class="dash">If the document has a @ParentDocument and a @Nodename field, the
  <code>parent</code> is used to determine the id from this information. This
  is the most failsave strategy as it will ensure that there is a PHPCR parent
  existing for the document;</li>
<li class="dash">If only an @ParentDocument field is present, the <code>auto</code> takes
  the path from the @ParentDocument as the parent id generator does, but
  generates the node name automatically using the PHPCR <code>addNodeAutoNamed</code>
  method;</li>
<li class="dash">If there is only an id field, the <code>assigned</code> is used. It expects
  you to assign the repository path to the id field. You will have to make sure
  yourself that the parent exists.</li>
</ul>

<p>Another strategy that is never chosen automatically but that you can assign
explicitly is the <code>RepositoryIdGenerator</code>. For this you need to configure a
custom repository implementing <code>RepositoryIdInterface</code>. This way you can
implement any logic you might need.</p>
<h4 class="section-header" id="title.1.6.1.1"><a href="#title.1.6.1.1">Parent and name strategy (recommended)<i class="fas fa-link"></i></a></h4>
<p>This strategy uses the @Nodename (name of this node) and
@ParentDocument (PHPCR-ODM document that is the parent). The id is generated
as the id of the parent concatenated with '/' and the Nodename.</p>
<p>If you supply a ParentDocument annotation, the strategy is automatically set to
parent. This strategy will check the parent and the name and will fall back to
the assigned id if either is missing.</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Parentdocument
 */
private $parent;

/**
 * @PHPCR\Nodename
 */
private $nodename;
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;parentdocument name=&quot;parent&quot; /&gt;
        &lt;nodename name=&quot;nodename&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    parentdocument: parent
    nodename: nodename
</code></pre>
</div>
<p>To create a new document, you do something like this:</p>
<pre><code class="">$doc = new Document();
$doc-&gt;setParent($dm-&gt;find(null, '/test'));
$doc-&gt;setNodename('mynode');
// document is persisted with id /test/mynode
</code></pre>
<h4 class="section-header" id="title.1.6.1.2"><a href="#title.1.6.1.2">Assigned Id<i class="fas fa-link"></i></a></h4>
<p>This is the default but very unsafe strategy. You need to manually assign the
path to the id field.
A document is not allowed to have no parent, so you need to make sure that the
parent of that path already exists. (It can be a plain PHPCR node not
representing any PHPCR-ODM document, though.)</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Id
 */
private $id;
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;id name=&quot;id&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    id: ~
</code></pre>
</div>
<p>To create a new document, you do something like this:</p>
<pre><code class="">$doc = new Document();
$doc-&gt;setId('/test/mynode');
// document is persisted with id /test/mynode

</code></pre>
<h4 class="section-header" id="title.1.6.1.3"><a href="#title.1.6.1.3">Repository strategy<i class="fas fa-link"></i></a></h4>
<p>If you need custom logic to determine the id, you can explicitly set the
strategy to &quot;repository&quot;. You need to define the repositoryClass in your Document mapping which will
handle the task of generating the id from the information in the document.
This gives you full control how you want to build the id path.</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Id(strategy=&quot;repository&quot;)
 */
private $id;
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document name=&quot;MyPersistentClass&quot;&gt;
        &lt;id name=&quot;id&quot; type=&quot;id&quot;&gt;
            &lt;generator strategy=&quot;repository&quot; /&gt;
        &lt;/id&gt;
    &lt;/entity&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
    id:
        generator:
            strategy: repository
</code></pre>
</div>
<p>The corresponding code could look like this:</p>
<pre><code class="">namespace Demo;

use Doctrine\ODM\PHPCR\Id\RepositoryIdInterface;
use Doctrine\ODM\PHPCR\DocumentRepository as BaseDocumentRepository;
use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Document(repositoryClass=&quot;Demo\DocumentRepository&quot;)
 */
class Document
{
    /**
     * @PHPCR\Id(strategy=&quot;repository&quot;)
     */
    private $id;

    /**
     * @PHPCR\Field(type=&quot;string&quot;)
     */
    private $title;
    //...
}

class DocumentRepository extends BaseDocumentRepository implements RepositoryIdInterface
{
    /**
     * Generate a document id
     *
     * @param object $document
     * @return string
     */
    public function generateId($document, $parent = null)
    {
        return '/functional/'.$document-&gt;getTitle();
    }
}
</code></pre>
<h2 class="section-header" id="title.1.7"><a href="#title.1.7">Symfony bundle<i class="fas fa-link"></i></a></h2>
<p>If you are using the <a href="https://github.com/doctrine/DoctrinePHPCRBundle">Symfony DoctrinePHPCRBundle</a>, you can use the <code>ValidPhpcrOdm</code> validator to validate your documents.</p>
<p>You can find an example in the <a href="http://symfony.com/doc/master/cmf/bundles/phpcr_odm/forms.html#validator-constraint">Symfony documentation</a>.</p>
</body>
</html>                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
