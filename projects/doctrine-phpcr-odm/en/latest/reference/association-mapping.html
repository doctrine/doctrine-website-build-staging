<!DOCTYPE html>
<html>
    <head>
        <title>Association Mapping - PHPCR ODM (PHPCR ODM)</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="PHP Doctrine Content Repository Object Document Mapper (ODM) provides transparent persistence for PHP objects.
">

        <meta name="keywords" content="php,content,odm,mapper,mapping,object">

                    <meta name="robots" content="noindex">
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/association-mapping.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?ab4e16" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/association-mapping.html" />
        <meta property="og:title" content="Association Mapping - PHPCR ODM (PHPCR ODM)" />
        <meta property="og:description" content="PHP Doctrine Content Repository Object Document Mapper (ODM) provides transparent persistence for PHP objects.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine PHPCR ODM",
            "description": "Association Mapping",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="--/index-html-doctrine-php-content-repository-odm-documentation" class="toc-item"><a href="../index.html#doctrine-php-content-repository-odm-documentation">Doctrine PHP Content Repository ODM documentation</a></li><ul><li id="--/index-html-getting-help" class="toc-item"><a href="../index.html#getting-help">Getting Help</a></li><li id="--/index-html-getting-started" class="toc-item"><a href="../index.html#getting-started">Getting Started</a></li><li id="--/index-html-mapping-objects-onto-a-document-repository" class="toc-item"><a href="../index.html#mapping-objects-onto-a-document-repository">Mapping Objects onto a Document Repository</a></li><li id="--/index-html-working-with-objects" class="toc-item"><a href="../index.html#working-with-objects">Working with Objects</a></li><li id="--/index-html-advanced-topics" class="toc-item"><a href="../index.html#advanced-topics">Advanced Topics</a></li><li id="--/index-html-cookbook" class="toc-item"><a href="../index.html#cookbook">Cookbook</a></li></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Association Mapping</li>
                            </ol>
                        </nav>
                                    </div>

                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-phpcr-odm/en/latest/reference/association-mapping.html" class="project-version-switcher badge badge-warning">master</a>
                                        </li>
                                    
                                    
                                    <li class="list-inline-item ml-2"><a href="https://github.com/doctrine/phpcr-odm/edit/master/docs/en/reference/association-mapping.rst" class="badge badge-primary">Edit</a></li>

                                </ul>
                            
                            
<p></p>
<a class="section-anchor" id="association-mapping" name="association-mapping"></a><h1 class="section-header"><a href="#association-mapping">Association Mapping<i class="fas fa-link"></i></a></h1>
<p>This chapter introduces association mappings. PHPCR has a tree based model of the content.
In addition to references to arbitrary other documents, every document has a parent and may
have children.</p>
<p>We will start with the hierarchy associations and then go into the references, which work
slightly differently from what you are used from an RDBMS as well.</p>
<a id="hierarchy-mappings"></a>
<a class="section-anchor" id="hierarchy-mappings" name="hierarchy-mappings"></a><h2 class="section-header"><a href="#hierarchy-mappings">Hierarchy mappings<i class="fas fa-link"></i></a></h2>
<p>We have already seen the <code>ParentDocument</code> in the previous chapter in the section about
identifier generation. The field with this annotation maps the parent document of this document
(<code>PHPCR\NodeInterface::getParent()</code>). If the repository can determine the document class of the
parent, it will use it, otherwise <code>Doctrine\ODM\PHPCR\Document\Generic</code> is used.</p>
<p>To map children, you have two options:</p>
<ul><li class="dash">You can map a single child with a specific name.</li>
<li class="dash">Or you can map a <a href="#collections">collection</a> of children, with the possibility to filter on the document name.</li>
</ul>

<p>A single Child will always load only one document. If no explicit name is specified, the field
name is used to retrieve the child document. The name is the last part of that document's id,
resp. its Nodename mapping.</p>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>When persisting such a document, the name of the child document set on that
field must be empty or match the configured name. If it is not the expected
name, you will get an exception.</p>
<p>PHPCR-ODM 1.0 silently changed the name of the child to the name of the
mapping, which could lead to unexpected behaviour.</p>
</div>
<p>To map a collection of children, use <code>Children</code>. This will always be a collection, regardless of
the number of found children. You can limit the children to a subset of all children by specifying
a <code>filter</code> that acts on the node name. See <a href="http://phpcr.github.com/doc/html/phpcr/nodeinterface.html#getNodes()">PHPCR\NodeInterface::getNodes()</a>
for details on allowed filters.</p>
<p>To tweak performance, you can also specify a <code>fetchDepth</code> if you know that you will always access children
of the mapped children. This can improve performance when you need to load a more complicated structure.
(See also <a href="fetch-depth.html">Tuning the node preloading</a>).</p>
<p>Some sample mappings:</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Parentdocument
 */
private $parent;

/**
 * @PHPCR\Child
 */
private $mychild;

/**
 * @PHPCR\Children(filter=&quot;a*&quot;, fetchDepth=3)
 */
private $children;
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
  &lt;document name=&quot;MyPersistentClass&quot;&gt;
    &lt;parentdocument name=&quot;parent&quot; /&gt;
    &lt;child fieldName=&quot;mychild&quot; /&gt;
    &lt;children fieldName=&quot;children&quot; filter=&quot;a*&quot; fetchDepth=&quot;3&quot; /&gt;
  &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">MyPersistentClass:
  parentdocument: parent
  child:
    mychild: ~
  children:
    some:
     filter: &quot;a*&quot;
     fetchDepth: 3
</code></pre></div></li></ul></div>
<a class="section-anchor" id="child-restriction" name="child-restriction"></a><h3 class="section-header"><a href="#child-restriction">Child restriction<i class="fas fa-link"></i></a></h3>
<p>You may either specify which classes may be children of a document or that a
document is not allowed to have children (i.e. that it is a leaf node).</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">&lt;?php
/**
 * @Document(childClasses={&quot;App\Documents\Article&quot;, &quot;App\Documents\Page&quot;})
 */
class ContentFolder
{
    // ...
}
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;ContentFolder&quot;&gt;
        &lt;child-class&gt;Article&lt;/child-class&gt;
        &lt;child-class&gt;Page&lt;/child-class&gt;
        &lt;!-- ... --&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">ContentFolder:
    # ...
    child_classes: [ &quot;Article&quot;, &quot;Page&quot; ]
</code></pre></div></li></ul></div>
<p>To specify that a document can have no children:</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">&lt;?php
/**
 * @Document(isLeaf=true)
 */
class LeafDocument
{
    // ...
}
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;LeafDocument&quot; is-leaf=&quot;true&quot;&gt;
        &lt;!-- ... --&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">MyPersistentClass:
    # ...
    is_leaf: true
</code></pre></div></li></ul></div>
<a class="section-anchor" id="references" name="references"></a><h2 class="section-header"><a href="#references">References<i class="fas fa-link"></i></a></h2>
<p>In PHPCR any referenceable node can be referenced by any other node, regardless of their types.</p>
<p>References are always directional, but thanks to the Referrers, you can model the back reference as well.</p>
<p>References use universally unique identifiers automatically generated on documents if they
are set to be referenceable. That way, a reference will stay intact even if documents are moved.
A field can reference one or many documents, and it can enforce referencial integrity or create
a weak reference that does not ensure integrity, depending on your use case.</p>
<a id="association-mapping_referenceable"></a>
<a class="section-anchor" id="referenceable-documents" name="referenceable-documents"></a><h3 class="section-header"><a href="#referenceable-documents">Referenceable documents<i class="fas fa-link"></i></a></h3>
<p>To be allowed to reference a document, it needs to be referenceable. To achieve this, this fact needs
to be specified in the Document mapping. Having a referenceable document also allows you to
map its uuid to a field.</p>
<p>The Uuid is read only, autogenerated on the first flush of the document. It follows the universally unique
id standard and is guaranteed to be unique for the whole PHPCR repository (all workspaces).</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Document(referenceable=true)
 */
class MyPersistentClass
{
    /**
     * @PHPCR\Uuid
     **/
    private $uuid;

}
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;MyPersistentClass&quot; referenceable=&quot;true&quot;&gt;
        &lt;uuid fieldName=&quot;uuid&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">MyPersistentClass:
  referenceable: true
  fields:
    uuid:
      uuid: true
</code></pre></div></li></ul></div>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>PHPCR-ODM has no migrations (yet). If you change a document class to become referenceable,
you need to load and save every document of that type to make the stored documents note the change.</p>
</div>
<a id="associationmapping_referenceotherdocuments"></a>
<a class="section-anchor" id="reference-other-documents" name="reference-other-documents"></a><h3 class="section-header"><a href="#reference-other-documents">Reference other documents<i class="fas fa-link"></i></a></h3>
<p>As noted above, the target document needs to be referenceable. Apart from that, there is
no limitation on the type of the target document, giving you great flexibility.</p>
<p>There are two mappings, ReferenceOne and ReferenceMany to reference one or several
target documents. ReferenceMany is using <code>doctrine/common</code>'s collections.</p>
<p>You can specify for each reference if it should ensure referencial integrity or just
be a weak reference. By default, a weak reference is created, allowing you to delete
the referenced target document. Alternatively you can also tell PHPCR-ODM to reference by path,
which is interesting to create references to non-referenceable documents and when using relative paths.
A path reference will never ensure referential integrity.
(TODO: solve the open issue of how we can make paths relative and document here)</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\ReferenceOne(strategy=&quot;weak&quot;)
 */
private $weakTarget;

/**
 * @PHPCR\ReferenceOne(strategy=&quot;hard&quot;)
 */
private $hardTarget;

/**
 * @PHPCR\ReferenceOne(strategy=&quot;path&quot;)
 */
private $pathTarget;

/**
 * @PHPCR\ReferenceMany(strategy=&quot;weak&quot;)
 */
private $weakGroup;

/**
 * @PHPCR\ReferenceMany(strategy=&quot;hard&quot;)
 */
private $hardGroup;

/**
 * @PHPCR\ReferenceMany(strategy=&quot;path&quot;)
 */
private $pathGroup;
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;MyPersistentClass&quot;&gt;
        &lt;reference-one fieldName=&quot;weakTarget&quot; strategy=&quot;weak&quot; /&gt;
        &lt;reference-one fieldName=&quot;hardTarget&quot; strategy=&quot;hard&quot; /&gt;
        &lt;reference-one fieldName=&quot;pathTarget&quot; strategy=&quot;path&quot; /&gt;
        &lt;reference-many fieldName=&quot;weakGroup&quot; strategy=&quot;weak&quot; /&gt;
        &lt;reference-many fieldName=&quot;hardGroup&quot; strategy=&quot;hard&quot; /&gt;
        &lt;reference-many fieldName=&quot;pathGroup&quot; strategy=&quot;path&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">MyPersistentClass:
    referenceOne:
        weakTarget:
          strategy: weak
        hardTarget:
          strategy: hard
        pathTarget:
          strategy: path
    referenceMany:
        weakGroup:
          strategy: weak
        hardGroup:
          strategy: hard
        pathGroup:
          strategy: path
</code></pre></div></li></ul></div>
<p><code>ReferenceMany</code> documents will always be handled as collections to allow for lazy loading,
regardless of the strategy chosen.</p>
<p>All types of reference support the optional argument <code>targetDocument</code>.
This can be used to tell what the expected document type for the reference target is.
If you only reference documents of one specific type, you can use this as sanity check,
additionally path references will be faster this way.</p>
<p>If you do not set the targetDocument, you can reference documents of any type.
In ReferenceMany collections, you can even have documents of mixed types.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>If your repository supports programmatically setting the uuid property at node creation,
you can just persist your main document and the referenced documents will be persisted
automatically.</p>
<p>Otherwise you first need to flush the document manager for the reference targets before
you can reference them in your document.</p>
</div>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>When using hard references in combination with versioning, old versions of
your documents may still have target documents that become null if the
target has been deleted since the version has been created. This is due to
PHPCR not ensuring referential integrity for old versions as otherwise you
could never delete a document once it has been referenced and the reference
versioned, even if the reference is deleted later. When working with
versions, you thus always need to check if a referenced document actually
exists.</p>
</div>
<a class="section-anchor" id="referrers-to-inverse-the-reference-relation" name="referrers-to-inverse-the-reference-relation"></a><h3 class="section-header"><a href="#referrers-to-inverse-the-reference-relation">Referrers to inverse the reference relation<i class="fas fa-link"></i></a></h3>
<p>PHPCR-ODM is able to tell which documents reference a specific document, if the <code>hard</code> or
<code>weak</code> strategy is used. The <code>Referrers</code> mapping is a collection of documents that have
a reference to this document.</p>
<p>In ORM terms, the Reference is the owning side of the association, while the
Referrer is the inverse side. Contrary to the ORM, the PHPCR references really
are directional, they are always stored in the property of the document with
the ReferenceOne or ReferenceMany field. Referrer is a purely virtual information
that is not explicitly stored in the PHPCR database but determined at runtime.</p>
<p>You need to specify the <code>referringDocument</code> to specify the (base) class of the
document that has the reference, and <code>referencedBy</code> to tell which field of the
referencing document contains the reference. After flushing, the reference property
will contain the referenced document.</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Referrers(referringDocument=&quot;FQN\Class\Name&quot;, referencedBy=&quot;otherFieldName&quot;)
 */
private $specificReferrers;

/**
 * @PHPCR\Referrers(referringDocument=&quot;Other\Class\Name&quot;, referencedBy=&quot;someFieldName&quot;, cascade=&quot;persist, remove&quot;)
 */
private $cascadedReferrers;
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;MyPersistentClass&quot;&gt;
        &lt;referrers fieldName=&quot;specificReferrers&quot; referring-document=&quot;FQN\Class\Name&quot; referenced-by=&quot;otherFieldName&quot; /&gt;
        &lt;referrers fieldName=&quot;cascadedReferrers&quot; referring-document=&quot;Other\Class\Name&quot; referenced-by=&quot;someFieldName&quot; cascade=&quot;persist, remove&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">MyPersistentClass:
    referrers:
        specificReferrers:
            referringDocument: FQN\Class\Name
            referencedBy: otherFieldName
        cascadedReferrers:
            referringDocument: Other\Class\Name
            referencedBy: someFieldName
            cascade: persist, remove
</code></pre></div></li></ul></div>
<p>Referrers can cascade like the other association mappings to persist or delete their
referrers if desired.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>The main use case to persist cascade or deletion of the referrer mapping
is to build a form where it is possible to add documents that should reference
this content. However, it is not allowed to modify both the reference collection
and the referrer collection of interlinked content, as this would be ambiguous.</p>
</div>
<div class="alert tip bg-success text-light"><i class="fas fa-question-circle mr-2"></i><p>There is also the <code>DocumentManager::getReferrers()</code> method that allows you
to get more fine grained control on what referencing documents are returned,
if <code>Referrers</code> is too limited and <code>MixedReferrers</code> too broad.</p>
</div>
<a class="section-anchor" id="mixedreferrers" name="mixedreferrers"></a><h3 class="section-header"><a href="#mixedreferrers">MixedReferrers<i class="fas fa-link"></i></a></h3>
<p>The mixed referrers is a much simpler but read only mapping to get a collection
of <em>all</em> documents that have a reference to this document. The only possible option
of mixed referrers is `referenceType` to limit the referrers to only hard resp. weak
references. If left out, you get both types of references.</p>
<p>Mixed referrers can even be mapped on a document that is not referenceable, as you
might do it on a base document of which some extending documents are referenceable.
An example for this is the `Generic` document provided by phpcr-odm itself.</p>
<div class="configuration-block jsactive clearfix"><ul class="simple"><li><em>PHP</em><div class="highlight-php"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\MixedReferrers
 */
private $allReferrers;

/**
 * @PHPCR\MixedReferrers(referenceType=&quot;hard&quot;)
 */
private $hardReferrers;
</code></pre></div></li><li><em>XML</em><div class="highlight-xml"><pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;MyPersistentClass&quot;&gt;
        &lt;mixed-referrers fieldName=&quot;allReferrers&quot; /&gt;
        &lt;mixed-referrers fieldName=&quot;hardReferrers&quot; reference-type=&quot;hard&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre></div></li><li><em>YAML</em><div class="highlight-yaml"><pre><code class="yaml">MyPersistentClass:
    mixedReferrers:
        allReferrers: ~
        hardReferrers:
            referenceType: hard
</code></pre></div></li></ul></div>
<a id="assocmap_cascading"></a>
<a id="assocmap_transpers"></a>
<a class="section-anchor" id="transitive-persistence-cascade-operations" name="transitive-persistence-cascade-operations"></a><h2 class="section-header"><a href="#transitive-persistence-cascade-operations">Transitive persistence / Cascade Operations<i class="fas fa-link"></i></a></h2>
<p>Persisting, removing, detaching and merging individual documents can
become pretty cumbersome, especially when a highly interweaved object graph
is involved. PHPCR-ODM provides cascading with the same concepts as
Doctrine2 ORM does.</p>
<p>Each association to another document or a collection of documents can be
configured to automatically cascade certain operations. For the <code>Children</code> mapping,
cascading persist and remove are implicit and cannot be disabled. A PHPCR node
always must have a parent, removing the parent removes its children.
The child removal happens on PHPCR level and does not trigger additional
lifecycle events.</p>
<p>For References and Referrers, no operations are cascaded by default, they
can be configured specifically.</p>
<p>The following cascade options exist:</p>
<ul><li class="dash"> <strong>persist</strong>: Cascades persist operations to the associated documents.</li>
<li class="dash"> <strong>remove</strong>: Cascades remove operations to the associated documents.</li>
<li class="dash"> <strong>merge</strong>: Cascades merge operations to the associated documents.</li>
<li class="dash"> <strong>detach</strong>: Cascades detach operations to the associated documents.</li>
<li class="dash"> <strong>refresh</strong>: Also refresh the associated documents when refreshing this document.</li>
<li class="dash"> <strong>translation</strong>: Cascade the current translation locale to associated documents.</li>
<li class="dash"> <strong>all</strong>: Cascades persist, remove, merge, detach, refresh and translation
   operations to associated documents.</li>
</ul>

<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>Cascade operations are performed in memory. That means collections and related documents
are fetched into memory, even if they are still marked as lazy when
the cascade operation is about to be performed. This approach allows
document lifecycle events to be performed for each of these operations.</p>
<p>However, pulling a large object graph into memory on cascade can cause considerable performance
overhead, especially when cascading collections are large. Makes sure
to weigh the benefits and downsides of each cascade operation that you define.</p>
</div>
<p>Even though automatic cascading is convenient it should be used
with care. Do not blindly apply <code>cascade=all</code> to all associations as
it will unnecessarily degrade the performance of your application.
For each cascade operation that gets activated Doctrine also
applies that operation to the association, be it single or
collection valued.</p>
<a class="section-anchor" id="persistence-by-reachability-cascade-persist" name="persistence-by-reachability-cascade-persist"></a><h3 class="section-header"><a href="#persistence-by-reachability-cascade-persist">Persistence by Reachability: Cascade Persist<i class="fas fa-link"></i></a></h3>
<p>There are additional semantics that apply to the Cascade Persist
operation. During each flush() operation Doctrine detects if there
are new documents in any collection and three possible cases can
happen:</p>
<ol><li>New documents in a collection marked as cascade persist will be
   directly persisted by Doctrine.</li>
<li>New documents in a collection not marked as cascade persist will
   produce an Exception and rollback the flush() operation.</li>
<li>Collections without new documents are skipped.</li>
</ol>

<p>This concept is called &quot;Persistence by Reachability&quot;. New documents
that are found on already managed documents are automatically
persisted as long as the association is defined as cascade
persist.</p>
<a id="collections"></a>
<a class="section-anchor" id="collections" name="collections"></a><h2 class="section-header"><a href="#collections">Collections<i class="fas fa-link"></i></a></h2>
<p>All many-valued associations of PHPCR-ODM use implementations of the <code>Collection</code>
interface. They are more powerful than plain arrays. Read sections 8.2 to 8.5 in
the ORM documentation <a href="http://docs.doctrine-project.org/en/latest/reference/working-with-associations.html">Working with associations</a>
if you are not familiar with associations.</p>
<p>Your domain models need to use those classes, but they are defined in a
specific doctrine collections repository and thus not specific to any
persistence implementation.
For a discussion of this topic, see the <a href="http://docs.doctrine-project.org/en/latest/reference/association-mapping.html#collections">Collections section</a>
in the ORM documentation.</p>
<a class="section-anchor" id="initializing-collections" name="initializing-collections"></a><h3 class="section-header"><a href="#initializing-collections">Initializing Collections<i class="fas fa-link"></i></a></h3>
<p>You have to be careful when using document fields that contain a
collection of related documents. Say we have a User document that
contains a collection of groups:</p>
<pre><code class="">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Document
 */
class User
{
    /**
     * @PHPCR\ReferenceMany
     */
    private $groups;

    public function getGroups()
    {
        return $this-&gt;groups;
    }
}
</code></pre>
<p>With this code alone the <code>$groups</code> field only contains an
instance of <code>Doctrine\Common\Collections\Collection</code> if the user
is retrieved from Doctrine, however not after you instantiated a
fresh instance of the User. When your user document is still new
<code>$groups</code> will obviously be null.</p>
<p>This is why we recommend to initialize all collection fields to an
empty <code>ArrayCollection</code> in your documents constructor:</p>
<pre><code class="">use Doctrine\Common\Collections\ArrayCollection;
use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Document
 */
class User
{
    /**
     * @PHPCR\ReferenceMany
     */
    private $groups;

    public function __construct()
    {
        $this-&gt;groups = new ArrayCollection();
    }

    public function getGroups()
    {
        return $this-&gt;groups;
    }
}
</code></pre>
<p>Now the following code will be working even if the Document hasn't
been associated with a DocumentManager yet:</p>
<pre><code class="">$group = $documentManager-&gt;find(null, $groupId);
$user = new User();
$user-&gt;getGroups()-&gt;add($group);
</code></pre>
<a class="section-anchor" id="new-collections-after-flushing" name="new-collections-after-flushing"></a><h3 class="section-header"><a href="#new-collections-after-flushing">New Collections after Flushing<i class="fas fa-link"></i></a></h3>
<p>On flushing, Doctrine replaces all collection fields (children, reference many,
referrers, mixed referrers) that contain plain arrays or ArrayCollection with
the appropriate persistent collection class for the field type.</p>
<p>When flushing a new document, their collections are <em>not</em> synchronized with the
database, though cascading happens as explained above. The collections thus
only show the documents that where explicitly added. If other documents are
added directly (e.g. a child with assigned id), you will only see them after
calling <code>$dm-&gt;refresh()</code>, or in subsequent requests.</p>
<p>On an existing document, setting a field to an array or new collection
overwrites all existing documents that previously where in that field, leading
to the deletion of the previous documents.</p>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'phpcr-odm';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

            <script src="https://staging.doctrine-project.org/js/sidebar.js?482a20"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

        
        
            </body>
</html>
