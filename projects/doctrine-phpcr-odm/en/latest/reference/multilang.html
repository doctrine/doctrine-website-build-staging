<!DOCTYPE html>
<html>
    <head>
        <title>Multilanguage support - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                                                                
                                
                                                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/">Projects</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/">Documentation</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Multilanguage support</li>
                        </ol>
                    </nav>
                
                                    <ul class="list-inline float-right">
                                                    <li class="list-inline-item mr-0">
                                <a href="/projects/doctrine-phpcr-odm/en/latest/reference/multilang.html" class="badge badge-primary">master</a>
                            </li>
                                            </ul>
                
                <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
</head>
<body>
<h1 class="section-header" id="title.1"><a href="#title.1">Multilanguage support<i class="fas fa-link"></i></a></h1>
<p>PHPCR-ODM has multilanguage support built in. This is an additional feature not supported by
PHPCR, but modeled on top of it.</p>
<h2 class="section-header" id="title.1.1"><a href="#title.1.1">Philosophy<i class="fas fa-link"></i></a></h2>
<p>You can mark any properties as being translatable and have the document manager store and load
the correct language for you. Note that translation always happens on a document level, not on
the individual translatable fields. The non-translated fields however are not duplicated to
avoid redundancy.</p>
<p>The multilanguage support is built in a way to allow you to not explicitly handle language.
You can tell the DocumentManager the current language and it will be used as default language
when calling <code>find</code> methods and when persisting new documents.</p>
<p>When a document is read, its current language is stored with the document, to make sure changes go
to the correct language.</p>
<p>Because every document may only exist once, and translations are considered the same document, you can not have multiple languages loaded at the same time.</p>
<p>For required fields (fields not having nullable=true), the behaviour is the
same as with normal fields: On saving, an error is thrown when a required field
is null. On loading, missing fields trigger no error. A translation exists as
soon as at least one field in that locale exists.</p>
<a id="multilang_mapping"></a>
<h2 class="section-header" id="title.1.2"><a href="#title.1.2">Mapping<i class="fas fa-link"></i></a></h2>
<p>To make a document translated, you need to define the <code>translator</code> attribute on the document
configuration, and you need to map the <code>locale</code> field. Then you can use the <code>translated</code>
attribute on all fields that should be different depending on the locale.</p>
<div class="configuration-block"><pre><code class="php">use Doctrine\ODM\PHPCR\Mapping\Annotations as PHPCR;

/**
 * @PHPCR\Document(translator=&quot;attribute&quot;)
 */
class MyPersistentClass
{
    /**
     * The language this document currently is in
     * @Locale
     */
    private $locale;

    /**
     * Untranslated property
     * @PHPCR\Field(type=&quot;date&quot;)
     */
    private $publishDate;

    /**
     * Translated property
     * @PHPCR\Field(type=&quot;string&quot;, translated=true)
     */
    private $topic;

    /**
     * Language specific image
     * @PHPCR\Field(type=&quot;binary&quot;, translated=true)
     */
    private $image;
}
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;document class=&quot;MyPersistentClass&quot; translator=&quot;attribute&quot;&gt;
        &lt;locale fieldName=&quot;locale&quot; /&gt;
        &lt;field fieldName=&quot;publishDate&quot; type=&quot;date&quot; /&gt;
        &lt;field fieldName=&quot;topic&quot; type=&quot;string&quot; translated=&quot;true&quot; /&gt;
        &lt;field fieldName=&quot;image&quot; type=&quot;binary&quot; translated=&quot;true&quot; /&gt;
    &lt;/document&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">MyPersistentClass:
  translator: attribute
  locale: locale
  fields:
    publishDate:
        type: date
    topic:
        type: string
        translated: true
    image:
        type: binary
        translated: true
</code></pre>
</div>
<p>The translation strategy is telling the document manager which strategy to use to store and load
translations for this document. The <code>Locale</code> field holds the current locale of the document.
It is populated when finding the document, updated whenever you call bindTranslation and also
taken into account when you flush the document, to save the correct translation.
When you manually change the Locale after loading a document, it will be saved as the newly assigned language.</p>
<p>You can set any type of property as translatable, but should only set those that are actually language
specific. All other properties should not have that annotation, then they are the same in all languages.
However, you can not set any association annotations to translatable and translations will not propagate
through associations (see the section &quot;Limitations&quot; for an explanation).</p>
<p>Having at least one property marked as translatable will require the whole document to
have a translator strategy and a Locale field.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>You need to be careful when refactoring documents that have existing data.
When you change fields to be translated or no longer translated, or change
the translation strategy, you need to migrate the data.</p>
<p>See <a href="../cookbook/refactoring-multilang.html">Refactoring Multilanguage Documents</a> for more information on the
tools to do the data migration.</p>
</div>
<h2 class="section-header" id="title.1.3"><a href="#title.1.3">Interacting with translations<i class="fas fa-link"></i></a></h2>
<p>When reading, <code>DocumentManager::find()</code> uses the default locale (see below how to set that). This means
your reading code does not need to be aware of content translations happening.</p>
<p>If you need to access a document with an explicit locale that might be different from the default locale,
you can use <code>DocumentManager::findTranslation()</code>.</p>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>When loading a document with findTranslation that was already loaded with this DocumentManager session,
the DocumentManager will not create a copy of the document but change the fields of the existing document.
This means you can not have two languages of the same document in memory at the same time.</p>
<p>The reason for this is that otherwise we could run into inconsistencies if any of the non-translatable
fields is changed in one of the two document instances that are the same document.</p>
</div>
<p>To get a list of all available locales for a document, use <code>DocumentManager::getLocalesFor</code>.</p>
<p>When writing, you can use <code>DocumentManager::persist()</code> as normal. Persist will respect the locale
set in the Locale field, and fall back to the default locale if that field is empty.</p>
<p>During <code>DocumentManager::flush()</code>, if you edited a document, the current value of the Locale
field is respected as well. If you want to flush more than one language in one go, you can use
<code>DocumentManager::bindTranslation()</code> repeatedly and update the translated fields of your document
before each call to bindTranslation. (See the example below).</p>
<h2 class="section-header" id="title.1.4"><a href="#title.1.4">Choosing the right translation strategy<i class="fas fa-link"></i></a></h2>
<p>A translation strategy needs to be selected by adding the <code>translator</code> parameter to the document mapping.
The translation strategy is responsible to actually persist the translated properties.</p>
<p>There are two default translation strategies implemented and automatically available:</p>
<ul><li><code>attribute</code> stores the translations in attributes of the node containing the translatable properties</li>
<li><code>child</code> stores the translations in a child node of the node containing the translatable properties</li>
</ul>

<p>Thus, if you do not have many fields, the attribute strategy puts less load on the content repository.
On the other hand, if you have a lot of fields on your document, you may want to use the child strategy.</p>
<p>If needed, it is possible to implement other strategies to persist the translations.</p>
<h3 class="section-header" id="title.1.4.1"><a href="#title.1.4.1">Implementing your own translation strategy<i class="fas fa-link"></i></a></h3>
<p>You may want to implement your own translation strategy to persist the translatable properties of a node.
For example if you want all the translations to be stored in a separate subtree of you content repository.</p>
<p>To do so you need to implement the <code>Doctrine\ODM\PHPCR\Translation\TranslationStrategy\TranslationStrategyInterface</code>.</p>
<p>Then you have to register your translation strategy with the document manager during the bootstrap:</p>
<pre><code class="">use Doctrine\ODM\PHPCR\Translation\TranslationStrategy\TranslationStrategyInterface;

class MyTranslationStrategy implements TranslationStrategyInterface
{
    // ...
}

$dm = new \Doctrine\ODM\PHPCR\DocumentManager($session, $config);
$dm-&gt;setTranslationStrategy('my_strategy_name', new MyTranslationStrategy());
</code></pre>
<p><code>my_strategy_name</code> would be the value for the translator attribute to use your custom strategy.</p>
<a id="multilang_chooser"></a>
<h2 class="section-header" id="title.1.5"><a href="#title.1.5">Configure the locale chooser strategy<i class="fas fa-link"></i></a></h2>
<p>The language chooser is used when loading translated documents. If no language is specified,
it provides the default language. If the requested language is not available for this document,
the strategy is asked for a fallback order of other languages to try in order to find the best
available translation.</p>
<p>On reading, PHPCR-ODM tries to find a translation with each of the languages in that
list and throws a not found exception if none of the languages exists.</p>
<p>The default language chooser strategy <code>Doctrine\ODM\PHPCR\Translation\LocaleChooser\LocaleChooser</code> returns
a configurable list of languages based on the requested language. On instantiation, you specify
the default locale. This should be your application default locale. It is used to get the default locale order
which usually should not vary based on the current locale.
Based on your HTTP request or whatever criteria you have, you can use setLocale() to have the document manager load
your document in the right language.</p>
<p>When you bootstrap the document manager, you need to set the language chooser strategy if you have
any translatable documents:</p>
<pre><code class="">use Doctrine\ODM\PHPCR\DocumentManager;

$localePrefs = array(
    'en' =&gt; array('de', 'fr'),
    'fr' =&gt; array('de', 'en'),
    'it' =&gt; array('de', 'en'),
);

$dm = new DocumentManager($session, $config);
$dm-&gt;setLocaleChooserStrategy(new LocaleChooser($localePrefs, 'en'));
</code></pre>
<p>The above says: When <code>en</code> is requested but you do not find it, then try <code>de</code> and finally <code>fr</code>.</p>
<p>You can write your own strategy by implementing <code>Doctrine\ODM\PHPCR\Translation\LocaleChooser\LocaleChooserInterface</code>.
This is useful to determine the default language based on some logic, or provide fallback orders based on user preferences.</p>
<h2 class="section-header" id="title.1.6"><a href="#title.1.6">Full Example<i class="fas fa-link"></i></a></h2>
<pre><code class="php">use Doctrine\ODM\PHPCR\DocumentManager;

// bootstrap the DocumentManager as required (see above)

$localePrefs = array(
    'en' =&gt; array('fr'),
    'fr' =&gt; array('en'),
);

$dm = new DocumentManager($session, $config);
$dm-&gt;setLocaleChooserStrategy(new LocaleChooser($localePrefs, 'en'));

// then to use translations:

$doc = new Article();
$doc-&gt;id = '/my_test_node';
$doc-&gt;author = 'John Doe';
$doc-&gt;topic = 'An interesting subject';
$doc-&gt;text = 'Lorem ipsum...';

// Persist the document in English
$dm-&gt;persist($doc);
$dm-&gt;bindTranslation($doc, 'en');

// Change the content and persist the document in French
$doc-&gt;topic = 'Un sujet intéressant';
$dm-&gt;bindTranslation($doc, 'fr');

// locale is updated automatically if there is such an annotation
echo $doc-&gt;locale; // fr

// Flush to write the changes to the phpcr backend
$dm-&gt;flush();

// Get the document in default language
// (English if you bootstrapped as in the example)
$doc = $dm-&gt;find(null, '/my_test_node');

// Get the document in French
$doc = $dm-&gt;findTranslation(null, '/my_test_node', 'fr');
$doc-&gt;title = 'nouveau';
$dm-&gt;flush(); // french is updated as the language is tracked by the dm

</code></pre>
<h2 class="section-header" id="title.1.7"><a href="#title.1.7">Querying Translated Properties<i class="fas fa-link"></i></a></h2>
<p>The translation strategy will store translated strings into specific
properties. When using the PHPCR SQL2 queries, you will need to look
into implementation details to make them work.</p>
<p>When using the PHPCR-ODM query builder, it will detect translated fields
and adjust the query accordingly. By default, the current locale will be
used, but you can manually call <code>$qb-&gt;setLocale($locale)</code> if you need
a different locale.</p>
<p>Read more in the <a href="qb-translation.html">query builder documentation</a>.</p>
<h2 class="section-header" id="title.1.8"><a href="#title.1.8">Limitations<i class="fas fa-link"></i></a></h2>
<h3 class="section-header" id="title.1.8.1"><a href="#title.1.8.1">Translations and references / hierarchy<i class="fas fa-link"></i></a></h3>
<p>For now, Child, Children, Parent, ReferenceMany, ReferenceOne and Referrers will all fall back to the default language.
The reason for this is that there can be only one tracked instance of a document per session. (Otherwise what should happen
if both copies where modified?...).</p>
<p>For more details, see the <a href="https://github.com/doctrine/phpcr-odm/wiki/Multilanguage">wiki page</a>.</p>
</body>
</html>                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
