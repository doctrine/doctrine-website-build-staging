<!DOCTYPE html>
<html>
    <head>
        <title>Refactoring Multilanguage Documents - PHPCR ODM (PHPCR ODM)</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="PHP Doctrine Content Repository Object Document Mapper (ODM) provides transparent persistence for PHP objects.
">

        <meta name="keywords" content="php,content,odm,mapper,mapping,object">

                    <meta name="robots" content="noindex">
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/cookbook/refactoring-multilang.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?49bbdd" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/cookbook/refactoring-multilang.html" />
        <meta property="og:title" content="Refactoring Multilanguage Documents - PHPCR ODM (PHPCR ODM)" />
        <meta property="og:description" content="PHP Doctrine Content Repository Object Document Mapper (ODM) provides transparent persistence for PHP objects.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine PHPCR ODM",
            "description": "Refactoring Multilanguage Documents",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="custom_documentclass_mapper-html-using-a-custom-document-class-mapper-with-phpcr-odm" class="toc-item"><a href="custom_documentclass_mapper.html#using-a-custom-document-class-mapper-with-phpcr-odm">Using a Custom Document Class Mapper with PHPCR-ODM</a></li><ul><li id="custom_documentclass_mapper-html-symfony2-integration" class="toc-item"><a href="custom_documentclass_mapper.html#symfony2-integration">Symfony2 integration</a></li></ul><li id="last-modified-html-last-modification-timestamp" class="toc-item"><a href="last-modified.html#last-modification-timestamp">Last modification timestamp</a></li><ul><li id="last-modified-html-using-the-build-in-support" class="toc-item"><a href="last-modified.html#using-the-build-in-support">Using the build-in support</a></li><li id="last-modified-html-a-lastmodified-listener-for-custom-behaviour" class="toc-item"><a href="last-modified.html#a-lastmodified-listener-for-custom-behaviour">A lastModified listener for custom behaviour</a></li></ul><li id="refactoring-multilang-html-refactoring-multilanguage-documents" class="toc-item"><a href="refactoring-multilang.html#refactoring-multilanguage-documents">Refactoring Multilanguage Documents</a></li><ul><li id="refactoring-multilang-html-procedure" class="toc-item"><a href="refactoring-multilang.html#procedure">Procedure</a></li><li id="refactoring-multilang-html-converting-untranslated-fields-to-be-translated" class="toc-item"><a href="refactoring-multilang.html#converting-untranslated-fields-to-be-translated">Converting Untranslated Fields to be Translated</a></li><li id="refactoring-multilang-html-removing-translation-from-a-field" class="toc-item"><a href="refactoring-multilang.html#removing-translation-from-a-field">Removing Translation from a Field</a></li><li id="refactoring-multilang-html-changing-the-translation-strategy" class="toc-item"><a href="refactoring-multilang.html#changing-the-translation-strategy">Changing the Translation Strategy</a></li></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Documentation</li>
                            </ol>
                        </nav>
                    
                                                        </div>

                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-phpcr-odm/en/latest/cookbook/refactoring-multilang.html" class="project-version-switcher badge badge-warning">master</a>
                                        </li>
                                    
                                    
                                    <li class="list-inline-item ml-2"><a href="https://github.com/doctrine/phpcr-odm/edit/master/docs/en/cookbook/refactoring-multilang.rst" class="badge badge-primary">Edit</a></li>

                                </ul>
                            
                            
<p></p>
<a class="section-anchor" id="refactoring-multilanguage-documents" name="refactoring-multilanguage-documents"></a><h1 class="section-header"><a href="#refactoring-multilanguage-documents">Refactoring Multilanguage Documents<i class="fas fa-link"></i></a></h1>
<p>Documents that are <a href="../reference/multilang.html">multilanguage</a> store a copy
of their translated fields for each locale. When you refactor documents and
to change fields to become translated or no longer translated, the data in PHPCR
needs to be migrated.</p>
<p>A command line tool and a class are provided to help with this task.</p>
<div class="version-added"><p>The command and helper class where introduced in PHPCR-ODM 1.3.</p>
</div>
<a class="section-anchor" id="procedure" name="procedure"></a><h2 class="section-header"><a href="#procedure">Procedure<i class="fas fa-link"></i></a></h2>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>As always with data migrations, create a backup before you attempt to
migrate the live data. If there is a bug or you make a mistake, data
could be destroyed otherwise.</p>
</div>
<p>The first step is to update the translation metadata (add or remove the
translated attribute of a field mapping, or change the translation strategy
declaration on the class mapping). The conversion tool converts to the current
state. Sometimes it can guess the previous state, sometimes you will need to
provide that information.</p>
<p>Once this is done, use the command line
tool <code>doctrine:phpcr:document:convert-translation</code>. If you need additional
logic, you can also write your own PHP code that instantiates
<code>Doctrine\ODM\PHPCR\Tools\Helper\TranslationConverter</code> and calls its
<code>convert</code> method. If you do the later, make sure to read the phpdoc on the
<code>convert</code> method.</p>
<a class="section-anchor" id="converting-untranslated-fields-to-be-translated" name="converting-untranslated-fields-to-be-translated"></a><h2 class="section-header"><a href="#converting-untranslated-fields-to-be-translated">Converting Untranslated Fields to be Translated<i class="fas fa-link"></i></a></h2>
<p>First, add the <code>translated</code> mapping attribute for the fields that should
become translated. If the document had no translated fields previously, you
also need to define a translator strategy on the class mapping, as explained
in <a href="../reference/multilang.html">multilanguage support</a>.</p>
<p>Now you can run the command to make fields translated. It will copy the
current untranslated value of the fields into all locales specified in the
<code>--locales</code> option. From this, editors can adjust translations in specific
languages.</p>
<p>Assuming you have a <code>Acme\Document\Article</code> with the fields <code>title</code> and
<code>body</code> that was previously not translated at all, the command looks as
follows:</p>
<pre><code class="bash">$ ./vendor/bin/phpcrodm doctrine:phpcr:document:convert-translation &quot;Acme\\Document\\Article&quot; --locales=en
</code></pre>
<p>If a document is already translated but new fields become translated, you can
limit which fields to convert using the <code>fields</code> option to the command.</p>
<p>To continue with the previous example, lets assume you had a field
<code>furtherInfo</code> that you did not translate but now realize needs being
translated as well. Add the translated attribute and then run:</p>
<pre><code class="bash">$ ./vendor/bin/phpcrodm doctrine:phpcr:document:convert-translation &quot;Acme\\Document\\Article&quot; --locales=en --fields=furtherInfo
</code></pre>
<a class="section-anchor" id="removing-translation-from-a-field" name="removing-translation-from-a-field"></a><h2 class="section-header"><a href="#removing-translation-from-a-field">Removing Translation from a Field<i class="fas fa-link"></i></a></h2>
<p>To remove translation from a field, adjust the field mapping to not provide the
translated attribute anymore. As long as the class mapping specifies the
translation strategy, you can just specify what field to update. Assume you
have a field <code>furtherInfo</code> that you changed from translated to untranslated:</p>
<pre><code class="bash">$ ./vendor/bin/phpcrodm doctrine:phpcr:document:convert-translation &quot;Acme\\Document\\Article&quot; --fields=furtherInfo
</code></pre>
<p>The command will request the translation of the field in the current locale,
with fallback order as configured.</p>
<p>If your whole document should no longer be translated, you can remove the
document translator configuration and the translated attribute from all fields.
You then need to specify all fields that need to be converted back, as well as
the translation strategy that was used:</p>
<pre><code class="bash">$ ./vendor/bin/phpcrodm doctrine:phpcr:document:convert-translation &quot;Acme\\Document\\Article&quot; --fields=furtherInfo,title,body --previous-strategy=attribute
</code></pre>
<a class="section-anchor" id="changing-the-translation-strategy" name="changing-the-translation-strategy"></a><h2 class="section-header"><a href="#changing-the-translation-strategy">Changing the Translation Strategy<i class="fas fa-link"></i></a></h2>
<p>To convert from one translation strategy to another, update the document to
specify the new strategy, and pass the old strategy on the command line:</p>
<pre><code class="bash">$ ./vendor/bin/phpcrodm doctrine:phpcr:document:convert-translation &quot;Acme\\Document\\Article&quot; --locales=en --previous-strategy=attribute
</code></pre>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'phpcr-odm';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

            <script src="https://staging.doctrine-project.org/js/sidebar.js?482a20"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

        
        
            </body>
</html>
