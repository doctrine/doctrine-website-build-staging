<!DOCTYPE html>
<html>
    <head>
        <title>Basic Mapping - CouchDB Object Document Mapper (CouchDB ODM)</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="PHP Doctrine CouchDB Object Document Mapper (ODM) provides transparent persistence for PHP objects to CouchDB.
">

        <meta name="keywords" content="couchdb,odm,mapper,mapping,object">

                    <meta name="robots" content="noindex">
        
                    <link rel="canonical" href="https://staging.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/reference/basic-mapping.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?ab4e16" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/reference/basic-mapping.html" />
        <meta property="og:title" content="Basic Mapping - CouchDB Object Document Mapper (CouchDB ODM)" />
        <meta property="og:description" content="PHP Doctrine CouchDB Object Document Mapper (ODM) provides transparent persistence for PHP objects to CouchDB.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine CouchDB Object Document Mapper",
            "description": "Basic Mapping",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://staging.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="--/index-html-welcome-to-doctrine-couchdb-documentation" class="toc-item"><a href="../index.html#welcome-to-doctrine-couchdb-documentation">Welcome to Doctrine CouchDB documentation</a></li></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/couchdb-odm.html">CouchDB ODM</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Basic Mapping</li>
                            </ol>
                        </nav>
                                    </div>

                                    <div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i> This project is not being actively maintained. If you are interested in helping to maintain this project, take a look at the open issues on <a href="https://github.com/doctrine/couchdb-odm/" target="_blank">GitHub</a> and submit pull requests.</div>
                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-couchdb-odm/en/latest/reference/basic-mapping.html" class="project-version-switcher badge badge-warning">master</a>
                                        </li>
                                    
                                    
                                    <li class="list-inline-item ml-2"><a href="https://github.com/doctrine/couchdb-odm/edit/master/docs/en/reference/basic-mapping.rst" class="badge badge-primary">Edit</a></li>

                                </ul>
                            
                            
<p></p>
<a class="section-anchor" id="basic-mapping" name="basic-mapping"></a><h1 class="section-header"><a href="#basic-mapping">Basic Mapping<i class="fas fa-link"></i></a></h1>
<p>This chapter explains the basic mapping of objects and properties.
Mapping of associations will be covered in the next chapter
&quot;Association Mapping&quot;.</p>
<a class="section-anchor" id="introduction-to-docblock-annotations" name="introduction-to-docblock-annotations"></a><h2 class="section-header"><a href="#introduction-to-docblock-annotations">Introduction to Docblock Annotations<i class="fas fa-link"></i></a></h2>
<p>You've probably used docblock annotations in some form already,
most likely to provide documentation metadata for a tool like
<code>PHPDocumentor</code> (@author, @link, ...). Docblock annotations are a
tool to embed metadata inside the documentation section which can
then be processed by some tool. Doctrine generalizes the concept
of docblock annotations so that they can be used for any kind of
metadata and so that it is easy to define new docblock annotations.
In order to allow more involved annotation values and to reduce the
chances of clashes with other docblock annotations, the Doctrine 2
docblock annotations feature an alternative syntax that is heavily
inspired by the Annotation syntax introduced in Java 5.</p>
<p>The implementation of these enhanced docblock annotations is
located in the <code>Doctrine\Common\Annotations</code> namespace and
therefore part of the Common package. Doctrine docblock
annotations support namespaces and nested annotations among other
things. The Doctrine CouchDB ODM defines its own set of docblock
annotations for supplying object-relational mapping metadata.</p>
<blockquote><p><strong>NOTE</strong> If you're not comfortable with the concept of docblock
annotations, don't worry, as mentioned earlier Doctrine 2 provides
XML and YAML alternatives and you could easily implement your own
favourite mechanism for defining metadata.</p>
</blockquote>
<a class="section-anchor" id="persistent-classes" name="persistent-classes"></a><h2 class="section-header"><a href="#persistent-classes">Persistent classes<i class="fas fa-link"></i></a></h2>
<p>In order to mark a class for CouchDB persistence it needs
to be designated as an document. This can be done through the
<code>@Document</code> marker annotation.</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    //...
}
</code></pre>
<a class="section-anchor" id="doctrine-mapping-types" name="doctrine-mapping-types"></a><h2 class="section-header"><a href="#doctrine-mapping-types">Doctrine Mapping Types<i class="fas fa-link"></i></a></h2>
<p>A Doctrine Mapping Type defines the mapping between a PHP type and
an JSON type. Since CouchDB speaks JSON there has to be a transformation
between PHP and JSON values. You can even write your own
custom mapping types that map PHP values or objects to JSON-able PHP
scalar or array values.</p>
<p>Here is a quick overview of the built-in mapping types:</p>
<ul><li class="dash"> <code>string</code>: Type that maps a JSON String to a PHP string.</li>
<li class="dash"> <code>datetime</code>: Type that maps an stringified Date to a PHP
   DateTime object.</li>
<li class="dash"> <code>mixed</code>: Type that saves and retrives any value unconverted into the Couch.</li>
<li class="dash"> <code>integer</code>: Type that ensures the value to be an integer.</li>
<li class="dash"> <code>boolean</code>: Type that ensures the value to be a boolean.</li>
</ul>

<a class="section-anchor" id="field-mapping" name="field-mapping"></a><h2 class="section-header"><a href="#field-mapping">Field Mapping<i class="fas fa-link"></i></a></h2>
<p>After a class has been marked as an entity it can specify mappings
for its instance fields. Here we will only look at simple fields
that hold scalar values like strings, numbers, etc. Associations to
other objects are covered in the chapter &quot;Association Mapping&quot;.</p>
<p>To mark a property for relational persistence the <code>@Field</code>
docblock annotation is used. This annotation usually requires at
least one attribute to be set, the <code>type</code>. The <code>type</code> attribute
specifies the Doctrine Mapping Type to use for the field. If the
type is not specified, 'mixed' is used as the default mapping type
since it is the most flexible.</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /** @Field(type=&quot;string&quot;) */
    private $name;
}
</code></pre>
<a class="section-anchor" id="indexing-fields" name="indexing-fields"></a><h3 class="section-header"><a href="#indexing-fields">Indexing Fields<i class="fas fa-link"></i></a></h3>
<p>CouchDB uses map-reduce to query documents. Except querying for the ID of a document
there is no additional query capability available for fields. Doctrine CouchDB ODM
allows you to use a predefined view that allows equality comparisons on fields:</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /**
     * @Index
     * @Field(type=&quot;string&quot;)
     */
    private $name;
}
</code></pre>
<p>All indexed fields can be queried in <code>DocumentRepository::findBy()</code> and <code>DocumentRepository:findOneBy()</code>:</p>
<pre><code class="php">&lt;?php
$repository = $documentManager-&gt;getRepository(&quot;MyApp\Document\MyPersistentClass&quot;);
$john = $repository-&gt;findOneBy(array(&quot;name&quot; =&gt; &quot;John Galt&quot;));
</code></pre>
<a class="section-anchor" id="json-names" name="json-names"></a><h3 class="section-header"><a href="#json-names">Json Names<i class="fas fa-link"></i></a></h3>
<p>If your fields for some reason have different names in the PHP class and CouchDB document you<br />can use the attribute &quot;jsonName&quot; to specify the name of the key in the json document.</p>
<a class="section-anchor" id="id-mapping" name="id-mapping"></a><h2 class="section-header"><a href="#id-mapping">Id Mapping<i class="fas fa-link"></i></a></h2>
<p>CouchDB documents have a special field &quot;_id&quot; that contains the globally
unique identifier of a document in the database. This is always a string,
so it suffices to specify only the @Id annotation on the property:</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /** @Id */
    private $id;
}
</code></pre>
<a class="section-anchor" id="id-generation-strategies" name="id-generation-strategies"></a><h3 class="section-header"><a href="#id-generation-strategies">Id Generation Strategies<i class="fas fa-link"></i></a></h3>
<p>By default the ODM uses CouchDBs batch UUID generation mechanism
to generate a UUID for a document as soon as it is registered with
the DocumentManager. You can configure different strategies to generate
IDs, here is a list:</p>
<ul><li class="dash">  @Id(strategy=&quot;UUID&quot;) - Uses CouchDB UUID generation. This is the implicitly
    selected strategy if you do not specify the strategy argument</li>
<li class="dash">  @Id(strategy=&quot;ASSIGNED&quot;) - Assumes that you as developer have assigned a unique
    identifier before passing the document to the DocumentManager for the first time.</li>
</ul>

<a class="section-anchor" id="attachments" name="attachments"></a><h2 class="section-header"><a href="#attachments">Attachments<i class="fas fa-link"></i></a></h2>
<p>You can map an array of all CouchDB attachments to a document to a field in your PHP class:</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /** @Attachments */
    private $attachments;
}
</code></pre>
<p>The mapped field is indexed by filename and contains instances of <code>Doctrine\CouchDB\Attachment</code>.
Contents of the attachments are loaded lazily by using the stub details inside the CouchDB document.</p>
<a class="section-anchor" id="document-repositories" name="document-repositories"></a><h2 class="section-header"><a href="#document-repositories">Document Repositories<i class="fas fa-link"></i></a></h2>
<p>A repository is a finder class for your documents. Every document automatically has a repository
of the type <code>Doctrine\ODM\CouchDB\DocumentRepository</code>. You can specify your own repository classes
that extend the base repository and provide additional finder methods:</p>
<pre><code class="php">&lt;?php
/** @Document(repositoryClass=&quot;MyApp\Repository\MyPersistentRepository&quot;) */
class MyPersistentClass
{
    /** @Attachments */
    private $attachments;
}
</code></pre>
<p>Then when calling <code>DocumentManager#getRepository</code> you will get an instance of your repository subclass:</p>
<pre><code class="php">&lt;?php
$repository = $documentManager-&gt;getRepository(&quot;MyApp\Document\MyPersistentClass&quot;);
</code></pre>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'couchdb-odm';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

            <script src="https://staging.doctrine-project.org/js/sidebar.js?482a20"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

        
        
            </body>
</html>
