<!DOCTYPE html>
<html>
    <head>
        <title>Basic Mapping - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                                                                
                                
                                                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/">Projects</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/">Documentation</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Basic Mapping</li>
                        </ol>
                    </nav>
                
                                    <ul class="list-inline float-right">
                                                    <li class="list-inline-item mr-0">
                                <a href="/projects/doctrine-couchdb-odm/en/latest/reference/basic-mapping.html" class="badge badge-primary">master</a>
                            </li>
                                            </ul>
                
                <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
</head>
<body>
<h1 class="section-header" id="title.1"><a href="#title.1">Basic Mapping<i class="fas fa-link"></i></a></h1>
<p>This chapter explains the basic mapping of objects and properties.
Mapping of associations will be covered in the next chapter
&quot;Association Mapping&quot;.</p>
<h2 class="section-header" id="title.1.1"><a href="#title.1.1">Introduction to Docblock Annotations<i class="fas fa-link"></i></a></h2>
<p>You've probably used docblock annotations in some form already,
most likely to provide documentation metadata for a tool like
<code>PHPDocumentor</code> (@author, @link, ...). Docblock annotations are a
tool to embed metadata inside the documentation section which can
then be processed by some tool. Doctrine generalizes the concept
of docblock annotations so that they can be used for any kind of
metadata and so that it is easy to define new docblock annotations.
In order to allow more involved annotation values and to reduce the
chances of clashes with other docblock annotations, the Doctrine 2
docblock annotations feature an alternative syntax that is heavily
inspired by the Annotation syntax introduced in Java 5.</p>
<p>The implementation of these enhanced docblock annotations is
located in the <code>Doctrine\Common\Annotations</code> namespace and
therefore part of the Common package. Doctrine docblock
annotations support namespaces and nested annotations among other
things. The Doctrine CouchDB ODM defines its own set of docblock
annotations for supplying object-relational mapping metadata.</p>
<blockquote><p><strong>NOTE</strong> If you're not comfortable with the concept of docblock
annotations, don't worry, as mentioned earlier Doctrine 2 provides
XML and YAML alternatives and you could easily implement your own
favourite mechanism for defining metadata.</p>
</blockquote>
<h2 class="section-header" id="title.1.2"><a href="#title.1.2">Persistent classes<i class="fas fa-link"></i></a></h2>
<p>In order to mark a class for CouchDB persistence it needs
to be designated as an document. This can be done through the
<code>@Document</code> marker annotation.</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    //...
}
</code></pre>
<h2 class="section-header" id="title.1.3"><a href="#title.1.3">Doctrine Mapping Types<i class="fas fa-link"></i></a></h2>
<p>A Doctrine Mapping Type defines the mapping between a PHP type and
an JSON type. Since CouchDB speaks JSON there has to be a transformation
between PHP and JSON values. You can even write your own
custom mapping types that map PHP values or objects to JSON-able PHP
scalar or array values.</p>
<p>Here is a quick overview of the built-in mapping types:</p>
<ul><li class="dash"> <code>string</code>: Type that maps a JSON String to a PHP string.</li>
<li class="dash"> <code>datetime</code>: Type that maps an stringified Date to a PHP
   DateTime object.</li>
<li class="dash"> <code>mixed</code>: Type that saves and retrives any value unconverted into the Couch.</li>
<li class="dash"> <code>integer</code>: Type that ensures the value to be an integer.</li>
<li class="dash"> <code>boolean</code>: Type that ensures the value to be a boolean.</li>
</ul>

<h2 class="section-header" id="title.1.4"><a href="#title.1.4">Field Mapping<i class="fas fa-link"></i></a></h2>
<p>After a class has been marked as an entity it can specify mappings
for its instance fields. Here we will only look at simple fields
that hold scalar values like strings, numbers, etc. Associations to
other objects are covered in the chapter &quot;Association Mapping&quot;.</p>
<p>To mark a property for relational persistence the <code>@Field</code>
docblock annotation is used. This annotation usually requires at
least one attribute to be set, the <code>type</code>. The <code>type</code> attribute
specifies the Doctrine Mapping Type to use for the field. If the
type is not specified, 'mixed' is used as the default mapping type
since it is the most flexible.</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /** @Field(type=&quot;string&quot;) */
    private $name;
}
</code></pre>
<h3 class="section-header" id="title.1.4.1"><a href="#title.1.4.1">Indexing Fields<i class="fas fa-link"></i></a></h3>
<p>CouchDB uses map-reduce to query documents. Except querying for the ID of a document
there is no additional query capability available for fields. Doctrine CouchDB ODM
allows you to use a predefined view that allows equality comparisons on fields:</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /**
     * @Index
     * @Field(type=&quot;string&quot;)
     */
    private $name;
}
</code></pre>
<p>All indexed fields can be queried in <code>DocumentRepository::findBy()</code> and <code>DocumentRepository:findOneBy()</code>:</p>
<pre><code class="php">&lt;?php
$repository = $documentManager-&gt;getRepository(&quot;MyApp\Document\MyPersistentClass&quot;);
$john = $repository-&gt;findOneBy(array(&quot;name&quot; =&gt; &quot;John Galt&quot;));
</code></pre>
<h3 class="section-header" id="title.1.4.2"><a href="#title.1.4.2">Json Names<i class="fas fa-link"></i></a></h3>
<p>If your fields for some reason have different names in the PHP class and CouchDB document you<br />can use the attribute &quot;jsonName&quot; to specify the name of the key in the json document.</p>
<h2 class="section-header" id="title.1.5"><a href="#title.1.5">Id Mapping<i class="fas fa-link"></i></a></h2>
<p>CouchDB documents have a special field &quot;_id&quot; that contains the globally
unique identifier of a document in the database. This is always a string,
so it suffices to specify only the @Id annotation on the property:</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /** @Id */
    private $id;
}
</code></pre>
<h3 class="section-header" id="title.1.5.1"><a href="#title.1.5.1">Id Generation Strategies<i class="fas fa-link"></i></a></h3>
<p>By default the ODM uses CouchDBs batch UUID generation mechanism
to generate a UUID for a document as soon as it is registered with
the DocumentManager. You can configure different strategies to generate
IDs, here is a list:</p>
<ul><li class="dash">  @Id(strategy=&quot;UUID&quot;) - Uses CouchDB UUID generation. This is the implicitly
    selected strategy if you do not specify the strategy argument</li>
<li class="dash">  @Id(strategy=&quot;ASSIGNED&quot;) - Assumes that you as developer have assigned a unique
    identifier before passing the document to the DocumentManager for the first time.</li>
</ul>

<h2 class="section-header" id="title.1.6"><a href="#title.1.6">Attachments<i class="fas fa-link"></i></a></h2>
<p>You can map an array of all CouchDB attachments to a document to a field in your PHP class:</p>
<pre><code class="php">&lt;?php
/** @Document */
class MyPersistentClass
{
    /** @Attachments */
    private $attachments;
}
</code></pre>
<p>The mapped field is indexed by filename and contains instances of <code>Doctrine\CouchDB\Attachment</code>.
Contents of the attachments are loaded lazily by using the stub details inside the CouchDB document.</p>
<h2 class="section-header" id="title.1.7"><a href="#title.1.7">Document Repositories<i class="fas fa-link"></i></a></h2>
<p>A repository is a finder class for your documents. Every document automatically has a repository
of the type <code>Doctrine\ODM\CouchDB\DocumentRepository</code>. You can specify your own repository classes
that extend the base repository and provide additional finder methods:</p>
<pre><code class="php">&lt;?php
/** @Document(repositoryClass=&quot;MyApp\Repository\MyPersistentRepository&quot;) */
class MyPersistentClass
{
    /** @Attachments */
    private $attachments;
}
</code></pre>
<p>Then when calling <code>DocumentManager#getRepository</code> you will get an instance of your repository subclass:</p>
<pre><code class="php">&lt;?php
$repository = $documentManager-&gt;getRepository(&quot;MyApp\Document\MyPersistentClass&quot;);
</code></pre>
</body>
</html>                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
