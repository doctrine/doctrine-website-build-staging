<!DOCTYPE html>
<html>
    <head>
        <title>Doctrine Query Language - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                                                                
                                
                                                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/">Projects</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/orm/">ORM</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/doctrine-orm/en/latest/">Documentation</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Doctrine Query Language</li>
                        </ol>
                    </nav>
                
                                    <ul class="list-inline float-right">
                                                    <li class="list-inline-item mr-0">
                                <a href="/projects/doctrine-orm/en/latest/reference/dql-doctrine-query-language.html" class="badge badge-primary">master</a>
                            </li>
                                                    <li class="list-inline-item mr-0">
                                <a href="/projects/doctrine-orm/en/2.6/reference/dql-doctrine-query-language.html" class="badge badge-secondary">2.6</a>
                            </li>
                                                    <li class="list-inline-item mr-0">
                                <a href="/projects/doctrine-orm/en/2.5/reference/dql-doctrine-query-language.html" class="badge badge-secondary">2.5</a>
                            </li>
                                            </ul>
                
                <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
</head>
<body>
<h1 class="section-header" id="title.1"><a href="#title.1">Doctrine Query Language<i class="fas fa-link"></i></a></h1>
<p>DQL stands for Doctrine Query Language and is an Object
Query Language derivative that is very similar to the Hibernate
Query Language (HQL) or the Java Persistence Query Language (JPQL).</p>
<p>In essence, DQL provides powerful querying capabilities over your
object model. Imagine all your objects lying around in some storage
(like an object database). When writing DQL queries, think about
querying that storage to pick a certain subset of your objects.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>A common mistake for beginners is to mistake DQL for
being just some form of SQL and therefore trying to use table names
and column names or join arbitrary tables together in a query. You
need to think about DQL as a query language for your object model,
not for your relational schema.</p>
</div>
<p>DQL is case in-sensitive, except for namespace, class and field
names, which are case sensitive.</p>
<h2 class="section-header" id="title.1.1"><a href="#title.1.1">Types of DQL queries<i class="fas fa-link"></i></a></h2>
<p>DQL as a query language has SELECT, UPDATE and DELETE constructs
that map to their corresponding SQL statement types. INSERT
statements are not allowed in DQL, because entities and their
relations have to be introduced into the persistence context
through <code>EntityManager#persist()</code> to ensure consistency of your
object model.</p>
<p>DQL SELECT statements are a very powerful way of retrieving parts
of your domain model that are not accessible via associations.
Additionally they allow you to retrieve entities and their associations
in one single SQL select statement which can make a huge difference
in performance compared to using several queries.</p>
<p>DQL UPDATE and DELETE statements offer a way to execute bulk
changes on the entities of your domain model. This is often
necessary when you cannot load all the affected entities of a bulk
update into memory.</p>
<h2 class="section-header" id="title.1.2"><a href="#title.1.2">SELECT queries<i class="fas fa-link"></i></a></h2>
<h3 class="section-header" id="title.1.2.1"><a href="#title.1.2.1">DQL SELECT clause<i class="fas fa-link"></i></a></h3>
<p>Here is an example that selects all users with an age &gt; 20:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM MyProject\Model\User u WHERE u.age &gt; 20');
$users = $query-&gt;getResult();
</code></pre>
<p>Lets examine the query:</p>
<ul><li class="dash"> <code>u</code> is a so called identification variable or alias that
   refers to the <code>MyProject\Model\User</code> class. By placing this alias
   in the SELECT clause we specify that we want all instances of the
   User class that are matched by this query to appear in the query
   result.</li>
<li class="dash"> The FROM keyword is always followed by a fully-qualified class
   name which in turn is followed by an identification variable or
   alias for that class name. This class designates a root of our
   query from which we can navigate further via joins (explained
   later) and path expressions.</li>
<li class="dash"> The expression <code>u.age</code> in the WHERE clause is a path
   expression. Path expressions in DQL are easily identified by the
   use of the '.' operator that is used for constructing paths. The
   path expression <code>u.age</code> refers to the <code>age</code> field on the User
   class.</li>
</ul>

<p>The result of this query would be a list of User objects where all
users are older than 20.</p>
<h3 class="section-header" id="title.1.2.2"><a href="#title.1.2.2">Result format<i class="fas fa-link"></i></a></h3>
<p>The composition of the expressions in the SELECT clause also
influences the nature of the query result. There are three
cases:</p>
<p><strong>All objects</strong></p>
<pre><code class="sql">SELECT u, p, n FROM Users u...
</code></pre>
<p>In this case, the result will be an array of User objects because of
the FROM clause, with children <code>p</code> and <code>n</code> hydrated because of
their inclusion in the SELECT clause.</p>
<p><strong>All scalars</strong></p>
<pre><code class="sql">SELECT u.name, u.address FROM Users u...
</code></pre>
<p>In this case, the result will be an array of arrays.  In the example
above, each element of the result array would be an array of the
scalar name and address values.</p>
<p>You can select scalars from any entity in the query.</p>
<p><strong>Mixed</strong></p>
<pre><code class="sql">``SELECT u, p.quantity FROM Users u...``
</code></pre>
<p>Here, the result will again be an array of arrays, with each element
being an array made up of a User object and the scalar value
<code>p.quantity</code>.</p>
<p>Multiple FROM clauses are allowed, which would cause the result
array elements to cycle through the classes included in the
multiple FROM clauses.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>You cannot select other entities unless you also select the
root of the selection (which is the first entity in FROM).</p>
<p>For example, <code>SELECT p,n FROM Users u...</code> would be wrong because
<code>u</code> is not part of the SELECT</p>
<p>Doctrine throws an exception if you violate this constraint.</p>
</div>
<h3 class="section-header" id="title.1.2.3"><a href="#title.1.2.3">Joins<i class="fas fa-link"></i></a></h3>
<p>A SELECT query can contain joins. There are 2 types of JOINs:
&quot;Regular&quot; Joins and &quot;Fetch&quot; Joins.</p>
<p><strong>Regular Joins</strong>: Used to limit the results and/or compute
aggregate values.</p>
<p><strong>Fetch Joins</strong>: In addition to the uses of regular joins: Used to
fetch related entities and include them in the hydrated result of a
query.</p>
<p>There is no special DQL keyword that distinguishes a regular join
from a fetch join. A join (be it an inner or outer join) becomes a
&quot;fetch join&quot; as soon as fields of the joined entity appear in the
SELECT part of the DQL query outside of an aggregate function.
Otherwise its a &quot;regular join&quot;.</p>
<p>Example:</p>
<p>Regular join of the address:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT u FROM User u JOIN u.address a WHERE a.city = 'Berlin'&quot;);
$users = $query-&gt;getResult();
</code></pre>
<p>Fetch join of the address:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT u, a FROM User u JOIN u.address a WHERE a.city = 'Berlin'&quot;);
$users = $query-&gt;getResult();
</code></pre>
<p>When Doctrine hydrates a query with fetch-join it returns the class
in the FROM clause on the root level of the result array. In the
previous example an array of User instances is returned and the
address of each user is fetched and hydrated into the
<code>User#address</code> variable. If you access the address Doctrine does
not need to lazy load the association with another query.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>Doctrine allows you to walk all the associations between
all the objects in your domain model. Objects that were not already
loaded from the database are replaced with lazy loading proxy
instances. Non-loaded Collections are also replaced by lazy-loading
instances that fetch all the contained objects upon first access.
However relying on the lazy-loading mechanism leads to many small
queries executed against the database, which can significantly
affect the performance of your application. <strong>Fetch Joins</strong> are the
solution to hydrate most or all of the entities that you need in a
single SELECT query.</p>
</div>
<h3 class="section-header" id="title.1.2.4"><a href="#title.1.2.4">Named and Positional Parameters<i class="fas fa-link"></i></a></h3>
<p>DQL supports both named and positional parameters, however in
contrast to many SQL dialects positional parameters are specified
with numbers, for example &quot;?1&quot;, &quot;?2&quot; and so on. Named parameters
are specified with &quot;:name1&quot;, &quot;:name2&quot; and so on.</p>
<p>When referencing the parameters in <code>Query#setParameter($param, $value)</code>
both named and positional parameters are used <strong>without</strong> their prefixes.</p>
<h3 class="section-header" id="title.1.2.5"><a href="#title.1.2.5">DQL SELECT Examples<i class="fas fa-link"></i></a></h3>
<p>This section contains a large set of DQL queries and some
explanations of what is happening. The actual result also depends
on the hydration mode.</p>
<p>Hydrate all User entities:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM MyProject\Model\User u');
$users = $query-&gt;getResult(); // array of User objects
</code></pre>
<p>Retrieve the IDs of all CmsUsers:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.id FROM CmsUser u');
$ids = $query-&gt;getResult(); // array of CmsUser ids
</code></pre>
<p>Retrieve the IDs of all users that have written an article:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT DISTINCT u.id FROM CmsArticle a JOIN a.user u');
$ids = $query-&gt;getResult(); // array of CmsUser ids
</code></pre>
<p>Retrieve all articles and sort them by the name of the articles
users instance:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT a FROM CmsArticle a JOIN a.user u ORDER BY u.name ASC');
$articles = $query-&gt;getResult(); // array of CmsArticle objects
</code></pre>
<p>Retrieve the Username and Name of a CmsUser:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.username, u.name FROM CmsUser u');
$users = $query-&gt;getResult(); // array of CmsUser username and name values
echo $users[0]['username'];
</code></pre>
<p>Retrieve a ForumUser and his single associated entity:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u, a FROM ForumUser u JOIN u.avatar a');
$users = $query-&gt;getResult(); // array of ForumUser objects with the avatar association loaded
echo get_class($users[0]-&gt;getAvatar());
</code></pre>
<p>Retrieve a CmsUser and fetch join all the phonenumbers he has:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u, p FROM CmsUser u JOIN u.phonenumbers p');
$users = $query-&gt;getResult(); // array of CmsUser objects with the phonenumbers association loaded
$phonenumbers = $users[0]-&gt;getPhonenumbers();
</code></pre>
<p>Hydrate a result in Ascending:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM ForumUser u ORDER BY u.id ASC');
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>Or in Descending Order:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM ForumUser u ORDER BY u.id DESC');
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>Using Aggregate Functions:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT COUNT(u.id) FROM Entities\User u');
$count = $query-&gt;getSingleScalarResult();

$query = $em-&gt;createQuery('SELECT u, count(g.id) FROM Entities\User u JOIN u.groups g GROUP BY u.id');
$result = $query-&gt;getResult();
</code></pre>
<p>With WHERE Clause and Positional Parameter:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM ForumUser u WHERE u.id = ?1');
$query-&gt;setParameter(1, 321);
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>With WHERE Clause and Named Parameter:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM ForumUser u WHERE u.username = :name');
$query-&gt;setParameter('name', 'Bob');
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>With Nested Conditions in WHERE Clause:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM ForumUser u WHERE (u.username = :name OR u.username = :name2) AND u.id = :id');
$query-&gt;setParameters(array(
    'name' =&gt; 'Bob',
    'name2' =&gt; 'Alice',
    'id' =&gt; 321,
));
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>With COUNT DISTINCT:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT COUNT(DISTINCT u.name) FROM CmsUser');
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>With Arithmetic Expression in WHERE clause:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u WHERE ((u.id + 5000) * u.id + 3) &lt; 10000000');
$users = $query-&gt;getResult(); // array of ForumUser objects
</code></pre>
<p>Retrieve user entities with Arithmetic Expression in ORDER clause, using the <code>HIDDEN</code> keyword:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u, u.posts_count + u.likes_count AS HIDDEN score FROM CmsUser u ORDER BY score');
$users = $query-&gt;getResult(); // array of User objects
</code></pre>
<p>Using a LEFT JOIN to hydrate all user-ids and optionally associated
article-ids:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.id, a.id as article_id FROM CmsUser u LEFT JOIN u.articles a');
$results = $query-&gt;getResult(); // array of user ids and every article_id for each user
</code></pre>
<p>Restricting a JOIN clause by additional conditions specified by
WITH:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT u FROM CmsUser u LEFT JOIN u.articles a WITH a.topic LIKE :foo&quot;);
$query-&gt;setParameter('foo', '%foo%');
$users = $query-&gt;getResult();
</code></pre>
<p>Using several Fetch JOINs:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u, a, p, c FROM CmsUser u JOIN u.articles a JOIN u.phonenumbers p JOIN a.comments c');
$users = $query-&gt;getResult();
</code></pre>
<p>BETWEEN in WHERE clause:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.name FROM CmsUser u WHERE u.id BETWEEN ?1 AND ?2');
$query-&gt;setParameter(1, 123);
$query-&gt;setParameter(2, 321);
$usernames = $query-&gt;getResult();
</code></pre>
<p>DQL Functions in WHERE clause:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT u.name FROM CmsUser u WHERE TRIM(u.name) = 'someone'&quot;);
$usernames = $query-&gt;getResult();
</code></pre>
<p>IN() Expression:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.name FROM CmsUser u WHERE u.id IN(46)');
$usernames = $query-&gt;getResult();

$query = $em-&gt;createQuery('SELECT u FROM CmsUser u WHERE u.id IN (1, 2)');
$users = $query-&gt;getResult();

$query = $em-&gt;createQuery('SELECT u FROM CmsUser u WHERE u.id NOT IN (1)');
$users = $query-&gt;getResult();
</code></pre>
<p>CONCAT() DQL Function:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT u.id FROM CmsUser u WHERE CONCAT(u.name, 's') = ?1&quot;);
$query-&gt;setParameter(1, 'Jess');
$ids = $query-&gt;getResult();

$query = $em-&gt;createQuery('SELECT CONCAT(u.id, u.name) FROM CmsUser u WHERE u.id = ?1');
$query-&gt;setParameter(1, 321);
$idUsernames = $query-&gt;getResult();
</code></pre>
<p>EXISTS in WHERE clause with correlated Subquery</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.id FROM CmsUser u WHERE EXISTS (SELECT p.phonenumber FROM CmsPhonenumber p WHERE p.user = u.id)');
$ids = $query-&gt;getResult();
</code></pre>
<p>Get all users who are members of $group.</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u.id FROM CmsUser u WHERE :groupId MEMBER OF u.groups');
$query-&gt;setParameter('groupId', $group);
$ids = $query-&gt;getResult();
</code></pre>
<p>Get all users that have more than 1 phonenumber</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u WHERE SIZE(u.phonenumbers) &gt; 1');
$users = $query-&gt;getResult();
</code></pre>
<p>Get all users that have no phonenumber</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u WHERE u.phonenumbers IS EMPTY');
$users = $query-&gt;getResult();
</code></pre>
<p>Get all instances of a specific type, for use with inheritance
hierarchies:</p>
<div class="version-added"></div>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM Doctrine\Tests\Models\Company\CompanyPerson u WHERE u INSTANCE OF Doctrine\Tests\Models\Company\CompanyEmployee');
$query = $em-&gt;createQuery('SELECT u FROM Doctrine\Tests\Models\Company\CompanyPerson u WHERE u INSTANCE OF ?1');
$query = $em-&gt;createQuery('SELECT u FROM Doctrine\Tests\Models\Company\CompanyPerson u WHERE u NOT INSTANCE OF ?1');
</code></pre>
<p>Get all users visible on a given website that have chosen certain gender:</p>
<div class="version-added"></div>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM User u WHERE u.gender IN (SELECT IDENTITY(agl.gender) FROM Site s JOIN s.activeGenderList agl WHERE s.id = ?1)');
</code></pre>
<div class="version-added"><p>Starting with 2.4, the IDENTITY() DQL function also works for composite primary keys:</p></div>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT IDENTITY(c.location, 'latitude') AS latitude, IDENTITY(c.location, 'longitude') AS longitude FROM Checkpoint c WHERE c.user = ?1&quot;);
</code></pre>
<p>Joins between entities without associations were not possible until version
2.4, where you can generate an arbitrary join with the following syntax:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM User u JOIN Blacklist b WITH u.email = b.email');
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>The differences between WHERE, WITH and HAVING clauses may be
confusing.</p>
<ul><li class="dash">WHERE is applied to the results of an entire query</li>
<li class="dash">WITH is applied to a join as an additional condition. For
  arbitrary joins (SELECT f, b FROM Foo f, Bar b WITH f.id = b.id)
  the WITH is required, even if it is 1 = 1</li>
<li class="dash">HAVING is applied to the results of a query after
  aggregation (GROUP BY)</li>
</ul>

</div>
<h4 class="section-header" id="title.1.2.5.1"><a href="#title.1.2.5.1">Partial Object Syntax<i class="fas fa-link"></i></a></h4>
<p>By default when you run a DQL query in Doctrine and select only a
subset of the fields for a given entity, you do not receive objects
back. Instead, you receive only arrays as a flat rectangular result
set, similar to how you would if you were just using SQL directly
and joining some data.</p>
<p>If you want to select partial objects you can use the <code>partial</code>
DQL keyword:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT partial u.{id, username} FROM CmsUser u');
$users = $query-&gt;getResult(); // array of partially loaded CmsUser objects
</code></pre>
<p>You use the partial syntax when joining as well:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT partial u.{id, username}, partial a.{id, name} FROM CmsUser u JOIN u.articles a');
$users = $query-&gt;getResult(); // array of partially loaded CmsUser objects
</code></pre>
<h4 class="section-header" id="title.1.2.5.2"><a href="#title.1.2.5.2">&quot;NEW&quot; Operator Syntax<i class="fas fa-link"></i></a></h4>
<div class="version-added"><p>Using the <code>NEW</code> operator you can construct Data Transfer Objects (DTOs) directly from DQL queries.</p></div>
<ul><li class="dash">When using <code>SELECT NEW</code> you don't need to specify a mapped entity.</li>
<li class="dash">You can specify any PHP class, it only requires that the constructor of this class matches the <code>NEW</code> statement.</li>
<li class="dash">This approach involves determining exactly which columns you really need,
  and instantiating a data-transfer object that contains a constructor with those arguments.</li>
</ul>

<p>If you want to select data-transfer objects you should create a class:</p>
<pre><code class="php">&lt;?php
class CustomerDTO
{
    public function __construct($name, $email, $city, $value = null)
    {
        // Bind values to the object properties.
    }
}
</code></pre>
<p>And then use the <code>NEW</code> DQL keyword :</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT NEW CustomerDTO(c.name, e.email, a.city) FROM Customer c JOIN c.email e JOIN c.address a');
$users = $query-&gt;getResult(); // array of CustomerDTO
</code></pre>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT NEW CustomerDTO(c.name, e.email, a.city, SUM(o.value)) FROM Customer c JOIN c.email e JOIN c.address a JOIN c.orders o GROUP BY c');
$users = $query-&gt;getResult(); // array of CustomerDTO
</code></pre>
<p>Note that you can only pass scalar expressions to the constructor.</p>
<h3 class="section-header" id="title.1.2.6"><a href="#title.1.2.6">Using INDEX BY<i class="fas fa-link"></i></a></h3>
<p>The INDEX BY construct is nothing that directly translates into SQL
but that affects object and array hydration. After each FROM and
JOIN clause you specify by which field this class should be indexed
in the result. By default a result is incremented by numerical keys
starting with 0. However with INDEX BY you can specify any other
column to be the key of your result, it really only makes sense
with primary or unique fields though:</p>
<pre><code class="sql">SELECT u.id, u.status, upper(u.name) nameUpper FROM User u INDEX BY u.id
JOIN u.phonenumbers p INDEX BY p.phonenumber
</code></pre>
<p>Returns an array of the following kind, indexed by both user-id
then phonenumber-id:</p>
<pre><code class="php">array
  0 =&gt;
    array
      1 =&gt;
        object(stdClass)[299]
          public '__CLASS__' =&gt; string 'Doctrine\Tests\Models\CMS\CmsUser' (length=33)
          public 'id' =&gt; int 1
          ..
      'nameUpper' =&gt; string 'ROMANB' (length=6)
  1 =&gt;
    array
      2 =&gt;
        object(stdClass)[298]
          public '__CLASS__' =&gt; string 'Doctrine\Tests\Models\CMS\CmsUser' (length=33)
          public 'id' =&gt; int 2
          ...
      'nameUpper' =&gt; string 'JWAGE' (length=5)
</code></pre>
<h2 class="section-header" id="title.1.3"><a href="#title.1.3">UPDATE queries<i class="fas fa-link"></i></a></h2>
<p>DQL not only allows to select your Entities using field names, you
can also execute bulk updates on a set of entities using an
DQL-UPDATE query. The Syntax of an UPDATE query works as expected,
as the following example shows:</p>
<pre><code class="sql">UPDATE MyProject\Model\User u SET u.password = 'new' WHERE u.id IN (1, 2, 3)
</code></pre>
<p>References to related entities are only possible in the WHERE
clause and using sub-selects.</p>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>DQL UPDATE statements are ported directly into a
Database UPDATE statement and therefore bypass any locking scheme, events
and do not increment the version column. Entities that are already
loaded into the persistence context will <em>NOT</em> be synced with the
updated database state. It is recommended to call
<code>EntityManager#clear()</code> and retrieve new instances of any
affected entity.</p>
</div>
<h2 class="section-header" id="title.1.4"><a href="#title.1.4">DELETE queries<i class="fas fa-link"></i></a></h2>
<p>DELETE queries can also be specified using DQL and their syntax is
as simple as the UPDATE syntax:</p>
<pre><code class="sql">DELETE MyProject\Model\User u WHERE u.id = 4
</code></pre>
<p>The same restrictions apply for the reference of related entities.</p>
<div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i><p>DQL DELETE statements are ported directly into a
Database DELETE statement and therefore bypass any events and checks for the
version column if they are not explicitly added to the WHERE clause
of the query. Additionally Deletes of specified entities are <em>NOT</em>
cascaded to related entities even if specified in the metadata.</p>
</div>
<h2 class="section-header" id="title.1.5"><a href="#title.1.5">Functions, Operators, Aggregates<i class="fas fa-link"></i></a></h2>
<p>It is possible to wrap both fields and identification values into
aggregation and DQL functions. Numerical fields can be part of
computations using mathematical operations.</p>
<h3 class="section-header" id="title.1.5.1"><a href="#title.1.5.1">DQL Functions<i class="fas fa-link"></i></a></h3>
<p>The following functions are supported in SELECT, WHERE and HAVING
clauses:</p>
<ul><li class="dash"> IDENTITY(single\_association\_path\_expression [, fieldMapping]) - Retrieve the foreign key column of association of the owning side</li>
<li class="dash"> ABS(arithmetic\_expression)</li>
<li class="dash"> CONCAT(str1, str2)</li>
<li class="dash"> CURRENT\_DATE() - Return the current date</li>
<li class="dash"> CURRENT\_TIME() - Returns the current time</li>
<li class="dash"> CURRENT\_TIMESTAMP() - Returns a timestamp of the current date
   and time.</li>
<li class="dash"> LENGTH(str) - Returns the length of the given string</li>
<li class="dash"> LOCATE(needle, haystack [, offset]) - Locate the first
   occurrence of the substring in the string.</li>
<li class="dash"> LOWER(str) - returns the string lowercased.</li>
<li class="dash"> MOD(a, b) - Return a MOD b.</li>
<li class="dash"> SIZE(collection) - Return the number of elements in the
   specified collection</li>
<li class="dash"> SQRT(q) - Return the square-root of q.</li>
<li class="dash"> SUBSTRING(str, start [, length]) - Return substring of given
   string.</li>
<li class="dash"> TRIM([LEADING \ BOTH] ['trchar' FROM] str) - Trim
   the string by the given trim char, defaults to whitespaces.</li>
<li class="dash"> UPPER(str) - Return the upper-case of the given string.</li>
<li class="dash"> DATE_ADD(date, days, unit) - Add the number of days to a given date. (Supported units are DAY, MONTH)</li>
<li class="dash"> DATE_SUB(date, days, unit) - Substract the number of days from a given date. (Supported units are DAY, MONTH)</li>
<li class="dash"> DATE_DIFF(date1, date2) - Calculate the difference in days between date1-date2.</li>
</ul>

<h3 class="section-header" id="title.1.5.2"><a href="#title.1.5.2">Arithmetic operators<i class="fas fa-link"></i></a></h3>
<p>You can do math in DQL using numeric values, for example:</p>
<pre><code class="sql">SELECT person.salary * 1.5 FROM CompanyPerson person WHERE person.salary &lt; 100000
</code></pre>
<h3 class="section-header" id="title.1.5.3"><a href="#title.1.5.3">Aggregate Functions<i class="fas fa-link"></i></a></h3>
<p>The following aggregate functions are allowed in SELECT and GROUP
BY clauses: AVG, COUNT, MIN, MAX, SUM</p>
<h3 class="section-header" id="title.1.5.4"><a href="#title.1.5.4">Other Expressions<i class="fas fa-link"></i></a></h3>
<p>DQL offers a wide-range of additional expressions that are known
from SQL, here is a list of all the supported constructs:</p>
<ul><li class="dash"> <code>ALL/ANY/SOME</code> - Used in a WHERE clause followed by a
   sub-select this works like the equivalent constructs in SQL.</li>
<li class="dash"> <code>BETWEEN a AND b</code> and <code>NOT BETWEEN a AND b</code> can be used to
   match ranges of arithmetic values.</li>
<li class="dash"> <code>IN (x1, x2, ...)</code> and <code>NOT IN (x1, x2, ..)</code> can be used to
   match a set of given values.</li>
<li class="dash"> <code>LIKE ..</code> and <code>NOT LIKE ..</code> match parts of a string or text
   using % as a wildcard.</li>
<li class="dash"> <code>IS NULL</code> and <code>IS NOT NULL</code> to check for null values</li>
<li class="dash"> <code>EXISTS</code> and <code>NOT EXISTS</code> in combination with a sub-select</li>
</ul>

<h3 class="section-header" id="title.1.5.5"><a href="#title.1.5.5">Adding your own functions to the DQL language<i class="fas fa-link"></i></a></h3>
<p>By default DQL comes with functions that are part of a large basis
of underlying databases. However you will most likely choose a
database platform at the beginning of your project and most likely
never change it. For this cases you can easily extend the DQL
parser with own specialized platform functions.</p>
<p>You can register custom DQL functions in your ORM Configuration:</p>
<pre><code class="php">&lt;?php
$config = new \Doctrine\ORM\Configuration();
$config-&gt;addCustomStringFunction($name, $class);
$config-&gt;addCustomNumericFunction($name, $class);
$config-&gt;addCustomDatetimeFunction($name, $class);

$em = EntityManager::create($dbParams, $config);
</code></pre>
<p>The functions have to return either a string, numeric or datetime
value depending on the registered function type. As an example we
will add a MySQL specific FLOOR() functionality. All the given
classes have to implement the base class :</p>
<pre><code class="php">&lt;?php
namespace MyProject\Query\AST;

use \Doctrine\ORM\Query\AST\Functions\FunctionNode;
use \Doctrine\ORM\Query\Lexer;

class MysqlFloor extends FunctionNode
{
    public $simpleArithmeticExpression;

    public function getSql(\Doctrine\ORM\Query\SqlWalker $sqlWalker)
    {
        return 'FLOOR(' . $sqlWalker-&gt;walkSimpleArithmeticExpression(
            $this-&gt;simpleArithmeticExpression
        ) . ')';
    }

    public function parse(\Doctrine\ORM\Query\Parser $parser)
    {
        $parser-&gt;match(Lexer::T_IDENTIFIER);
        $parser-&gt;match(Lexer::T_OPEN_PARENTHESIS);

        $this-&gt;simpleArithmeticExpression = $parser-&gt;SimpleArithmeticExpression();

        $parser-&gt;match(Lexer::T_CLOSE_PARENTHESIS);
    }
}
</code></pre>
<p>We will register the function by calling and can then use it:</p>
<pre><code class="php">&lt;?php
$config = $em-&gt;getConfiguration();
$config-&gt;registerNumericFunction('FLOOR', 'MyProject\Query\MysqlFloor');

$dql = &quot;SELECT FLOOR(person.salary * 1.75) FROM CompanyPerson person&quot;;
</code></pre>
<h2 class="section-header" id="title.1.6"><a href="#title.1.6">Querying Inherited Classes<i class="fas fa-link"></i></a></h2>
<p>This section demonstrates how you can query inherited classes and
what type of results to expect.</p>
<h3 class="section-header" id="title.1.6.1"><a href="#title.1.6.1">Single Table<i class="fas fa-link"></i></a></h3>
<p><a href="https://martinfowler.com/eaaCatalog/singleTableInheritance.html">Single Table Inheritance</a>
is an inheritance mapping strategy where all classes of a hierarchy
are mapped to a single database table. In order to distinguish
which row represents which type in the hierarchy a so-called
discriminator column is used.</p>
<p>First we need to setup an example set of entities to use. In this
scenario it is a generic Person and Employee example:</p>
<pre><code class="php">&lt;?php
namespace Entities;

/**
 * @Entity
 * @InheritanceType(&quot;SINGLE_TABLE&quot;)
 * @DiscriminatorColumn(name=&quot;discr&quot;, type=&quot;string&quot;)
 * @DiscriminatorMap({&quot;person&quot; = &quot;Person&quot;, &quot;employee&quot; = &quot;Employee&quot;})
 */
class Person
{
    /**
     * @Id @Column(type=&quot;integer&quot;)
     * @GeneratedValue
     */
    protected $id;

    /**
     * @Column(type=&quot;string&quot;, length=50)
     */
    protected $name;

    // ...
}

/**
 * @Entity
 */
class Employee extends Person
{
    /**
     * @Column(type=&quot;string&quot;, length=50)
     */
    private $department;

    // ...
}
</code></pre>
<p>First notice that the generated SQL to create the tables for these
entities looks like the following:</p>
<pre><code class="sql">CREATE TABLE Person (
    id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
    name VARCHAR(50) NOT NULL,
    discr VARCHAR(255) NOT NULL,
    department VARCHAR(50) NOT NULL
)
</code></pre>
<p>Now when persist a new <code>Employee</code> instance it will set the
discriminator value for us automatically:</p>
<pre><code class="php">&lt;?php
$employee = new \Entities\Employee();
$employee-&gt;setName('test');
$employee-&gt;setDepartment('testing');
$em-&gt;persist($employee);
$em-&gt;flush();
</code></pre>
<p>Now lets run a simple query to retrieve the <code>Employee</code> we just
created:</p>
<pre><code class="sql">SELECT e FROM Entities\Employee e WHERE e.name = 'test'
</code></pre>
<p>If we check the generated SQL you will notice it has some special
conditions added to ensure that we will only get back <code>Employee</code>
entities:</p>
<pre><code class="sql">SELECT p0_.id AS id0, p0_.name AS name1, p0_.department AS department2,
       p0_.discr AS discr3 FROM Person p0_
WHERE (p0_.name = ?) AND p0_.discr IN ('employee')
</code></pre>
<h3 class="section-header" id="title.1.6.2"><a href="#title.1.6.2">Class Table Inheritance<i class="fas fa-link"></i></a></h3>
<p><a href="https://martinfowler.com/eaaCatalog/classTableInheritance.html">Class Table Inheritance</a>
is an inheritance mapping strategy where each class in a hierarchy
is mapped to several tables: its own table and the tables of all
parent classes. The table of a child class is linked to the table
of a parent class through a foreign key constraint. Doctrine 2
implements this strategy through the use of a discriminator column
in the topmost table of the hierarchy because this is the easiest
way to achieve polymorphic queries with Class Table Inheritance.</p>
<p>The example for class table inheritance is the same as single
table, you just need to change the inheritance type from
<code>SINGLE_TABLE</code> to <code>JOINED</code>:</p>
<pre><code class="php">&lt;?php
/**
 * @Entity
 * @InheritanceType(&quot;JOINED&quot;)
 * @DiscriminatorColumn(name=&quot;discr&quot;, type=&quot;string&quot;)
 * @DiscriminatorMap({&quot;person&quot; = &quot;Person&quot;, &quot;employee&quot; = &quot;Employee&quot;})
 */
class Person
{
    // ...
}
</code></pre>
<p>Now take a look at the SQL which is generated to create the table,
you'll notice some differences:</p>
<pre><code class="sql">CREATE TABLE Person (
    id INT AUTO_INCREMENT NOT NULL,
    name VARCHAR(50) NOT NULL,
    discr VARCHAR(255) NOT NULL,
    PRIMARY KEY(id)
) ENGINE = InnoDB;
CREATE TABLE Employee (
    id INT NOT NULL,
    department VARCHAR(50) NOT NULL,
    PRIMARY KEY(id)
) ENGINE = InnoDB;
ALTER TABLE Employee ADD FOREIGN KEY (id) REFERENCES Person(id) ON DELETE CASCADE
</code></pre>
<ul><li class="dash"> The data is split between two tables</li>
<li class="dash"> A foreign key exists between the two tables</li>
</ul>

<p>Now if were to insert the same <code>Employee</code> as we did in the
<code>SINGLE_TABLE</code> example and run the same example query it will
generate different SQL joining the <code>Person</code> information
automatically for you:</p>
<pre><code class="sql">SELECT p0_.id AS id0, p0_.name AS name1, e1_.department AS department2,
       p0_.discr AS discr3
FROM Employee e1_ INNER JOIN Person p0_ ON e1_.id = p0_.id
WHERE p0_.name = ?
</code></pre>
<h2 class="section-header" id="title.1.7"><a href="#title.1.7">The Query class<i class="fas fa-link"></i></a></h2>
<p>An instance of the <code>Doctrine\ORM\Query</code> class represents a DQL
query. You create a Query instance be calling
<code>EntityManager#createQuery($dql)</code>, passing the DQL query string.
Alternatively you can create an empty <code>Query</code> instance and invoke
<code>Query#setDQL($dql)</code> afterwards. Here are some examples:</p>
<pre><code class="php">&lt;?php
// $em instanceof EntityManager

// example1: passing a DQL string
$q = $em-&gt;createQuery('select u from MyProject\Model\User u');

// example2: using setDQL
$q = $em-&gt;createQuery();
$q-&gt;setDQL('select u from MyProject\Model\User u');
</code></pre>
<h3 class="section-header" id="title.1.7.1"><a href="#title.1.7.1">Query Result Formats<i class="fas fa-link"></i></a></h3>
<p>The format in which the result of a DQL SELECT query is returned
can be influenced by a so-called <code>hydration mode</code>. A hydration
mode specifies a particular way in which a SQL result set is
transformed. Each hydration mode has its own dedicated method on
the Query class. Here they are:</p>
<ul><li class="dash"> <code>Query#getResult()</code>: Retrieves a collection of objects. The
   result is either a plain collection of objects (pure) or an array
   where the objects are nested in the result rows (mixed).</li>
<li class="dash"> <code>Query#getSingleResult()</code>: Retrieves a single object. If the
   result contains more than one object, an <code>NonUniqueResultException</code>
   is thrown. If the result contains no objects, an <code>NoResultException</code>
   is thrown. The pure/mixed distinction does not apply.</li>
<li class="dash"> <code>Query#getOneOrNullResult()</code>: Retrieve a single object. If no
   object is found null will be returned.</li>
<li class="dash"> <code>Query#getArrayResult()</code>: Retrieves an array graph (a nested
   array) that is largely interchangeable with the object graph
   generated by <code>Query#getResult()</code> for read-only purposes.
    .. note::
        An array graph can differ from the corresponding object
        graph in certain scenarios due to the difference of the identity
        semantics between arrays and objects.</li>
<li class="dash"> <code>Query#getScalarResult()</code>: Retrieves a flat/rectangular result
   set of scalar values that can contain duplicate data. The
   pure/mixed distinction does not apply.</li>
<li class="dash"> <code>Query#getSingleScalarResult()</code>: Retrieves a single scalar
   value from the result returned by the dbms. If the result contains
   more than a single scalar value, an exception is thrown. The
   pure/mixed distinction does not apply.</li>
</ul>

<p>Instead of using these methods, you can alternatively use the
general-purpose method
<code>Query#execute(array $params = array(), $hydrationMode = Query::HYDRATE_OBJECT)</code>.
Using this method you can directly supply the hydration mode as the
second parameter via one of the Query constants. In fact, the
methods mentioned earlier are just convenient shortcuts for the
execute method. For example, the method <code>Query#getResult()</code>
internally invokes execute, passing in <code>Query::HYDRATE_OBJECT</code> as
the hydration mode.</p>
<p>The use of the methods mentioned earlier is generally preferred as
it leads to more concise code.</p>
<h3 class="section-header" id="title.1.7.2"><a href="#title.1.7.2">Pure and Mixed Results<i class="fas fa-link"></i></a></h3>
<p>The nature of a result returned by a DQL SELECT query retrieved
through <code>Query#getResult()</code> or <code>Query#getArrayResult()</code> can be
of 2 forms: <strong>pure</strong> and <strong>mixed</strong>. In the previous simple
examples, you already saw a &quot;pure&quot; query result, with only objects.
By default, the result type is <strong>pure</strong> but
<strong>as soon as scalar values, such as aggregate values or other scalar values that do not belong to an entity, appear in the SELECT part of the DQL query, the result becomes mixed</strong>.
A mixed result has a different structure than a pure result in
order to accommodate for the scalar values.</p>
<p>A pure result usually looks like this:</p>
<pre><code class="php">$dql = &quot;SELECT u FROM User u&quot;;

array
    [0] =&gt; Object
    [1] =&gt; Object
    [2] =&gt; Object
    ...
</code></pre>
<p>A mixed result on the other hand has the following general
structure:</p>
<pre><code class="php">$dql = &quot;SELECT u, 'some scalar string', count(g.id) AS num FROM User u JOIN u.groups g GROUP BY u.id&quot;;

array
    [0]
        [0] =&gt; Object
        [1] =&gt; &quot;some scalar string&quot;
        ['num'] =&gt; 42
        // ... more scalar values, either indexed numerically or with a name
    [1]
        [0] =&gt; Object
        [1] =&gt; &quot;some scalar string&quot;
        ['num'] =&gt; 42
        // ... more scalar values, either indexed numerically or with a name
</code></pre>
<p>To better understand mixed results, consider the following DQL
query:</p>
<pre><code class="sql">SELECT u, UPPER(u.name) nameUpper FROM MyProject\Model\User u
</code></pre>
<p>This query makes use of the <code>UPPER</code> DQL function that returns a
scalar value and because there is now a scalar value in the SELECT
clause, we get a mixed result.</p>
<p>Conventions for mixed results are as follows:</p>
<ul><li class="dash"> The object fetched in the FROM clause is always positioned with the key '0'.</li>
<li class="dash"> Every scalar without a name is numbered in the order given in the query, starting with 1.</li>
<li class="dash"> Every aliased scalar is given with its alias-name as the key. The case of the name is kept.</li>
<li class="dash"> If several objects are fetched from the FROM clause they alternate every row.</li>
</ul>

<p>Here is how the result could look like:</p>
<pre><code class="php">array
    array
        [0] =&gt; User (Object)
        ['nameUpper'] =&gt; &quot;ROMAN&quot;
    array
        [0] =&gt; User (Object)
        ['nameUpper'] =&gt; &quot;JONATHAN&quot;
    ...
</code></pre>
<p>And here is how you would access it in PHP code:</p>
<pre><code class="php">&lt;?php
foreach ($results as $row) {
    echo &quot;Name: &quot; . $row[0]-&gt;getName();
    echo &quot;Name UPPER: &quot; . $row['nameUpper'];
}
</code></pre>
<h3 class="section-header" id="title.1.7.3"><a href="#title.1.7.3">Fetching Multiple FROM Entities<i class="fas fa-link"></i></a></h3>
<p>If you fetch multiple entities that are listed in the FROM clause then the hydration
will return the rows iterating the different top-level entities.</p>
<pre><code class="php">$dql = &quot;SELECT u, g FROM User u, Group g&quot;;

array
    [0] =&gt; Object (User)
    [1] =&gt; Object (Group)
    [2] =&gt; Object (User)
    [3] =&gt; Object (Group)
</code></pre>
<h3 class="section-header" id="title.1.7.4"><a href="#title.1.7.4">Hydration Modes<i class="fas fa-link"></i></a></h3>
<p>Each of the Hydration Modes makes assumptions about how the result
is returned to user land. You should know about all the details to
make best use of the different result formats:</p>
<p>The constants for the different hydration modes are:</p>
<ul><li class="dash"> Query::HYDRATE\_OBJECT</li>
<li class="dash"> Query::HYDRATE\_ARRAY</li>
<li class="dash"> Query::HYDRATE\_SCALAR</li>
<li class="dash"> Query::HYDRATE\_SINGLE\_SCALAR</li>
</ul>

<h4 class="section-header" id="title.1.7.4.1"><a href="#title.1.7.4.1">Object Hydration<i class="fas fa-link"></i></a></h4>
<p>Object hydration hydrates the result set into the object graph:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u');
$users = $query-&gt;getResult(Query::HYDRATE_OBJECT);
</code></pre>
<p>Sometimes the behavior in the object hydrator can be confusing, which is
why we are listing as many of the assumptions here for reference:</p>
<ul><li class="dash">Objects fetched in a FROM clause are returned as a Set, that means every
  object is only ever included in the resulting array once. This is the case
  even when using JOIN or GROUP BY in ways that return the same row for an
  object multiple times. If the hydrator sees the same object multiple times,
  then it makes sure it is only returned once.</li>
<li class="dash">If an object is already in memory from a previous query of any kind, then
  then the previous object is used, even if the database may contain more
  recent data. Data from the database is discarded. This even happens if the
  previous object is still an unloaded proxy.</li>
</ul>

<p>This list might be incomplete.</p>
<h4 class="section-header" id="title.1.7.4.2"><a href="#title.1.7.4.2">Array Hydration<i class="fas fa-link"></i></a></h4>
<p>You can run the same query with array hydration and the result set
is hydrated into an array that represents the object graph:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u');
$users = $query-&gt;getResult(Query::HYDRATE_ARRAY);
</code></pre>
<p>You can use the <code>getArrayResult()</code> shortcut as well:</p>
<pre><code class="php">&lt;?php
$users = $query-&gt;getArrayResult();
</code></pre>
<h4 class="section-header" id="title.1.7.4.3"><a href="#title.1.7.4.3">Scalar Hydration<i class="fas fa-link"></i></a></h4>
<p>If you want to return a flat rectangular result set instead of an
object graph you can use scalar hydration:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u');
$users = $query-&gt;getResult(Query::HYDRATE_SCALAR);
echo $users[0]['u_id'];
</code></pre>
<p>The following assumptions are made about selected fields using
Scalar Hydration:</p>
<ol><li>Fields from classes are prefixed by the DQL alias in the result.
   A query of the kind 'SELECT u.name ..' returns a key 'u\_name' in
   the result rows.</li>
</ol>

<h4 class="section-header" id="title.1.7.4.4"><a href="#title.1.7.4.4">Single Scalar Hydration<i class="fas fa-link"></i></a></h4>
<p>If you have a query which returns just a single scalar value you can use
single scalar hydration:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT COUNT(a.id) FROM CmsUser u LEFT JOIN u.articles a WHERE u.username = ?1 GROUP BY u.id');
$query-&gt;setParameter(1, 'jwage');
$numArticles = $query-&gt;getResult(Query::HYDRATE_SINGLE_SCALAR);
</code></pre>
<p>You can use the <code>getSingleScalarResult()</code> shortcut as well:</p>
<pre><code class="php">&lt;?php
$numArticles = $query-&gt;getSingleScalarResult();
</code></pre>
<h4 class="section-header" id="title.1.7.4.5"><a href="#title.1.7.4.5">Custom Hydration Modes<i class="fas fa-link"></i></a></h4>
<p>You can easily add your own custom hydration modes by first
creating a class which extends <code>AbstractHydrator</code>:</p>
<pre><code class="php">&lt;?php
namespace MyProject\Hydrators;

use Doctrine\DBAL\FetchMode;
use Doctrine\ORM\Internal\Hydration\AbstractHydrator;

class CustomHydrator extends AbstractHydrator
{
    protected function _hydrateAll()
    {
        return $this-&gt;stmt-&gt;fetchAll(FetchMode::Associative);
    }
}
</code></pre>
<p>Next you just need to add the class to the ORM configuration:</p>
<pre><code class="php">&lt;?php
$em-&gt;getConfiguration()-&gt;addCustomHydrationMode('CustomHydrator', 'MyProject\Hydrators\CustomHydrator');
</code></pre>
<p>Now the hydrator is ready to be used in your queries:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM CmsUser u');
$results = $query-&gt;getResult('CustomHydrator');
</code></pre>
<h3 class="section-header" id="title.1.7.5"><a href="#title.1.7.5">Iterating Large Result Sets<i class="fas fa-link"></i></a></h3>
<p>There are situations when a query you want to execute returns a
very large result-set that needs to be processed. All the
previously described hydration modes completely load a result-set
into memory which might not be feasible with large result sets. See
the <a href="batch-processing.html">Batch Processing</a> section on details how
to iterate large result sets.</p>
<h3 class="section-header" id="title.1.7.6"><a href="#title.1.7.6">Functions<i class="fas fa-link"></i></a></h3>
<p>The following methods exist on the <code>AbstractQuery</code> which both
<code>Query</code> and <code>NativeQuery</code> extend from.</p>
<h4 class="section-header" id="title.1.7.6.1"><a href="#title.1.7.6.1">Parameters<i class="fas fa-link"></i></a></h4>
<p>Prepared Statements that use numerical or named wildcards require
additional parameters to be executable against the database. To
pass parameters to the query the following methods can be used:</p>
<ul><li class="dash"> <code>AbstractQuery::setParameter($param, $value)</code> - Set the
   numerical or named wildcard to the given value.</li>
<li class="dash"> <code>AbstractQuery::setParameters(array $params)</code> - Set an array
   of parameter key-value pairs.</li>
<li class="dash"> <code>AbstractQuery::getParameter($param)</code></li>
<li class="dash"> <code>AbstractQuery::getParameters()</code></li>
</ul>

<p>Both named and positional parameters are passed to these methods without their ? or : prefix.</p>
<h4 class="section-header" id="title.1.7.6.2"><a href="#title.1.7.6.2">Cache related API<i class="fas fa-link"></i></a></h4>
<p>You can cache query results based either on all variables that
define the result (SQL, Hydration Mode, Parameters and Hints) or on
user-defined cache keys. However by default query results are not
cached at all. You have to enable the result cache on a per query
basis. The following example shows a complete workflow using the
Result Cache API:</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery('SELECT u FROM MyProject\Model\User u WHERE u.id = ?1');
$query-&gt;setParameter(1, 12);

$query-&gt;setResultCacheDriver(new ApcCache());

$query-&gt;useResultCache(true)
      -&gt;setResultCacheLifeTime($seconds = 3600);

$result = $query-&gt;getResult(); // cache miss

$query-&gt;expireResultCache(true);
$result = $query-&gt;getResult(); // forced expire, cache miss

$query-&gt;setResultCacheId('my_query_result');
$result = $query-&gt;getResult(); // saved in given result cache id.

// or call useResultCache() with all parameters:
$query-&gt;useResultCache(true, $seconds = 3600, 'my_query_result');
$result = $query-&gt;getResult(); // cache hit!

// Introspection
$queryCacheProfile = $query-&gt;getQueryCacheProfile();
$cacheDriver = $query-&gt;getResultCacheDriver();
$lifetime = $query-&gt;getLifetime();
$key = $query-&gt;getCacheKey();
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>You can set the Result Cache Driver globally on the
<code>Doctrine\ORM\Configuration</code> instance so that it is passed to
every <code>Query</code> and <code>NativeQuery</code> instance.</p>
</div>
<h4 class="section-header" id="title.1.7.6.3"><a href="#title.1.7.6.3">Query Hints<i class="fas fa-link"></i></a></h4>
<p>You can pass hints to the query parser and hydrators by using the
<code>AbstractQuery::setHint($name, $value)</code> method. Currently there
exist mostly internal query hints that are not be consumed in
userland. However the following few hints are to be used in
userland:</p>
<ul><li class="dash"> Query::HINT\_FORCE\_PARTIAL\_LOAD - Allows to hydrate objects
   although not all their columns are fetched. This query hint can be
   used to handle memory consumption problems with large result-sets
   that contain char or binary data. Doctrine has no way of implicitly
   reloading this data. Partially loaded objects have to be passed to
   <code>EntityManager::refresh()</code> if they are to be reloaded fully from
   the database.</li>
<li class="dash"> Query::HINT\_REFRESH - This query is used internally by
   <code>EntityManager::refresh()</code> and can be used in userland as well.
   If you specify this hint and a query returns the data for an entity
   that is already managed by the UnitOfWork, the fields of the
   existing entity will be refreshed. In normal operation a result-set
   that loads data of an already existing entity is discarded in favor
   of the already existing entity.</li>
<li class="dash"> Query::HINT\_CUSTOM\_TREE\_WALKERS - An array of additional
   <code>Doctrine\ORM\Query\TreeWalker</code> instances that are attached to
   the DQL query parsing process.</li>
</ul>

<h4 class="section-header" id="title.1.7.6.4"><a href="#title.1.7.6.4">Query Cache (DQL Query Only)<i class="fas fa-link"></i></a></h4>
<p>Parsing a DQL query and converting it into a SQL query against the
underlying database platform obviously has some overhead in
contrast to directly executing Native SQL queries. That is why
there is a dedicated Query Cache for caching the DQL parser
results. In combination with the use of wildcards you can reduce
the number of parsed queries in production to zero.</p>
<p>The Query Cache Driver is passed from the
<code>Doctrine\ORM\Configuration</code> instance to each
<code>Doctrine\ORM\Query</code> instance by default and is also enabled by
default. This also means you don't regularly need to fiddle with
the parameters of the Query Cache, however if you do there are
several methods to interact with it:</p>
<ul><li class="dash"> <code>Query::setQueryCacheDriver($driver)</code> - Allows to set a Cache
   instance</li>
<li class="dash"> <code>Query::setQueryCacheLifeTime($seconds = 3600)</code> - Set lifetime
   of the query caching.</li>
<li class="dash"> <code>Query::expireQueryCache($bool)</code> - Enforce the expiring of the
   query cache if set to true.</li>
<li class="dash"> <code>Query::getExpireQueryCache()</code></li>
<li class="dash"> <code>Query::getQueryCacheDriver()</code></li>
<li class="dash"> <code>Query::getQueryCacheLifeTime()</code></li>
</ul>

<h4 class="section-header" id="title.1.7.6.5"><a href="#title.1.7.6.5">First and Max Result Items (DQL Query Only)<i class="fas fa-link"></i></a></h4>
<p>You can limit the number of results returned from a DQL query as
well as specify the starting offset, Doctrine then uses a strategy
of manipulating the select query to return only the requested
number of results:</p>
<ul><li class="dash"> <code>Query::setMaxResults($maxResults)</code></li>
<li class="dash"> <code>Query::setFirstResult($offset)</code></li>
</ul>

<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>If your query contains a fetch-joined collection
specifying the result limit methods are not working as you would
expect. Set Max Results restricts the number of database result
rows, however in the case of fetch-joined collections one root
entity might appear in many rows, effectively hydrating less than
the specified number of results.</p>
</div>
<a id="dql-temporarily-change-fetch-mode"></a>
<h4 class="section-header" id="title.1.7.6.6"><a href="#title.1.7.6.6">Temporarily change fetch mode in DQL<i class="fas fa-link"></i></a></h4>
<p>While normally all your associations are marked as lazy or extra lazy you will have cases where you are using DQL and don't want to
fetch join a second, third or fourth level of entities into your result, because of the increased cost of the SQL JOIN. You
can mark a many-to-one or one-to-one association as fetched temporarily to batch fetch these entities using a WHERE .. IN query.</p>
<pre><code class="php">&lt;?php
$query = $em-&gt;createQuery(&quot;SELECT u FROM MyProject\User u&quot;);
$query-&gt;setFetchMode(&quot;MyProject\User&quot;, &quot;address&quot;, \Doctrine\ORM\Mapping\FetchMode::EAGER);
$query-&gt;execute();
</code></pre>
<p>Given that there are 10 users and corresponding addresses in the database the executed queries will look something like:</p>
<pre><code class="sql">SELECT * FROM users;
SELECT * FROM address WHERE id IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10);
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>Changing the fetch mode during a query mostly makes sense for one-to-one and many-to-one relations. In that case,
all the necessary IDs are available after the root entity (<code>user</code> in the above example) has been loaded. So, one
query per association can be executed to fetch all the referred-to entities (<code>address</code>).</p>
<p>For one-to-many relations, changing the fetch mode to eager will cause to execute one query <strong>for every root entity
loaded</strong>. This gives no improvement over the <code>lazy</code> fetch mode which will also initialize the associations on
a one-by-one basis once they are accessed.</p>
</div>
<h2 class="section-header" id="title.1.8"><a href="#title.1.8">EBNF<i class="fas fa-link"></i></a></h2>
<p>The following context-free grammar, written in an EBNF variant,
describes the Doctrine Query Language. You can consult this grammar
whenever you are unsure about what is possible with DQL or what the
correct syntax for a particular query should be.</p>
<h3 class="section-header" id="title.1.8.1"><a href="#title.1.8.1">Document syntax:<i class="fas fa-link"></i></a></h3>
<ul><li class="dash"> non-terminals begin with an upper case character</li>
<li class="dash"> terminals begin with a lower case character</li>
<li class="dash"> parentheses (...) are used for grouping</li>
<li class="dash"> square brackets [...] are used for defining an optional part,
   e.g. zero or one time</li>
<li class="dash"> curly brackets {...} are used for repetition, e.g. zero or more
   times</li>
<li class="dash"> double quotation marks &quot;...&quot; define a terminal string</li>
<li class="dash"> a vertical bar \| represents an alternative</li>
</ul>

<h3 class="section-header" id="title.1.8.2"><a href="#title.1.8.2">Terminals<i class="fas fa-link"></i></a></h3>
<ul><li class="dash"> identifier (name, email, ...) must match <code>[a-z_][a-z0-9_]*</code></li>
<li class="dash"> fully_qualified_name (Doctrine\Tests\Models\CMS\CmsUser) matches PHP's fully qualified class names</li>
<li class="dash"> string ('foo', 'bar''s house', '%ninja%', ...)</li>
<li class="dash"> char ('/', '\\', ' ', ...)</li>
<li class="dash"> integer (-1, 0, 1, 34, ...)</li>
<li class="dash"> float (-0.23, 0.007, 1.245342E+8, ...)</li>
<li class="dash"> boolean (false, true)</li>
</ul>

<h3 class="section-header" id="title.1.8.3"><a href="#title.1.8.3">Query Language<i class="fas fa-link"></i></a></h3>
<pre><code class="php">QueryLanguage ::= SelectStatement | UpdateStatement | DeleteStatement
</code></pre>
<h3 class="section-header" id="title.1.8.4"><a href="#title.1.8.4">Statements<i class="fas fa-link"></i></a></h3>
<pre><code class="php">SelectStatement ::= SelectClause FromClause [WhereClause] [GroupByClause] [HavingClause] [OrderByClause]
UpdateStatement ::= UpdateClause [WhereClause]
DeleteStatement ::= DeleteClause [WhereClause]
</code></pre>
<h3 class="section-header" id="title.1.8.5"><a href="#title.1.8.5">Identifiers<i class="fas fa-link"></i></a></h3>
<pre><code class="php">/* Alias Identification usage (the &quot;u&quot; of &quot;u.name&quot;) */
IdentificationVariable ::= identifier

/* Alias Identification declaration (the &quot;u&quot; of &quot;FROM User u&quot;) */
AliasIdentificationVariable :: = identifier

/* identifier that must be a class name (the &quot;User&quot; of &quot;FROM User u&quot;), possibly as a fully qualified class name or namespace-aliased */
AbstractSchemaName ::= fully_qualified_name | identifier

/* Alias ResultVariable declaration (the &quot;total&quot; of &quot;COUNT(*) AS total&quot;) */
AliasResultVariable = identifier

/* ResultVariable identifier usage of mapped field aliases (the &quot;total&quot; of &quot;COUNT(*) AS total&quot;) */
ResultVariable = identifier

/* identifier that must be a field (the &quot;name&quot; of &quot;u.name&quot;) */
/* This is responsible to know if the field exists in Object, no matter if it's a relation or a simple field */
FieldIdentificationVariable ::= identifier

/* identifier that must be a collection-valued association field (to-many) (the &quot;Phonenumbers&quot; of &quot;u.Phonenumbers&quot;) */
CollectionValuedAssociationField ::= FieldIdentificationVariable

/* identifier that must be a single-valued association field (to-one) (the &quot;Group&quot; of &quot;u.Group&quot;) */
SingleValuedAssociationField ::= FieldIdentificationVariable

/* identifier that must be an embedded class state field */
EmbeddedClassStateField ::= FieldIdentificationVariable

/* identifier that must be a simple state field (name, email, ...) (the &quot;name&quot; of &quot;u.name&quot;) */
/* The difference between this and FieldIdentificationVariable is only semantical, because it points to a single field (not mapping to a relation) */
SimpleStateField ::= FieldIdentificationVariable
</code></pre>
<h3 class="section-header" id="title.1.8.6"><a href="#title.1.8.6">Path Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">/* &quot;u.Group&quot; or &quot;u.Phonenumbers&quot; declarations */
JoinAssociationPathExpression             ::= IdentificationVariable &quot;.&quot; (CollectionValuedAssociationField | SingleValuedAssociationField)

/* &quot;u.Group&quot; or &quot;u.Phonenumbers&quot; usages */
AssociationPathExpression                 ::= CollectionValuedPathExpression | SingleValuedAssociationPathExpression

/* &quot;u.name&quot; or &quot;u.Group&quot; */
SingleValuedPathExpression                ::= StateFieldPathExpression | SingleValuedAssociationPathExpression

/* &quot;u.name&quot; or &quot;u.Group.name&quot; */
StateFieldPathExpression                  ::= IdentificationVariable &quot;.&quot; StateField

/* &quot;u.Group&quot; */
SingleValuedAssociationPathExpression     ::= IdentificationVariable &quot;.&quot; SingleValuedAssociationField

/* &quot;u.Group.Permissions&quot; */
CollectionValuedPathExpression            ::= IdentificationVariable &quot;.&quot; CollectionValuedAssociationField

/* &quot;name&quot; */
StateField                                ::= {EmbeddedClassStateField &quot;.&quot;}* SimpleStateField
</code></pre>
<h3 class="section-header" id="title.1.8.7"><a href="#title.1.8.7">Clauses<i class="fas fa-link"></i></a></h3>
<pre><code class="php">SelectClause        ::= &quot;SELECT&quot; [&quot;DISTINCT&quot;] SelectExpression {&quot;,&quot; SelectExpression}*
SimpleSelectClause  ::= &quot;SELECT&quot; [&quot;DISTINCT&quot;] SimpleSelectExpression
UpdateClause        ::= &quot;UPDATE&quot; AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable &quot;SET&quot; UpdateItem {&quot;,&quot; UpdateItem}*
DeleteClause        ::= &quot;DELETE&quot; [&quot;FROM&quot;] AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable
FromClause          ::= &quot;FROM&quot; IdentificationVariableDeclaration {&quot;,&quot; IdentificationVariableDeclaration}*
SubselectFromClause ::= &quot;FROM&quot; SubselectIdentificationVariableDeclaration {&quot;,&quot; SubselectIdentificationVariableDeclaration}*
WhereClause         ::= &quot;WHERE&quot; ConditionalExpression
HavingClause        ::= &quot;HAVING&quot; ConditionalExpression
GroupByClause       ::= &quot;GROUP&quot; &quot;BY&quot; GroupByItem {&quot;,&quot; GroupByItem}*
OrderByClause       ::= &quot;ORDER&quot; &quot;BY&quot; OrderByItem {&quot;,&quot; OrderByItem}*
Subselect           ::= SimpleSelectClause SubselectFromClause [WhereClause] [GroupByClause] [HavingClause] [OrderByClause]
</code></pre>
<h3 class="section-header" id="title.1.8.8"><a href="#title.1.8.8">Items<i class="fas fa-link"></i></a></h3>
<pre><code class="php">UpdateItem  ::= SingleValuedPathExpression &quot;=&quot; NewValue
OrderByItem ::= (SimpleArithmeticExpression | SingleValuedPathExpression | ScalarExpression | ResultVariable | FunctionDeclaration) [&quot;ASC&quot; | &quot;DESC&quot;]
GroupByItem ::= IdentificationVariable | ResultVariable | SingleValuedPathExpression
NewValue    ::= SimpleArithmeticExpression | &quot;NULL&quot;
</code></pre>
<h3 class="section-header" id="title.1.8.9"><a href="#title.1.8.9">From, Join and Index by<i class="fas fa-link"></i></a></h3>
<pre><code class="php">IdentificationVariableDeclaration          ::= RangeVariableDeclaration [IndexBy] {Join}*
SubselectIdentificationVariableDeclaration ::= IdentificationVariableDeclaration
RangeVariableDeclaration                   ::= AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable
JoinAssociationDeclaration                 ::= JoinAssociationPathExpression [&quot;AS&quot;] AliasIdentificationVariable [IndexBy]
Join                                       ::= [&quot;LEFT&quot; [&quot;OUTER&quot;] | &quot;INNER&quot;] &quot;JOIN&quot; (JoinAssociationDeclaration | RangeVariableDeclaration) [&quot;WITH&quot; ConditionalExpression]
IndexBy                                    ::= &quot;INDEX&quot; &quot;BY&quot; StateFieldPathExpression
</code></pre>
<h3 class="section-header" id="title.1.8.10"><a href="#title.1.8.10">Select Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">SelectExpression        ::= (IdentificationVariable | ScalarExpression | AggregateExpression | FunctionDeclaration | PartialObjectExpression | &quot;(&quot; Subselect &quot;)&quot; | CaseExpression | NewObjectExpression) [[&quot;AS&quot;] [&quot;HIDDEN&quot;] AliasResultVariable]
SimpleSelectExpression  ::= (StateFieldPathExpression | IdentificationVariable | FunctionDeclaration | AggregateExpression | &quot;(&quot; Subselect &quot;)&quot; | ScalarExpression) [[&quot;AS&quot;] AliasResultVariable]
PartialObjectExpression ::= &quot;PARTIAL&quot; IdentificationVariable &quot;.&quot; PartialFieldSet
PartialFieldSet         ::= &quot;{&quot; SimpleStateField {&quot;,&quot; SimpleStateField}* &quot;}&quot;
NewObjectExpression     ::= &quot;NEW&quot; AbstractSchemaName &quot;(&quot; NewObjectArg {&quot;,&quot; NewObjectArg}* &quot;)&quot;
NewObjectArg            ::= ScalarExpression | &quot;(&quot; Subselect &quot;)&quot;
</code></pre>
<h3 class="section-header" id="title.1.8.11"><a href="#title.1.8.11">Conditional Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">ConditionalExpression       ::= ConditionalTerm {&quot;OR&quot; ConditionalTerm}*
ConditionalTerm             ::= ConditionalFactor {&quot;AND&quot; ConditionalFactor}*
ConditionalFactor           ::= [&quot;NOT&quot;] ConditionalPrimary
ConditionalPrimary          ::= SimpleConditionalExpression | &quot;(&quot; ConditionalExpression &quot;)&quot;
SimpleConditionalExpression ::= ComparisonExpression | BetweenExpression | LikeExpression |
                                InExpression | NullComparisonExpression | ExistsExpression |
                                EmptyCollectionComparisonExpression | CollectionMemberExpression |
                                InstanceOfExpression
</code></pre>
<h3 class="section-header" id="title.1.8.12"><a href="#title.1.8.12">Collection Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">EmptyCollectionComparisonExpression ::= CollectionValuedPathExpression &quot;IS&quot; [&quot;NOT&quot;] &quot;EMPTY&quot;
CollectionMemberExpression          ::= EntityExpression [&quot;NOT&quot;] &quot;MEMBER&quot; [&quot;OF&quot;] CollectionValuedPathExpression
</code></pre>
<h3 class="section-header" id="title.1.8.13"><a href="#title.1.8.13">Literal Values<i class="fas fa-link"></i></a></h3>
<pre><code class="php">Literal     ::= string | char | integer | float | boolean
InParameter ::= Literal | InputParameter
</code></pre>
<h3 class="section-header" id="title.1.8.14"><a href="#title.1.8.14">Input Parameter<i class="fas fa-link"></i></a></h3>
<pre><code class="php">InputParameter      ::= PositionalParameter | NamedParameter
PositionalParameter ::= &quot;?&quot; integer
NamedParameter      ::= &quot;:&quot; string
</code></pre>
<h3 class="section-header" id="title.1.8.15"><a href="#title.1.8.15">Arithmetic Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">ArithmeticExpression       ::= SimpleArithmeticExpression | &quot;(&quot; Subselect &quot;)&quot;
SimpleArithmeticExpression ::= ArithmeticTerm {(&quot;+&quot; | &quot;-&quot;) ArithmeticTerm}*
ArithmeticTerm             ::= ArithmeticFactor {(&quot;*&quot; | &quot;/&quot;) ArithmeticFactor}*
ArithmeticFactor           ::= [(&quot;+&quot; | &quot;-&quot;)] ArithmeticPrimary
ArithmeticPrimary          ::= SingleValuedPathExpression | Literal | &quot;(&quot; SimpleArithmeticExpression &quot;)&quot;
                               | FunctionsReturningNumerics | AggregateExpression | FunctionsReturningStrings
                               | FunctionsReturningDatetime | IdentificationVariable | ResultVariable
                               | InputParameter | CaseExpression
</code></pre>
<h3 class="section-header" id="title.1.8.16"><a href="#title.1.8.16">Scalar and Type Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">ScalarExpression       ::= SimpleArithmeticExpression | StringPrimary | DateTimePrimary | StateFieldPathExpression | BooleanPrimary | CaseExpression | InstanceOfExpression
StringExpression       ::= StringPrimary | ResultVariable | &quot;(&quot; Subselect &quot;)&quot;
StringPrimary          ::= StateFieldPathExpression | string | InputParameter | FunctionsReturningStrings | AggregateExpression | CaseExpression
BooleanExpression      ::= BooleanPrimary | &quot;(&quot; Subselect &quot;)&quot;
BooleanPrimary         ::= StateFieldPathExpression | boolean | InputParameter
EntityExpression       ::= SingleValuedAssociationPathExpression | SimpleEntityExpression
SimpleEntityExpression ::= IdentificationVariable | InputParameter
DatetimeExpression     ::= DatetimePrimary | &quot;(&quot; Subselect &quot;)&quot;
DatetimePrimary        ::= StateFieldPathExpression | InputParameter | FunctionsReturningDatetime | AggregateExpression
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>Parts of CASE expressions are not yet implemented.</p>
</div>
<h3 class="section-header" id="title.1.8.17"><a href="#title.1.8.17">Aggregate Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">AggregateExpression ::= (&quot;AVG&quot; | &quot;MAX&quot; | &quot;MIN&quot; | &quot;SUM&quot; | &quot;COUNT&quot;) &quot;(&quot; [&quot;DISTINCT&quot;] SimpleArithmeticExpression &quot;)&quot;
</code></pre>
<h3 class="section-header" id="title.1.8.18"><a href="#title.1.8.18">Case Expressions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">CaseExpression        ::= GeneralCaseExpression | SimpleCaseExpression | CoalesceExpression | NullifExpression
GeneralCaseExpression ::= &quot;CASE&quot; WhenClause {WhenClause}* &quot;ELSE&quot; ScalarExpression &quot;END&quot;
WhenClause            ::= &quot;WHEN&quot; ConditionalExpression &quot;THEN&quot; ScalarExpression
SimpleCaseExpression  ::= &quot;CASE&quot; CaseOperand SimpleWhenClause {SimpleWhenClause}* &quot;ELSE&quot; ScalarExpression &quot;END&quot;
CaseOperand           ::= StateFieldPathExpression | TypeDiscriminator
SimpleWhenClause      ::= &quot;WHEN&quot; ScalarExpression &quot;THEN&quot; ScalarExpression
CoalesceExpression    ::= &quot;COALESCE&quot; &quot;(&quot; ScalarExpression {&quot;,&quot; ScalarExpression}* &quot;)&quot;
NullifExpression      ::= &quot;NULLIF&quot; &quot;(&quot; ScalarExpression &quot;,&quot; ScalarExpression &quot;)&quot;
</code></pre>
<h3 class="section-header" id="title.1.8.19"><a href="#title.1.8.19">Other Expressions<i class="fas fa-link"></i></a></h3>
<p>QUANTIFIED/BETWEEN/COMPARISON/LIKE/NULL/EXISTS</p>
<pre><code class="php">QuantifiedExpression     ::= (&quot;ALL&quot; | &quot;ANY&quot; | &quot;SOME&quot;) &quot;(&quot; Subselect &quot;)&quot;
BetweenExpression        ::= ArithmeticExpression [&quot;NOT&quot;] &quot;BETWEEN&quot; ArithmeticExpression &quot;AND&quot; ArithmeticExpression
ComparisonExpression     ::= ArithmeticExpression ComparisonOperator ( QuantifiedExpression | ArithmeticExpression )
InExpression             ::= SingleValuedPathExpression [&quot;NOT&quot;] &quot;IN&quot; &quot;(&quot; (InParameter {&quot;,&quot; InParameter}* | Subselect) &quot;)&quot;
InstanceOfExpression     ::= IdentificationVariable [&quot;NOT&quot;] &quot;INSTANCE&quot; [&quot;OF&quot;] (InstanceOfParameter | &quot;(&quot; InstanceOfParameter {&quot;,&quot; InstanceOfParameter}* &quot;)&quot;)
InstanceOfParameter      ::= AbstractSchemaName | InputParameter
LikeExpression           ::= StringExpression [&quot;NOT&quot;] &quot;LIKE&quot; StringPrimary [&quot;ESCAPE&quot; char]
NullComparisonExpression ::= (InputParameter | NullIfExpression | CoalesceExpression | AggregateExpression | FunctionDeclaration | IdentificationVariable | SingleValuedPathExpression | ResultVariable) &quot;IS&quot; [&quot;NOT&quot;] &quot;NULL&quot;
ExistsExpression         ::= [&quot;NOT&quot;] &quot;EXISTS&quot; &quot;(&quot; Subselect &quot;)&quot;
ComparisonOperator       ::= &quot;=&quot; | &quot;&lt;&quot; | &quot;&lt;=&quot; | &quot;&lt;&gt;&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot; | &quot;!=&quot;
</code></pre>
<h3 class="section-header" id="title.1.8.20"><a href="#title.1.8.20">Functions<i class="fas fa-link"></i></a></h3>
<pre><code class="php">FunctionDeclaration ::= FunctionsReturningStrings | FunctionsReturningNumerics | FunctionsReturningDateTime

FunctionsReturningNumerics ::=
        &quot;LENGTH&quot; &quot;(&quot; StringPrimary &quot;)&quot; |
        &quot;LOCATE&quot; &quot;(&quot; StringPrimary &quot;,&quot; StringPrimary [&quot;,&quot; SimpleArithmeticExpression]&quot;)&quot; |
        &quot;ABS&quot; &quot;(&quot; SimpleArithmeticExpression &quot;)&quot; |
        &quot;SQRT&quot; &quot;(&quot; SimpleArithmeticExpression &quot;)&quot; |
        &quot;MOD&quot; &quot;(&quot; SimpleArithmeticExpression &quot;,&quot; SimpleArithmeticExpression &quot;)&quot; |
        &quot;SIZE&quot; &quot;(&quot; CollectionValuedPathExpression &quot;)&quot; |
        &quot;DATE_DIFF&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;)&quot; |
        &quot;BIT_AND&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;)&quot; |
        &quot;BIT_OR&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;)&quot;

FunctionsReturningDateTime ::=
        &quot;CURRENT_DATE&quot; |
        &quot;CURRENT_TIME&quot; |
        &quot;CURRENT_TIMESTAMP&quot; |
        &quot;DATE_ADD&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;,&quot; StringPrimary &quot;)&quot; |
        &quot;DATE_SUB&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;,&quot; StringPrimary &quot;)&quot;

FunctionsReturningStrings ::=
        &quot;CONCAT&quot; &quot;(&quot; StringPrimary &quot;,&quot; StringPrimary &quot;)&quot; |
        &quot;SUBSTRING&quot; &quot;(&quot; StringPrimary &quot;,&quot; SimpleArithmeticExpression &quot;,&quot; SimpleArithmeticExpression &quot;)&quot; |
        &quot;TRIM&quot; &quot;(&quot; [[&quot;LEADING&quot; | &quot;TRAILING&quot; | &quot;BOTH&quot;] [char] &quot;FROM&quot;] StringPrimary &quot;)&quot; |
        &quot;LOWER&quot; &quot;(&quot; StringPrimary &quot;)&quot; |
        &quot;UPPER&quot; &quot;(&quot; StringPrimary &quot;)&quot; |
        &quot;IDENTITY&quot; &quot;(&quot; SingleValuedAssociationPathExpression {&quot;,&quot; string} &quot;)&quot;
</code></pre>
</body>
</html>                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
