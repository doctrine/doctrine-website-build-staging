<!DOCTYPE html>
<html>
    <head>
        <title>Ordering To-Many Associations - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?3625e4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/couchdb-odm.html">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="composite-primary-keys-html-title-1" class="toc-item"><a href="composite-primary-keys.html#title.1">Composite and Foreign Keys as Primary Key</a></li><ul><li id="composite-primary-keys-html-title-1-1" class="toc-item"><a href="composite-primary-keys.html#title.1.1">General Considerations</a></li><li id="composite-primary-keys-html-title-1-2" class="toc-item"><a href="composite-primary-keys.html#title.1.2">Primitive Types only</a></li><li id="composite-primary-keys-html-title-1-3" class="toc-item"><a href="composite-primary-keys.html#title.1.3">Identity through foreign Entities</a></li><li id="composite-primary-keys-html-title-1-4" class="toc-item"><a href="composite-primary-keys.html#title.1.4">Use-Case 1: Dynamic Attributes</a></li><li id="composite-primary-keys-html-title-1-5" class="toc-item"><a href="composite-primary-keys.html#title.1.5">Use-Case 2: Simple Derived Identity</a></li><li id="composite-primary-keys-html-title-1-6" class="toc-item"><a href="composite-primary-keys.html#title.1.6">Use-Case 3: Join-Table with Metadata</a></li><li id="composite-primary-keys-html-title-1-7" class="toc-item"><a href="composite-primary-keys.html#title.1.7">Performance Considerations</a></li></ul><li id="embeddables-html-title-1" class="toc-item"><a href="embeddables.html#title.1">Separating Concerns using Embeddables</a></li><li id="embeddables-html-title-2" class="toc-item"><a href="embeddables.html#title.2">Column Prefixing</a></li><li id="embeddables-html-title-3" class="toc-item"><a href="embeddables.html#title.3">DQL</a></li><li id="extra-lazy-associations-html-title-1" class="toc-item"><a href="extra-lazy-associations.html#title.1">Extra Lazy Associations</a></li><ul><li id="extra-lazy-associations-html-title-1-1" class="toc-item"><a href="extra-lazy-associations.html#title.1.1">Enabling Extra-Lazy Associations</a></li></ul><li id="getting-started-database-html-title-1" class="toc-item"><a href="getting-started-database.html#title.1">Getting Started: Database First</a></li><li id="getting-started-models-html-title-1" class="toc-item"><a href="getting-started-models.html#title.1">Getting Started: Model First</a></li><li id="getting-started-html-title-1" class="toc-item"><a href="getting-started.html#title.1">Getting Started with Doctrine</a></li><ul><li id="getting-started-html-title-1-1" class="toc-item"><a href="getting-started.html#title.1.1">Guide Assumptions</a></li><li id="getting-started-html-title-1-2" class="toc-item"><a href="getting-started.html#title.1.2">What is Doctrine?</a></li><ul><li id="getting-started-html-title-1-2-1" class="toc-item"><a href="getting-started.html#title.1.2.1">What are Entities?</a></li></ul><li id="getting-started-html-title-1-3" class="toc-item"><a href="getting-started.html#title.1.3">An Example Model: Bug Tracker</a></li><li id="getting-started-html-title-1-4" class="toc-item"><a href="getting-started.html#title.1.4">Project Setup</a></li><li id="getting-started-html-title-1-5" class="toc-item"><a href="getting-started.html#title.1.5">Obtaining the EntityManager</a></li><li id="getting-started-html-title-1-6" class="toc-item"><a href="getting-started.html#title.1.6">Generating the Database Schema</a></li><li id="getting-started-html-title-1-7" class="toc-item"><a href="getting-started.html#title.1.7">Starting with the Product</a></li><li id="getting-started-html-title-1-8" class="toc-item"><a href="getting-started.html#title.1.8">Adding Bug and User Entities</a></li><li id="getting-started-html-title-1-9" class="toc-item"><a href="getting-started.html#title.1.9">Implementing more Requirements</a></li><li id="getting-started-html-title-1-10" class="toc-item"><a href="getting-started.html#title.1.10">Queries for Application Use-Cases</a></li><ul><li id="getting-started-html-title-1-10-1" class="toc-item"><a href="getting-started.html#title.1.10.1">List of Bugs</a></li><li id="getting-started-html-title-1-10-2" class="toc-item"><a href="getting-started.html#title.1.10.2">Array Hydration of the Bug List</a></li><li id="getting-started-html-title-1-10-3" class="toc-item"><a href="getting-started.html#title.1.10.3">Find by Primary Key</a></li></ul><li id="getting-started-html-title-1-11" class="toc-item"><a href="getting-started.html#title.1.11">Dashboard of the User</a></li><li id="getting-started-html-title-1-12" class="toc-item"><a href="getting-started.html#title.1.12">Number of Bugs</a></li><li id="getting-started-html-title-1-13" class="toc-item"><a href="getting-started.html#title.1.13">Updating Entities</a></li><li id="getting-started-html-title-1-14" class="toc-item"><a href="getting-started.html#title.1.14">Entity Repositories</a></li><li id="getting-started-html-title-1-15" class="toc-item"><a href="getting-started.html#title.1.15">Conclusion</a></li></ul><li id="ordered-associations-html-title-1" class="toc-item"><a href="ordered-associations.html#title.1">Ordering To-Many Associations</a></li><li id="override-field-association-mappings-in-subclasses-html-title-1" class="toc-item"><a href="override-field-association-mappings-in-subclasses.html#title.1">Override Field Association Mappings In Subclasses</a></li><li id="pagination-html-title-1" class="toc-item"><a href="pagination.html#title.1">Pagination</a></li><li id="working-with-indexed-associations-html-title-1" class="toc-item"><a href="working-with-indexed-associations.html#title.1">Working with Indexed Associations</a></li><ul><li id="working-with-indexed-associations-html-title-1-1" class="toc-item"><a href="working-with-indexed-associations.html#title.1.1">Mapping Indexed Associations</a></li><li id="working-with-indexed-associations-html-title-1-2" class="toc-item"><a href="working-with-indexed-associations.html#title.1.2">Querying indexed associations</a></li><li id="working-with-indexed-associations-html-title-1-3" class="toc-item"><a href="working-with-indexed-associations.html#title.1.3">Outlook into the Future</a></li></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                                                
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/orm.html">ORM</a></li>
                                <li class="breadcrumb-item"><a href="https://staging.doctrine-project.org/projects/doctrine-orm/en/2.5/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Ordering To-Many Associations</li>
                            </ol>
                        </nav>
                                    </div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-orm/en/latest/tutorials/ordered-associations.html" class="project-version-switcher badge badge-secondary">master</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-orm/en/2.6/tutorials/ordered-associations.html" class="project-version-switcher badge badge-secondary">2.6</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-orm/en/2.5/tutorials/ordered-associations.html" class="project-version-switcher badge badge-warning">2.5</a>
                                        </li>
                                    
                                    
                                    <li class="list-inline-item ml-2"><a href="https://github.com/doctrine/doctrine2/edit/2.5/docs/en/tutorials/ordered-associations.rst" class="badge badge-primary">Edit</a></li>

                                </ul>
                            
                            
<a class="section-anchor" id="title.1" name="title.1"></a><h1 class="section-header"><a href="#title.1">Ordering To-Many Associations<i class="fas fa-link"></i></a></h1>
<p>There are use-cases when you'll want to sort collections when they are
retrieved from the database. In userland you do this as long as you
haven't initially saved an entity with its associations into the
database. To retrieve a sorted collection from the database you can
use the <code>@OrderBy</code> annotation with an collection that specifies
an DQL snippet that is appended to all queries with this
collection.</p>
<p>Additional to any <code>@OneToMany</code> or <code>@ManyToMany</code> annotation you
can specify the <code>@OrderBy</code> in the following way:</p>
<div class="configuration-block"><pre><code class="php">&lt;?php
/** @Entity **/
class User
{
    // ...

    /**
     * @ManyToMany(targetEntity=&quot;Group&quot;)
     * @OrderBy({&quot;name&quot; = &quot;ASC&quot;})
     **/
    private $groups;
}
</code></pre>
<pre><code class="xml">&lt;doctrine-mapping&gt;
    &lt;entity name=&quot;User&quot;&gt;
        &lt;many-to-many field=&quot;groups&quot; target-entity=&quot;Group&quot;&gt;
            &lt;order-by&gt;
                &lt;order-by-field name=&quot;name&quot; direction=&quot;ASC&quot; /&gt;
            &lt;/order-by&gt;
        &lt;/many-to-many&gt;
    &lt;/entity&gt;
&lt;/doctrine-mapping&gt;
</code></pre>
<pre><code class="yaml">User:
  type: entity
  manyToMany:
    groups:
      orderBy: { 'name': 'ASC' }
      targetEntity: Group
      joinTable:
        name: users_groups
        joinColumns:
          user_id:
            referencedColumnName: id
        inverseJoinColumns:
          group_id:
            referencedColumnName: id
</code></pre>
</div>
<p>The DQL Snippet in OrderBy is only allowed to consist of
unqualified, unquoted field names and of an optional ASC/DESC
positional statement. Multiple Fields are separated by a comma (,).
The referenced field names have to exist on the <code>targetEntity</code>
class of the <code>@ManyToMany</code> or <code>@OneToMany</code> annotation.</p>
<p>The semantics of this feature can be described as follows.</p>
<ul><li class="dash"> <code>@OrderBy</code> acts as an implicit ORDER BY clause for the given
   fields, that is appended to all the explicitly given ORDER BY
   items.</li>
<li class="dash"> All collections of the ordered type are always retrieved in an
   ordered fashion.</li>
<li class="dash"> To keep the database impact low, these implicit ORDER BY items
   are only added to an DQL Query if the collection is fetch joined in
   the DQL query.</li>
</ul>

<p>Given our previously defined example, the following would not add
ORDER BY, since g is not fetch joined:</p>
<pre><code class="sql">SELECT u FROM User u JOIN u.groups g WHERE SIZE(g) &gt; 10
</code></pre>
<p>However the following:</p>
<pre><code class="sql">SELECT u, g FROM User u JOIN u.groups g WHERE u.id = 10
</code></pre>
<p>...would internally be rewritten to:</p>
<pre><code class="sql">SELECT u, g FROM User u JOIN u.groups g WHERE u.id = 10 ORDER BY g.name ASC
</code></pre>
<p>You can reverse the order with an explicit DQL ORDER BY:</p>
<pre><code class="sql">SELECT u, g FROM User u JOIN u.groups g WHERE u.id = 10 ORDER BY g.name DESC
</code></pre>
<p>...is internally rewritten to:</p>
<pre><code class="sql">SELECT u, g FROM User u JOIN u.groups g WHERE u.id = 10 ORDER BY g.name DESC, g.name ASC
</code></pre>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?f32c09"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?36322d"></script>

        <script type="text/javascript">
            var projectSlug = 'orm';
            var versionSlug = '2.5';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

            <script src="https://staging.doctrine-project.org/js/sidebar.js?cd221a"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

        
        
            </body>
</html>
