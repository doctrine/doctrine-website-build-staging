<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                            
                                
                                
                
                <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Blog</li>
    </ol>
</nav>

    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/06/05/doctrine-statistics">Doctrine Statistics</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-06-05
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>On October 18th of 2007 I implemented Google Analytics which
allowed me to track the statistics of the website. On that first
day of statistics gathered we had 93 visitors and yesterday we had
a little over 1500! Needless to say that is pretty exciting!</p>
<p>Here is a graph from google analytics that illustrates the growth.</p>
<p>Here are some more statistics gathered:</p>
<a id="title.1"></a><h1>Google Analytics</h1>
<p>\ \ ----- \ \ 607,035 \ Absolute Unique Visitors \ \ 2,331,993
\ Average Pageviews \ \ 00:05:02 \ Bounce Rate \ \ 38.19% \|</p>
<a id="title.2"></a><h1>Downloads</h1>
<p>\ # \ ---------- \ \ 126 \ 0.10
\ \ 6691 \ 1.0 \ \ 9539 \|</p>
<blockquote><p><strong>NOTE</strong>
<strong>These statistics don't count downloads through other sources such as symfony, Doctrine SVN, etc. They only track the downloads through the Doctrine website on the <a href="http://www.doctrine-project.org/download">Download</a> page.</strong></p>
</blockquote>
<p>Hopefully I can make this same post a year from now about the same
thing and Doctrine will have grown with many new versions.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/05/29/doctrine-lazy-loading">Doctrine Lazy Loading</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-05-29
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <a id="title.1"></a><h1>Did you know?</h1>
<p>Did you know that in Doctrine if you don't specifically select a
property or join a relationship in your DQL query, you can lazily
load that data? Here is a simple example to demonstrate.</p>
<pre><code class="php">&lt;?php
$q = Doctrine::getTable('User')
  -&gt;createQuery('u')
  -&gt;select('u.id, u.username')
  -&gt;where('u.username = ?', 'jwage');

$user = $q-&gt;fetchOne();
</code></pre>
<p>Notice how I only selected the <code>id</code> and <code>username</code>, but we have
an additional column named <code>email_address</code>. If I were to access
that property it would lazily load the data.</p>
<pre><code class="php">&lt;?php
echo $user['email_address']

**NOTE** The above code would result in an additional query to the
database that would lazy load all unloaded properties of an object
in proxy state. A record is in proxy state when it has one or more
properties that have not been loaded from the database.

</code></pre>
<a id="title.2"></a><h1>Be aware</h1>
<p>This can be both a curse and a blessing because if you lazily load
many properties and relationships this means you will have a high
query count per page. In Doctrine 1.x lazy loading is on by default
so it is often overly used. The problem is people aren't even aware
that it is happening.</p>
<a id="title.3"></a><h1>More Examples</h1>
<p>Imagine you had a <code>User</code> and <code>Profile</code> model where <code>User</code> has
one <code>Profile</code> and <code>Profile</code> has one <code>User</code>, a simple
one-to-one relationship. If I were to write a DQL query where I
retrieve an individual user record like the following.</p>
<pre><code class="php">&lt;?php
$q = Doctrine::getTable('User')
  -&gt;createQuery('u')
  -&gt;where('u.username = ?', 'jwage');

$user = $q-&gt;fetchOne();
</code></pre>
<p>But then I wanted to retrieve the <code>Profile</code> for that <code>User</code> I
could do so by simply accessing the <code>Profile</code> property on
<code>User</code>.</p>
<pre><code class="php">&lt;?php
$profile = $user-&gt;Profile;
</code></pre>
<p>The above code would result in an additional query to the database
that loads the <code>Profile</code> record for the <code>User</code> in question. Now
if I were to be rendering a list of twenty <code>User</code> objects and I
lazily load the profile of each user that means I would have 21
queries total! That is too many! In that case it would be smart to
<code>leftJoin()</code> the <code>Profile</code> object like the following.</p>
<pre><code class="php">&lt;?php
$q = Doctrine::getTable('User')
  -&gt;createQuery('u')
  -&gt;leftJoin('u.Profile p');

$users = $q-&gt;execute();
</code></pre>
<p>Now when I access the <code>Profile</code> relationship of an individual
object the data would already be present and no lazy loading would
be required.</p>
<a id="title.4"></a><h1>Why?</h1>
<p>I made this blog post because I noticed this feature being abused
and overly used just because it makes things easier. The goal is to
make you aware of what is happening so that you can effectively use
lazy loading and not end up having applications with very high
query counts per page.</p>
<p>I've seen this many times and the blame is often put on Doctrine
but really it is the tool not being used properly. So, be aware of
when you are lazy loading properties and the total number of
queries you execute per page. Make sure you always join required
relationships and only select the properties you need to access. It
doesn't make sense to load data if you're not going to be using
it.</p>
<a id="title.5"></a><h1>How?</h1>
<p>If you need help with keeping track of how many queries you have
per page, frameworks like
<a href="http://www.symfony-project.org/book/1_0/16-Application-Management-Tools#chapter_16_sub_web_debug_toolbar">Symfony</a>
and <a href="http://framework.zend.com">Zend Framework</a> give you debug
tools to show you how many queries you have per page. Or of course
you can always use the
<a href="http://www.doctrine-project.org/documentation/manual/1_1/en/component-overview:profiler">Profiling</a>
tool built in to Doctrine to log the queries in your application
and keep track of it that way.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/05/28/doctrine-database-abstraction-layer">Doctrine Database Abstraction Layer</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-05-28
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>One of the greatest advantages to using Doctrine is what is under
the hood that powers it. That is the database abstraction layer.
This powerful layer is based off of a lot of different code from
various popular PHP projects such as PEAR MDB2 and Zend\_Db. It
provides you a nice intuitive interface for retrieving information
about your database schema as well as issuing DDL statements to
change it.</p>
<a id="title.1"></a><h1>Public Method Index</h1>
<p>The database abstraction layer features the following methods in
1.x and some new methods added in 2.0.</p>
<a id="title.1.1"></a><h2>1.x Methods</h2>
<ul><li class="dash"> listDatabases()</li>
<li class="dash"> listFunctions()</li>
<li class="dash"> listTriggers()</li>
<li class="dash"> listSequences()</li>
<li class="dash"> listTableConstraints()</li>
<li class="dash"> listTableColumns()</li>
<li class="dash"> listTableIndexes()</li>
<li class="dash"> listTables()</li>
<li class="dash"> listUsers()</li>
<li class="dash"> listViews()</li>
<li class="dash"> dropDatabase()</li>
<li class="dash"> dropTable()</li>
<li class="dash"> dropIndex()</li>
<li class="dash"> dropConstraint()</li>
<li class="dash"> dropForeignKey()</li>
<li class="dash"> dropSequence()</li>
<li class="dash"> createDatabase()</li>
<li class="dash"> createTable()</li>
<li class="dash"> createSequence()</li>
<li class="dash"> createConstraint()</li>
<li class="dash"> createIndex()</li>
<li class="dash"> createForeignKey()</li>
<li class="dash"> alterTable()</li>
</ul>

<a id="title.1.2"></a><h2>New Methods in 2.0</h2>
<ul><li class="dash"> renameTable()</li>
<li class="dash"> addTableColumn()</li>
<li class="dash"> removeTableColumn()</li>
<li class="dash"> changeTableColumn()</li>
<li class="dash"> renameTableColumn()</li>
<li class="dash"> dropView()</li>
<li class="dash"> createView()</li>
</ul>

<a id="title.2"></a><h1>Some 2.0 Examples</h1>
<p>Here are some code examples using the Doctrine 2.0 Database
Abstraction Layer. We'll show you how you can execute these
examples yourself by checking out Doctrine 2.0 from SVN and setting
up a PHP script to test with.</p>
<blockquote><p><strong>TIP</strong> The database abstraction layer can be used standalone so if
you just want a nice standard layer for communicating with your
database then Doctrine works for you too.</p>
</blockquote>
<a id="title.2.1"></a><h2>Checkout Doctrine</h2>

<pre><code class="">$ svn co http://svn.doctrine-project.org/trunk doctrine2
$ cd doctrine2
</code></pre>
<a id="title.2.2"></a><h2>Create Test Script</h2>
<p>Create a new PHP script anywhere on your server and name it
<code>test.php</code>. Now lets initialize Doctrine so we can work with it.
First we need to set our <code>ClassLoader</code>.</p>
<pre><code class="php">&lt;?php
// test.php

require 'lib/Doctrine/Common/ClassLoader.php';

$classLoader = new \Doctrine\Common\ClassLoader();
$classLoader-&gt;setBasePath('Doctrine', __DIR__ . '/lib');
</code></pre>
<a id="title.2.3"></a><h2>Create Connection</h2>
<p>Now we need to create our <code>Connection</code> instance.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$connectionOptions = array(
    'driver' =&gt; 'pdo_mysql',
    'dbname' =&gt; 'mysql',
    'user' =&gt; 'root',
    'password' =&gt; ''
);
$driver = new \Doctrine\DBAL\Driver\PDOMySql\Driver;
$conn = new \Doctrine\DBAL\Connection($connectionOptions, $driver);

**NOTE** Notice how we are temporarily connecting to the special
database for MySQL named ``mysql``. We'll use this database to
connect to so we can create our test database.

</code></pre>
<p>Now we can simply retrieve the <code>SchemaManager</code> instance from the
<code>Connection</code> driver and begin to execute some of the methods we
listed above.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$sm = $conn-&gt;getSchemaManager();
</code></pre>
<p>The first thing we could do is create the database by calling the
<code>createDatabase()</code> method on the <code>$sm</code> instance.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$sm-&gt;createDatabase('doctrine2test');
</code></pre>
<p>Now that we have the database created, change your
<code>$connectionOptions</code> key <code>dbname</code> to specify <code>doctrine2test</code>
so that we connect to the new database that we just created.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$connectionOptions = array(
    'driver' =&gt; 'pdo_mysql',
    'dbname' =&gt; 'doctrine2test',
    'user' =&gt; 'root',
    'password' =&gt; ''
);

// ...
</code></pre>
<p>Now we can begin adding things to the new database. For example we
could issue a command to create a new table.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$columns = array(
    'id' =&gt; array(
        'type' =&gt; \Doctrine\DBAL\Type::getType('integer'),
        'autoincrement' =&gt; true,
        'primary' =&gt; true,
        'notnull' =&gt; true
    ),
    'test' =&gt; array(
        'type' =&gt;  \Doctrine\DBAL\Type::getType('string'),
        'length' =&gt; 255
    )
);

$options = array();

$sm-&gt;createTable('new_table', $columns, $options);
</code></pre>
<p>Then after creating the table I can later add a new column to it.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$column = array(
    'type' =&gt;  \Doctrine\DBAL\Type::getType('string'),
    'length' =&gt; 255
);

$sm-&gt;addTableColumn('new_table', 'new_column', $column);
</code></pre>
<p>Or I could even drop the table completely.</p>
<pre><code class="php">&lt;?php
// test.php

// ...

$sm-&gt;dropTable('new_table');

**NOTE** Not all of the above listed methods are supported by every
single DBMS. If your DBMS does not support the functionality then
Doctrine will throw exceptions accordingly.

</code></pre>
<p>All the above example are very simple schema changes but Doctrine
is capable of manipulating very complex schemas from a standardized
programmatic interface. The Doctrine Migrations extension makes use
of this layer heavily to do all the operations for changing your
database schemas.</p>

        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://new.doctrine-project.org/blog/page/66.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://new.doctrine-project.org/blog/page/68.html">Older Posts</a></li>        </ul>
    </nav>
                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
