<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?3625e4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer/">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
                        <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2010/02/17/doctrine2-behaviours-nutshell.html">Doctrine 2 &quot;Behaviours&quot; in a Nutshell</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-02-17
                            by
                                    beberlei
                                    </p>

        <hr />

        <div>
            **NOTE** This blog entry relates to an outdated Doctrine 2 Alpha
    version. Please see the documentation for the most up to date
    behavior.


One of the most common fallacies out there about Doctrine 2
abandoning Behaviours is that developers now have to implement
fancy logic to re-implement them yourself. Doctrine 2's approach to
completly separate ORM from your domain classes allows to build
behaviours in a very clean, unobstrusive and simple object-oriented
way. This article shows you how to implement some of the Doctrine 1
behaviours in your Doctrine 2 code. For this I will rewrite the
Doctrine 1.x manuals examples for each Behaviour.

This example uses Annotations as example, yet this of course works
with YAML and XML mappings. Additionally Doctrine 2 allows
constructors to have required arguments as of a commit of the last
week. This allows for some pretty slick enforcements in user-land
code as you will see in this post.

Straightforward combination of "Behaviours"
-------------------------------------------

All the code listed below is somehwat more verbose than the
Doctrine 1 code, however much more bound to the domain of your
model and very straightforward. There is no magic involved and you
will fully understand what will be happening in each of the
behaviours. The best of all, although not a simple trick, you will
be able to combine ALL behaviours in one model class and still be
completly on top of their inner workings.

Timestampable
-------------

Timestampable is a behaviour that requires you to hook into the
pre-update event which is called whenever an entity is updated:

.. code-block:: php

    <?php
    /**
     * @Id
     * @HasLifecycleCallbacks
     */
    class BlogPost
    {
        /**
         * @Column(type="DateTime")
         */
        private $created;
    
        /**
         * @Column(type="DateTime")
         */
        private $updated;
    
        public function __construct()
        {
            // constructor is never called by Doctrine
            $this->created = $this->updated = new DateTime("now");
        }
    
        /**
         * @PreUpdate
         */
        public function updated()
        {
            $this->updated = new DateTime("now");
        }
    }

Sluggable
---------

The sluggable behaviour is trivial to implement in Doctrine 2:

.. code-block:: php

    <?php
    class BlogPost
    {
        /** @Column(type="string") */
        private $slug;
    
        /** @Column(type="string") */
        private $title;
    
        public function setTitle($title)
        {
            if ($this->slug == null) {
                $this->slug = MyStringHelper::slugize($title);
            }
            $this->title = $title;
        }
    
        /**
         * Put this method in if your slug should be "editable"
         */
        public function setSlug($slug)
        {
            $this->slug = $slug;
        }
    }

See how its much more explicit in your code how and why the slug is
generated.

NestedSet
---------

This is one of the more complex behaviours in Doctrine 1 and it
won't be necessarily more easy in Doctrine 2. However as this is an
important feature we will provide an implementation as a
``DoctrineExtensions`` namespaced package that will be maintained
by Doctrine Devs.

Searchable
----------

There is currently no plan to port the Searchable behaviour to
Doctrine 2, but the possibility to instantiate objects using *new*
allows a very simple integration of a Doctrine 2 model with Apache
Solr or Lucene with a little wrapper that re-creates detached
instances from this powerful search engines.

For example using
`ezcSearch <http://ezcomponents.org/docs/api/trunk/introduction_Search.html>`_
we can make our BlogPost accessible for Solr:

.. code-block:: php

    <?php
    class BlogPost implements ezcBasePersistable, ezcSearchDefinitionProvider 
    {
        public function getState()
        {
            return array(
                'id' => $this->id,
                'title' => $this->title,
                'body' => $this->body,
                'slug' => $this->slug,
            );
        }
    
        public function setState($state)
        {
            foreach ($state AS $k => $v) {
                $this->$k = $v;
            }
        }
    
        static public function getDefinition() 
        {
            // define search schema
            return $def;
        }
    }

ezcSearch can then index a blog post whenever it is changed by
hooking an EventListener into the Doctrine ``PreUpdate`` Event:

.. code-block:: php

    <?php
    class EzcSearchListener
    {
        private $_searchSession;
    
        public function __construct(ezcSearchSession $searchSession)
        {
            $this->_searchSession = $searchSession;
        }
    
        public function preUpdate(LifecycleEventArgs $args)
        {
            if ($args->getEntity() instanceof ezcBasePersistable) {
                $this->_searchSession->index($args->getEntity());
            }
        }
    }

You can now hook this event into Doctrine's EntityManager:

.. code-block:: php

    <?php
    $searchListener = new EzcSearchListener(...);
    $em->getEventManager()->addEventListener(
        array(Doctrine\ORM\Events::preUpdate), $searchListener
    );

Now when you search for your entities you get returned ``BlogPost``
instances from ezcSearchs Solr interface:

.. code-block:: php

    <?php
    // initialize a pre-configured query
    $q = $session->createFindQuery( 'BlogPost' );
    $searchWord = 'test';
    
    // where either body or title contains thr $searchWord
    $q->where(
        $q->lOr(
            $q->eq( 'body', $searchWord ),
            $q->eq( 'title', $searchWord )
        )
    );
    $searchedBlogPosts = $session->find( $q ); 

These instances are detached from the EntityManager when they get
returned from ezcSearch and can be merged back into the persistence
context:

.. code-block:: php

    <?php
    $searchedBlogPosts[0]->setTitle("ChangeFoo");
    $em->merge($searchedBlogPosts[0]);

Read about Merging, Detached instances and other cool stuff of
Doctrines object model in the
`Working with Objects <http://www.doctrine-project.org/documentation/manual/2_0/en/working-with-objects#merging-entities>`_
chapter of the manual.

Versionable
-----------

By default Doctrine 2 comes with a way to set a *version* column
that is automatically incremented on each update. Using the event
system it is easy to use this information to implement a
versionable audit-log behaviour. The required code is more verbose
than the simple configuration of Doctrine 1, however there is much
less magic involved and you can implement this behaviour in a way
that is trivial to understand for someone new looking at your
code:

.. code-block:: php

    <?php
    /**
     * @Entity
     * @HasLifeCycleCallbacks
     * @generatedValue(strategy="AUTO")
     */
    class BlogPost
    {
        /**
         * @Id
         * @Column(type="integer")
         */
        private $id;
    
        /**
         * @Column(type="string")
         */
        private $title;
    
        /**
         * @Column(type="text")
         */
        private $body;
    
        /**
         * @Column(type="integer")
         * @version
         */
        private $version;
    
        /**
         * @OneToMany(targetEntity="BlogPostVersion", mappedBy="post")
         */
        private $auditLog = array();
    
        /**
         * @PrePersist
         * @PreUpdate
         */
        public function logVersion()
        {
            $this->auditLog[] = new BlogPostVersion($this);  
        }
        // getters
    }
    
    /**
     * @Entity
     */
    class BlogPostVersion
    {
        /**
         * @Id
         * @Column(type="integer")
         * @generatedValue(strategy="AUTO")
         */
        private $id;
    
        /**
         * @Column(type="string")
         */
        private $title;
    
        /**
         * @Column(type="text")
         */
        private $body;
    
        /**
         * @Column(type="integer")
         */
        private $version;
    
        /**
         * @ManyToOne(targetEntity="BlogPost")
         */
        private $post;
    
        public function __construct(BlogPost $post)
        {
            $this->post = $post;
            $this->title = $post->getTitle();
            $this->body = $post->getBody();
            $this->version = $post->getCurrentVersion();       
        }
    }

I18N
----

Multi-Language content is an important topic and can be implemented
in Doctrine 2, since its just a fancy name for a One-To-Many
relation. However currently Doctrine 2 does not allow to persist
keys by name, which makes a OneToMany implementation a bit more
intensive then it could be. We plan to implement primitive value
collections however which would simplify any attempt to implement
nested structured content, that is not an entity by itself.

Soft Delete
-----------

We won't support soft-delete at all. If you want to implement a
soft-delete alike behaviour its probably a good idea to look into
the State pattern instead.

Blameable
---------

Implementing this behaviour is just a matter of adding two fields
*createdByUserId* and *modifiedByUserId* fields and setting them
whenever one of your relevant fields change by hooking into setter
methods:

.. code-block:: php

    <?php
    /**
     * @Entity
     */
    class BlogPost
    {
        /**
         * @Column(type="string")
         */
        private $title;
    
        /**
         * @Column(type="integer")
         */
        private $modifiedByUserId;
    
        public function updateBlogPost($title, ..., User $user)
        {
            $this->title = $title;
            $this->modifiedByUserId = $user->getId();
        }
    }

Sortable
--------

Same as I18N, we are planning to support persistence of collection
keys in the Doctrine 2 Core. This would allow to sort collections
by using the possibilities of the
``Doctrine\Common\Collections\Collection`` interface.

Conclusion
----------

Although slightly more complex than Doctrine 1s simple
configuration options, most "behaviours" are still way easy to
implement in Doctrine 2. The additional benefit of this
straightforward approach:
*You can combine behaviours in any way, inside your domain model, without having to wonder how the magic works together, you are completly on top of it.*
        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2010/02/11/database-support-doctrine2.html">Database-Driver Support in Doctrine 2</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-02-11
                            by
                                    beberlei
                                    </p>

        <hr />

        <div>
            Not only the ORM part of Doctrine will see major changes for the
step from the 1.x to the Doctrine 2 series. The DBAL layer has
undergone major refactorings and there has been a very throughout
separation of concerns. Any database platform that will be
supported has to extend four different classes/interfaces.


-  Doctrine and Doctrine - Both interfaces implement the
   interference between PHP and the Database, they are the lowest
   layer of any platform support.
-  Doctrine - This abstract class requires you to specify the
   specialites of the SQL dialect of the database-platform you are
   going to implement.
-  Doctrine - This abstract class defines the interaction of the
   database platform to create a database schema, for example in
   combination with the ORM SchemaTool.

For the Doctrine 2.0 release we plan to support 4 different
platforms, all tested in-depth:


-  MySQL using the PDO Mysql extension
-  PgSQL using the PDO PostgresSQL extension
-  Oracle using the OCI extension
-  Sqlite using the PDO SQLite extension

Both the SchemaManager and Platform can be re-used for any Driver
that is connected to the database. If you would want to use Mysqli
instead of PDO MySQL you would only need to implement a new Driver
and Statement. And if you just want to change some of the sql
specific details in regard to schema generation you would only need
to extend the AbstractPlatform.

Still, from a database-platform point of view the default support
is lacking, for example MsSql support with both PDO and SqlSrv is
currently missing. Firebird or IBM Db2 are other platforms that are
wide-spread and not supported currently. However we don't want to
rush only half-finished support into Doctrine 2. That is where you
come in: We would greatly appreciate any help in getting support
for any new database platform into Doctrine 2.

For the implementation of a completly new database platform you can
rely on the powerful PHPUnit Testsuite of Doctrine 2. There are
lots of tests that check the functionality of your driver, platform
and schema implementations against various scenarios. Additionally
the complete ORM functional test-suite can run against your new
database platform. Furthermore you can count of everyone in the
Doctrine DEV Team for help, we are hanging around on Freenode IRC
in the #doctrine-dev Channel. You could also create a ticket on
Jira and attach a patch or just discuss your ideas.
        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2010/01/22/doctrine-2-0-0-alpha4-released.html">Doctrine 2 ALPHA4 Released</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-01-22
                            by
                                    romanb
                                    </p>

        <hr />

        <div>
            Today we are happy to announce the release of the next, and
hopefully last, alpha release of Doctrine 2. With over 60 fixed
bugs and some improvements this is another significant step towards
the final release.

Highlights
~~~~~~~~~~


-  DBAL Refactorings: [DDC-169]
-  CLI Refactoring and Enhancements: [r6972] [DDC-223], [DDC-225]
-  Support for customizing the DDL of column definitions: [DDC-200]
-  XML Mapping Driver Improvements: [DDC-243], [DDC-242],
   [DDC-159]

View the complete
`change log <http://www.doctrine-project.org/change_log/2_0_0_ALPHA4>`_
to see a detailed list of every change contained in this release.
You can `download <http://www.doctrine-project.org/download#2_0>`_
this release and report any issues you find in
`Jira <http://www.doctrine-project.org/jira>`_.

We would like to thank everyone who participated in this release
through bug reports, patches and suggestions.

What is Next?
~~~~~~~~~~~~~

We are planning to work towards entering beta from here on. There
are still some backwards-incompatible changes to come. Once we hit
beta, efforts will concentrate on fixing bugs and further
stabilizing the code base. The first beta release is currently
scheduled for March 1st, 2010.
        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/52.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/54.html">Older Posts</a></li>        </ul>
    </nav>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?f32c09"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?36322d"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

        
        
        
            </body>
</html>
