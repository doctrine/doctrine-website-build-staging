<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?3625e4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/couchdb-odm.html">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
                        <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2009/06/19/cross-database-joins.html">Cross Database Joins</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-06-19
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <h1 id="cross-database-joins">Cross Database Joins</h1>

<p>In Doctrine, joining data across databases is not technically
"supported" by a designed feature, but you can make it work by tricking
Doctrine a little bit.</p>

<p>In this article I'll show you how you can setup a database schema that
specifies relationships across two databases and then issue a query
which joins data from these two databases.</p>

<p>I used the Doctrine sandbox to prepare this test so if you want to try
it, you can use it too.</p>

<h1 id="database-connections">Database Connections</h1>

<p>First lets setup our two database connections we'll use to query from.
Modify the <code>config.php</code> file included with the sandbox and replace the
default single connection with the following code.</p>

<pre><code class="sourceCode php">&lt;?php
Doctrine_Manager::connection('mysql://root@localhost/doctrine_test1', 'doctrine_test1');
Doctrine_Manager::connection('mysql://root@localhost/doctrine_test2', 'doctrine_test2');
</code></pre>

<h1 id="schema">Schema</h1>

<p>Now lets define our YAML schema file that we'll use to run our tests
against. You can modify the <code>config/doctrine/schema.yml</code> file and
include the following YAML.</p>

<pre><code>[yml]
User:
  tableName: doctrine_test1.user
  connection: doctrine_test1
  columns:
    username: string(255)
    password: string(255)

Profile:
  tableName: doctrine_test2.profile
  connection: doctrine_test2
  columns:
    user_id: integer
    first_name: string(255)
    last_name: string(255)
  relations:
    User:
      foreignType: one
      onDelete: CASCADE

**NOTE** Notice how we specify the full table name, including the
name of the database. Currently, Doctrine does not generate the SQL
that includes the database name. It only includes the table name,
but we can trick Doctrine by simply specifying the
``database_name.table_name`` as the table name.
</code></pre>

<h1 id="test-data-fixtures">Test Data Fixtures</h1>

<p>In the <code>data/fixtures</code> directory create a <code>data.yml</code> file and paste the
following fixtures inside so we can have some data in each database to
run our tests against.</p>

<pre><code>[yml]
User:
  jwage:
    username: jwage
    password: changeme
    Profile:
      first_name: string(255)
      last_name: string(255)
</code></pre>

<h1 id="build-the-database">Build the Database</h1>

<p>Now lets build our database and import the data fixtures from above.
This can be easily done by running the following from the Doctrine
command line interface.</p>

<pre><code>$ php doctrine build-all-reload
</code></pre>

<h1 id="run-the-test">Run the Test</h1>

<p>Now we have our models created, we have our database created and we have
our test fixtures loaded in to the database. Now it is time to run some
sample code and see what we get!</p>

<p>First lets write our <code>Doctrine_Query</code> and look at the generated SQL.
Paste the following code in to index.php and lets execute it!</p>

<pre><code class="sourceCode php">&lt;?php
$q = Doctrine::getTable('User')
  -&gt;createQuery('u')
  -&gt;leftJoin('u.Profile p');

echo $q-&gt;getSql();
</code></pre>

<p>The above code would output the following SQL query.</p>

<pre><code>[sql]
SELECT d.id AS d__id, d.username AS d__username, d.password AS d__password, d2.id AS d2__id, d2.user_id AS d2__user_id, d2.first_name AS d2__first_name, d2.last_name AS d2__last_name FROM doctrine_test1.user d LEFT JOIN doctrine_test2.profile d2 ON d.id = d2.user_id

**NOTE** Notice how in the above SQL that is generated it include
the database name and the table name. So now the query is able to
join across databases if your RDBMS supports it.
</code></pre>

<p>Now lets execute the above query and look at the results.</p>

<pre><code class="sourceCode php">&lt;?php
$q = Doctrine::getTable('User')
  -&gt;createQuery('u')
  -&gt;leftJoin('u.Profile p');

$users = $q-&gt;fetchArray();

print_r($users);
</code></pre>

<p>The above would output just exactly what you'd expect.</p>

<pre><code>Array
(
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [username] =&gt; jwage
            [password] =&gt; changeme
            [Profile] =&gt; Array
                (
                    [id] =&gt; 1
                    [user_id] =&gt; 1
                    [first_name] =&gt; string(255)
                    [last_name] =&gt; string(255)
                )

        )

)
</code></pre>

<p>The data from the <code>User</code> model came from one database, and the data from
the <code>Profile</code> model came from the other database.</p>

<blockquote>
  <p><strong>NOTE</strong> This will only work if your database supports foreign keys
  and joins across databases. I know MySQL does support this but I am
  unsure about others. This same method can be used to query for data
  across PostgreSQL schemas too.</p>
</blockquote>

<p>That is it! Joining data from across different databases is no problem
in Doctrine.</p>

<blockquote>
  <p><strong>CAUTION</strong> This is not a designed feature of Doctrine and you may
  experience edge cases that may not work as you'd expect. This is just
  useful if you need to join data across databases and if you experience
  edge cases you can work around them in your project.</p>
</blockquote>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2009/06/17/special-price-offer-symfony-1-2-doctrine-training-workshop.html">Special Price Offer: Symfony 1.2 + Doctrine Training Workshop</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-06-17
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>As you all may know, I work for <a href="http://www.sensiolabs.com">Sensio Labs</a>
, the creators of the <a href="http://www.symfony-project.org">Symfony</a>
framework. Sensio offers trainings in many topics, but primarily Symfony
and Doctrine. I will be teaching a training session June 29th to July
1st in the San Francisco bay area that covers Symfony 1.2 and Doctrine
1.0. We are having a little issue completely filling the class and I
need a few more trainees in order to fill the class to maintain the
date, otherwise we'll have to cancel.</p>

<p>I am able to make a special offer to any interested parties on the price
of the training. All things are negotiable. So if you would like to
attend the 3 day workshop taught by myself and learn the best practices
when using Symfony and Doctrine, contact me right away! Remember, the
price is completely negotiable so if you're a student or a member of a
development team and would like to attend please contact me so we can
negotiate a price that works for you.</p>

<p>You can contact me at
<a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#111;:&#x6a;&#111;&#110;&#x61;&#x74;&#104;a&#x6e;&#46;&#119;&#x61;&#x67;&#101;&#64;&#x73;&#x65;&#110;&#x73;&#x69;&#111;&#46;&#x63;&#x6f;&#109;">jonathan.wage@sensio.com</a> to discuss
details.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2009/06/16/doctrine-changing-homes.html">Doctrine changing homes</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-06-16
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>You all may have noticed the stability of the website going up and down
recently. Up until now we have been lucky to have our good friend Ian
Christian(pookey in IRC) host all the Doctrine infrastructure for over 3
whole years! With Doctrine continuing to grow and move forward, it is
time to move on to greener pastures to a dedicated home.</p>

<p>Tonight we will try to begin the migration to our new home. Hopefully
this transition will be fairly seamless but we expect at least a little
downtime. We are moving the website, Trac and SVN all at once to avoid
the migration lasting over a long period of time. Thanks for your
patience while we work through these issues.</p>

        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/64.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/66.html">Older Posts</a></li>        </ul>
    </nav>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?f32c09"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

        
        
        
            </body>
</html>
