<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?3625e4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer/">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
                        <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2010/07/22/mongodb-for-ecommerce.html">MongoDB ODM: MongoDB for eCommerce</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-07-22
                            by
                                    avalanche123
                                    </p>

        <hr />

        <div>
            .. raw:: html

   <div style="float: left; width: 300px;">
       <div style="padding: 15px; border: 1px solid #ccc; margin: 0 15px; background: #eee; color: #888">
       <p style="margin: 0;">
   
Hi, my name is Bulat S. (my last name won't make it any easier, but
in case you were wondering it's Shakirzyanov), I joined OpenSky in
August 2009 (It's been almost a year since then, but it feels like
ages). My official title in the company is Hacker, which also says
a lot about me (that I don't like corporate titles for one).

.. raw:: html

   </p>
       <p style="margin: 10px 0 0;">
   
The last 6 weeks were truly amazing for me. Not only was I able to
learn a new technology, I also managed to contribute back to the
community. But let's go over everything step by step.

.. raw:: html

   </p>
       </div>
   </div>
   
Building an eCommerce system is not easy, and building a platform
is even harder. When it comes to data in eCommerce, there is
nothing definite, no real structure you could stick to, and no
final requirements. Something as obvious as the "item you add to
cart" could be overly complicated when it comes to data.

There is a good example of how to model the database for handling
variable product attributes;
`Magento <http://www.magentocommerce.com>`_ is one of the most
advanced open source eCommerce solutions available today. It uses
`EAV (Entity Attribute Value) <http://en.wikipedia.org/wiki/Entity-attribute-value_model>`_ ,
which solves the problem of variable attributes by sacrificing
database level integrity and application performance. The amount of
queries you need to perform to select one entity will grow with
every attribute data type you introduce; however, it still is a
viable solution.

A document store on the other hand lets you save two absolutely
different documents in the same collection. Because of its
schema-less structure it is also possible to add or remove a
document's properties after saving - it's a database that adapts to
your data structure on the fly.

At `OpenSky <http://www.theopenskyproject.com/>`_ , we decided to
use `MongoDB <http://www.mongodb.org/>`_ for storage of products
and use relational databases for order-related data since
`MongoDB <http://www.mongodb.org/>`_ doesn't support transactions.

So what is the benefit of using
`MongoDB <http://www.mongodb.org/>`_ over MySQL, or any other
RDBMS, for storing variable attribute data. Performance. This is
the pseudo-query we would have to write to select one product, with
id 1, and all of its attributes in a typical
`EAV model <http://en.wikipedia.org/wiki/Entity-attribute-value_model>`_:


.. raw:: html

   <div class="right">
       
   

.. raw:: html

   </div>
   
::

    [txt]
    SELECT * FROM `product` WHERE id = 1;
    SELECT * FROM `product_attributes` = WHERE product_id = 1;
    SELECT * FROM `product_values_int` WHERE product_id = 1;
    SELECT * FROM `product_values_varchar` WHERE product_id = 1;
    SELECT * FROM `product_values_datetime` WHERE product_id = 1;
    SELECT * FROM `product_values_text` WHERE product_id = 1;
    SELECT * FROM `product_values_float` WHERE product_id = 1;

After the above queries are run, there would be a huge step of data
hydration into the product object, which
`Magento <http://www.magentocommerce.com>`_ handles quite well,
albeit slowly. Contrast this with what we would do in
`MongoDB <http://www.mongodb.org/>`_:

::

    [javascript]
    db.products.find({'_id': '1'});

Not only is the selection simpler, but it also returns a JSON
object, which can easily be hydrated into a native PHP object. And
here is how a configurable product could be represented in
`MongoDB <http://www.mongodb.org/>`_:

::

    [javascript]
    {
        "_id": ObjectId("4bffd798fdc2120019040000")
        "name": "Configurable T-Shirt"
        "options": [
            {
                "name": "small",
                "price": 12.99
            },
            {
                "name": "medium",
                "price": 15.99
            },
            {
                "name": "large",
                "price": 17.99
            }
        ]
    }

    **NOTE** There is no need for joins, as product options are a
    collection of embedded objects. Object references (akin foreign key
    relationships in RDBMSs) are also possible, but they are generally
    only necessary if you need to access the object independently. For
    instance, if I needed a page to list all product options across all
    products, I would probably put options into their own collection
    and reference them from the product document.


Of course, there are
`plenty of ORM libraries <http://www.mongodb.org/display/DOCS/PHP+Language+Center#PHPLanguageCenter-LibraryandFrameworkTools>`_
for `MongoDB <http://www.mongodb.org/>`_ , which were either
hard-to-extract parts of frameworks, not quite ORMs or used the
`ActiveRecord pattern <http://martinfowler.com/eaaCatalog/activeRecord.html>`_
(which after using
`DataMapper <http://martinfowler.com/eaaCatalog/dataMapper.html>`_
for quite some time, I wouldn't want to go back to). The very same
day I started writing an object document mapper (ODM) to use at
`OpenSky <http://www.theopenskyproject.com/>`_ ,
`Jon Wage <http://www.twitter.com/jwage>`_ (developer for the
Doctrine project) released a proof-of-concept
`MongoDB ODM <http://www.doctrine-project.org/projects/mongodb_odm>`_ ,
which you can
`find on github <http://github.com/doctrine/mongodb-odm>`_. After
contacting Jon and giving his library a couple of tries and
`tests <http://www.phpunit.de/>`_ , I decided to use it for
`OpenSky <http://www.theopenskyproject.com/>`_'s products domain
layer.

I started to submit patches and
`unit tests <http://www.phpunit.de/>`_ to the project and soon
joined the core team for
`MongoDB ODM <http://www.doctrine-project.org/projects/mongodb_odm>`_.
Today, we are past first alpha release of the project, and this is
my first post on the Doctrine blog (yay!).

Getting back to our example, this is how the product and embedded
option classes for the aforementioned data structure could look:

.. code-block:: php

    <?php
    // Product.php
    /**
     * @Document(collection="products")
     */
    class Product
    {
    
        /**
         * @Id
         */
        private $id;
    
        /**
         * @String
         */
        private $name;
    
        /**
         * @EmbedMany(targetDocument="Product\Option")
         */
        private $options = array();
    
        public function getId()
        {
            return $this->id;
        }
    
        public function setName($name)
        {
            $this->name = $name;
        }
    
        public function getName()
        {
            return $this->name;
        }
    
        public function addOption(Product\Option $option)
        {
            $this->options[] = $option
        }
    
        //...
    }

And the Product class:

.. code-block:: php

    <?php
    // Product/Option.php
    namespace Product;
    /**
     * @EmbeddedDocument
     */
    class Option
    {
    
        /**
         * @String
         */
        private $name;
    
        /**
         * @Float
         */
        private $price;
    
        public function setName($name)
        {
            $this->name = $name;
        }
    
        public function getName()
        {
            return $this->name;
        }
    
        public function setPrice($price)
        {
            $this->price = $price;
        }
    
        public function getPrice()
        {
            return $this->price;
        }
    
        //...
    }

Using the DocumentManager instance, we could easily persist the
product with:

.. code-block:: php

    <?php
    $product = new Product();
    $product->setName('Configurable T-Shirt');
    
    $small = new Product\Option();
    $small->setName('small');
    $small->setPrice(12.99);
    $product->addOption($small);
    
    $medium = new Product\Option();
    $medium->setName('medium');
    $medium->setPrice(15.99);
    $product->addOption($medium);
    
    $large = new Product\Option();
    $large->setName('large');
    $large->setPrice(15.99);
    $product->addOption($large);
    
    $documentManager->persist($product);
    $documentManager->flush();

    **NOTE** MongoDB ODM intelligently uses
    `atomic operators <http://www.mongodb.org/display/DOCS/Atomic+Operations>`_
    to update data, which makes it really fast. It also supports
    inheritance (collection-per-class and single-collection
    inheritances), which is similar to table inheritance design
    patterns for ORMs. Check out the official Mongo ODM
    `project documentation <http://www.doctrine-project.org/projects/mongodb_odm/1.0/docs/en>`_
    for more information and examples. Complete instructions on how to
    setup your DocumentManager instance
    `can be found here <http://www.doctrine-project.org/projects/mongodb_odm/1.0/docs/reference/introduction/en>`_.


The above code would store the product object as a document in
`MongoDB <http://www.mongodb.org/>`_.

There is much more to talk about in terms or technologies,
techniques and practices we adopt and use at
`OpenSky <http://www.theopenskyproject.com/>`_ , so this post is
definitely not the last one.
        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2010/07/21/mongodb-odm-query-builder-api.html">MongoDB ODM: Query Builder API</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-07-21
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            The Doctrine MongoDB Object Document Mapper includes a fluent
object oriented API for building queries to execute against
MongoDB. Recently some changes were made to the API to simplify it
and make it more readable. This blog post aims to demonstrate and
introduce the new API to you!

Query Types
-----------

The API still supports all the types of queries you would expect:


-  `find <#find>`_
-  `insert <#insert>`_
-  `update <#update>`_
-  `delete <#delete>`_

Continue reading to see examples for each of the above types of
queries!

## Find

You can easily find documents by just creating a new ``Query``
object with the ``createQuery()`` method. A new ``Query`` object
defaults to a ``find`` query so you just need to pass the name of
the document to query for:

.. code-block:: php

    <?php
    $q = $dm->createQuery('User');

You can change the document being queried for by using the
``find()`` method:

.. code-block:: php

    <?php
    $q->find('Project');

Conditions
~~~~~~~~~~

You can limit the returned documents by specifying some
conditions:

.. code-block:: php

    <?php
    $q->field('title')->equals('The Doctrine Project');

Maybe you want to only return projects created after today:

.. code-block:: php

    <?php
    $q->field('createdAt')->greaterThan(new MongoDate(time()));

You can even a condition on an embedded document:

.. code-block:: php

    <?php
    $q->field('profile.firstName')->equals('Jonathan');

Also, you can add a condition for a referenced document to filter
by id:

.. code-block:: php

    <?php
    $q->field('account.$id')->equals($accountId);

The ``field()`` method specifies the current field to add the
conditions to. You can optionally use the magical ``__call()``
feature of the ``Query`` object to specify the current field as
well:

.. code-block:: php

    <?php
    $q->createdAt()->greaterThan(new MongoDate(time()));

All the methods you'd expect can be used in combination with the
``field()`` method for adding conditions to your query:


-  equal($value)
-  where($javascript)
-  not($value)
-  in($values)
-  notIn($values)
-  notEqual($value)
-  greaterThan($value)
-  greaterThanOrEq($value)
-  lessThan($value)
-  lessThanOrEq($value)
-  range($start, $end)
-  size($size)
-  exists($bool)
-  type($type)
-  all($values)
-  mod($mod)

## Insert

You can easily insert new documents using the ``Query`` API as
well. Just use the ``insert()`` method in combination with
``field()`` and ``set()``:

.. code-block:: php

    <?php
    $q = $dm->createQuery('User')
        ->insert()
        ->field('username')->set('jwage')
        ->field('password')->set('password');

If you want to set the new document to insert you can use the
``setNewObj()`` method:

.. code-block:: php

    <?php
    $q = $dm->createQuery('User')
        ->insert()
        ->setNewObj(array(
            'username' => 'jwage',
            'password' => 'password'
        ));

## Update

If you want to update a document you can use the ``update()``
method in combination with ``field()``, ``set()`` and conditions.
Here is an example where we create a query to update a user with
the username ``jwage`` and give him a new password:

.. code-block:: php

    <?php
    $q = $dm->createQuery('User')
        ->update()
        ->field('password')->set('newpassword')
        ->field('username')->equals('jwage');

## Delete

You can delete documents as well by using the ``delete()`` method
in combination with conditions. Here is an example where we create
a query to delete the user document with a username of ``jwage``:

.. code-block:: php

    <?php
    $q = $dm->createQuery('User')
        ->delete()
        ->field('username')->equals('jwage');

As you can see the fluent API makes it a bit easier to express
queries that are easy to read in the same way you would read
english from left to right. We hope to enhance and improve this API
even more before we release the stable 1.0 version.

You can read more about the Query Builder API in the
`documentation <http://www.doctrine-project.org/projects/mongodb_odm/1.0/docs/reference/query-builder-api/en#query-builder-api>`_.
        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2010/07/20/mixing-types-of-documents.html">MongoDB ODM: Mixing Types of Documents</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-07-20
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            One major advantage to using something like MongoDB is the fact
that it is schema-less. We can store multiple types of documents in
a single collection and we are not limited to a single type of
document in embedded and referenced documents. This article shows
how you can easily mix types of documents in collections, embedded
and referenced documents.

Mixing Types in Collections
---------------------------

If you don't want to use ``SINGLE_COLLECTION`` inheritance you can
easily store different documents in the same collection by using a
discriminator field. First define an ``Article`` document that maps
to ``my_documents``:

.. code-block:: php

    <?php
    /**
     * @Document(collection="my_documents")
     * @DiscriminatorField(fieldName="type")
     * @DiscriminatorMap({"article"="Article", "album"="Album"})
     */
    class Article
    {
        // ...
    }

Next create another document named ``Album`` and also map it to
``my_documents``:

.. code-block:: php

    <?php
    /**
     * @Document(collection="my_documents")
     * @DiscriminatorField(fieldName="type")
     * @DiscriminatorMap({"article"="Article", "album"="Album"})
     */
    class Album
    {
        // ...
    }

Now if you create some instances and persist them they will all be
stored in the ``my_documents`` collection and will have a
discriminator field named ``type`` automatically set with the value
specified in the mapping:

.. code-block:: php

    <?php
    $article = new Article();
    $article->setTitle('Sample Article');
    // ...
    
    $album = new Album();
    $album->setName('My Album');
    
    $dm->persist($article);
    $dm->persist($album);

Finally, if you retrieve the documents they'll all be retrieved
from ``my_documents`` but you will get back the proper PHP classes
that created them:

.. code-block:: php

    <?php
    $articles = $dm->find('Article');
    $albums = $dm->find('Album');

You can retrieve more then just one document type by specifying an
array:

.. code-block:: php

    <?php
    $documents = $dm
        ->createQuery(array('Article', 'Album'))
        ->execute();

The returned documents will contain instances of articles and
albums!

Mixing Types in Embedded Documents
----------------------------------

You can store multiple types of documents in embedded documents by
simply omitting the ``targetDocument`` option. First create a
``User`` document and embed multiple task documents:

.. code-block:: php

    <?php
    /** @Document(collection="users") */
    class User
    {
        // ...
    
        /** @Embedded */
        private $tasks = array();
    
        // ...
    }

    **NOTE** Notice how on the ``$tasks`` annotation we don't specify
    whether it is ``one`` or ``many``. This is because we know it is
    ``many`` due to the default value being an array.


Now create the different types of tasks we can add to the user:

.. code-block:: php

    <?php
    /** @EmbeddedDocument */
    class DownloadTask
    {
        // ...
    }
    
    /** @EmbeddedDocument */
    class UploadTask
    {
        // ...
    }

Now you can embed any type of class in the ``$tasks`` property:

.. code-block:: php

    <?php
    $user = $dm->findOne('User', array(...));
    
    $task = new DownloadTask();
    // ...
    
    $user->addTask($task);
    
    $task = new UploadTask();
    // ...
    
    $user->addTask($task);
    
    $dm->flush();

Mixing Types in Referenced Documents
------------------------------------

Mixing types in referenced documents works just the same as
embedded by omitting the ``targetDocument`` option. In this example
a user can add references to all his favorite albums, songs and
books. First define a ``User`` document with a many references
property for storing the users favorites:

.. code-block:: php

    <?php
    /** @Document(collection="users") */
    class User
    {
        // ...
    
        /** @Reference */
        private $favorites = array();
    
        // ...
    }

Now here is what the referenced documents would look like:

.. code-block:: php

    <?php
    /** @Document(collection="albums") */
    class Album
    {
        // ...
    }
    
    /** @Document(collection="songs") */
    class Song
    {
        // ...
    }
    
    /** @Document(collection="books") */
    class Book
    {
        // ...
    }

Now it is easy to add the references to his favorites:

.. code-block:: php

    <?php
    $user->addFavorite($album);
    $user->addFavorite($song);
    $user->addFavorite($book);
    
    $dm->flush();

When you retrieve the user and access the ``$favorites`` the
documents will be grouped by type and loaded with one or more
``$in`` queries:

.. code-block:: php

    <?php
    $user = $dm->findOne('User', array(...));
    $favorites = $user->getFavorites();
    
    // Lazily loads references
    // Contains Album, Song and Book instances
    foreach ($favorites as $favorite) {
        // ...
    }

That is it! It is easy to take advantage of the schema-less
features of MongoDB with the Doctrine Object Document Mapper
(ODM)!
        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/44.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/46.html">Older Posts</a></li>        </ul>
    </nav>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?f32c09"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?36322d"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

        
        
        
            </body>
</html>
