<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                            
                                
                                
                
                <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Blog</li>
    </ol>
</nav>

    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/01/30/new-documentation-pdf-downloads">New Documentation PDF Downloads</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-01-30
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>Today we have some great news! Thanks to Fabien from the
<a href="http://www.symfony-project.org">symfony project</a> , we now have a
new way to generate the PDF version of our documentation. The new
PDFs are a MAJOR step up from the previous style of PDF and am very
pleased with it! Check it out by viewing the 1.0 version of
<a href="http://www.doctrine-project.org/documentation/manual/1_0/en/pdf">The Guide to Doctrine for PHP</a>
or
<a href="http://www.doctrine-project.org/documentation/cookbook/1_0/en/pdf">The Doctrine Cookbook</a>.</p>
<a id="title.1"></a><h1>What is next?</h1>
<ul><li class="dash"> API Documentation available as PDF.</li>
<li class="dash"> Downloadable package/zip file containing PDF versions of all
   documentation.</li>
<li class="dash"> User submitted articles, snippets, tutorials, etc. to complement
   the official documentation.</li>
<li class="dash"> ...Printed book.</li>
</ul>

<a id="title.2"></a><h1>Printed Book</h1>
<p>Here is a teaser of the first draft of the front cover for the
printed version of the book. Big thanks goes out to Jason O'Brien
from centre{source} for doing the design work. The printed copy
will be available on lulu very soon we just need to do some more
proof reading and Q&amp;A on everything before it is ready. The printed
version of the book will use a slightly modified version of the PDF
that is available for download on the web.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/01/28/cookbook-recipe-relation-dql-behavior">Cookbook Recipe: Relation DQL Behavior</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-01-28
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>Today I will teach you how to write a simple Doctrine behavior. You
will learn some of the basics of creating a behavior and you will
gain some pretty cool functionality for your relationships.</p>
<p>We will write a behavior called <code>RelationDql</code> which allows you to
add default query parts that are automatically added to your
queries when you reference the specified relationships. So first we
will get started by looking at an example schema we can apply this
to.</p>
<p>Here is an example schema where we have a <code>Site</code>, <code>BlogPost</code>
and <code>Tag</code> model:</p>

<pre><code class="">[yml]
Site:
  columns:
    name: string(255)

BlogPost:
  actAs: [Timestampable]
  columns:
    title: string(255)
    body: clob
    site_id: integer
  relations:
    Site:
      foreignAlias: BlogPosts
    Tags:
      class: Tag
      refClass: BlogPostTag
      foreignAlias: BlogPosts

Tag:
  columns:
    name: string(255)

BlogPostTag:
  columns:
    blog_post_id:
      type: integer
      primary: true
    tag_id:
      type: integer
      primary: true
  relations:
    BlogPost:
      foreignAlias: BlogPostTags
    Tag:
      foreignAlias: BlogPostTags
</code></pre>
<p>This is a fairly simple schema as you can see, but what if we want
to have a relationship on the <code>Site</code> model to retrieve the latest
five <code>BlogPost</code> records or order the <code>Tags</code> relationship
alphabetically by default?</p>
<p>Lets modify our schema to take into account a new behavior that we
will write in the next step. First modify the <code>Site</code> model and a
relationship named <code>LatestBlogPosts</code>:</p>

<pre><code class="">[yml]
Site:
  actAs:
    RelationDql:
      relations:
        LatestBlogPosts:
          orderBy: %s.created_at DESC
          limit: 5
  columns:
    name: string(255)
  relations:
    LatestBlogPosts:
      autoComplete: false
      class: BlogPost
      local: id
      foreign: site_id

**TIP** The ``autoComplete`` option is set to ``false`` so that the
relationship is not reflected and added to the opposite end,
``BlogPost`` automatically.

</code></pre>
<p>Now lets modify the <code>BlogPost</code> model to change the <code>Tags</code>
relationship so that it is ordered alphabetically by name by
default:</p>

<pre><code class="">[yml]
BlogPost:
  actAs:
    Timestampable:
    RelationDql:
      relations:
        Tags:
          orderBy: %s.name ASC
  columns:
    title: string(255)
    body: clob
    site_id: integer
  relations:
    Site:
      foreignAlias: BlogPosts
    Tags:
      class: Tag
      refClass: BlogPostTag
      foreignAlias: BlogPosts

**TIP** The ``relations`` array is an array of changes to make to
the DQL query. The key can be any valid function on the
``Doctrine_Query`` API and the value is of course the parameter to
pass to the function.

</code></pre>
<p>Now that we have our schemas modified to take into account the new
<code>RelationDql</code> behavior we need to actually write the code:</p>
<pre><code class="php">&lt;?php
class RelationDql extends Doctrine_Template
{
  protected $_options = array();

  public function __construct($options)
  {
    $this-&gt;_options = $options;
  }

  public function setTableDefinition()
  {
    $this-&gt;_table-&gt;addRecordListener(new RelationDqlListener($this-&gt;_options));
  }
}
</code></pre>
<p>The template is very simple. It only attaches a record listener to
the invoking table. Their is where most of the magic happens. So
now lets define the <code>RelationDqlListener</code> class:</p>
<pre><code class="php">&lt;?php
class RelationDqlListener extends Doctrine_Record_Listener
{
  protected $_options = array('relations' =&gt; array());

  public function __construct($options)
  {
    $this-&gt;_options = $options;
  }

  public function preDqlSelect(Doctrine_Event $event)
  {
    $query = $event-&gt;getQuery();

    if (empty($this-&gt;_options['relations']))
    {
      throw new Doctrine_Exception(
        'You must specify at least one relationship to add DQL to'
      );
    }

    $relations = $this-&gt;_options['relations'];

    $components = $this-&gt;_getDqlCallbackComponents($query);
    foreach ($components as $alias =&gt; $component)
    {
      if (isset($component['relation']) &amp;&amp; isset($relations[$component['relation']-&gt;getAlias()]))
      {
        $dqls = $relations[$component['relation']-&gt;getAlias()];
        foreach ($dqls as $func =&gt; $dql)
        {
          $dql = str_replace('%s', $alias, $dql);
          $query-&gt;$func($dql);
        }
        unset($relations[$component['relation']-&gt;getAlias()]);
      }
    }
  }

  protected function _getDqlCallbackComponents($query)
  {
      $params = $query-&gt;getParams();
      $componentsBefore = array();
      if ($query-&gt;isSubquery()) {
          $componentsBefore = $query-&gt;getQueryComponents();
      }

      $copy = $query-&gt;copy();
      $copy-&gt;getSqlQuery($params);
      $componentsAfter = $copy-&gt;getQueryComponents();

      if ($componentsBefore !== $componentsAfter) {
          return array_diff($componentsAfter, $componentsBefore);
      } else {
          return $componentsAfter;
      }
  }
}
</code></pre>
<p>So now we have the behavior defined so lets look at some example
DQL queries and the SQL that is outputted:</p>
<blockquote><p><strong>TIP</strong> Remember, in order for the dql callbacks to be executed we
must enable an attribute first.</p>
</blockquote>
<pre><code class="php">&lt;?php
    $manager-&gt;setAttribute('use_dql_callbacks', true);

</code></pre>
<pre><code class="php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;select('s.name, p.title, p.created_at')
  -&gt;from('Site s')
  -&gt;leftJoin('s.LatestBlogPosts p');

echo $q-&gt;getSql();
</code></pre>
<p>The above would output the following SQL:</p>

<pre><code class="">[sql]
SELECT s.id AS s__id, s.name AS s__name, b.id AS b__id, b.title AS b__title, b.created_at AS b__created_at FROM site s LEFT JOIN blog_post b ON s.id = b.site_id ORDER BY b.created_at DESC LIMIT 5

**NOTE** Notice how the ``ORDER BY`` and ``LIMIT`` were added to
the query.

</code></pre>
<p>Now lets look at an example that involves the <code>BlogPost</code> tags:</p>
<pre><code class="php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;from('BlogPost p')
  -&gt;leftJoin('p.Tags t');

echo $q-&gt;getSql();
</code></pre>
<p>The above would output the following SQL query:</p>

<pre><code class="">[sql]
SELECT b.id AS b__id, b.title AS b__title, b.body AS b__body, b.site_id AS b__site_id, b.created_at AS b__created_at, b.updated_at AS b__updated_at, t.id AS t__id, t.name AS t__name FROM blog_post b LEFT JOIN blog_post_tag b2 ON b.id = b2.blog_post_id LEFT JOIN tag t ON t.id = b2.tag_id ORDER BY t.name ASC
</code></pre>
<p>As you can see the <code>ORDER BY</code> clause to order the related tags by
<code>name</code> was added for us.</p>
<p>Pretty cool huh? You can use this in your projects to make your
relationships a little nicer.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/01/26/php-5-3-and-doctrine-2-0-teaser">PHP 5.3 and Doctrine 2.0 Teaser</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-01-26
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>We've been really busy around here as you may have noticed.
Doctrine 1.1 is about to be released, we just got some much needed
new documentation, we're going to be offering a printed version of
the documentation soon! Something we haven't talked to much about
is Doctrine 2.0! Roman has been quietly working on the next major
major version of Doctrine, 2.0. This version will be taking a big
leap by requiring PHP 5.3! The progress this new version of PHP is
so great and it lends itself very well to the world of Object
Relational Mappers.</p>
<a id="title.1"></a><h1>Doctrine 2.0 Teaser</h1>
<p>Here is an early teaser of what one of the class meta data drivers
looks like:</p>
<pre><code class="php">&lt;?php
namespace Doctrine\Tests\Models\CMS;

/**
* @DoctrineEntity(tableName=&quot;cms_articles&quot;)
*/
class CmsArticle
{
   /**
    * @DoctrineId
    * @DoctrineColumn(type=&quot;integer&quot;)
    * @DoctrineIdGenerator(&quot;auto&quot;)
    */
   public $id;

   /**
    * @DoctrineColumn(type=&quot;varchar&quot;, length=255)
    */
   public $topic;

   /**
    * @DoctrineColumn(type=&quot;varchar&quot;)
    */
   public $text;

   /**
    * @DoctrineManyToOne(targetEntity=&quot;Doctrine\Tests\Models\CMS\CmsUser&quot;,
           joinColumns={&quot;user_id&quot; = &quot;id&quot;})
    */
   public $user;

   /**
    * @DoctrineOneToMany(targetEntity=&quot;Doctrine\Tests\Models\CMS\CmsComment&quot;, mappedBy=&quot;article&quot;)
    */
   public $comments;
}

**NOTE**

Notice these few things:

1.) We define the class meta data for the model in the doc block.
This is just one way you will be able to define class meta data.
YAML schema syntax will be possible as well.

2.) The ``CmsArticle`` class is not extending anything! Thats right
in Doctrine 2.0 your domain model won't be imposed on one bit!

3.) The properties on the class are not required to be public, they
can of course be private or protected. Doctrine will not require
you to have a getter and setter methods for every property. It is
totally up to how the user wants to design the class.

</code></pre>
<p>Doctrine 2.0 is being built around the concept of a UnitOfWork that
keeps track of your objects during a script execution. You just
work with your objects normally and when you commit a UnitOfWork,
Doctrine takes care of synchronizing your mapped objects with the
database, taking care of referential integrity etc. The boundaries
of a UnitOfWork can be defined by the user, typically, however, one
script execution requires only one UnitOfWork. In Doctrine 2.0 we
really try to keep Doctrine out of your domain objects as much as
possible, yet providing you with all the features you need.</p>
<hr />
<a id="title.2"></a><h1>PHP 5.3 Benchmarks</h1>
<p>While I have been playing with Doctrine 2.0 I did some simple
benchmarks against the Doctrine 1.0 version test suite to see what
kind of performance improvements were made. I was pretty
impressed!</p>
<p>These tests are not the best obviously but it does clearly show
that when you run the Doctrine tests under PHP 5.3, it is faster
and uses less memory.</p>
<a id="title.2.1"></a><h2>PHP 5.2.8</h2>
<blockquote><p># \ Memory --- \ ----------------- 1 \ 129170.648438 KB 2 \ 129164.078125 KB 3 \
129176.851562 KB</p>
</blockquote>
<a id="title.2.2"></a><h2>PHP 5.3.0alpha4-dev</h2>
<blockquote><p># \ Memory --- \ ----------------- 1 \ 89858.7421875 KB 2 \ 89864.59765625 KB 3 \
89867.89453125 KB</p>
</blockquote>
<p>The Doctrine test suite uses <strong>31%</strong> less memory and is <strong>17%</strong>
faster when running under PHP 5.3!</p>

        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://new.doctrine-project.org/blog/page/70.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://new.doctrine-project.org/blog/page/72.html">Older Posts</a></li>        </ul>
    </nav>
                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
