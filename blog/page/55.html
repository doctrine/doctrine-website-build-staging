<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?3625e4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/lexer/">Lexer</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://staging.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
                        <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2009/11/23/new-doctrine-core-team-member.html">New Doctrine Core Team Member</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-11-23
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            Today I am very excited to announce to you all that we have
officially invited Benjamin Eberlei, also known as beberlei in IRC,
to join the core Doctrine team. He has steadily contributed to
Doctrine 2 and has been very helpful. We are confident that he will
be a great new addition to the team.

Benjamin is a contributor to the Zend Framework as well so he will
be responsible for leading the integration between the projects.
You can read a little more about Benjamin on his
`about page <http://www.doctrine-project.org/contributor/beberlei>`_.
        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2009/11/23/doctrine-1-2-0-rc1-released.html">Doctrine 1.2.0-RC1 Released</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-11-23
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            Today the first release candidate for the 1.2 version of Doctrine
is available for
`download <http://www.doctrine-project.org/download#1_2>`_. We
addressed around 20 or so issues in
`Jira <http://www.doctrine-project.org/jira>`_ for this release and
we hope to have a stable release by the end of November. Please
test this latest release and report any issues you discover in
`Jira <http://www.doctrine-project.org/jira>`_.

View the full
`change log <http://www.doctrine-project.org/change_log/1_2_0_RC1>`_
for this release and
`download RC1 <http://www.doctrine-project.org/download#1_2>`_
now!
        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://staging.doctrine-project.org/2009/11/18/php-benchmarking-mythbusters.html">PHP Benchmarking Mythbusters</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-11-18
                            by
                                    romanb
                                    </p>

        <hr />

        <div>
            First of, this blog post sucks. I thought I would never write such
a senseless apples and oranges comparison with artificial and
meaningless benchmarks, but I was just a bit astonished by the
results that I would like to share.

I use object-relational mapping tools in many different languages,
from Java to C# to PHP. One of the many supposedly lightweight
alternatives in PHP to Doctrine is Outlet. After stumbling upon
this comment on a
`stackoverflow.com post <http://stackoverflow.com/questions/185358/simple-php-orm>`_:
**"Gotta second Outlet. Doctrine is comically bloated - it is WAY too big to be a sensible choice for anything but the lightest of server loads."**
I thought I take a look at Outlet. This ORM seems to consist of
only 9 classes! It can't get any more lightweight right? I assumed
it would blow Doctrine out of the water performance-wise in all
situations.

So I downloaded Outlet 0.7 and created a simple test database with
just 1 table. Then I wrote a small script that bootstraps Outlet,
inserts 500 objects into the database and reads them out afterwards
(Yes, it's stupid, just like most other artificial benchmarks).

Environment is PHP 5.3.0 with APC.

.. code-block:: php

    <?php
        echo PHP_EOL . (memory_get_usage() / 1024) . ' KB ' . PHP_EOL;
    
    include 'config.php';
    
    set_include_path(get_include_path() . PATH_SEPARATOR . __DIR__ . '/outlet');
    
    require 'Outlet.php';
    
    ini_set('error_reporting', E_ALL);
    
    class Bug
    {
        public $ID;
        public $Title;
        public $Description;
    }
    
    $config = array(
      'connection' => array(
        'dsn'      => 'mysql:host=localhost;dbname=outletbenchmark',
        'username' => $mysqlUsername,
        'password' => $mysqlPassword,
        'dialect' => 'mysql'
      ),
      'classes' => array(
        'Bug' => array(
          'table' => 'bugs',
          'props' => array(
            'ID'        => array('ID', 'int', array('pk' => true, 'autoIncrement' => true)),
            'Title'     => array('Title', 'varchar'),
            'Description' => array('Description', 'varchar')
          )
        )
      )
    );
    Outlet::init($config);
    $outlet = Outlet::getInstance();
    $outlet->createProxies();
    
    $s = microtime(true);
    $outlet->getConnection()->beginTransaction();
    for ($i = 0; $i < 500; ++$i) {
        $bug = new Bug;
        $bug->Title = 'This is a test bug';
        $bug->Description = 'Hey there!';
    
        $outlet->save($bug);
    }
    $outlet->getConnection()->commit();
    
    $e = microtime(true);
    echo "\nInsert:" . ($e - $s) . "\n";
    
    $outlet->clearCache();
    
    $s = microtime(true);
    $bugs = $outlet->select('Bug');
    $e = microtime(true);
    
    $outlet->clearCache();
    
    echo "\nQuery:" . ($e - $s) . "\n";
    
    echo "\n" . (memory_get_usage() / 1024) . ' KB ' . PHP_EOL;

    **CAUTION** First off, ini\_set('error\_reporting', E\_ALL); was
    necessary to silence the following E\_STRICT warnings coming from
    Outlet:

    ::

        Strict Standards: Non-static method OutletMapper::get() should not be called statically,
        assuming $this from incompatible context in /Users/robo/dev/php/outlet/outlet-0.7/classes
        /outlet/Outlet.php on line 184
        
        Strict Standards: Only variables should be passed by reference in /Users/robo/dev
        /php/outlet/outlet-0.7/classes/outlet/OutletMapper.php on line 546

    Does not really look good (and does not speak for Outlet very
    well), but anyway.


I did the same for Doctrine 2.0,
*without setting up a metadata or query cache*.

.. code-block:: php

    <?php
    echo PHP_EOL . (memory_get_usage() / 1024) . ' KB ' . PHP_EOL;
    
    include 'config.php';
    
    require 'doctrine/Doctrine/Common/IsolatedClassLoader.php';
    
    /**
     * @Entity
     * @Table(name="bugs")
     */
    class Bug
    {
        /** @Id @Column(type="integer") @GeneratedValue(strategy="AUTO") */
        public $ID;
        /** @Column(type="string") */
        public $Title;
        /** @Column(type="string") */
        public $Description;
    }
    
    $classLoader = new \Doctrine\Common\IsolatedClassLoader('Doctrine');
    $classLoader->setBasePath(__DIR__ . '/doctrine');
    $classLoader->register();
    
    $config = new \Doctrine\ORM\Configuration;
    
    $config->setProxyDir(__DIR__ . '/Proxies');
    $config->setProxyNamespace('Proxies');
    $connectionOptions = array(
        'driver' => 'pdo_mysql',
        'user' => $mysqlUsername,
        'password' => $mysqlPassword,
        'host' => 'localhost',
        'dbname' => 'doctrine2benchmark'
    );
    
    $em = \Doctrine\ORM\EntityManager::create($connectionOptions, $config);
    
    $s = microtime(true);
    for ($i = 0; $i < 500; ++$i) {
        $bug = new Bug;
        $bug->Title = 'BBug';
        $bug->Description = 'Hello there!';
    
        $em->persist($bug);
    }
    $em->flush();
    
    $e = microtime(true);
    echo "\nInsert:" . ($e - $s) . "\n";
    
    $em->clear();
    
    $s = microtime(true);
    $bugs = $em->getRepository('Bug')->findAll();
    $e = microtime(true);
    
    $em->clear();
    
    echo "\nQuery:" . ($e - $s) . "\n";
    
    echo "\n" . (memory_get_usage() / 1024) . ' KB ' . PHP_EOL;

Here are my results.

1st Run
~~~~~~~

\| Measurement \| \| Outlet \| \| Doctrine \| \| ------------ \| \|
----------------- \| \| ------------------- \| \| Insert Time \| \|
0.23142600059509 \| \| 0.11601996421814 \| \| Query Time \| \|
0.070523977279663 \| \| 0.025638818740845 \| \| Used Memory \| \|
644.5546875 KB \| \| 1061.83203125 KB \|

No, I did not swap the numbers, I promise. You see that the D2
version uses about 400KB more memory but the result of the timings
are quite surprising. Being curious I ran both scripts several
times which means the query section has to hydrate 500 objects more
for each run.

2nd Run
~~~~~~~

**1st refresh (1000 objects)**

\| Measurement \| \| Outlet \| \| Doctrine \| \| ------------ \| \|
----------------- \| \| ------------------- \| \| Insert Time \| \|
0.26595592498779 \| \| 0.11661005020142 \| \| Query Time \| \|
0.14437794685364 \| \| 0.052286863327026 \| \| Used Memory \| \|
875.0703125 KB \| \| 1313.15625 KB \|

3rd Run
~~~~~~~

**2nd refresh (1500 objects)**

\| Measurement \| \| Outlet \| \| Doctrine \| \| ------------ \| \|
----------------- \| \| ------------------- \| \| Insert Time \| \|
0.2314441204071 \| \| 0.11621117591858 \| \| Query Time \| \|
0.21359491348267 \| \| 0.079329013824463 \| \| Used Memory \| \|
1139.5859375 KB \| \| 1541.59375 KB \|

Did you expect these results? After all Doctrine is so bloated,
right? (Doctrine 2 full package ~250 classes) and Outlet is so
lightweight (~9 classes)?

Bottom line:


-  The number of classes barely means anything. (Its probably a
   good criterion if you're short on disk space).
-  "Lightweight" is a buzzword and meaningless without a reference
   point.
-  Don't judge a library by its size and certainly dont try to draw
   conclusions from the size to the performance, or worse to the
   scalability. It just doesnt work.
-  *Artificial benchmarks suck.*
-  To all the folks hunting for everything lightweight and
   micro-benchmarking all day long: You're wasting your time (Just
   like I did with this stupid benchmark...).
-  Don't trust artificial benchmarks (Not even this one).

PS: This is no post against Outlet, so if any Outlet guys or fans
are reading this, please don't feel offended. Since I dont know
Outlet well I'm sure I did a lot of things wrong but thats really
not important here. I am just making a stance against all the
ridiculously stupid artificial benchmarks out there that try to
make people believe Doctrine is slow and bloated. This post shows I
can make it look the other way around easily. That just shows how
meaningless these comparisons are.

    **NOTE** All the code used to run these benchmarks can be
    downloaded from
    `here <http://www.doctrine-project.org/downloads/doctrine2outletbenchmark.zip>`_.
    It is a zip archive containing all the code you need to run the
    benchmarks yourself.
        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/54.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://staging.doctrine-project.org/blog/page/56.html">Older Posts</a></li>        </ul>
    </nav>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?f32c09"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?36322d"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

        
        
        
            </body>
</html>
