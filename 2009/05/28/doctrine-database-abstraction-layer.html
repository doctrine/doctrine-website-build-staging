<!DOCTYPE html>
<html>
    <head>
        <title>Doctrine Database Abstraction Layer - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="noindex">
        
            <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://staging.doctrine-project.org/2009/05/28/doctrine-database-abstraction-layer.html"
        },
        "headline": "Doctrine Database Abstraction Layer",
        "image": [
            "https://staging.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2009-05-28T00:00:00+00:00",
        "dateModified": "2009-05-28T00:00:00+00:00",
        "author": {
            "@type": "Person",
            "name": "jwage"
        },
         "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://staging.doctrine-project.org/images/og.png"
            }
        },
        "description": "One of the greatest advantages to using Doctrine is what is under the
hood that powers it. That is t"
    }
    </script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://staging.doctrine-project.org/css/style.css?a0d80f" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://staging.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://staging.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://staging.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://staging.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://staging.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://staging.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://staging.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://staging.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://staging.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://staging.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://staging.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://staging.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://staging.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://staging.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://staging.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://staging.doctrine-project.org/2009/05/28/doctrine-database-abstraction-layer.html" />
        <meta property="og:title" content="Doctrine Database Abstraction Layer - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://staging.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://staging.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://staging.doctrine-project.org",
            "logo": "https://staging.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://staging.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://staging.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://staging.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://staging.doctrine-project.org/"><img src="https://staging.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://staging.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://staging.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://staging.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://staging.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://staging.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://staging.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://staging.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
            <article>
        <header>
            <h2>Doctrine Database Abstraction Layer <small>post</small></h2>
        </header>

        <p class="lead">
            Posted on 2009-05-28
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>One of the greatest advantages to using Doctrine is what is under the
hood that powers it. That is the database abstraction layer. This
powerful layer is based off of a lot of different code from various
popular PHP projects such as PEAR MDB2 and Zend&#95;Db. It provides you a
nice intuitive interface for retrieving information about your database
schema as well as issuing DDL statements to change it.</p>

<h1 id="public-method-index">Public Method Index</h1>

<p>The database abstraction layer features the following methods in 1.x and
some new methods added in 2.0.</p>

<h2 id="1.x-methods">1.x Methods</h2>

<ul>
<li>listDatabases()</li>
<li>listFunctions()</li>
<li>listTriggers()</li>
<li>listSequences()</li>
<li>listTableConstraints()</li>
<li>listTableColumns()</li>
<li>listTableIndexes()</li>
<li>listTables()</li>
<li>listUsers()</li>
<li>listViews()</li>
<li>dropDatabase()</li>
<li>dropTable()</li>
<li>dropIndex()</li>
<li>dropConstraint()</li>
<li>dropForeignKey()</li>
<li>dropSequence()</li>
<li>createDatabase()</li>
<li>createTable()</li>
<li>createSequence()</li>
<li>createConstraint()</li>
<li>createIndex()</li>
<li>createForeignKey()</li>
<li>alterTable()</li>
</ul>

<h2 id="new-methods-in-2.0">New Methods in 2.0</h2>

<ul>
<li>renameTable()</li>
<li>addTableColumn()</li>
<li>removeTableColumn()</li>
<li>changeTableColumn()</li>
<li>renameTableColumn()</li>
<li>dropView()</li>
<li>createView()</li>
</ul>

<h1 id="some-2.0-examples">Some 2.0 Examples</h1>

<p>Here are some code examples using the Doctrine 2.0 Database Abstraction
Layer. We'll show you how you can execute these examples yourself by
checking out Doctrine 2.0 from SVN and setting up a PHP script to test
with.</p>

<blockquote>
  <p><strong>TIP</strong> The database abstraction layer can be used standalone so if
  you just want a nice standard layer for communicating with your
  database then Doctrine works for you too.</p>
</blockquote>

<h2 id="checkout-doctrine">Checkout Doctrine</h2>

<pre><code>$ svn co http://svn.doctrine-project.org/trunk doctrine2
$ cd doctrine2
</code></pre>

<h2 id="create-test-script">Create Test Script</h2>

<p>Create a new PHP script anywhere on your server and name it <code>test.php</code>.
Now lets initialize Doctrine so we can work with it. First we need to
set our <code>ClassLoader</code>.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

require 'lib/Doctrine/Common/ClassLoader.php';

$classLoader = new \Doctrine\Common\ClassLoader();
$classLoader-&gt;setBasePath('Doctrine', __DIR__ . '/lib');
</code></pre>

<h2 id="create-connection">Create Connection</h2>

<p>Now we need to create our <code>Connection</code> instance.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$connectionOptions = array(
    'driver' =&gt; 'pdo_mysql',
    'dbname' =&gt; 'mysql',
    'user' =&gt; 'root',
    'password' =&gt; ''
);
$driver = new \Doctrine\DBAL\Driver\PDOMySql\Driver;
$conn = new \Doctrine\DBAL\Connection($connectionOptions, $driver);

**NOTE** Notice how we are temporarily connecting to the special
database for MySQL named ``mysql``. We'll use this database to
connect to so we can create our test database.
</code></pre>

<p>Now we can simply retrieve the <code>SchemaManager</code> instance from the
<code>Connection</code> driver and begin to execute some of the methods we listed
above.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$sm = $conn-&gt;getSchemaManager();
</code></pre>

<p>The first thing we could do is create the database by calling the
<code>createDatabase()</code> method on the <code>$sm</code> instance.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$sm-&gt;createDatabase('doctrine2test');
</code></pre>

<p>Now that we have the database created, change your <code>$connectionOptions</code>
key <code>dbname</code> to specify <code>doctrine2test</code> so that we connect to the new
database that we just created.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$connectionOptions = array(
    'driver' =&gt; 'pdo_mysql',
    'dbname' =&gt; 'doctrine2test',
    'user' =&gt; 'root',
    'password' =&gt; ''
);

// ...
</code></pre>

<p>Now we can begin adding things to the new database. For example we could
issue a command to create a new table.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$columns = array(
    'id' =&gt; array(
        'type' =&gt; \Doctrine\DBAL\Type::getType('integer'),
        'autoincrement' =&gt; true,
        'primary' =&gt; true,
        'notnull' =&gt; true
    ),
    'test' =&gt; array(
        'type' =&gt;  \Doctrine\DBAL\Type::getType('string'),
        'length' =&gt; 255
    )
);

$options = array();

$sm-&gt;createTable('new_table', $columns, $options);
</code></pre>

<p>Then after creating the table I can later add a new column to it.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$column = array(
    'type' =&gt;  \Doctrine\DBAL\Type::getType('string'),
    'length' =&gt; 255
);

$sm-&gt;addTableColumn('new_table', 'new_column', $column);
</code></pre>

<p>Or I could even drop the table completely.</p>

<pre><code class="sourceCode php">&lt;?php
// test.php

// ...

$sm-&gt;dropTable('new_table');

**NOTE** Not all of the above listed methods are supported by every
single DBMS. If your DBMS does not support the functionality then
Doctrine will throw exceptions accordingly.
</code></pre>

<p>All the above example are very simple schema changes but Doctrine is
capable of manipulating very complex schemas from a standardized
programmatic interface. The Doctrine Migrations extension makes use of
this layer heavily to do all the operations for changing your database
schemas.</p>

        </div>

                    <nav class="article">
                <ul class="pagination">
                                            <li class="page-item"><a class="page-link previous" href="https://staging.doctrine-project.org/2009/05/27/want-to-contribute-to-doctrine.html" title="Want to contribute to Doctrine?"><span class="title">Previous: Want to contribute to Doctrine?</span></a></li>
                                                                <li class="page-item"><a class="page-link next" href="https://staging.doctrine-project.org/2009/05/29/doctrine-lazy-loading.html" title="Doctrine Lazy Loading"><span class="title">Next: Doctrine Lazy Loading</span></a></li>
                                    </ul>
            </nav>
            </article>



    </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://staging.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://staging.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://staging.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                console.log(eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
        
        
            </body>
</html>
